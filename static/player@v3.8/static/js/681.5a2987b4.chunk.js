"use strict";(self.webpackChunkttsreader_player=self.webpackChunkttsreader_player||[]).push([[681],{5681:function(e,t,i){function n(e){return n=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},n(e)}function r(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=n(e)););return e}function a(){return a="undefined"!==typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,i){var n=r(e,t);if(n){var a=Object.getOwnPropertyDescriptor(n,t);return a.get?a.get.call(arguments.length<3?e:i):a.value}},a.apply(this,arguments)}i.r(t),i.d(t,{AbortException:function(){return Ie},AnnotationEditorLayer:function(){return $y},AnnotationEditorParamsType:function(){return Y},AnnotationEditorType:function(){return X},AnnotationEditorUIManager:function(){return xn},AnnotationLayer:function(){return xd},AnnotationMode:function(){return W},AnnotationType:function(){return re},ColorPicker:function(){return xf},DOMSVGFactory:function(){return jh},DrawLayer:function(){return vm},FeatureTest:function(){return je},GlobalWorkerOptions:function(){return gl},ImageKind:function(){return ne},InvalidPDFException:function(){return Te},MathClamp:function(){return Xe},OPS:function(){return ce},OutputScale:function(){return yt},PDFDataRangeTransport:function(){return Yu},PDFDateString:function(){return ct},PDFWorker:function(){return vh},PasswordResponses:function(){return ge},PermissionFlag:function(){return K},PixelsPerInch:function(){return Qe},RenderingCancelledException:function(){return tt},ResponseException:function(){return Re},SignatureExtractor:function(){return Yg},SupportedImageMimeTypes:function(){return mt},TextLayer:function(){return Lu},TouchManager:function(){return Er},Util:function(){return He},VerbosityLevel:function(){return he},XfaLayer:function(){return Fh},build:function(){return Rh},createValidAbsoluteUrl:function(){return Pe},fetchData:function(){return Je},getDocument:function(){return Hu},getFilenameFromUrl:function(){return rt},getPdfFilenameFromUrl:function(){return at},getUuid:function(){return We},getXfaPageViewport:function(){return dt},isDataScheme:function(){return it},isPdfFile:function(){return nt},isValidExplicitDest:function(){return ss},noContextMenu:function(){return lt},normalizeUnicode:function(){return Ve},setLayerDimensions:function(){return gt},shadow:function(){return Ee},stopEvent:function(){return ut},updateUrlHash:function(){return Se},version:function(){return Th}});var s=i(4942);function o(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var l=i(1413),u=i(3433),h=i(4165),c=i(9439),d=i(5861),v=i(7762),f=i(3878),p=i(9199),g=i(181),y=i(5267);function m(e){return(0,f.Z)(e)||(0,p.Z)(e)||(0,g.Z)(e)||(0,y.Z)()}function b(e,t){if(!Object.prototype.hasOwnProperty.call(e,t))throw new TypeError("attempted to use private field on non-instance");return e}var w=0;function k(e){return"__private_"+w+++"_"+e}var A=i(3144),_=i(5671);function x(e,t){return x=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},x(e,t)}function P(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&x(e,t)}var S,E,C,O,M=i(1002);function T(e,t){if(t&&("object"===(0,M.Z)(t)||"function"===typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return o(e)}function R(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,r=n(e);if(t){var a=n(this).constructor;i=Reflect.construct(r,arguments,a)}else i=r.apply(this,arguments);return T(this,i)}}function Z(e){var t,i,n,r=2;for("undefined"!=typeof Symbol&&(i=Symbol.asyncIterator,n=Symbol.iterator);r--;){if(i&&null!=(t=e[i]))return t.call(e);if(n&&null!=(t=e[n]))return new I(t.call(e));i="@@asyncIterator",n="@@iterator"}throw new TypeError("Object is not async iterable")}function I(e){function t(e){if(Object(e)!==e)return Promise.reject(new TypeError(e+" is not an object."));var t=e.done;return Promise.resolve(e.value).then((function(e){return{value:e,done:t}}))}return I=function(e){this.s=e,this.n=e.next},I.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var i=this.s.return;return void 0===i?Promise.resolve({value:e,done:!0}):t(i.apply(this.s,arguments))},throw:function(e){var i=this.s.return;return void 0===i?Promise.reject(e):t(i.apply(this.s,arguments))}},new I(e)}var D="object"===typeof process&&process+""==="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&"browser"!==process.type),L=[.001,0,0,.001,0,0],j=1.35,F=1,N=2,B=4,H=16,z=32,G=64,U=128,V=256,W={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3},q="pdfjs_internal_editor_",X={DISABLE:-1,NONE:0,FREETEXT:3,HIGHLIGHT:9,STAMP:13,INK:15,SIGNATURE:101},Y={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23,HIGHLIGHT_COLOR:31,HIGHLIGHT_DEFAULT_COLOR:32,HIGHLIGHT_THICKNESS:33,HIGHLIGHT_FREE:34,HIGHLIGHT_SHOW_ALL:35,DRAW_STEP:41},K={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048},Q=0,J=1,$=2,ee=3,te=3,ie=4,ne={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3},re={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26},ae=1,se=2,oe=3,le=4,ue=5,he={ERRORS:0,WARNINGS:1,INFOS:5},ce={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91,setStrokeTransparent:92,setFillTransparent:93,rawFillPath:94},de=0,ve=1,fe=2,pe=3,ge={NEED_PASSWORD:1,INCORRECT_PASSWORD:2},ye=he.WARNINGS;function me(e){Number.isInteger(e)&&(ye=e)}function be(){return ye}function we(e){ye>=he.INFOS&&console.log("Info: ".concat(e))}function ke(e){ye>=he.WARNINGS&&console.log("Warning: ".concat(e))}function Ae(e){throw new Error(e)}function _e(e,t){e||Ae(t)}function xe(e){switch(null===e||void 0===e?void 0:e.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function Pe(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!e)return null;if(i&&"string"===typeof e){if(i.addDefaultProtocol&&e.startsWith("www.")){var n=e.match(/\./g);(null===n||void 0===n?void 0:n.length)>=2&&(e="http://".concat(e))}if(i.tryConvertEncoding)try{e=ze(e)}catch(a){}}var r=t?URL.parse(e,t):URL.parse(e);return xe(r)?r:null}function Se(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=URL.parse(e);return n?(n.hash=t,n.href):i&&Pe(e,"http://example.com")?e.split("#",1)[0]+"".concat(t?"#".concat(t):""):""}function Ee(e,t,i){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return Object.defineProperty(e,t,{value:i,enumerable:!n,configurable:!0,writable:!1}),i}var Ce=function(){function e(e,t){this.message=e,this.name=t}return e.prototype=new Error,e.constructor=e,e}(),Oe=function(e){P(i,e);var t=R(i);function i(e,n){var r;return(0,_.Z)(this,i),(r=t.call(this,e,"PasswordException")).code=n,r}return(0,A.Z)(i)}(Ce),Me=function(e){P(i,e);var t=R(i);function i(e,n){var r;return(0,_.Z)(this,i),(r=t.call(this,e,"UnknownErrorException")).details=n,r}return(0,A.Z)(i)}(Ce),Te=function(e){P(i,e);var t=R(i);function i(e){return(0,_.Z)(this,i),t.call(this,e,"InvalidPDFException")}return(0,A.Z)(i)}(Ce),Re=function(e){P(i,e);var t=R(i);function i(e,n,r){var a;return(0,_.Z)(this,i),(a=t.call(this,e,"ResponseException")).status=n,a.missing=r,a}return(0,A.Z)(i)}(Ce),Ze=function(e){P(i,e);var t=R(i);function i(e){return(0,_.Z)(this,i),t.call(this,e,"FormatError")}return(0,A.Z)(i)}(Ce),Ie=function(e){P(i,e);var t=R(i);function i(e){return(0,_.Z)(this,i),t.call(this,e,"AbortException")}return(0,A.Z)(i)}(Ce);function De(e){"object"===typeof e&&void 0!==(null===e||void 0===e?void 0:e.length)||Ae("Invalid argument for bytesToString");var t=e.length,i=8192;if(t<i)return String.fromCharCode.apply(null,e);for(var n=[],r=0;r<t;r+=i){var a=Math.min(r+i,t),s=e.subarray(r,a);n.push(String.fromCharCode.apply(null,s))}return n.join("")}function Le(e){"string"!==typeof e&&Ae("Invalid argument for stringToBytes");for(var t=e.length,i=new Uint8Array(t),n=0;n<t;++n)i[n]=255&e.charCodeAt(n);return i}var je=function(){function e(){(0,_.Z)(this,e)}return(0,A.Z)(e,null,[{key:"isLittleEndian",get:function(){return Ee(this,"isLittleEndian",function(){var e=new Uint8Array(4);return e[0]=1,1===new Uint32Array(e.buffer,0,1)[0]}())}},{key:"isEvalSupported",get:function(){return Ee(this,"isEvalSupported",function(){try{return new Function(""),!0}catch(e){return!1}}())}},{key:"isOffscreenCanvasSupported",get:function(){return Ee(this,"isOffscreenCanvasSupported","undefined"!==typeof OffscreenCanvas)}},{key:"isImageDecoderSupported",get:function(){return Ee(this,"isImageDecoderSupported","undefined"!==typeof ImageDecoder)}},{key:"platform",get:function(){var e=navigator,t=e.platform,i=e.userAgent;return Ee(this,"platform",{isAndroid:i.includes("Android"),isLinux:t.includes("Linux"),isMac:t.includes("Mac"),isWindows:t.includes("Win"),isFirefox:i.includes("Firefox")})}},{key:"isCSSRoundSupported",get:function(){var e,t;return Ee(this,"isCSSRoundSupported",null===(e=globalThis.CSS)||void 0===e||null===(t=e.supports)||void 0===t?void 0:t.call(e,"width: round(1.5px, 1px)"))}}]),e}(),Fe=Array.from(Array(256).keys(),(function(e){return e.toString(16).padStart(2,"0")})),Ne=k("getExtremumOnCurve"),Be=k("getExtremum"),He=function(){function e(){(0,_.Z)(this,e)}return(0,A.Z)(e,null,[{key:"makeHexColor",value:function(e,t,i){return"#".concat(Fe[e]).concat(Fe[t]).concat(Fe[i])}},{key:"scaleMinMax",value:function(e,t){var i;e[0]?(e[0]<0&&(i=t[0],t[0]=t[2],t[2]=i),t[0]*=e[0],t[2]*=e[0],e[3]<0&&(i=t[1],t[1]=t[3],t[3]=i),t[1]*=e[3],t[3]*=e[3]):(i=t[0],t[0]=t[1],t[1]=i,i=t[2],t[2]=t[3],t[3]=i,e[1]<0&&(i=t[1],t[1]=t[3],t[3]=i),t[1]*=e[1],t[3]*=e[1],e[2]<0&&(i=t[0],t[0]=t[2],t[2]=i),t[0]*=e[2],t[2]*=e[2]),t[0]+=e[4],t[1]+=e[5],t[2]+=e[4],t[3]+=e[5]}},{key:"transform",value:function(e,t){return[e[0]*t[0]+e[2]*t[1],e[1]*t[0]+e[3]*t[1],e[0]*t[2]+e[2]*t[3],e[1]*t[2]+e[3]*t[3],e[0]*t[4]+e[2]*t[5]+e[4],e[1]*t[4]+e[3]*t[5]+e[5]]}},{key:"applyTransform",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=e[i],r=e[i+1];e[i]=n*t[0]+r*t[2]+t[4],e[i+1]=n*t[1]+r*t[3]+t[5]}},{key:"applyTransformToBezier",value:function(e,t){for(var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=t[0],r=t[1],a=t[2],s=t[3],o=t[4],l=t[5],u=0;u<6;u+=2){var h=e[i+u],c=e[i+u+1];e[i+u]=h*n+c*a+o,e[i+u+1]=h*r+c*s+l}}},{key:"applyInverseTransform",value:function(e,t){var i=e[0],n=e[1],r=t[0]*t[3]-t[1]*t[2];e[0]=(i*t[3]-n*t[2]+t[2]*t[5]-t[4]*t[3])/r,e[1]=(-i*t[1]+n*t[0]+t[4]*t[1]-t[5]*t[0])/r}},{key:"axialAlignedBoundingBox",value:function(e,t,i){var n=t[0],r=t[1],a=t[2],s=t[3],o=t[4],l=t[5],u=e[0],h=e[1],c=e[2],d=e[3],v=n*u+o,f=v,p=n*c+o,g=p,y=s*h+l,m=y,b=s*d+l,w=b;if(0!==r||0!==a){var k=r*u,A=r*c,_=a*h,x=a*d;v+=_,g+=_,p+=x,f+=x,y+=k,w+=k,b+=A,m+=A}i[0]=Math.min(i[0],v,p,f,g),i[1]=Math.min(i[1],y,b,m,w),i[2]=Math.max(i[2],v,p,f,g),i[3]=Math.max(i[3],y,b,m,w)}},{key:"inverseTransform",value:function(e){var t=e[0]*e[3]-e[1]*e[2];return[e[3]/t,-e[1]/t,-e[2]/t,e[0]/t,(e[2]*e[5]-e[4]*e[3])/t,(e[4]*e[1]-e[5]*e[0])/t]}},{key:"singularValueDecompose2dScale",value:function(e,t){var i=e[0],n=e[1],r=e[2],a=e[3],s=Math.pow(i,2)+Math.pow(n,2),o=i*r+n*a,l=Math.pow(r,2)+Math.pow(a,2),u=(s+l)/2,h=Math.sqrt(Math.pow(u,2)-(s*l-Math.pow(o,2)));t[0]=Math.sqrt(u+h||1),t[1]=Math.sqrt(u-h||1)}},{key:"normalizeRect",value:function(e){var t=e.slice(0);return e[0]>e[2]&&(t[0]=e[2],t[2]=e[0]),e[1]>e[3]&&(t[1]=e[3],t[3]=e[1]),t}},{key:"intersect",value:function(e,t){var i=Math.max(Math.min(e[0],e[2]),Math.min(t[0],t[2])),n=Math.min(Math.max(e[0],e[2]),Math.max(t[0],t[2]));if(i>n)return null;var r=Math.max(Math.min(e[1],e[3]),Math.min(t[1],t[3])),a=Math.min(Math.max(e[1],e[3]),Math.max(t[1],t[3]));return r>a?null:[i,r,n,a]}},{key:"pointBoundingBox",value:function(e,t,i){i[0]=Math.min(i[0],e),i[1]=Math.min(i[1],t),i[2]=Math.max(i[2],e),i[3]=Math.max(i[3],t)}},{key:"rectBoundingBox",value:function(e,t,i,n,r){r[0]=Math.min(r[0],e,i),r[1]=Math.min(r[1],t,n),r[2]=Math.max(r[2],e,i),r[3]=Math.max(r[3],t,n)}},{key:"bezierBoundingBox",value:function(e,t,i,n,r,a,s,o,l){l[0]=Math.min(l[0],e,s),l[1]=Math.min(l[1],t,o),l[2]=Math.max(l[2],e,s),l[3]=Math.max(l[3],t,o),b(this,Be)[Be](e,i,r,s,t,n,a,o,3*(3*(i-r)-e+s),6*(e-2*i+r),3*(i-e),l),b(this,Be)[Be](e,i,r,s,t,n,a,o,3*(3*(n-a)-t+o),6*(t-2*n+a),3*(n-t),l)}}]),e}();Object.defineProperty(He,Be,{value:function(e,t,i,n,r,a,s,o,l,u,h,c){if(Math.abs(l)<1e-12)Math.abs(u)>=1e-12&&b(this,Ne)[Ne](e,t,i,n,r,a,s,o,-h/u,c);else{var d=Math.pow(u,2)-4*h*l;if(!(d<0)){var v=Math.sqrt(d),f=2*l;b(this,Ne)[Ne](e,t,i,n,r,a,s,o,(-u+v)/f,c),b(this,Ne)[Ne](e,t,i,n,r,a,s,o,(-u-v)/f,c)}}}}),Object.defineProperty(He,Ne,{value:function(e,t,i,n,r,a,s,o,l,u){if(!(l<=0||l>=1)){var h=1-l,c=l*l,d=c*l,v=h*(h*(h*e+3*l*t)+3*c*i)+d*n,f=h*(h*(h*r+3*l*a)+3*c*s)+d*o;u[0]=Math.min(u[0],v),u[1]=Math.min(u[1],f),u[2]=Math.max(u[2],v),u[3]=Math.max(u[3],f)}}});function ze(e){return decodeURIComponent(escape(e))}var Ge=null,Ue=null;function Ve(e){return Ge||(Ge=/([\xA0\xB5\u037E\u0EB3\u2000-\u200A\u202F\u2126\uFB00-\uFB04\uFB06\uFB20-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBA1\uFBA4-\uFBA9\uFBAE-\uFBB1\uFBD3-\uFBDC\uFBDE-\uFBE7\uFBEA-\uFBF8\uFBFC\uFBFD\uFC00-\uFC5D\uFC64-\uFCF1\uFCF5-\uFD3D\uFD88\uFDF4\uFDFA\uFDFB\uFE71\uFE77\uFE79\uFE7B\uFE7D]+)|(\uFB05+)/g,Ue=new Map([["\ufb05","\u017ft"]])),e.replaceAll(Ge,(function(e,t,i){return t?t.normalize("NFKC"):Ue.get(i)}))}function We(){if("function"===typeof crypto.randomUUID)return crypto.randomUUID();var e=new Uint8Array(32);return crypto.getRandomValues(e),De(e)}var qe="pdfjs_internal_id_";function Xe(e,t,i){return Math.min(Math.max(e,t),i)}function Ye(e){return Uint8Array.prototype.toBase64?e.toBase64():btoa(De(e))}"function"!==typeof Promise.try&&(Promise.try=function(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),n=1;n<t;n++)i[n-1]=arguments[n];return new Promise((function(t){t(e.apply(void 0,i))}))}),"function"!==typeof Math.sumPrecise&&(Math.sumPrecise=function(e){return e.reduce((function(e,t){return e+t}),0)});var Ke="http://www.w3.org/2000/svg",Qe=(0,A.Z)((function e(){(0,_.Z)(this,e)}));function Je(e){return $e.apply(this,arguments)}function $e(){return $e=(0,d.Z)((0,h.Z)().mark((function e(t){var i,n,r=arguments;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=r.length>1&&void 0!==r[1]?r[1]:"text",!ot(t,document.baseURI)){e.next=14;break}return e.next=4,fetch(t);case 4:if((n=e.sent).ok){e.next=7;break}throw new Error(n.statusText);case 7:e.t0=i,e.next="arraybuffer"===e.t0?10:"blob"===e.t0?11:"json"===e.t0?12:13;break;case 10:return e.abrupt("return",n.arrayBuffer());case 11:return e.abrupt("return",n.blob());case 12:return e.abrupt("return",n.json());case 13:return e.abrupt("return",n.text());case 14:return e.abrupt("return",new Promise((function(e,n){var r=new XMLHttpRequest;r.open("GET",t,!0),r.responseType=i,r.onreadystatechange=function(){if(r.readyState===XMLHttpRequest.DONE)if(200!==r.status&&0!==r.status)n(new Error(r.statusText));else{switch(i){case"arraybuffer":case"blob":case"json":return void e(r.response)}e(r.responseText)}},r.send(null)})));case 15:case"end":return e.stop()}}),e)}))),$e.apply(this,arguments)}Qe.CSS=96,Qe.PDF=72,Qe.PDF_TO_CSS_UNITS=Qe.CSS/Qe.PDF;var et=function(){function e(t){var i=t.viewBox,n=t.userUnit,r=t.scale,a=t.rotation,s=t.offsetX,o=void 0===s?0:s,l=t.offsetY,u=void 0===l?0:l,h=t.dontFlip,c=void 0!==h&&h;(0,_.Z)(this,e),this.viewBox=i,this.userUnit=n,this.scale=r,this.rotation=a,this.offsetX=o,this.offsetY=u,r*=n;var d,v,f,p,g,y,m,b,w=(i[2]+i[0])/2,k=(i[3]+i[1])/2;switch((a%=360)<0&&(a+=360),a){case 180:d=-1,v=0,f=0,p=1;break;case 90:d=0,v=1,f=1,p=0;break;case 270:d=0,v=-1,f=-1,p=0;break;case 0:d=1,v=0,f=0,p=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}c&&(f=-f,p=-p),0===d?(g=Math.abs(k-i[1])*r+o,y=Math.abs(w-i[0])*r+u,m=(i[3]-i[1])*r,b=(i[2]-i[0])*r):(g=Math.abs(w-i[0])*r+o,y=Math.abs(k-i[1])*r+u,m=(i[2]-i[0])*r,b=(i[3]-i[1])*r),this.transform=[d*r,v*r,f*r,p*r,g-d*r*w-f*r*k,y-v*r*w-p*r*k],this.width=m,this.height=b}return(0,A.Z)(e,[{key:"rawDims",get:function(){var e=this.viewBox;return Ee(this,"rawDims",{pageWidth:e[2]-e[0],pageHeight:e[3]-e[1],pageX:e[0],pageY:e[1]})}},{key:"clone",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=t.scale,n=void 0===i?this.scale:i,r=t.rotation,a=void 0===r?this.rotation:r,s=t.offsetX,o=void 0===s?this.offsetX:s,l=t.offsetY,u=void 0===l?this.offsetY:l,h=t.dontFlip,c=void 0!==h&&h;return new e({viewBox:this.viewBox.slice(),userUnit:this.userUnit,scale:n,rotation:a,offsetX:o,offsetY:u,dontFlip:c})}},{key:"convertToViewportPoint",value:function(e,t){var i=[e,t];return He.applyTransform(i,this.transform),i}},{key:"convertToViewportRectangle",value:function(e){var t=[e[0],e[1]];He.applyTransform(t,this.transform);var i=[e[2],e[3]];return He.applyTransform(i,this.transform),[t[0],t[1],i[0],i[1]]}},{key:"convertToPdfPoint",value:function(e,t){var i=[e,t];return He.applyInverseTransform(i,this.transform),i}}]),e}(),tt=function(e){P(i,e);var t=R(i);function i(e){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return(0,_.Z)(this,i),(n=t.call(this,e,"RenderingCancelledException")).extraDelay=r,n}return(0,A.Z)(i)}(Ce);function it(e){for(var t=e.length,i=0;i<t&&""===e[i].trim();)i++;return"data:"===e.substring(i,i+5).toLowerCase()}function nt(e){return"string"===typeof e&&/\.pdf$/i.test(e)}function rt(e){var t=e.split(/[#?]/,1);return(e=(0,c.Z)(t,1)[0]).substring(e.lastIndexOf("/")+1)}function at(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"document.pdf";if("string"!==typeof e)return t;if(it(e))return ke('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),t;var i=function(e){try{return new URL(e)}catch(t){try{return new URL(decodeURIComponent(e))}catch(i){try{return new URL(e,"https://foo.bar")}catch(n){try{return new URL(decodeURIComponent(e),"https://foo.bar")}catch(r){return null}}}}},n=i(e);if(!n)return t;var r=function(e){try{var t=decodeURIComponent(e);return t.includes("/")?(t=t.split("/").at(-1)).test(/^\.pdf$/i)?t:e:t}catch(i){return e}},a=/\.pdf$/i,s=n.pathname.split("/").at(-1);if(a.test(s))return r(s);if(n.searchParams.size>0){var o,l=Array.from(n.searchParams.values()).reverse(),u=(0,v.Z)(l);try{for(u.s();!(o=u.n()).done;){var h=o.value;if(a.test(h))return r(h)}}catch(m){u.e(m)}finally{u.f()}var c,d=Array.from(n.searchParams.keys()).reverse(),f=(0,v.Z)(d);try{for(f.s();!(c=f.n()).done;){var p=c.value;if(a.test(p))return r(p)}}catch(m){f.e(m)}finally{f.f()}}if(n.hash){var g=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i,y=g.exec(n.hash);if(y)return r(y[0])}return t}var st=function(){function e(){(0,_.Z)(this,e),this.started=Object.create(null),this.times=[]}return(0,A.Z)(e,[{key:"time",value:function(e){e in this.started&&ke("Timer is already running for ".concat(e)),this.started[e]=Date.now()}},{key:"timeEnd",value:function(e){e in this.started||ke("Timer has not been started for ".concat(e)),this.times.push({name:e,start:this.started[e],end:Date.now()}),delete this.started[e]}},{key:"toString",value:function(){var e,t=[],i=0,n=(0,v.Z)(this.times);try{for(n.s();!(e=n.n()).done;){var r=e.value.name;i=Math.max(r.length,i)}}catch(c){n.e(c)}finally{n.f()}var a,s=(0,v.Z)(this.times);try{for(s.s();!(a=s.n()).done;){var o=a.value,l=o.name,u=o.start,h=o.end;t.push("".concat(l.padEnd(i)," ").concat(h-u,"ms\n"))}}catch(c){s.e(c)}finally{s.f()}return t.join("")}}]),e}();function ot(e,t){var i=t?URL.parse(e,t):URL.parse(e);return"http:"===(null===i||void 0===i?void 0:i.protocol)||"https:"===(null===i||void 0===i?void 0:i.protocol)}function lt(e){e.preventDefault()}function ut(e){e.preventDefault(),e.stopPropagation()}var ht=k("regex"),ct=function(){function e(){(0,_.Z)(this,e)}return(0,A.Z)(e,null,[{key:"toDateObject",value:function(e){var t;if(!e||"string"!==typeof e)return null;(t=b(this,ht))[ht]||(t[ht]=new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?"));var i=b(this,ht)[ht].exec(e);if(!i)return null;var n=parseInt(i[1],10),r=parseInt(i[2],10);r=r>=1&&r<=12?r-1:0;var a=parseInt(i[3],10);a=a>=1&&a<=31?a:1;var s=parseInt(i[4],10);s=s>=0&&s<=23?s:0;var o=parseInt(i[5],10);o=o>=0&&o<=59?o:0;var l=parseInt(i[6],10);l=l>=0&&l<=59?l:0;var u=i[7]||"Z",h=parseInt(i[8],10);h=h>=0&&h<=23?h:0;var c=parseInt(i[9],10)||0;return c=c>=0&&c<=59?c:0,"-"===u?(s+=h,o+=c):"+"===u&&(s-=h,o-=c),new Date(Date.UTC(n,r,a,s,o,l))}}]),e}();function dt(e,t){var i=t.scale,n=void 0===i?1:i,r=t.rotation,a=void 0===r?0:r,s=e.attributes.style,o=s.width,l=s.height,u=[0,0,parseInt(o),parseInt(l)];return new et({viewBox:u,userUnit:1,scale:n,rotation:a})}function vt(e){if(e.startsWith("#")){var t=parseInt(e.slice(1),16);return[(16711680&t)>>16,(65280&t)>>8,255&t]}return e.startsWith("rgb(")?e.slice(4,-1).split(",").map((function(e){return parseInt(e)})):e.startsWith("rgba(")?e.slice(5,-1).split(",").map((function(e){return parseInt(e)})).slice(0,3):(ke('Not a valid color format: "'.concat(e,'"')),[0,0,0])}function ft(e){var t=e.getTransform();return[t.a,t.b,t.c,t.d,t.e,t.f]}function pt(e){var t=e.getTransform().invertSelf();return[t.a,t.b,t.c,t.d,t.e,t.f]}function gt(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(t instanceof et){var r=t.rawDims,a=r.pageWidth,s=r.pageHeight,o=e.style,l=je.isCSSRoundSupported,u="var(--total-scale-factor) * ".concat(a,"px"),h="var(--total-scale-factor) * ".concat(s,"px"),c=l?"round(down, ".concat(u,", var(--scale-round-x))"):"calc(".concat(u,")"),d=l?"round(down, ".concat(h,", var(--scale-round-y))"):"calc(".concat(h,")");i&&t.rotation%180!==0?(o.width=d,o.height=c):(o.width=c,o.height=d)}n&&e.setAttribute("data-main-rotation",t.rotation)}Object.defineProperty(ct,ht,{writable:!0,value:void 0});var yt=function(){function e(){(0,_.Z)(this,e);var t=e.pixelRatio;this.sx=t,this.sy=t}return(0,A.Z)(e,[{key:"scaled",get:function(){return 1!==this.sx||1!==this.sy}},{key:"symmetric",get:function(){return this.sx===this.sy}},{key:"limitCanvas",value:function(t,i,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:-1,s=1/0,o=1/0,l=1/0;(n=e.capPixels(n,a))>0&&(s=Math.sqrt(n/(t*i))),-1!==r&&(o=r/t,l=r/i);var u=Math.min(s,o,l);return(this.sx>u||this.sy>u)&&(this.sx=u,this.sy=u,!0)}}],[{key:"pixelRatio",get:function(){return globalThis.devicePixelRatio||1}},{key:"capPixels",value:function(e,t){if(t>=0){var i=Math.ceil(window.screen.availWidth*window.screen.availHeight*Math.pow(this.pixelRatio,2)*(1+t/100));return e>0?Math.min(e,i):i}return e}}]),e}(),mt=["image/apng","image/avif","image/bmp","image/gif","image/jpeg","image/png","image/svg+xml","image/webp","image/x-icon"],bt=k("toolbar"),wt=k("colorPicker"),kt=k("editor"),At=k("buttons"),_t=k("altText"),xt=k("signatureDescriptionButton"),Pt=k("l10nRemove"),St=k("pointerDown"),Et=k("focusIn"),Ct=k("focusOut"),Ot=k("addListenersToElement"),Mt=k("divider"),Tt=function(){function e(t){var i;(0,_.Z)(this,e),Object.defineProperty(this,Mt,{get:Dt,set:void 0}),Object.defineProperty(this,Ot,{value:It}),Object.defineProperty(this,Ct,{value:Zt}),Object.defineProperty(this,Et,{value:Rt}),Object.defineProperty(this,bt,{writable:!0,value:null}),Object.defineProperty(this,wt,{writable:!0,value:null}),Object.defineProperty(this,kt,{writable:!0,value:void 0}),Object.defineProperty(this,At,{writable:!0,value:null}),Object.defineProperty(this,_t,{writable:!0,value:null}),Object.defineProperty(this,xt,{writable:!0,value:null}),b(this,kt)[kt]=t,(i=b(e,Pt))[Pt]||(i[Pt]=Object.freeze({freetext:"pdfjs-editor-remove-freetext-button",highlight:"pdfjs-editor-remove-highlight-button",ink:"pdfjs-editor-remove-ink-button",stamp:"pdfjs-editor-remove-stamp-button",signature:"pdfjs-editor-remove-signature-button"}))}return(0,A.Z)(e,[{key:"render",value:function(){var t=b(this,bt)[bt]=document.createElement("div");t.classList.add("editToolbar","hidden"),t.setAttribute("role","toolbar");var i=b(this,kt)[kt]._uiManager._signal;t.addEventListener("contextmenu",lt,{signal:i}),t.addEventListener("pointerdown",b(e,St)[St],{signal:i});var n=b(this,At)[At]=document.createElement("div");n.className="buttons",t.append(n);var r=b(this,kt)[kt].toolbarPosition;if(r){var a=t.style,s="ltr"===b(this,kt)[kt]._uiManager.direction?1-r[0]:r[0];a.insetInlineEnd="".concat(100*s,"%"),a.top="calc(".concat(100*r[1],"% + var(--editor-toolbar-vert-offset))")}return t}},{key:"div",get:function(){return b(this,bt)[bt]}},{key:"hide",value:function(){var e;b(this,bt)[bt].classList.add("hidden"),null===(e=b(this,wt)[wt])||void 0===e||e.hideDropdown()}},{key:"show",value:function(){var e;b(this,bt)[bt].classList.remove("hidden"),null===(e=b(this,_t)[_t])||void 0===e||e.shown()}},{key:"addDeleteButton",value:function(){var t=b(this,kt)[kt],i=t.editorType,n=t._uiManager,r=document.createElement("button");r.className="delete",r.tabIndex=0,r.setAttribute("data-l10n-id",b(e,Pt)[Pt][i]),b(this,Ot)[Ot](r),r.addEventListener("click",(function(e){n.delete()}),{signal:n._signal}),b(this,At)[At].append(r)}},{key:"addAltText",value:function(){var e=(0,d.Z)((0,h.Z)().mark((function e(t){var i;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.render();case 2:i=e.sent,b(this,Ot)[Ot](i),b(this,At)[At].append(i,b(this,Mt)[Mt]),b(this,_t)[_t]=t;case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"addColorPicker",value:function(e){b(this,wt)[wt]=e;var t=e.renderButton();b(this,Ot)[Ot](t),b(this,At)[At].append(t,b(this,Mt)[Mt])}},{key:"addEditSignatureButton",value:function(){var e=(0,d.Z)((0,h.Z)().mark((function e(t){var i;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.renderEditButton(b(this,kt)[kt]);case 2:i=b(this,xt)[xt]=e.sent,b(this,Ot)[Ot](i),b(this,At)[At].append(i,b(this,Mt)[Mt]);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"addButton",value:function(){var e=(0,d.Z)((0,h.Z)().mark((function e(t,i){return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t,e.next="colorPicker"===e.t0?3:"altText"===e.t0?5:"editSignature"===e.t0?8:"delete"===e.t0?11:13;break;case 3:return this.addColorPicker(i),e.abrupt("break",13);case 5:return e.next=7,this.addAltText(i);case 7:case 10:return e.abrupt("break",13);case 8:return e.next=10,this.addEditSignatureButton(i);case 11:return this.addDeleteButton(),e.abrupt("break",13);case 13:case"end":return e.stop()}}),e,this)})));return function(t,i){return e.apply(this,arguments)}}()},{key:"updateEditSignatureButton",value:function(e){b(this,xt)[xt]&&(b(this,xt)[xt].title=e)}},{key:"remove",value:function(){var e;b(this,bt)[bt].remove(),null===(e=b(this,wt)[wt])||void 0===e||e.destroy(),b(this,wt)[wt]=null}}]),e}();function Rt(e){b(this,kt)[kt]._focusEventsAllowed=!1,ut(e)}function Zt(e){b(this,kt)[kt]._focusEventsAllowed=!0,ut(e)}function It(e){var t=b(this,kt)[kt]._uiManager._signal;e.addEventListener("focusin",b(this,Et)[Et].bind(this),{capture:!0,signal:t}),e.addEventListener("focusout",b(this,Ct)[Ct].bind(this),{capture:!0,signal:t}),e.addEventListener("contextmenu",lt,{signal:t})}function Dt(){var e=document.createElement("div");return e.className="divider",e}Object.defineProperty(Tt,St,{value:function(e){e.stopPropagation()}}),Object.defineProperty(Tt,Pt,{writable:!0,value:null});var Lt=k("buttons"),jt=k("toolbar"),Ft=k("uiManager"),Nt=k("render"),Bt=k("getLastPoint"),Ht=k("addHighlightButton"),zt=function(){function e(t){(0,_.Z)(this,e),Object.defineProperty(this,Ht,{value:Vt}),Object.defineProperty(this,Bt,{value:Ut}),Object.defineProperty(this,Nt,{value:Gt}),Object.defineProperty(this,Lt,{writable:!0,value:null}),Object.defineProperty(this,jt,{writable:!0,value:null}),Object.defineProperty(this,Ft,{writable:!0,value:void 0}),b(this,Ft)[Ft]=t}return(0,A.Z)(e,[{key:"show",value:function(e,t,i){var n,r=b(this,Bt)[Bt](t,i),a=(0,c.Z)(r,2),s=a[0],o=a[1],l=((n=b(this,jt))[jt]||(n[jt]=b(this,Nt)[Nt]())).style;e.append(b(this,jt)[jt]),l.insetInlineEnd="".concat(100*s,"%"),l.top="calc(".concat(100*o,"% + var(--editor-toolbar-vert-offset))")}},{key:"hide",value:function(){b(this,jt)[jt].remove()}}]),e}();function Gt(){var e=b(this,jt)[jt]=document.createElement("div");e.className="editToolbar",e.setAttribute("role","toolbar"),e.addEventListener("contextmenu",lt,{signal:b(this,Ft)[Ft]._signal});var t=b(this,Lt)[Lt]=document.createElement("div");return t.className="buttons",e.append(t),b(this,Ht)[Ht](),e}function Ut(e,t){var i,n=0,r=0,a=(0,v.Z)(e);try{for(a.s();!(i=a.n()).done;){var s=i.value,o=s.y+s.height;if(!(o<n)){var l=s.x+(t?s.width:0);o>n?(r=l,n=o):t?l>r&&(r=l):l<r&&(r=l)}}}catch(u){a.e(u)}finally{a.f()}return[t?1-r:r,n]}function Vt(){var e=this,t=document.createElement("button");t.className="highlightButton",t.tabIndex=0,t.setAttribute("data-l10n-id","pdfjs-highlight-floating-button1");var i=document.createElement("span");t.append(i),i.className="visuallyHidden",i.setAttribute("data-l10n-id","pdfjs-highlight-floating-button-label");var n=b(this,Ft)[Ft]._signal;t.addEventListener("contextmenu",lt,{signal:n}),t.addEventListener("click",(function(){b(e,Ft)[Ft].highlightSelection("floating_button")}),{signal:n}),b(this,Lt)[Lt].append(t)}function Wt(e,t,i){var n,r=(0,v.Z)(i);try{for(r.s();!(n=r.n()).done;){var a=n.value;t.addEventListener(a,e[a].bind(e))}}catch(s){r.e(s)}finally{r.f()}}var qt=k("id"),Xt=function(){function e(){(0,_.Z)(this,e),Object.defineProperty(this,qt,{writable:!0,value:0})}return(0,A.Z)(e,[{key:"id",get:function(){return"".concat(q).concat(b(this,qt)[qt]++)}}]),e}(),Yt=k("baseId"),Kt=k("id"),Qt=k("cache"),Jt=k("get"),$t=function(){function e(){(0,_.Z)(this,e),Object.defineProperty(this,Jt,{value:ei}),Object.defineProperty(this,Yt,{writable:!0,value:We()}),Object.defineProperty(this,Kt,{writable:!0,value:0}),Object.defineProperty(this,Qt,{writable:!0,value:null})}return(0,A.Z)(e,[{key:"getFromFile",value:function(){var e=(0,d.Z)((0,h.Z)().mark((function e(t){var i,n,r,a;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=t.lastModified,n=t.name,r=t.size,a=t.type,e.abrupt("return",b(this,Jt)[Jt]("".concat(i,"_").concat(n,"_").concat(r,"_").concat(a),t));case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getFromUrl",value:function(){var e=(0,d.Z)((0,h.Z)().mark((function e(t){return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",b(this,Jt)[Jt](t,t));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getFromBlob",value:function(){var e=(0,d.Z)((0,h.Z)().mark((function e(t,i){var n;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i;case 2:return n=e.sent,e.abrupt("return",b(this,Jt)[Jt](t,n));case 4:case"end":return e.stop()}}),e,this)})));return function(t,i){return e.apply(this,arguments)}}()},{key:"getFromId",value:function(){var e=(0,d.Z)((0,h.Z)().mark((function e(t){var i,n,r;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((i=b(this,Qt))[Qt]||(i[Qt]=new Map),n=b(this,Qt)[Qt].get(t)){e.next=4;break}return e.abrupt("return",null);case 4:if(!n.bitmap){e.next=7;break}return n.refCounter+=1,e.abrupt("return",n);case 7:if(!n.file){e.next=9;break}return e.abrupt("return",this.getFromFile(n.file));case 9:if(!n.blobPromise){e.next=13;break}return r=n.blobPromise,delete n.blobPromise,e.abrupt("return",this.getFromBlob(n.id,r));case 13:return e.abrupt("return",this.getFromUrl(n.url));case 14:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getFromCanvas",value:function(e,t){var i,n;(i=b(this,Qt))[Qt]||(i[Qt]=new Map);var r=b(this,Qt)[Qt].get(e);if(null!==(n=r)&&void 0!==n&&n.bitmap)return r.refCounter+=1,r;var a=new OffscreenCanvas(t.width,t.height);return a.getContext("2d").drawImage(t,0,0),r={bitmap:a.transferToImageBitmap(),id:"image_".concat(b(this,Yt)[Yt],"_").concat(b(this,Kt)[Kt]++),refCounter:1,isSvg:!1},b(this,Qt)[Qt].set(e,r),b(this,Qt)[Qt].set(r.id,r),r}},{key:"getSvgUrl",value:function(e){var t=b(this,Qt)[Qt].get(e);return null!==t&&void 0!==t&&t.isSvg?t.svgUrl:null}},{key:"deleteId",value:function(e){var t,i;(t=b(this,Qt))[Qt]||(t[Qt]=new Map);var n=b(this,Qt)[Qt].get(e);if(n&&(n.refCounter-=1,0===n.refCounter)){var r=n.bitmap;if(!n.url&&!n.file){var a=new OffscreenCanvas(r.width,r.height);a.getContext("bitmaprenderer").transferFromImageBitmap(r),n.blobPromise=a.convertToBlob()}null===(i=r.close)||void 0===i||i.call(r),n.bitmap=null}}},{key:"isValidId",value:function(e){return e.startsWith("image_".concat(b(this,Yt)[Yt],"_"))}}],[{key:"_isSVGFittingCanvas",get:function(){var e=new OffscreenCanvas(1,3).getContext("2d",{willReadFrequently:!0}),t=new Image;return t.src='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>',Ee(this,"_isSVGFittingCanvas",t.decode().then((function(){return e.drawImage(t,0,0,1,1,0,0,1,3),0===new Uint32Array(e.getImageData(0,0,1,1).data.buffer)[0]})))}}]),e}();function ei(e,t){return ti.apply(this,arguments)}function ti(){return(ti=(0,d.Z)((0,h.Z)().mark((function e(t,i){var n,r,a,s,o,l,u,c;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((n=b(this,Qt))[Qt]||(n[Qt]=new Map),null!==(a=b(this,Qt)[Qt].get(t))){e.next=4;break}return e.abrupt("return",null);case 4:if(null===(r=a)||void 0===r||!r.bitmap){e.next=7;break}return a.refCounter+=1,e.abrupt("return",a);case 7:if(e.prev=7,a||(a={bitmap:null,id:"image_".concat(b(this,Yt)[Yt],"_").concat(b(this,Kt)[Kt]++),refCounter:0,isSvg:!1}),"string"!==typeof i){e.next=16;break}return a.url=i,e.next=13,Je(i,"blob");case 13:s=e.sent,e.next=17;break;case 16:i instanceof File?s=a.file=i:i instanceof Blob&&(s=i);case 17:if("image/svg+xml"!==s.type){e.next=27;break}return o=$t._isSVGFittingCanvas,l=new FileReader,u=new Image,c=new Promise((function(e,t){u.onload=function(){a.bitmap=u,a.isSvg=!0,e()},l.onload=(0,d.Z)((0,h.Z)().mark((function e(){var t;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.svgUrl=l.result,e.next=3,o;case 3:if(!e.sent){e.next=7;break}e.t0="".concat(t,"#svgView(preserveAspectRatio(none))"),e.next=8;break;case 7:e.t0=t;case 8:u.src=e.t0;case 9:case"end":return e.stop()}}),e)}))),u.onerror=l.onerror=t})),l.readAsDataURL(s),e.next=25,c;case 25:e.next=30;break;case 27:return e.next=29,createImageBitmap(s);case 29:a.bitmap=e.sent;case 30:a.refCounter=1,e.next=37;break;case 33:e.prev=33,e.t0=e.catch(7),ke(e.t0),a=null;case 37:return b(this,Qt)[Qt].set(t,a),a&&b(this,Qt)[Qt].set(a.id,a),e.abrupt("return",a);case 40:case"end":return e.stop()}}),e,this,[[7,33]])})))).apply(this,arguments)}var ii=k("commands"),ni=k("locked"),ri=k("maxSize"),ai=k("position"),si=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:128;(0,_.Z)(this,e),Object.defineProperty(this,ii,{writable:!0,value:[]}),Object.defineProperty(this,ni,{writable:!0,value:!1}),Object.defineProperty(this,ri,{writable:!0,value:void 0}),Object.defineProperty(this,ai,{writable:!0,value:-1}),b(this,ri)[ri]=t}return(0,A.Z)(e,[{key:"add",value:function(e){var t=e.cmd,i=e.undo,n=e.post,r=e.mustExec,a=e.type,s=void 0===a?NaN:a,o=e.overwriteIfSameType,l=void 0!==o&&o,u=e.keepUndo,h=void 0!==u&&u;if(r&&t(),!b(this,ni)[ni]){var c={cmd:t,undo:i,post:n,type:s};if(-1===b(this,ai)[ai])return b(this,ii)[ii].length>0&&(b(this,ii)[ii].length=0),b(this,ai)[ai]=0,void b(this,ii)[ii].push(c);if(l&&b(this,ii)[ii][b(this,ai)[ai]].type===s)return h&&(c.undo=b(this,ii)[ii][b(this,ai)[ai]].undo),void(b(this,ii)[ii][b(this,ai)[ai]]=c);var d=b(this,ai)[ai]+1;d===b(this,ri)[ri]?b(this,ii)[ii].splice(0,1):(b(this,ai)[ai]=d,d<b(this,ii)[ii].length&&b(this,ii)[ii].splice(d)),b(this,ii)[ii].push(c)}}},{key:"undo",value:function(){if(-1!==b(this,ai)[ai]){b(this,ni)[ni]=!0;var e=b(this,ii)[ii][b(this,ai)[ai]],t=e.undo,i=e.post;t(),null===i||void 0===i||i(),b(this,ni)[ni]=!1,b(this,ai)[ai]-=1}}},{key:"redo",value:function(){if(b(this,ai)[ai]<b(this,ii)[ii].length-1){b(this,ai)[ai]+=1,b(this,ni)[ni]=!0;var e=b(this,ii)[ii][b(this,ai)[ai]],t=e.cmd,i=e.post;t(),null===i||void 0===i||i(),b(this,ni)[ni]=!1}}},{key:"hasSomethingToUndo",value:function(){return-1!==b(this,ai)[ai]}},{key:"hasSomethingToRedo",value:function(){return b(this,ai)[ai]<b(this,ii)[ii].length-1}},{key:"cleanType",value:function(e){if(-1!==b(this,ai)[ai]){for(var t=b(this,ai)[ai];t>=0;t--)if(b(this,ii)[ii][t].type!==e)return b(this,ii)[ii].splice(t+1,b(this,ai)[ai]-t),void(b(this,ai)[ai]=t);b(this,ii)[ii].length=0,b(this,ai)[ai]=-1}}},{key:"destroy",value:function(){b(this,ii)[ii]=null}}]),e}(),oi=k("serialize"),li=function(){function e(t){(0,_.Z)(this,e),Object.defineProperty(this,oi,{value:ui}),this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;var i,n=je.platform.isMac,r=(0,v.Z)(t);try{for(r.s();!(i=r.n()).done;){var a,s=(0,c.Z)(i.value,3),o=s[0],l=s[1],u=s[2],h=void 0===u?{}:u,d=(0,v.Z)(o);try{for(d.s();!(a=d.n()).done;){var f=a.value,p=f.startsWith("mac+");n&&p?(this.callbacks.set(f.slice(4),{callback:l,options:h}),this.allKeys.add(f.split("+").at(-1))):n||p||(this.callbacks.set(f,{callback:l,options:h}),this.allKeys.add(f.split("+").at(-1)))}}catch(g){d.e(g)}finally{d.f()}}}catch(g){r.e(g)}finally{r.f()}}return(0,A.Z)(e,[{key:"exec",value:function(e,t){if(this.allKeys.has(t.key)){var i=this.callbacks.get(b(this,oi)[oi](t));if(i){var n=i.callback,r=i.options,a=r.bubbles,s=void 0!==a&&a,o=r.args,l=void 0===o?[]:o,h=r.checker,c=void 0===h?null:h;c&&!c(e,t)||(n.bind.apply(n,[e].concat((0,u.Z)(l),[t]))(),s||ut(t))}}}}]),e}();function ui(e){e.altKey&&this.buffer.push("alt"),e.ctrlKey&&this.buffer.push("ctrl"),e.metaKey&&this.buffer.push("meta"),e.shiftKey&&this.buffer.push("shift"),this.buffer.push(e.key);var t=this.buffer.join("+");return this.buffer.length=0,t}var hi=function(){function e(){(0,_.Z)(this,e)}return(0,A.Z)(e,[{key:"_colors",get:function(){var e=new Map([["CanvasText",null],["Canvas",null]]);return function(e){var t=document.createElement("span");t.style.visibility="hidden",t.style.colorScheme="only light",document.body.append(t);var i,n=(0,v.Z)(e.keys());try{for(n.s();!(i=n.n()).done;){var r=i.value;t.style.color=r;var a=window.getComputedStyle(t).color;e.set(r,vt(a))}}catch(s){n.e(s)}finally{n.f()}t.remove()}(e),Ee(this,"_colors",e)}},{key:"convert",value:function(t){var i=vt(t);if(!window.matchMedia("(forced-colors: active)").matches)return i;var n,r=(0,v.Z)(this._colors);try{for(r.s();!(n=r.n()).done;){var a=(0,c.Z)(n.value,2),s=a[0];if(a[1].every((function(e,t){return e===i[t]})))return e._colorsMapping.get(s)}}catch(o){r.e(o)}finally{r.f()}return i}},{key:"getHexCode",value:function(e){var t=this._colors.get(e);return t?He.makeHexColor.apply(He,(0,u.Z)(t)):e}}]),e}();hi._colorsMapping=new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]);var ci=k("abortController"),di=k("activeEditor"),vi=k("allEditors"),fi=k("allLayers"),pi=k("altTextManager"),gi=k("annotationStorage"),yi=k("changedExistingAnnotations"),mi=k("commandManager"),bi=k("copyPasteAC"),wi=k("currentDrawingSession"),ki=k("currentPageIndex"),Ai=k("deletedAnnotationsElementIds"),_i=k("draggingEditors"),xi=k("editorTypes"),Pi=k("editorsToRescale"),Si=k("enableHighlightFloatingButton"),Ei=k("enableUpdatedAddImage"),Ci=k("enableNewAltTextWhenAddingImage"),Oi=k("filterFactory"),Mi=k("focusMainContainerTimeoutId"),Ti=k("focusManagerAC"),Ri=k("highlightColors"),Zi=k("highlightWhenShiftUp"),Ii=k("highlightToolbar"),Di=k("idManager"),Li=k("isEnabled"),ji=k("isWaiting"),Fi=k("keyboardManagerAC"),Ni=k("lastActiveElement"),Bi=k("mainHighlightColorPicker"),Hi=k("missingCanvases"),zi=k("mlManager"),Gi=k("mode"),Ui=k("selectedEditors"),Vi=k("selectedTextNode"),Wi=k("signatureManager"),qi=k("pageColors"),Xi=k("showAllStates"),Yi=k("previousStates"),Ki=k("translation"),Qi=k("translationTimeoutId"),Ji=k("container"),$i=k("viewer"),en=k("viewerAlert"),tn=k("updateModeCapability"),nn=k("getAnchorElementForSelection"),rn=k("getLayerForTextLayer"),an=k("displayHighlightToolbar"),sn=k("selectionChange"),on=k("onSelectEnd"),ln=k("addSelectionListener"),un=k("addFocusManager"),hn=k("removeFocusManager"),cn=k("addKeyboardManager"),dn=k("removeKeyboardManager"),vn=k("addCopyPasteListeners"),fn=k("removeCopyPasteListeners"),pn=k("addDragAndDropListeners"),gn=k("dispatchUpdateStates"),yn=k("dispatchUpdateUI"),mn=k("enableAll"),bn=k("disableAll"),wn=k("addEditorToLayer"),kn=k("lastSelectedEditor"),An=k("isEmpty"),_n=k("selectEditors"),xn=function(){function e(t,i,n,r,a,s,o,l,u,h,c,d,v,f,p){var g=this;(0,_.Z)(this,e),Object.defineProperty(this,_n,{value:Wn}),Object.defineProperty(this,An,{value:Vn}),Object.defineProperty(this,kn,{get:Un,set:void 0}),Object.defineProperty(this,wn,{value:Gn}),Object.defineProperty(this,bn,{value:zn}),Object.defineProperty(this,mn,{value:Bn}),Object.defineProperty(this,yn,{value:Nn}),Object.defineProperty(this,gn,{value:Fn}),Object.defineProperty(this,pn,{value:jn}),Object.defineProperty(this,fn,{value:Ln}),Object.defineProperty(this,vn,{value:Dn}),Object.defineProperty(this,dn,{value:In}),Object.defineProperty(this,cn,{value:Zn}),Object.defineProperty(this,hn,{value:Rn}),Object.defineProperty(this,un,{value:Tn}),Object.defineProperty(this,ln,{value:Mn}),Object.defineProperty(this,on,{value:On}),Object.defineProperty(this,sn,{value:Cn}),Object.defineProperty(this,an,{value:En}),Object.defineProperty(this,rn,{value:Sn}),Object.defineProperty(this,nn,{value:Pn}),Object.defineProperty(this,ci,{writable:!0,value:new AbortController}),Object.defineProperty(this,di,{writable:!0,value:null}),Object.defineProperty(this,vi,{writable:!0,value:new Map}),Object.defineProperty(this,fi,{writable:!0,value:new Map}),Object.defineProperty(this,pi,{writable:!0,value:null}),Object.defineProperty(this,gi,{writable:!0,value:null}),Object.defineProperty(this,yi,{writable:!0,value:null}),Object.defineProperty(this,mi,{writable:!0,value:new si}),Object.defineProperty(this,bi,{writable:!0,value:null}),Object.defineProperty(this,wi,{writable:!0,value:null}),Object.defineProperty(this,ki,{writable:!0,value:0}),Object.defineProperty(this,Ai,{writable:!0,value:new Set}),Object.defineProperty(this,_i,{writable:!0,value:null}),Object.defineProperty(this,xi,{writable:!0,value:null}),Object.defineProperty(this,Pi,{writable:!0,value:new Set}),this._editorUndoBar=null,Object.defineProperty(this,Si,{writable:!0,value:!1}),Object.defineProperty(this,Ei,{writable:!0,value:!1}),Object.defineProperty(this,Ci,{writable:!0,value:!1}),Object.defineProperty(this,Oi,{writable:!0,value:null}),Object.defineProperty(this,Mi,{writable:!0,value:null}),Object.defineProperty(this,Ti,{writable:!0,value:null}),Object.defineProperty(this,Ri,{writable:!0,value:null}),Object.defineProperty(this,Zi,{writable:!0,value:!1}),Object.defineProperty(this,Ii,{writable:!0,value:null}),Object.defineProperty(this,Di,{writable:!0,value:new Xt}),Object.defineProperty(this,Li,{writable:!0,value:!1}),Object.defineProperty(this,ji,{writable:!0,value:!1}),Object.defineProperty(this,Fi,{writable:!0,value:null}),Object.defineProperty(this,Ni,{writable:!0,value:null}),Object.defineProperty(this,Bi,{writable:!0,value:null}),Object.defineProperty(this,Hi,{writable:!0,value:null}),Object.defineProperty(this,zi,{writable:!0,value:null}),Object.defineProperty(this,Gi,{writable:!0,value:X.NONE}),Object.defineProperty(this,Ui,{writable:!0,value:new Set}),Object.defineProperty(this,Vi,{writable:!0,value:null}),Object.defineProperty(this,Wi,{writable:!0,value:null}),Object.defineProperty(this,qi,{writable:!0,value:null}),Object.defineProperty(this,Xi,{writable:!0,value:null}),Object.defineProperty(this,Yi,{writable:!0,value:{isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1,hasSelectedText:!1}}),Object.defineProperty(this,Ki,{writable:!0,value:[0,0]}),Object.defineProperty(this,Qi,{writable:!0,value:null}),Object.defineProperty(this,Ji,{writable:!0,value:null}),Object.defineProperty(this,$i,{writable:!0,value:null}),Object.defineProperty(this,en,{writable:!0,value:null}),Object.defineProperty(this,tn,{writable:!0,value:null});var y=this._signal=b(this,ci)[ci].signal;b(this,Ji)[Ji]=t,b(this,$i)[$i]=i,b(this,en)[en]=n,b(this,pi)[pi]=r,b(this,Wi)[Wi]=a,this._eventBus=s,s._on("editingaction",this.onEditingAction.bind(this),{signal:y}),s._on("pagechanging",this.onPageChanging.bind(this),{signal:y}),s._on("scalechanging",this.onScaleChanging.bind(this),{signal:y}),s._on("rotationchanging",this.onRotationChanging.bind(this),{signal:y}),s._on("setpreference",this.onSetPreference.bind(this),{signal:y}),s._on("switchannotationeditorparams",(function(e){return g.updateParams(e.type,e.value)}),{signal:y}),b(this,ln)[ln](),b(this,pn)[pn](),b(this,cn)[cn](),b(this,gi)[gi]=o.annotationStorage,b(this,Oi)[Oi]=o.filterFactory,b(this,qi)[qi]=l,b(this,Ri)[Ri]=u||null,b(this,Si)[Si]=h,b(this,Ei)[Ei]=c,b(this,Ci)[Ci]=d,b(this,zi)[zi]=v||null,this.viewParameters={realScale:Qe.PDF_TO_CSS_UNITS,rotation:0},this.isShiftKeyDown=!1,this._editorUndoBar=f||null,this._supportsPinchToZoom=!1!==p}return(0,A.Z)(e,[{key:"destroy",value:function(){var e,t,i,n,r,a,s,o;null===(e=b(this,tn)[tn])||void 0===e||e.resolve(),b(this,tn)[tn]=null,null===(t=b(this,ci)[ci])||void 0===t||t.abort(),b(this,ci)[ci]=null,this._signal=null;var l,u=(0,v.Z)(b(this,fi)[fi].values());try{for(u.s();!(l=u.n()).done;){l.value.destroy()}}catch(h){u.e(h)}finally{u.f()}b(this,fi)[fi].clear(),b(this,vi)[vi].clear(),b(this,Pi)[Pi].clear(),null===(i=b(this,Hi)[Hi])||void 0===i||i.clear(),b(this,di)[di]=null,b(this,Ui)[Ui].clear(),b(this,mi)[mi].destroy(),null===(n=b(this,pi)[pi])||void 0===n||n.destroy(),null===(r=b(this,Wi)[Wi])||void 0===r||r.destroy(),null===(a=b(this,Ii)[Ii])||void 0===a||a.hide(),b(this,Ii)[Ii]=null,null===(s=b(this,Bi)[Bi])||void 0===s||s.destroy(),b(this,Bi)[Bi]=null,b(this,Mi)[Mi]&&(clearTimeout(b(this,Mi)[Mi]),b(this,Mi)[Mi]=null),b(this,Qi)[Qi]&&(clearTimeout(b(this,Qi)[Qi]),b(this,Qi)[Qi]=null),null===(o=this._editorUndoBar)||void 0===o||o.destroy()}},{key:"combinedSignal",value:function(e){return AbortSignal.any([this._signal,e.signal])}},{key:"mlManager",get:function(){return b(this,zi)[zi]}},{key:"useNewAltTextFlow",get:function(){return b(this,Ei)[Ei]}},{key:"useNewAltTextWhenAddingImage",get:function(){return b(this,Ci)[Ci]}},{key:"hcmFilter",get:function(){return Ee(this,"hcmFilter",b(this,qi)[qi]?b(this,Oi)[Oi].addHCMFilter(b(this,qi)[qi].foreground,b(this,qi)[qi].background):"none")}},{key:"direction",get:function(){return Ee(this,"direction",getComputedStyle(b(this,Ji)[Ji]).direction)}},{key:"highlightColors",get:function(){return Ee(this,"highlightColors",b(this,Ri)[Ri]?new Map(b(this,Ri)[Ri].split(",").map((function(e){return(e=e.split("=").map((function(e){return e.trim()})))[1]=e[1].toUpperCase(),e}))):null)}},{key:"highlightColorNames",get:function(){return Ee(this,"highlightColorNames",this.highlightColors?new Map(Array.from(this.highlightColors,(function(e){return e.reverse()}))):null)}},{key:"setCurrentDrawingSession",value:function(e){e?(this.unselectAll(),this.disableUserSelect(!0)):this.disableUserSelect(!1),b(this,wi)[wi]=e}},{key:"setMainHighlightColorPicker",value:function(e){b(this,Bi)[Bi]=e}},{key:"editAltText",value:function(e){var t,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];null===(t=b(this,pi)[pi])||void 0===t||t.editAltText(this,e,i)}},{key:"getSignature",value:function(e){var t;null===(t=b(this,Wi)[Wi])||void 0===t||t.getSignature({uiManager:this,editor:e})}},{key:"signatureManager",get:function(){return b(this,Wi)[Wi]}},{key:"switchToMode",value:function(e,t){this._eventBus.on("annotationeditormodechanged",t,{once:!0,signal:this._signal}),this._eventBus.dispatch("showannotationeditorui",{source:this,mode:e})}},{key:"setPreference",value:function(e,t){this._eventBus.dispatch("setpreference",{source:this,name:e,value:t})}},{key:"onSetPreference",value:function(e){var t=e.name,i=e.value;if("enableNewAltTextWhenAddingImage"===t)b(this,Ci)[Ci]=i}},{key:"onPageChanging",value:function(e){var t=e.pageNumber;b(this,ki)[ki]=t-1}},{key:"focusMainContainer",value:function(){b(this,Ji)[Ji].focus()}},{key:"findParent",value:function(e,t){var i,n=(0,v.Z)(b(this,fi)[fi].values());try{for(n.s();!(i=n.n()).done;){var r=i.value,a=r.div.getBoundingClientRect(),s=a.x,o=a.y,l=a.width,u=a.height;if(e>=s&&e<=s+l&&t>=o&&t<=o+u)return r}}catch(h){n.e(h)}finally{n.f()}return null}},{key:"disableUserSelect",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];b(this,$i)[$i].classList.toggle("noUserSelect",e)}},{key:"addShouldRescale",value:function(e){b(this,Pi)[Pi].add(e)}},{key:"removeShouldRescale",value:function(e){b(this,Pi)[Pi].delete(e)}},{key:"onScaleChanging",value:function(e){var t,i=e.scale;this.commitOrRemove(),this.viewParameters.realScale=i*Qe.PDF_TO_CSS_UNITS;var n,r=(0,v.Z)(b(this,Pi)[Pi]);try{for(r.s();!(n=r.n()).done;){n.value.onScaleChanging()}}catch(a){r.e(a)}finally{r.f()}null===(t=b(this,wi)[wi])||void 0===t||t.onScaleChanging()}},{key:"onRotationChanging",value:function(e){var t=e.pagesRotation;this.commitOrRemove(),this.viewParameters.rotation=t}},{key:"highlightSelection",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",i=document.getSelection();if(i&&!i.isCollapsed){var n=i.anchorNode,r=i.anchorOffset,a=i.focusNode,s=i.focusOffset,o=i.toString(),l=b(this,nn)[nn](i),u=l.closest(".textLayer"),h=this.getSelectionBoxes(u);if(h){i.empty();var c=b(this,rn)[rn](u),d=b(this,Gi)[Gi]===X.NONE,v=function(){null===c||void 0===c||c.createAndAddNewEditor({x:0,y:0},!1,{methodOfCreation:t,boxes:h,anchorNode:n,anchorOffset:r,focusNode:a,focusOffset:s,text:o}),d&&e.showAllEditors("highlight",!0,!0)};d?this.switchToMode(X.HIGHLIGHT,v):v()}}}},{key:"addToAnnotationStorage",value:function(e){e.isEmpty()||!b(this,gi)[gi]||b(this,gi)[gi].has(e.id)||b(this,gi)[gi].setValue(e.id,e)}},{key:"a11yAlert",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=b(this,en)[en];i&&(i.setAttribute("data-l10n-id",e),t?i.setAttribute("data-l10n-args",JSON.stringify(t)):i.removeAttribute("data-l10n-args"))}},{key:"blur",value:function(){if(this.isShiftKeyDown=!1,b(this,Zi)[Zi]&&(b(this,Zi)[Zi]=!1,b(this,on)[on]("main_toolbar")),this.hasSelection){var e,t=document.activeElement,i=(0,v.Z)(b(this,Ui)[Ui]);try{for(i.s();!(e=i.n()).done;){var n=e.value;if(n.div.contains(t)){b(this,Ni)[Ni]=[n,t],n._focusEventsAllowed=!1;break}}}catch(r){i.e(r)}finally{i.f()}}}},{key:"focus",value:function(){if(b(this,Ni)[Ni]){var e=(0,c.Z)(b(this,Ni)[Ni],2),t=e[0],i=e[1];b(this,Ni)[Ni]=null,i.addEventListener("focusin",(function(){t._focusEventsAllowed=!0}),{once:!0,signal:this._signal}),i.focus()}}},{key:"addEditListeners",value:function(){b(this,cn)[cn](),b(this,vn)[vn]()}},{key:"removeEditListeners",value:function(){b(this,dn)[dn](),b(this,fn)[fn]()}},{key:"dragOver",value:function(e){var t,i=(0,v.Z)(e.dataTransfer.items);try{for(i.s();!(t=i.n()).done;){var n,r=t.value.type,a=(0,v.Z)(b(this,xi)[xi]);try{for(a.s();!(n=a.n()).done;){if(n.value.isHandlingMimeForPasting(r))return e.dataTransfer.dropEffect="copy",void e.preventDefault()}}catch(s){a.e(s)}finally{a.f()}}}catch(s){i.e(s)}finally{i.f()}}},{key:"drop",value:function(e){var t,i=(0,v.Z)(e.dataTransfer.items);try{for(i.s();!(t=i.n()).done;){var n,r=t.value,a=(0,v.Z)(b(this,xi)[xi]);try{for(a.s();!(n=a.n()).done;){var s=n.value;if(s.isHandlingMimeForPasting(r.type))return s.paste(r,this.currentLayer),void e.preventDefault()}}catch(o){a.e(o)}finally{a.f()}}}catch(o){i.e(o)}finally{i.f()}}},{key:"copy",value:function(e){var t;if(e.preventDefault(),null===(t=b(this,di)[di])||void 0===t||t.commitOrRemove(),this.hasSelection){var i,n=[],r=(0,v.Z)(b(this,Ui)[Ui]);try{for(r.s();!(i=r.n()).done;){var a=i.value.serialize(!0);a&&n.push(a)}}catch(s){r.e(s)}finally{r.f()}0!==n.length&&e.clipboardData.setData("application/pdfjs",JSON.stringify(n))}}},{key:"cut",value:function(e){this.copy(e),this.delete()}},{key:"paste",value:function(){var e=(0,d.Z)((0,h.Z)().mark((function e(t){var i,n,r,a,s,o,l,u,c,d,f,p,g,y,m,w,k=this;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.preventDefault(),i=t.clipboardData,n=(0,v.Z)(i.items),e.prev=3,n.s();case 5:if((r=n.n()).done){e.next=27;break}a=r.value,s=(0,v.Z)(b(this,xi)[xi]),e.prev=8,s.s();case 10:if((o=s.n()).done){e.next=17;break}if(!(l=o.value).isHandlingMimeForPasting(a.type)){e.next=15;break}return l.paste(a,this.currentLayer),e.abrupt("return");case 15:e.next=10;break;case 17:e.next=22;break;case 19:e.prev=19,e.t0=e.catch(8),s.e(e.t0);case 22:return e.prev=22,s.f(),e.finish(22);case 25:e.next=5;break;case 27:e.next=32;break;case 29:e.prev=29,e.t1=e.catch(3),n.e(e.t1);case 32:return e.prev=32,n.f(),e.finish(32);case 35:if(u=i.getData("application/pdfjs")){e.next=38;break}return e.abrupt("return");case 38:e.prev=38,u=JSON.parse(u),e.next=46;break;case 42:return e.prev=42,e.t2=e.catch(38),ke('paste: "'.concat(e.t2.message,'".')),e.abrupt("return");case 46:if(Array.isArray(u)){e.next=48;break}return e.abrupt("return");case 48:this.unselectAll(),c=this.currentLayer,e.prev=50,d=[],f=(0,v.Z)(u),e.prev=53,f.s();case 55:if((p=f.n()).done){e.next=65;break}return g=p.value,e.next=59,c.deserialize(g);case 59:if(y=e.sent){e.next=62;break}return e.abrupt("return");case 62:d.push(y);case 63:e.next=55;break;case 65:e.next=70;break;case 67:e.prev=67,e.t3=e.catch(53),f.e(e.t3);case 70:return e.prev=70,f.f(),e.finish(70);case 73:m=function(){for(var e=0,t=d;e<t.length;e++){var i=t[e];b(k,wn)[wn](i)}b(k,_n)[_n](d)},w=function(){for(var e=0,t=d;e<t.length;e++){t[e].remove()}},this.addCommands({cmd:m,undo:w,mustExec:!0}),e.next=81;break;case 78:e.prev=78,e.t4=e.catch(50),ke('paste: "'.concat(e.t4.message,'".'));case 81:case"end":return e.stop()}}),e,this,[[3,29,32,35],[8,19,22,25],[38,42],[50,78],[53,67,70,73]])})));return function(t){return e.apply(this,arguments)}}()},{key:"keydown",value:function(t){this.isShiftKeyDown||"Shift"!==t.key||(this.isShiftKeyDown=!0),b(this,Gi)[Gi]===X.NONE||this.isEditorHandlingKeyboard||e._keyboardManager.exec(this,t)}},{key:"keyup",value:function(e){this.isShiftKeyDown&&"Shift"===e.key&&(this.isShiftKeyDown=!1,b(this,Zi)[Zi]&&(b(this,Zi)[Zi]=!1,b(this,on)[on]("main_toolbar")))}},{key:"onEditingAction",value:function(e){var t=e.name;switch(t){case"undo":case"redo":case"delete":case"selectAll":this[t]();break;case"highlightSelection":this.highlightSelection("context_menu")}}},{key:"setEditingState",value:function(e){e?(b(this,un)[un](),b(this,vn)[vn](),b(this,gn)[gn]({isEditing:b(this,Gi)[Gi]!==X.NONE,isEmpty:b(this,An)[An](),hasSomethingToUndo:b(this,mi)[mi].hasSomethingToUndo(),hasSomethingToRedo:b(this,mi)[mi].hasSomethingToRedo(),hasSelectedEditor:!1})):(b(this,hn)[hn](),b(this,fn)[fn](),b(this,gn)[gn]({isEditing:!1}),this.disableUserSelect(!1))}},{key:"registerEditorTypes",value:function(e){if(!b(this,xi)[xi]){b(this,xi)[xi]=e;var t,i=(0,v.Z)(b(this,xi)[xi]);try{for(i.s();!(t=i.n()).done;){var n=t.value;b(this,yn)[yn](n.defaultPropertiesToUpdate)}}catch(r){i.e(r)}finally{i.f()}}}},{key:"getId",value:function(){return b(this,Di)[Di].id}},{key:"currentLayer",get:function(){return b(this,fi)[fi].get(b(this,ki)[ki])}},{key:"getLayer",value:function(e){return b(this,fi)[fi].get(e)}},{key:"currentPageIndex",get:function(){return b(this,ki)[ki]}},{key:"addLayer",value:function(e){b(this,fi)[fi].set(e.pageIndex,e),b(this,Li)[Li]?e.enable():e.disable()}},{key:"removeLayer",value:function(e){b(this,fi)[fi].delete(e.pageIndex)}},{key:"updateMode",value:function(){var e=(0,d.Z)((0,h.Z)().mark((function e(t){var i,n,r,a,s,o,l,u,c,d,f,p=arguments;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=p.length>1&&void 0!==p[1]?p[1]:null,r=p.length>2&&void 0!==p[2]&&p[2],a=p.length>3&&void 0!==p[3]&&p[3],b(this,Gi)[Gi]!==t){e.next=5;break}return e.abrupt("return");case 5:if(!b(this,tn)[tn]){e.next=10;break}return e.next=8,b(this,tn)[tn].promise;case 8:if(b(this,tn)[tn]){e.next=10;break}return e.abrupt("return");case 10:if(b(this,tn)[tn]=Promise.withResolvers(),null===(i=b(this,wi)[wi])||void 0===i||i.commitOrRemove(),b(this,Gi)[Gi]=t,t!==X.NONE){e.next=19;break}return this.setEditingState(!1),b(this,bn)[bn](),null===(s=this._editorUndoBar)||void 0===s||s.hide(),b(this,tn)[tn].resolve(),e.abrupt("return");case 19:if(t!==X.SIGNATURE){e.next=22;break}return e.next=22,null===(o=b(this,Wi)[Wi])||void 0===o?void 0:o.loadSignatures();case 22:return this.setEditingState(!0),e.next=25,b(this,mn)[mn]();case 25:this.unselectAll(),l=(0,v.Z)(b(this,fi)[fi].values());try{for(l.s();!(u=l.n()).done;)u.value.updateMode(t)}catch(h){l.e(h)}finally{l.f()}if(n){e.next=32;break}return r&&this.addNewEditorFromKeyboard(),b(this,tn)[tn].resolve(),e.abrupt("return");case 32:c=(0,v.Z)(b(this,vi)[vi].values());try{for(c.s();!(d=c.n()).done;)(f=d.value).annotationElementId===n||f.id===n?(this.setSelected(f),a&&f.enterInEditMode()):f.unselect()}catch(h){c.e(h)}finally{c.f()}b(this,tn)[tn].resolve();case 35:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"addNewEditorFromKeyboard",value:function(){this.currentLayer.canCreateNewEmptyEditor()&&this.currentLayer.addNewEditor()}},{key:"updateToolbar",value:function(e){e.mode!==b(this,Gi)[Gi]&&this._eventBus.dispatch("switchannotationeditormode",(0,l.Z)({source:this},e))}},{key:"updateParams",value:function(e,t){var i,n;if(b(this,xi)[xi]){switch(e){case Y.CREATE:return void this.currentLayer.addNewEditor(t);case Y.HIGHLIGHT_DEFAULT_COLOR:null===(i=b(this,Bi)[Bi])||void 0===i||i.updateColor(t);break;case Y.HIGHLIGHT_SHOW_ALL:this._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:{type:"highlight",action:"toggle_visibility"}}}),((n=b(this,Xi))[Xi]||(n[Xi]=new Map)).set(e,t),this.showAllEditors("highlight",t)}var r,a=(0,v.Z)(b(this,Ui)[Ui]);try{for(a.s();!(r=a.n()).done;){r.value.updateParams(e,t)}}catch(l){a.e(l)}finally{a.f()}var s,o=(0,v.Z)(b(this,xi)[xi]);try{for(o.s();!(s=o.n()).done;){s.value.updateDefaultParams(e,t)}}catch(l){o.e(l)}finally{o.f()}}}},{key:"showAllEditors",value:function(e,t){var i,n,r,a=(0,v.Z)(b(this,vi)[vi].values());try{for(a.s();!(r=a.n()).done;){var s=r.value;s.editorType===e&&s.show(t)}}catch(l){a.e(l)}finally{a.f()}var o=null===(i=null===(n=b(this,Xi)[Xi])||void 0===n?void 0:n.get(Y.HIGHLIGHT_SHOW_ALL))||void 0===i||i;o!==t&&b(this,yn)[yn]([[Y.HIGHLIGHT_SHOW_ALL,t]])}},{key:"enableWaiting",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(b(this,ji)[ji]!==e){b(this,ji)[ji]=e;var t,i=(0,v.Z)(b(this,fi)[fi].values());try{for(i.s();!(t=i.n()).done;){var n=t.value;e?n.disableClick():n.enableClick(),n.div.classList.toggle("waiting",e)}}catch(r){i.e(r)}finally{i.f()}}}},{key:"getEditors",value:function(e){var t,i=[],n=(0,v.Z)(b(this,vi)[vi].values());try{for(n.s();!(t=n.n()).done;){var r=t.value;r.pageIndex===e&&i.push(r)}}catch(a){n.e(a)}finally{n.f()}return i}},{key:"getEditor",value:function(e){return b(this,vi)[vi].get(e)}},{key:"addEditor",value:function(e){b(this,vi)[vi].set(e.id,e)}},{key:"removeEditor",value:function(e){var t,i,n=this;(e.div.contains(document.activeElement)&&(b(this,Mi)[Mi]&&clearTimeout(b(this,Mi)[Mi]),b(this,Mi)[Mi]=setTimeout((function(){n.focusMainContainer(),b(n,Mi)[Mi]=null}),0)),b(this,vi)[vi].delete(e.id),e.annotationElementId)&&(null===(t=b(this,Hi)[Hi])||void 0===t||t.delete(e.annotationElementId));(this.unselect(e),e.annotationElementId&&b(this,Ai)[Ai].has(e.annotationElementId))||(null===(i=b(this,gi)[gi])||void 0===i||i.remove(e.id))}},{key:"addDeletedAnnotationElement",value:function(e){b(this,Ai)[Ai].add(e.annotationElementId),this.addChangedExistingAnnotation(e),e.deleted=!0}},{key:"isDeletedAnnotationElement",value:function(e){return b(this,Ai)[Ai].has(e)}},{key:"removeDeletedAnnotationElement",value:function(e){b(this,Ai)[Ai].delete(e.annotationElementId),this.removeChangedExistingAnnotation(e),e.deleted=!1}},{key:"setActiveEditor",value:function(e){b(this,di)[di]!==e&&(b(this,di)[di]=e,e&&b(this,yn)[yn](e.propertiesToUpdate))}},{key:"updateUI",value:function(e){b(this,kn)[kn]===e&&b(this,yn)[yn](e.propertiesToUpdate)}},{key:"updateUIForDefaultProperties",value:function(e){b(this,yn)[yn](e.defaultPropertiesToUpdate)}},{key:"toggleSelected",value:function(e){if(b(this,Ui)[Ui].has(e))return b(this,Ui)[Ui].delete(e),e.unselect(),void b(this,gn)[gn]({hasSelectedEditor:this.hasSelection});b(this,Ui)[Ui].add(e),e.select(),b(this,yn)[yn](e.propertiesToUpdate),b(this,gn)[gn]({hasSelectedEditor:!0})}},{key:"setSelected",value:function(e){var t;this.updateToolbar({mode:e.mode,editId:e.id}),null===(t=b(this,wi)[wi])||void 0===t||t.commitOrRemove();var i,n=(0,v.Z)(b(this,Ui)[Ui]);try{for(n.s();!(i=n.n()).done;){var r=i.value;r!==e&&r.unselect()}}catch(a){n.e(a)}finally{n.f()}b(this,Ui)[Ui].clear(),b(this,Ui)[Ui].add(e),e.select(),b(this,yn)[yn](e.propertiesToUpdate),b(this,gn)[gn]({hasSelectedEditor:!0})}},{key:"isSelected",value:function(e){return b(this,Ui)[Ui].has(e)}},{key:"firstSelectedEditor",get:function(){return b(this,Ui)[Ui].values().next().value}},{key:"unselect",value:function(e){e.unselect(),b(this,Ui)[Ui].delete(e),b(this,gn)[gn]({hasSelectedEditor:this.hasSelection})}},{key:"hasSelection",get:function(){return 0!==b(this,Ui)[Ui].size}},{key:"isEnterHandled",get:function(){return 1===b(this,Ui)[Ui].size&&this.firstSelectedEditor.isEnterHandled}},{key:"undo",value:function(){var e;b(this,mi)[mi].undo(),b(this,gn)[gn]({hasSomethingToUndo:b(this,mi)[mi].hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:b(this,An)[An]()}),null===(e=this._editorUndoBar)||void 0===e||e.hide()}},{key:"redo",value:function(){b(this,mi)[mi].redo(),b(this,gn)[gn]({hasSomethingToUndo:!0,hasSomethingToRedo:b(this,mi)[mi].hasSomethingToRedo(),isEmpty:b(this,An)[An]()})}},{key:"addCommands",value:function(e){b(this,mi)[mi].add(e),b(this,gn)[gn]({hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:b(this,An)[An]()})}},{key:"cleanUndoStack",value:function(e){b(this,mi)[mi].cleanType(e)}},{key:"delete",value:function(){var e,t=this;this.commitOrRemove();var i=null===(e=this.currentLayer)||void 0===e?void 0:e.endDrawingSession(!0);if(this.hasSelection||i){var n=i?[i]:(0,u.Z)(b(this,Ui)[Ui]),r=function(){var e,i=(0,v.Z)(n);try{for(i.s();!(e=i.n()).done;){var r=e.value;b(t,wn)[wn](r)}}catch(a){i.e(a)}finally{i.f()}};this.addCommands({cmd:function(){var e;null===(e=t._editorUndoBar)||void 0===e||e.show(r,1===n.length?n[0].editorType:n.length);var i,a=(0,v.Z)(n);try{for(a.s();!(i=a.n()).done;){i.value.remove()}}catch(s){a.e(s)}finally{a.f()}},undo:r,mustExec:!0})}}},{key:"commitOrRemove",value:function(){var e;null===(e=b(this,di)[di])||void 0===e||e.commitOrRemove()}},{key:"hasSomethingToControl",value:function(){return b(this,di)[di]||this.hasSelection}},{key:"selectAll",value:function(){var e,t=(0,v.Z)(b(this,Ui)[Ui]);try{for(t.s();!(e=t.n()).done;){e.value.commit()}}catch(i){t.e(i)}finally{t.f()}b(this,_n)[_n](b(this,vi)[vi].values())}},{key:"unselectAll",value:function(){var e;if((!b(this,di)[di]||(b(this,di)[di].commitOrRemove(),b(this,Gi)[Gi]===X.NONE))&&(null===(e=b(this,wi)[wi])||void 0===e||!e.commitOrRemove())&&this.hasSelection){var t,i=(0,v.Z)(b(this,Ui)[Ui]);try{for(i.s();!(t=i.n()).done;){t.value.unselect()}}catch(n){i.e(n)}finally{i.f()}b(this,Ui)[Ui].clear(),b(this,gn)[gn]({hasSelectedEditor:!1})}}},{key:"translateSelectedEditors",value:function(e,t){var i=this,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(n||this.commitOrRemove(),this.hasSelection){b(this,Ki)[Ki][0]+=e,b(this,Ki)[Ki][1]+=t;var r=(0,c.Z)(b(this,Ki)[Ki],2),a=r[0],s=r[1],o=(0,u.Z)(b(this,Ui)[Ui]),l=1e3;b(this,Qi)[Qi]&&clearTimeout(b(this,Qi)[Qi]),b(this,Qi)[Qi]=setTimeout((function(){b(i,Qi)[Qi]=null,b(i,Ki)[Ki][0]=b(i,Ki)[Ki][1]=0,i.addCommands({cmd:function(){var e,t=(0,v.Z)(o);try{for(t.s();!(e=t.n()).done;){var n=e.value;b(i,vi)[vi].has(n.id)&&(n.translateInPage(a,s),n.translationDone())}}catch(r){t.e(r)}finally{t.f()}},undo:function(){var e,t=(0,v.Z)(o);try{for(t.s();!(e=t.n()).done;){var n=e.value;b(i,vi)[vi].has(n.id)&&(n.translateInPage(-a,-s),n.translationDone())}}catch(r){t.e(r)}finally{t.f()}},mustExec:!1})}),l);var h,d=(0,v.Z)(o);try{for(d.s();!(h=d.n()).done;){var f=h.value;f.translateInPage(e,t),f.translationDone()}}catch(p){d.e(p)}finally{d.f()}}}},{key:"setUpDragSession",value:function(){if(this.hasSelection){this.disableUserSelect(!0),b(this,_i)[_i]=new Map;var e,t=(0,v.Z)(b(this,Ui)[Ui]);try{for(t.s();!(e=t.n()).done;){var i=e.value;b(this,_i)[_i].set(i,{savedX:i.x,savedY:i.y,savedPageIndex:i.pageIndex,newX:0,newY:0,newPageIndex:-1})}}catch(n){t.e(n)}finally{t.f()}}}},{key:"endDragSession",value:function(){var e=this;if(!b(this,_i)[_i])return!1;this.disableUserSelect(!1);var t=b(this,_i)[_i];b(this,_i)[_i]=null;var i,n=!1,r=(0,v.Z)(t);try{for(r.s();!(i=r.n()).done;){var a=(0,c.Z)(i.value,2),s=a[0],o=s.x,l=s.y,u=s.pageIndex,h=a[1];h.newX=o,h.newY=l,h.newPageIndex=u,n||(n=o!==h.savedX||l!==h.savedY||u!==h.savedPageIndex)}}catch(f){r.e(f)}finally{r.f()}if(!n)return!1;var d=function(t,i,n,r){if(b(e,vi)[vi].has(t.id)){var a=b(e,fi)[fi].get(r);a?t._setParentAndPosition(a,i,n):(t.pageIndex=r,t.x=i,t.y=n)}};return this.addCommands({cmd:function(){var e,i=(0,v.Z)(t);try{for(i.s();!(e=i.n()).done;){var n=(0,c.Z)(e.value,2),r=n[0],a=n[1],s=a.newX,o=a.newY,l=a.newPageIndex;d(r,s,o,l)}}catch(f){i.e(f)}finally{i.f()}},undo:function(){var e,i=(0,v.Z)(t);try{for(i.s();!(e=i.n()).done;){var n=(0,c.Z)(e.value,2),r=n[0],a=n[1],s=a.savedX,o=a.savedY,l=a.savedPageIndex;d(r,s,o,l)}}catch(f){i.e(f)}finally{i.f()}},mustExec:!0}),!0}},{key:"dragSelectedEditors",value:function(e,t){if(b(this,_i)[_i]){var i,n=(0,v.Z)(b(this,_i)[_i].keys());try{for(n.s();!(i=n.n()).done;){i.value.drag(e,t)}}catch(r){n.e(r)}finally{n.f()}}}},{key:"rebuild",value:function(e){if(null===e.parent){var t=this.getLayer(e.pageIndex);t?(t.changeParent(e),t.addOrRebuild(e)):(this.addEditor(e),this.addToAnnotationStorage(e),e.rebuild())}else e.parent.addOrRebuild(e)}},{key:"isEditorHandlingKeyboard",get:function(){var e;return(null===(e=this.getActive())||void 0===e?void 0:e.shouldGetKeyboardEvents())||1===b(this,Ui)[Ui].size&&this.firstSelectedEditor.shouldGetKeyboardEvents()}},{key:"isActive",value:function(e){return b(this,di)[di]===e}},{key:"getActive",value:function(){return b(this,di)[di]}},{key:"getMode",value:function(){return b(this,Gi)[Gi]}},{key:"imageManager",get:function(){return Ee(this,"imageManager",new $t)}},{key:"getSelectionBoxes",value:function(e){if(!e)return null;for(var t=document.getSelection(),i=0,n=t.rangeCount;i<n;i++)if(!e.contains(t.getRangeAt(i).commonAncestorContainer))return null;var r,a=e.getBoundingClientRect(),s=a.x,o=a.y,l=a.width,u=a.height;switch(e.getAttribute("data-main-rotation")){case"90":r=function(e,t,i,n){return{x:(t-o)/u,y:1-(e+i-s)/l,width:n/u,height:i/l}};break;case"180":r=function(e,t,i,n){return{x:1-(e+i-s)/l,y:1-(t+n-o)/u,width:i/l,height:n/u}};break;case"270":r=function(e,t,i,n){return{x:1-(t+n-o)/u,y:(e-s)/l,width:n/u,height:i/l}};break;default:r=function(e,t,i,n){return{x:(e-s)/l,y:(t-o)/u,width:i/l,height:n/u}}}for(var h=[],c=0,d=t.rangeCount;c<d;c++){var f=t.getRangeAt(c);if(!f.collapsed){var p,g=(0,v.Z)(f.getClientRects());try{for(g.s();!(p=g.n()).done;){var y=p.value,m=y.x,b=y.y,w=y.width,k=y.height;0!==w&&0!==k&&h.push(r(m,b,w,k))}}catch(A){g.e(A)}finally{g.f()}}}return 0===h.length?null:h}},{key:"addChangedExistingAnnotation",value:function(e){var t,i=e.annotationElementId,n=e.id;((t=b(this,yi))[yi]||(t[yi]=new Map)).set(i,n)}},{key:"removeChangedExistingAnnotation",value:function(e){var t,i=e.annotationElementId;null===(t=b(this,yi)[yi])||void 0===t||t.delete(i)}},{key:"renderAnnotationElement",value:function(e){var t,i=null===(t=b(this,yi)[yi])||void 0===t?void 0:t.get(e.data.id);if(i){var n=b(this,gi)[gi].getRawValue(i);n&&(b(this,Gi)[Gi]!==X.NONE||n.hasBeenModified)&&n.renderAnnotationElement(e)}}},{key:"setMissingCanvas",value:function(e,t,i){var n,r=null===(n=b(this,Hi)[Hi])||void 0===n?void 0:n.get(e);r&&(r.setCanvas(t,i),b(this,Hi)[Hi].delete(e))}},{key:"addMissingCanvas",value:function(e,t){var i;((i=b(this,Hi))[Hi]||(i[Hi]=new Map)).set(e,t)}}],[{key:"_keyboardManager",get:function(){var t=e.prototype,i=function(e){return b(e,Ji)[Ji].contains(document.activeElement)&&"BUTTON"!==document.activeElement.tagName&&e.hasSomethingToControl()},n=function(e,t){var i=t.target;if(i instanceof HTMLInputElement){var n=i.type;return"text"!==n&&"number"!==n}return!0},r=this.TRANSLATE_SMALL,a=this.TRANSLATE_BIG;return Ee(this,"_keyboardManager",new li([[["ctrl+a","mac+meta+a"],t.selectAll,{checker:n}],[["ctrl+z","mac+meta+z"],t.undo,{checker:n}],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],t.redo,{checker:n}],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],t.delete,{checker:n}],[["Enter","mac+Enter"],t.addNewEditorFromKeyboard,{checker:function(e,t){var i=t.target;return!(i instanceof HTMLButtonElement)&&b(e,Ji)[Ji].contains(i)&&!e.isEnterHandled}}],[[" ","mac+ "],t.addNewEditorFromKeyboard,{checker:function(e,t){return!(t.target instanceof HTMLButtonElement)&&b(e,Ji)[Ji].contains(document.activeElement)}}],[["Escape","mac+Escape"],t.unselectAll],[["ArrowLeft","mac+ArrowLeft"],t.translateSelectedEditors,{args:[-r,0],checker:i}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t.translateSelectedEditors,{args:[-a,0],checker:i}],[["ArrowRight","mac+ArrowRight"],t.translateSelectedEditors,{args:[r,0],checker:i}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t.translateSelectedEditors,{args:[a,0],checker:i}],[["ArrowUp","mac+ArrowUp"],t.translateSelectedEditors,{args:[0,-r],checker:i}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t.translateSelectedEditors,{args:[0,-a],checker:i}],[["ArrowDown","mac+ArrowDown"],t.translateSelectedEditors,{args:[0,r],checker:i}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t.translateSelectedEditors,{args:[0,a],checker:i}]]))}}]),e}();function Pn(e){var t=e.anchorNode;return t.nodeType===Node.TEXT_NODE?t.parentElement:t}function Sn(e){var t=this.currentLayer;if(t.hasTextLayer(e))return t;var i,n=(0,v.Z)(b(this,fi)[fi].values());try{for(n.s();!(i=n.n()).done;){var r=i.value;if(r.hasTextLayer(e))return r}}catch(a){n.e(a)}finally{n.f()}return null}function En(){var e,t=document.getSelection();if(t&&!t.isCollapsed){var i=b(this,nn)[nn](t).closest(".textLayer"),n=this.getSelectionBoxes(i);n&&((e=b(this,Ii))[Ii]||(e[Ii]=new zt(this)),b(this,Ii)[Ii].show(i,n,"ltr"===this.direction))}}function Cn(){var e,t=this,i=document.getSelection();if(i&&!i.isCollapsed){var n=i.anchorNode;if(n!==b(this,Vi)[Vi]){var r,a=b(this,nn)[nn](i).closest(".textLayer");if(a){if(null===(e=b(this,Ii)[Ii])||void 0===e||e.hide(),b(this,Vi)[Vi]=n,b(this,gn)[gn]({hasSelectedText:!0}),(b(this,Gi)[Gi]===X.HIGHLIGHT||b(this,Gi)[Gi]===X.NONE)&&(b(this,Gi)[Gi]===X.HIGHLIGHT&&this.showAllEditors("highlight",!0,!0),b(this,Zi)[Zi]=this.isShiftKeyDown,!this.isShiftKeyDown)){var s=b(this,Gi)[Gi]===X.HIGHLIGHT?b(this,rn)[rn](a):null;null===s||void 0===s||s.toggleDrawing();var o=new AbortController,l=this.combinedSignal(o),u=function(e){"pointerup"===e.type&&0!==e.button||(o.abort(),null===s||void 0===s||s.toggleDrawing(!0),"pointerup"===e.type&&b(t,on)[on]("main_toolbar"))};window.addEventListener("pointerup",u,{signal:l}),window.addEventListener("blur",u,{signal:l})}}else b(this,Vi)[Vi]&&(null===(r=b(this,Ii)[Ii])||void 0===r||r.hide(),b(this,Vi)[Vi]=null,b(this,gn)[gn]({hasSelectedText:!1}))}}else{var h;b(this,Vi)[Vi]&&(null===(h=b(this,Ii)[Ii])||void 0===h||h.hide(),b(this,Vi)[Vi]=null,b(this,gn)[gn]({hasSelectedText:!1}))}}function On(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";b(this,Gi)[Gi]===X.HIGHLIGHT?this.highlightSelection(e):b(this,Si)[Si]&&b(this,an)[an]()}function Mn(){document.addEventListener("selectionchange",b(this,sn)[sn].bind(this),{signal:this._signal})}function Tn(){if(!b(this,Ti)[Ti]){b(this,Ti)[Ti]=new AbortController;var e=this.combinedSignal(b(this,Ti)[Ti]);window.addEventListener("focus",this.focus.bind(this),{signal:e}),window.addEventListener("blur",this.blur.bind(this),{signal:e})}}function Rn(){var e;null===(e=b(this,Ti)[Ti])||void 0===e||e.abort(),b(this,Ti)[Ti]=null}function Zn(){if(!b(this,Fi)[Fi]){b(this,Fi)[Fi]=new AbortController;var e=this.combinedSignal(b(this,Fi)[Fi]);window.addEventListener("keydown",this.keydown.bind(this),{signal:e}),window.addEventListener("keyup",this.keyup.bind(this),{signal:e})}}function In(){var e;null===(e=b(this,Fi)[Fi])||void 0===e||e.abort(),b(this,Fi)[Fi]=null}function Dn(){if(!b(this,bi)[bi]){b(this,bi)[bi]=new AbortController;var e=this.combinedSignal(b(this,bi)[bi]);document.addEventListener("copy",this.copy.bind(this),{signal:e}),document.addEventListener("cut",this.cut.bind(this),{signal:e}),document.addEventListener("paste",this.paste.bind(this),{signal:e})}}function Ln(){var e;null===(e=b(this,bi)[bi])||void 0===e||e.abort(),b(this,bi)[bi]=null}function jn(){var e=this._signal;document.addEventListener("dragover",this.dragOver.bind(this),{signal:e}),document.addEventListener("drop",this.drop.bind(this),{signal:e})}function Fn(e){var t=this;Object.entries(e).some((function(e){var i=(0,c.Z)(e,2),n=i[0],r=i[1];return b(t,Yi)[Yi][n]!==r}))&&(this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(b(this,Yi)[Yi],e)}),b(this,Gi)[Gi]===X.HIGHLIGHT&&!1===e.hasSelectedEditor&&b(this,yn)[yn]([[Y.HIGHLIGHT_FREE,!0]]))}function Nn(e){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:e})}function Bn(){return Hn.apply(this,arguments)}function Hn(){return(Hn=(0,d.Z)((0,h.Z)().mark((function e(){var t,i,n,r,a,s;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(b(this,Li)[Li]){e.next=9;break}b(this,Li)[Li]=!0,t=[],i=(0,v.Z)(b(this,fi)[fi].values());try{for(i.s();!(n=i.n()).done;)r=n.value,t.push(r.enable())}catch(o){i.e(o)}finally{i.f()}return e.next=7,Promise.all(t);case 7:a=(0,v.Z)(b(this,vi)[vi].values());try{for(a.s();!(s=a.n()).done;)s.value.enable()}catch(o){a.e(o)}finally{a.f()}case 9:case"end":return e.stop()}}),e,this)})))).apply(this,arguments)}function zn(){if(this.unselectAll(),b(this,Li)[Li]){b(this,Li)[Li]=!1;var e,t=(0,v.Z)(b(this,fi)[fi].values());try{for(t.s();!(e=t.n()).done;){e.value.disable()}}catch(r){t.e(r)}finally{t.f()}var i,n=(0,v.Z)(b(this,vi)[vi].values());try{for(n.s();!(i=n.n()).done;){i.value.disable()}}catch(r){n.e(r)}finally{n.f()}}}function Gn(e){var t=b(this,fi)[fi].get(e.pageIndex);t?t.addOrRebuild(e):(this.addEditor(e),this.addToAnnotationStorage(e))}function Un(){var e,t=null,i=(0,v.Z)(b(this,Ui)[Ui]);try{for(i.s();!(e=i.n()).done;)t=e.value}catch(n){i.e(n)}finally{i.f()}return t}function Vn(){if(0===b(this,vi)[vi].size)return!0;if(1===b(this,vi)[vi].size){var e,t=(0,v.Z)(b(this,vi)[vi].values());try{for(t.s();!(e=t.n()).done;){return e.value.isEmpty()}}catch(i){t.e(i)}finally{t.f()}}return!1}function Wn(e){var t,i=(0,v.Z)(b(this,Ui)[Ui]);try{for(i.s();!(t=i.n()).done;){t.value.unselect()}}catch(s){i.e(s)}finally{i.f()}b(this,Ui)[Ui].clear();var n,r=(0,v.Z)(e);try{for(r.s();!(n=r.n()).done;){var a=n.value;a.isEmpty()||(b(this,Ui)[Ui].add(a),a.select())}}catch(s){r.e(s)}finally{r.f()}b(this,gn)[gn]({hasSelectedEditor:this.hasSelection})}xn.TRANSLATE_SMALL=1,xn.TRANSLATE_BIG=10;var qn=k("altText"),Xn=k("altTextDecorative"),Yn=k("altTextButton"),Kn=k("altTextButtonLabel"),Qn=k("altTextTooltip"),Jn=k("altTextTooltipTimeout"),$n=k("altTextWasFromKeyBoard"),er=k("badge"),tr=k("editor"),ir=k("guessedText"),nr=k("textWithDisclaimer"),rr=k("useNewAltTextFlow"),ar=k("l10nNewButton"),sr=k("label"),or=k("setState"),lr=function(){function e(t){var i;(0,_.Z)(this,e),Object.defineProperty(this,or,{value:hr}),Object.defineProperty(this,sr,{get:ur,set:void 0}),Object.defineProperty(this,qn,{writable:!0,value:null}),Object.defineProperty(this,Xn,{writable:!0,value:!1}),Object.defineProperty(this,Yn,{writable:!0,value:null}),Object.defineProperty(this,Kn,{writable:!0,value:null}),Object.defineProperty(this,Qn,{writable:!0,value:null}),Object.defineProperty(this,Jn,{writable:!0,value:null}),Object.defineProperty(this,$n,{writable:!0,value:!1}),Object.defineProperty(this,er,{writable:!0,value:null}),Object.defineProperty(this,tr,{writable:!0,value:null}),Object.defineProperty(this,ir,{writable:!0,value:null}),Object.defineProperty(this,nr,{writable:!0,value:null}),Object.defineProperty(this,rr,{writable:!0,value:!1}),b(this,tr)[tr]=t,b(this,rr)[rr]=t._uiManager.useNewAltTextFlow,(i=b(e,ar))[ar]||(i[ar]=Object.freeze({added:"pdfjs-editor-new-alt-text-added-button","added-label":"pdfjs-editor-new-alt-text-added-button-label",missing:"pdfjs-editor-new-alt-text-missing-button","missing-label":"pdfjs-editor-new-alt-text-missing-button-label",review:"pdfjs-editor-new-alt-text-to-review-button","review-label":"pdfjs-editor-new-alt-text-to-review-button-label"}))}return(0,A.Z)(e,[{key:"render",value:function(){var t=(0,d.Z)((0,h.Z)().mark((function t(){var i,n,r,a,s=this;return(0,h.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return(i=b(this,Yn)[Yn]=document.createElement("button")).className="altText",i.tabIndex="0",n=b(this,Kn)[Kn]=document.createElement("span"),i.append(n),b(this,rr)[rr]?(i.classList.add("new"),i.setAttribute("data-l10n-id",b(e,ar)[ar].missing),n.setAttribute("data-l10n-id",b(e,ar)[ar]["missing-label"])):(i.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button"),n.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button-label")),r=b(this,tr)[tr]._uiManager._signal,i.addEventListener("contextmenu",lt,{signal:r}),i.addEventListener("pointerdown",(function(e){return e.stopPropagation()}),{signal:r}),a=function(e){e.preventDefault(),b(s,tr)[tr]._uiManager.editAltText(b(s,tr)[tr]),b(s,rr)[rr]&&b(s,tr)[tr]._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_clicked",data:{label:b(s,sr)[sr]}})},i.addEventListener("click",a,{capture:!0,signal:r}),i.addEventListener("keydown",(function(e){e.target===i&&"Enter"===e.key&&(b(s,$n)[$n]=!0,a(e))}),{signal:r}),t.next=14,b(this,or)[or]();case 14:return t.abrupt("return",i);case 15:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"finish",value:function(){b(this,Yn)[Yn]&&(b(this,Yn)[Yn].focus({focusVisible:b(this,$n)[$n]}),b(this,$n)[$n]=!1)}},{key:"isEmpty",value:function(){return b(this,rr)[rr]?null===b(this,qn)[qn]:!b(this,qn)[qn]&&!b(this,Xn)[Xn]}},{key:"hasData",value:function(){return b(this,rr)[rr]?null!==b(this,qn)[qn]||!!b(this,ir)[ir]:this.isEmpty()}},{key:"guessedText",get:function(){return b(this,ir)[ir]}},{key:"setGuessedText",value:function(){var t=(0,d.Z)((0,h.Z)().mark((function t(i){return(0,h.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(null===b(this,qn)[qn]){t.next=2;break}return t.abrupt("return");case 2:return b(this,ir)[ir]=i,t.next=5,e._l10n.get("pdfjs-editor-new-alt-text-generated-alt-text-with-disclaimer",{generatedAltText:i});case 5:b(this,nr)[nr]=t.sent,b(this,or)[or]();case 7:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"toggleAltTextBadge",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!b(this,rr)[rr]||b(this,qn)[qn])return null===(e=b(this,er)[er])||void 0===e||e.remove(),void(b(this,er)[er]=null);if(!b(this,er)[er]){var i=b(this,er)[er]=document.createElement("div");i.className="noAltTextBadge",b(this,tr)[tr].div.append(i)}b(this,er)[er].classList.toggle("hidden",!t)}},{key:"serialize",value:function(e){var t=b(this,qn)[qn];return e||b(this,ir)[ir]!==t||(t=b(this,nr)[nr]),{altText:t,decorative:b(this,Xn)[Xn],guessedText:b(this,ir)[ir],textWithDisclaimer:b(this,nr)[nr]}}},{key:"data",get:function(){return{altText:b(this,qn)[qn],decorative:b(this,Xn)[Xn]}},set:function(e){var t=e.altText,i=e.decorative,n=e.guessedText,r=e.textWithDisclaimer,a=e.cancel,s=void 0!==a&&a;n&&(b(this,ir)[ir]=n,b(this,nr)[nr]=r),b(this,qn)[qn]===t&&b(this,Xn)[Xn]===i||(s||(b(this,qn)[qn]=t,b(this,Xn)[Xn]=i),b(this,or)[or]())}},{key:"toggle",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];b(this,Yn)[Yn]&&(!e&&b(this,Jn)[Jn]&&(clearTimeout(b(this,Jn)[Jn]),b(this,Jn)[Jn]=null),b(this,Yn)[Yn].disabled=!e)}},{key:"shown",value:function(){b(this,tr)[tr]._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_displayed",data:{label:b(this,sr)[sr]}})}},{key:"destroy",value:function(){var e,t;null===(e=b(this,Yn)[Yn])||void 0===e||e.remove(),b(this,Yn)[Yn]=null,b(this,Kn)[Kn]=null,b(this,Qn)[Qn]=null,null===(t=b(this,er)[er])||void 0===t||t.remove(),b(this,er)[er]=null}}],[{key:"initialize",value:function(t){var i;null!==(i=e._l10n)&&void 0!==i||(e._l10n=t)}}]),e}();function ur(){return(b(this,qn)[qn]?"added":null===b(this,qn)[qn]&&this.guessedText&&"review")||"missing"}function hr(){return cr.apply(this,arguments)}function cr(){return(cr=(0,d.Z)((0,h.Z)().mark((function e(){var t,i,n,r,a,s,o,l=this;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=b(this,Yn)[Yn]){e.next=3;break}return e.abrupt("return");case 3:if(!b(this,rr)[rr]){e.next=12;break}if(t.classList.toggle("done",!!b(this,qn)[qn]),t.setAttribute("data-l10n-id",b(lr,ar)[ar][b(this,sr)[sr]]),null===(i=b(this,Kn)[Kn])||void 0===i||i.setAttribute("data-l10n-id",b(lr,ar)[ar]["".concat(b(this,sr)[sr],"-label")]),b(this,qn)[qn]){e.next=10;break}return null===(n=b(this,Qn)[Qn])||void 0===n||n.remove(),e.abrupt("return");case 10:e.next=18;break;case 12:if(b(this,qn)[qn]||b(this,Xn)[Xn]){e.next=16;break}return t.classList.remove("done"),null===(r=b(this,Qn)[Qn])||void 0===r||r.remove(),e.abrupt("return");case 16:t.classList.add("done"),t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-edit-button");case 18:(a=b(this,Qn)[Qn])||(b(this,Qn)[Qn]=a=document.createElement("span"),a.className="tooltip",a.setAttribute("role","tooltip"),a.id="alt-text-tooltip-".concat(b(this,tr)[tr].id),100,(s=b(this,tr)[tr]._uiManager._signal).addEventListener("abort",(function(){clearTimeout(b(l,Jn)[Jn]),b(l,Jn)[Jn]=null}),{once:!0}),t.addEventListener("mouseenter",(function(){b(l,Jn)[Jn]=setTimeout((function(){b(l,Jn)[Jn]=null,b(l,Qn)[Qn].classList.add("show"),b(l,tr)[tr]._reportTelemetry({action:"alt_text_tooltip"})}),100)}),{signal:s}),t.addEventListener("mouseleave",(function(){var e;b(l,Jn)[Jn]&&(clearTimeout(b(l,Jn)[Jn]),b(l,Jn)[Jn]=null),null===(e=b(l,Qn)[Qn])||void 0===e||e.classList.remove("show")}),{signal:s})),b(this,Xn)[Xn]?a.setAttribute("data-l10n-id","pdfjs-editor-alt-text-decorative-tooltip"):(a.removeAttribute("data-l10n-id"),a.textContent=b(this,qn)[qn]),a.parentNode||t.append(a),null===(o=b(this,tr)[tr].getElementForAltText())||void 0===o||o.setAttribute("aria-describedby",a.id);case 24:case"end":return e.stop()}}),e,this)})))).apply(this,arguments)}Object.defineProperty(lr,ar,{writable:!0,value:null}),lr._l10n=null;var dr=k("container"),vr=k("isPinching"),fr=k("isPinchingStopped"),pr=k("isPinchingDisabled"),gr=k("onPinchStart"),yr=k("onPinching"),mr=k("onPinchEnd"),br=k("pointerDownAC"),wr=k("signal"),kr=k("touchInfo"),Ar=k("touchManagerAC"),_r=k("touchMoveAC"),xr=k("onTouchStart"),Pr=k("onTouchMove"),Sr=k("onTouchEnd"),Er=function(){function e(t){var i=t.container,n=t.isPinchingDisabled,r=void 0===n?null:n,a=t.isPinchingStopped,s=void 0===a?null:a,o=t.onPinchStart,l=void 0===o?null:o,u=t.onPinching,h=void 0===u?null:u,c=t.onPinchEnd,d=void 0===c?null:c,v=t.signal;(0,_.Z)(this,e),Object.defineProperty(this,Sr,{value:Mr}),Object.defineProperty(this,Pr,{value:Or}),Object.defineProperty(this,xr,{value:Cr}),Object.defineProperty(this,dr,{writable:!0,value:void 0}),Object.defineProperty(this,vr,{writable:!0,value:!1}),Object.defineProperty(this,fr,{writable:!0,value:null}),Object.defineProperty(this,pr,{writable:!0,value:void 0}),Object.defineProperty(this,gr,{writable:!0,value:void 0}),Object.defineProperty(this,yr,{writable:!0,value:void 0}),Object.defineProperty(this,mr,{writable:!0,value:void 0}),Object.defineProperty(this,br,{writable:!0,value:null}),Object.defineProperty(this,wr,{writable:!0,value:void 0}),Object.defineProperty(this,kr,{writable:!0,value:null}),Object.defineProperty(this,Ar,{writable:!0,value:void 0}),Object.defineProperty(this,_r,{writable:!0,value:null}),b(this,dr)[dr]=i,b(this,fr)[fr]=s,b(this,pr)[pr]=r,b(this,gr)[gr]=l,b(this,yr)[yr]=h,b(this,mr)[mr]=d,b(this,Ar)[Ar]=new AbortController,b(this,wr)[wr]=AbortSignal.any([v,b(this,Ar)[Ar].signal]),i.addEventListener("touchstart",b(this,xr)[xr].bind(this),{passive:!1,signal:b(this,wr)[wr]})}return(0,A.Z)(e,[{key:"MIN_TOUCH_DISTANCE_TO_PINCH",get:function(){return 35/yt.pixelRatio}},{key:"destroy",value:function(){var e,t;null===(e=b(this,Ar)[Ar])||void 0===e||e.abort(),b(this,Ar)[Ar]=null,null===(t=b(this,br)[br])||void 0===t||t.abort(),b(this,br)[br]=null}}]),e}();function Cr(e){var t,i,n,r,a=this;if(null===(t=(i=b(this,pr))[pr])||void 0===t||!t.call(i)){if(1===e.touches.length){if(b(this,br)[br])return;var s=b(this,br)[br]=new AbortController,o=AbortSignal.any([b(this,wr)[wr],s.signal]),l=b(this,dr)[dr],u={capture:!0,signal:o,passive:!1},h=function(e){var t;"touch"===e.pointerType&&(null===(t=b(a,br)[br])||void 0===t||t.abort(),b(a,br)[br]=null)};return l.addEventListener("pointerdown",(function(e){"touch"===e.pointerType&&(ut(e),h(e))}),u),l.addEventListener("pointerup",h,u),void l.addEventListener("pointercancel",h,u)}if(!b(this,_r)[_r]){var d,v;b(this,_r)[_r]=new AbortController;var f=AbortSignal.any([b(this,wr)[wr],b(this,_r)[_r].signal]),p=b(this,dr)[dr],g={signal:f,capture:!1,passive:!1};p.addEventListener("touchmove",b(this,Pr)[Pr].bind(this),g);var y=b(this,Sr)[Sr].bind(this);p.addEventListener("touchend",y,g),p.addEventListener("touchcancel",y,g),g.capture=!0,p.addEventListener("pointerdown",ut,g),p.addEventListener("pointermove",ut,g),p.addEventListener("pointercancel",ut,g),p.addEventListener("pointerup",ut,g),null===(d=(v=b(this,gr))[gr])||void 0===d||d.call(v)}if(ut(e),2!==e.touches.length||null!==(n=(r=b(this,fr))[fr])&&void 0!==n&&n.call(r))b(this,kr)[kr]=null;else{var m=(0,c.Z)(e.touches,2),w=m[0],k=m[1];if(w.identifier>k.identifier){var A=[k,w];w=A[0],k=A[1]}b(this,kr)[kr]={touch0X:w.screenX,touch0Y:w.screenY,touch1X:k.screenX,touch1Y:k.screenY}}}}function Or(e){var t,i;if(b(this,kr)[kr]&&2===e.touches.length){ut(e);var n=(0,c.Z)(e.touches,2),r=n[0],a=n[1];if(r.identifier>a.identifier){var s=[a,r];r=s[0],a=s[1]}var o=r,l=o.screenX,u=o.screenY,h=a,d=h.screenX,v=h.screenY,f=b(this,kr)[kr],p=f.touch0X,g=f.touch0Y,y=f.touch1X-p,m=f.touch1Y-g,w=d-l,k=v-u,A=Math.hypot(w,k)||1,_=Math.hypot(y,m)||1;if(b(this,vr)[vr]||!(Math.abs(_-A)<=Er.MIN_TOUCH_DISTANCE_TO_PINCH))if(f.touch0X=l,f.touch0Y=u,f.touch1X=d,f.touch1Y=v,b(this,vr)[vr]){var x=[(l+d)/2,(u+v)/2];null===(t=(i=b(this,yr))[yr])||void 0===t||t.call(i,x,_,A)}else b(this,vr)[vr]=!0}}function Mr(e){if(!(e.touches.length>=2)){var t,i;if(b(this,_r)[_r])b(this,_r)[_r].abort(),b(this,_r)[_r]=null,null===(t=(i=b(this,mr))[mr])||void 0===t||t.call(i);b(this,kr)[kr]&&(ut(e),b(this,kr)[kr]=null,b(this,vr)[vr]=!1)}}var Tr=k("accessibilityData"),Rr=k("allResizerDivs"),Zr=k("altText"),Ir=k("disabled"),Dr=k("dragPointerId"),Lr=k("dragPointerType"),jr=k("keepAspectRatio"),Fr=k("resizersDiv"),Nr=k("lastPointerCoords"),Br=k("savedDimensions"),Hr=k("focusAC"),zr=k("focusedResizerName"),Gr=k("hasBeenClicked"),Ur=k("initialRect"),Vr=k("isEditing"),Wr=k("isInEditMode"),qr=k("isResizerEnabledForKeyboard"),Xr=k("moveInDOMTimeout"),Yr=k("prevDragX"),Kr=k("prevDragY"),Qr=k("telemetryTimeouts"),Jr=k("touchManager"),$r=k("isDraggable"),ea=k("zIndex"),ta=k("translate"),ia=k("rotatePoint"),na=k("getRotationMatrix"),ra=k("createResizers"),aa=k("resizerPointerdown"),sa=k("resize"),oa=k("addResizeToUndoStack"),la=k("resizerPointermove"),ua=k("touchPinchStartCallback"),ha=k("touchPinchCallback"),ca=k("touchPinchEndCallback"),da=k("selectOnPointerEvent"),va=k("setUpDragSession"),fa=k("addFocusListeners"),pa=k("resizerKeydown"),ga=k("resizerBlur"),ya=k("resizerFocus"),ma=k("setResizerTabIndex"),ba=k("stopResizing"),wa=function(){function e(t){(0,_.Z)(this,e),Object.defineProperty(this,ba,{value:Fa}),Object.defineProperty(this,ma,{value:ja}),Object.defineProperty(this,ya,{value:La}),Object.defineProperty(this,ga,{value:Da}),Object.defineProperty(this,pa,{value:Ia}),Object.defineProperty(this,fa,{value:Za}),Object.defineProperty(this,va,{value:Ra}),Object.defineProperty(this,da,{value:Ta}),Object.defineProperty(this,ca,{value:Ma}),Object.defineProperty(this,ha,{value:Oa}),Object.defineProperty(this,ua,{value:Ca}),Object.defineProperty(this,la,{value:Ea}),Object.defineProperty(this,oa,{value:Sa}),Object.defineProperty(this,sa,{value:Pa}),Object.defineProperty(this,aa,{value:xa}),Object.defineProperty(this,ra,{value:_a}),Object.defineProperty(this,na,{value:Aa}),Object.defineProperty(this,ta,{value:ka}),Object.defineProperty(this,Tr,{writable:!0,value:null}),Object.defineProperty(this,Rr,{writable:!0,value:null}),Object.defineProperty(this,Zr,{writable:!0,value:null}),Object.defineProperty(this,Ir,{writable:!0,value:!1}),Object.defineProperty(this,Dr,{writable:!0,value:null}),Object.defineProperty(this,Lr,{writable:!0,value:""}),Object.defineProperty(this,jr,{writable:!0,value:!1}),Object.defineProperty(this,Fr,{writable:!0,value:null}),Object.defineProperty(this,Nr,{writable:!0,value:null}),Object.defineProperty(this,Br,{writable:!0,value:null}),Object.defineProperty(this,Hr,{writable:!0,value:null}),Object.defineProperty(this,zr,{writable:!0,value:""}),Object.defineProperty(this,Gr,{writable:!0,value:!1}),Object.defineProperty(this,Ur,{writable:!0,value:null}),Object.defineProperty(this,Vr,{writable:!0,value:!1}),Object.defineProperty(this,Wr,{writable:!0,value:!1}),Object.defineProperty(this,qr,{writable:!0,value:!1}),Object.defineProperty(this,Xr,{writable:!0,value:null}),Object.defineProperty(this,Yr,{writable:!0,value:0}),Object.defineProperty(this,Kr,{writable:!0,value:0}),Object.defineProperty(this,Qr,{writable:!0,value:null}),Object.defineProperty(this,Jr,{writable:!0,value:null}),this.isSelected=!1,this._isCopy=!1,this._editToolbar=null,this._initialOptions=Object.create(null),this._initialData=null,this._isVisible=!0,this._uiManager=null,this._focusEventsAllowed=!0,Object.defineProperty(this,$r,{writable:!0,value:!1}),Object.defineProperty(this,ea,{writable:!0,value:e._zIndex++}),this.parent=t.parent,this.id=t.id,this.width=this.height=null,this.pageIndex=t.parent.pageIndex,this.name=t.name,this.div=null,this._uiManager=t.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=t.isCentered,this._structTreeParentId=null,this.annotationElementId=t.annotationElementId||null;var i=this.parent.viewport,n=i.rotation,r=i.rawDims,a=r.pageWidth,s=r.pageHeight,o=r.pageX,l=r.pageY;this.rotation=n,this.pageRotation=(360+n-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[a,s],this.pageTranslation=[o,l];var u=(0,c.Z)(this.parentDimensions,2),h=u[0],d=u[1];this.x=t.x/h,this.y=t.y/d,this.isAttachedToDOM=!1,this.deleted=!1}return(0,A.Z)(e,[{key:"editorType",get:function(){return Object.getPrototypeOf(this).constructor._type}},{key:"mode",get:function(){return Object.getPrototypeOf(this).constructor._editorType}},{key:"propertiesToUpdate",get:function(){return[]}},{key:"_isDraggable",get:function(){return b(this,$r)[$r]},set:function(e){var t;b(this,$r)[$r]=e,null===(t=this.div)||void 0===t||t.classList.toggle("draggable",e)}},{key:"isEnterHandled",get:function(){return!0}},{key:"center",value:function(){var e=(0,c.Z)(this.pageDimensions,2),t=e[0],i=e[1];switch(this.parentRotation){case 90:this.x-=this.height*i/(2*t),this.y+=this.width*t/(2*i);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*i/(2*t),this.y-=this.width*t/(2*i);break;default:this.x-=this.width/2,this.y-=this.height/2}this.fixAndSetPosition()}},{key:"addCommands",value:function(e){this._uiManager.addCommands(e)}},{key:"currentLayer",get:function(){return this._uiManager.currentLayer}},{key:"setInBackground",value:function(){this.div.style.zIndex=0}},{key:"setInForeground",value:function(){this.div.style.zIndex=b(this,ea)[ea]}},{key:"setParent",value:function(e){null!==e?(this.pageIndex=e.pageIndex,this.pageDimensions=e.pageDimensions):b(this,ba)[ba](),this.parent=e}},{key:"focusin",value:function(e){this._focusEventsAllowed&&(b(this,Gr)[Gr]?b(this,Gr)[Gr]=!1:this.parent.setSelected(this))}},{key:"focusout",value:function(e){var t;if(this._focusEventsAllowed&&this.isAttachedToDOM){var i=e.relatedTarget;null!==i&&void 0!==i&&i.closest("#".concat(this.id))||(e.preventDefault(),null!==(t=this.parent)&&void 0!==t&&t.isMultipleSelection||this.commitOrRemove())}}},{key:"commitOrRemove",value:function(){this.isEmpty()?this.remove():this.commit()}},{key:"commit",value:function(){this.isInEditMode()&&this.addToAnnotationStorage()}},{key:"addToAnnotationStorage",value:function(){this._uiManager.addToAnnotationStorage(this)}},{key:"setAt",value:function(e,t,i,n){var r=(0,c.Z)(this.parentDimensions,2),a=r[0],s=r[1],o=this.screenToPageTranslation(i,n),l=(0,c.Z)(o,2);i=l[0],n=l[1],this.x=(e+i)/a,this.y=(t+n)/s,this.fixAndSetPosition()}},{key:"_moveAfterPaste",value:function(e,t){var i=(0,c.Z)(this.parentDimensions,2),n=i[0],r=i[1];this.setAt(e*n,t*r,this.width*n,this.height*r),this._onTranslated()}},{key:"translate",value:function(e,t){b(this,ta)[ta](this.parentDimensions,e,t)}},{key:"translateInPage",value:function(e,t){var i;(i=b(this,Ur))[Ur]||(i[Ur]=[this.x,this.y,this.width,this.height]),b(this,ta)[ta](this.pageDimensions,e,t),this.div.scrollIntoView({block:"nearest"})}},{key:"translationDone",value:function(){this._onTranslated(this.x,this.y)}},{key:"drag",value:function(e,t){var i;(i=b(this,Ur))[Ur]||(i[Ur]=[this.x,this.y,this.width,this.height]);var n=this.div,r=(0,c.Z)(this.parentDimensions,2),a=r[0],s=r[1];if(this.x+=e/a,this.y+=t/s,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){var o=this.div.getBoundingClientRect(),l=o.x,u=o.y;this.parent.findNewParent(this,l,u)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}var h=this.x,d=this.y,v=this.getBaseTranslation(),f=(0,c.Z)(v,2);h+=f[0],d+=f[1];var p=n.style;p.left="".concat((100*h).toFixed(2),"%"),p.top="".concat((100*d).toFixed(2),"%"),this._onTranslating(h,d),n.scrollIntoView({block:"nearest"})}},{key:"_onTranslating",value:function(e,t){}},{key:"_onTranslated",value:function(e,t){}},{key:"_hasBeenMoved",get:function(){return!!b(this,Ur)[Ur]&&(b(this,Ur)[Ur][0]!==this.x||b(this,Ur)[Ur][1]!==this.y)}},{key:"_hasBeenResized",get:function(){return!!b(this,Ur)[Ur]&&(b(this,Ur)[Ur][2]!==this.width||b(this,Ur)[Ur][3]!==this.height)}},{key:"getBaseTranslation",value:function(){var t=(0,c.Z)(this.parentDimensions,2),i=t[0],n=t[1],r=e._borderLineWidth,a=r/i,s=r/n;switch(this.rotation){case 90:return[-a,s];case 180:return[a,s];case 270:return[a,-s];default:return[-a,-s]}}},{key:"_mustFixPosition",get:function(){return!0}},{key:"fixAndSetPosition",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.rotation,t=this.div.style,i=(0,c.Z)(this.pageDimensions,2),n=i[0],r=i[1],a=this.x,s=this.y,o=this.width,l=this.height;if(o*=n,l*=r,a*=n,s*=r,this._mustFixPosition)switch(e){case 0:a=Xe(a,0,n-o),s=Xe(s,0,r-l);break;case 90:a=Xe(a,0,n-l),s=Xe(s,o,r);break;case 180:a=Xe(a,o,n),s=Xe(s,l,r);break;case 270:a=Xe(a,l,n),s=Xe(s,0,r-o)}this.x=a/=n,this.y=s/=r;var u=this.getBaseTranslation(),h=(0,c.Z)(u,2),d=h[0],v=h[1];a+=d,s+=v,t.left="".concat((100*a).toFixed(2),"%"),t.top="".concat((100*s).toFixed(2),"%"),this.moveInDOM()}},{key:"screenToPageTranslation",value:function(t,i){return b(e,ia)[ia](t,i,this.parentRotation)}},{key:"pageTranslationToScreen",value:function(t,i){return b(e,ia)[ia](t,i,360-this.parentRotation)}},{key:"parentScale",get:function(){return this._uiManager.viewParameters.realScale}},{key:"parentRotation",get:function(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}},{key:"parentDimensions",get:function(){var e=this.parentScale,t=(0,c.Z)(this.pageDimensions,2);return[t[0]*e,t[1]*e]}},{key:"setDims",value:function(e,t){var i=(0,c.Z)(this.parentDimensions,2),n=i[0],r=i[1],a=this.div.style;a.width="".concat((100*e/n).toFixed(2),"%"),b(this,jr)[jr]||(a.height="".concat((100*t/r).toFixed(2),"%"))}},{key:"fixDims",value:function(){var e=this.div.style,t=e.height,i=e.width,n=i.endsWith("%"),r=!b(this,jr)[jr]&&t.endsWith("%");if(!n||!r){var a=(0,c.Z)(this.parentDimensions,2),s=a[0],o=a[1];n||(e.width="".concat((100*parseFloat(i)/s).toFixed(2),"%")),b(this,jr)[jr]||r||(e.height="".concat((100*parseFloat(t)/o).toFixed(2),"%"))}}},{key:"getInitialTranslation",value:function(){return[0,0]}},{key:"_onResized",value:function(){}},{key:"_onResizing",value:function(){}},{key:"altTextFinish",value:function(){var e;null===(e=b(this,Zr)[Zr])||void 0===e||e.finish()}},{key:"toolbarButtons",get:function(){return null}},{key:"addEditToolbar",value:function(){var e=(0,d.Z)((0,h.Z)().mark((function e(){var t,i,n,r,a,s;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._editToolbar&&!b(this,Wr)[Wr]){e.next=2;break}return e.abrupt("return",this._editToolbar);case 2:if(this._editToolbar=new Tt(this),this.div.append(this._editToolbar.render()),!(t=this.toolbarButtons)){e.next=23;break}i=(0,v.Z)(t),e.prev=7,i.s();case 9:if((n=i.n()).done){e.next=15;break}return r=(0,c.Z)(n.value,2),a=r[0],s=r[1],e.next=13,this._editToolbar.addButton(a,s);case 13:e.next=9;break;case 15:e.next=20;break;case 17:e.prev=17,e.t0=e.catch(7),i.e(e.t0);case 20:return e.prev=20,i.f(),e.finish(20);case 23:return this._editToolbar.addButton("delete"),e.abrupt("return",this._editToolbar);case 25:case"end":return e.stop()}}),e,this,[[7,17,20,23]])})));return function(){return e.apply(this,arguments)}}()},{key:"removeEditToolbar",value:function(){var e;this._editToolbar&&(this._editToolbar.remove(),this._editToolbar=null,null===(e=b(this,Zr)[Zr])||void 0===e||e.destroy())}},{key:"addContainer",value:function(e){var t,i=null===(t=this._editToolbar)||void 0===t?void 0:t.div;i?i.before(e):this.div.append(e)}},{key:"getClientDimensions",value:function(){return this.div.getBoundingClientRect()}},{key:"createAltText",value:function(){return b(this,Zr)[Zr]||(lr.initialize(e._l10n),b(this,Zr)[Zr]=new lr(this),b(this,Tr)[Tr]&&(b(this,Zr)[Zr].data=b(this,Tr)[Tr],b(this,Tr)[Tr]=null)),b(this,Zr)[Zr]}},{key:"altTextData",get:function(){var e;return null===(e=b(this,Zr)[Zr])||void 0===e?void 0:e.data},set:function(e){b(this,Zr)[Zr]&&(b(this,Zr)[Zr].data=e)}},{key:"guessedAltText",get:function(){var e;return null===(e=b(this,Zr)[Zr])||void 0===e?void 0:e.guessedText}},{key:"setGuessedAltText",value:function(){var e=(0,d.Z)((0,h.Z)().mark((function e(t){var i;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,null===(i=b(this,Zr)[Zr])||void 0===i?void 0:i.setGuessedText(t);case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"serializeAltText",value:function(e){var t;return null===(t=b(this,Zr)[Zr])||void 0===t?void 0:t.serialize(e)}},{key:"hasAltText",value:function(){return!!b(this,Zr)[Zr]&&!b(this,Zr)[Zr].isEmpty()}},{key:"hasAltTextData",value:function(){var e,t;return null!==(e=null===(t=b(this,Zr)[Zr])||void 0===t?void 0:t.hasData())&&void 0!==e&&e}},{key:"render",value:function(){var e,t=this,i=this.div=document.createElement("div");i.setAttribute("data-editor-rotation",(360-this.rotation)%360),i.className=this.name,i.setAttribute("id",this.id),i.tabIndex=b(this,Ir)[Ir]?-1:0,i.setAttribute("role","application"),this.defaultL10nId&&i.setAttribute("data-l10n-id",this.defaultL10nId),this._isVisible||i.classList.add("hidden"),this.setInForeground(),b(this,fa)[fa]();var n=(0,c.Z)(this.parentDimensions,2),r=n[0],a=n[1];this.parentRotation%180!==0&&(i.style.maxWidth="".concat((100*a/r).toFixed(2),"%"),i.style.maxHeight="".concat((100*r/a).toFixed(2),"%"));var s,o=this.getInitialTranslation(),l=(0,c.Z)(o,2),u=l[0],h=l[1];(this.translate(u,h),Wt(this,i,["keydown","pointerdown","dblclick"]),this.isResizable&&this._uiManager._supportsPinchToZoom)&&((s=b(this,Jr))[Jr]||(s[Jr]=new Er({container:i,isPinchingDisabled:function(){return!t.isSelected},onPinchStart:b(this,ua)[ua].bind(this),onPinching:b(this,ha)[ha].bind(this),onPinchEnd:b(this,ca)[ca].bind(this),signal:this._uiManager._signal})));return null===(e=this._uiManager._editorUndoBar)||void 0===e||e.hide(),i}},{key:"pointerdown",value:function(e){var t=je.platform.isMac;0!==e.button||e.ctrlKey&&t?e.preventDefault():(b(this,Gr)[Gr]=!0,this._isDraggable?b(this,va)[va](e):b(this,da)[da](e))}},{key:"_onStartDragging",value:function(){}},{key:"_onStopDragging",value:function(){}},{key:"moveInDOM",value:function(){var e=this;b(this,Xr)[Xr]&&clearTimeout(b(this,Xr)[Xr]),b(this,Xr)[Xr]=setTimeout((function(){var t;b(e,Xr)[Xr]=null,null===(t=e.parent)||void 0===t||t.moveEditorInDOM(e)}),0)}},{key:"_setParentAndPosition",value:function(e,t,i){e.changeParent(this),this.x=t,this.y=i,this.fixAndSetPosition(),this._onTranslated()}},{key:"getRect",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.rotation,n=this.parentScale,r=(0,c.Z)(this.pageDimensions,2),a=r[0],s=r[1],o=(0,c.Z)(this.pageTranslation,2),l=o[0],u=o[1],h=e/n,d=t/n,v=this.x*a,f=this.y*s,p=this.width*a,g=this.height*s;switch(i){case 0:return[v+h+l,s-f-d-g+u,v+h+p+l,s-f-d+u];case 90:return[v+d+l,s-f+h+u,v+d+g+l,s-f+h+p+u];case 180:return[v-h-p+l,s-f+d+u,v-h+l,s-f+d+g+u];case 270:return[v-d-g+l,s-f-h-p+u,v-d+l,s-f-h+u];default:throw new Error("Invalid rotation")}}},{key:"getRectInCurrentCoords",value:function(e,t){var i=(0,c.Z)(e,4),n=i[0],r=i[1],a=i[2],s=i[3],o=a-n,l=s-r;switch(this.rotation){case 0:return[n,t-s,o,l];case 90:return[n,t-r,l,o];case 180:return[a,t-r,o,l];case 270:return[a,t-s,l,o];default:throw new Error("Invalid rotation")}}},{key:"onceAdded",value:function(e){}},{key:"isEmpty",value:function(){return!1}},{key:"enableEditMode",value:function(){return!this.isInEditMode()&&(this.parent.setEditingState(!1),b(this,Wr)[Wr]=!0,!0)}},{key:"disableEditMode",value:function(){return!!this.isInEditMode()&&(this.parent.setEditingState(!0),b(this,Wr)[Wr]=!1,!0)}},{key:"isInEditMode",value:function(){return b(this,Wr)[Wr]}},{key:"shouldGetKeyboardEvents",value:function(){return b(this,qr)[qr]}},{key:"needsToBeRebuilt",value:function(){return this.div&&!this.isAttachedToDOM}},{key:"isOnScreen",get:function(){var e=this.getClientDimensions(),t=e.top,i=e.left,n=e.bottom,r=e.right,a=window,s=a.innerHeight;return i<a.innerWidth&&r>0&&t<s&&n>0}},{key:"rebuild",value:function(){b(this,fa)[fa]()}},{key:"rotate",value:function(e){}},{key:"resize",value:function(){}},{key:"serializeDeleted",value:function(){var e;return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex,popupRef:(null===(e=this._initialData)||void 0===e?void 0:e.popupRef)||""}}},{key:"serialize",value:function(){Ae("An editor must be serializable")}},{key:"hasBeenModified",get:function(){return!!this.annotationElementId&&(this.deleted||null!==this.serialize())}},{key:"remove",value:function(){var e,t;if(null===(e=b(this,Hr)[Hr])||void 0===e||e.abort(),b(this,Hr)[Hr]=null,this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),b(this,Xr)[Xr]&&(clearTimeout(b(this,Xr)[Xr]),b(this,Xr)[Xr]=null),b(this,ba)[ba](),this.removeEditToolbar(),b(this,Qr)[Qr]){var i,n=(0,v.Z)(b(this,Qr)[Qr].values());try{for(n.s();!(i=n.n()).done;){var r=i.value;clearTimeout(r)}}catch(a){n.e(a)}finally{n.f()}b(this,Qr)[Qr]=null}this.parent=null,null===(t=b(this,Jr)[Jr])||void 0===t||t.destroy(),b(this,Jr)[Jr]=null}},{key:"isResizable",get:function(){return!1}},{key:"makeResizable",value:function(){this.isResizable&&(b(this,ra)[ra](),b(this,Fr)[Fr].classList.remove("hidden"))}},{key:"toolbarPosition",get:function(){return null}},{key:"keydown",value:function(t){if(this.isResizable&&t.target===this.div&&"Enter"===t.key){this._uiManager.setSelected(this),b(this,Br)[Br]={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height};var i=b(this,Fr)[Fr].children;if(!b(this,Rr)[Rr]){b(this,Rr)[Rr]=Array.from(i);var n,r=b(this,pa)[pa].bind(this),a=b(this,ga)[ga].bind(this),s=this._uiManager._signal,o=(0,v.Z)(b(this,Rr)[Rr]);try{for(o.s();!(n=o.n()).done;){var l=n.value,u=l.getAttribute("data-resizer-name");l.setAttribute("role","spinbutton"),l.addEventListener("keydown",r,{signal:s}),l.addEventListener("blur",a,{signal:s}),l.addEventListener("focus",b(this,ya)[ya].bind(this,u),{signal:s}),l.setAttribute("data-l10n-id",e._l10nResizer[u])}}catch(x){o.e(x)}finally{o.f()}}var h,c=b(this,Rr)[Rr][0],d=0,f=(0,v.Z)(i);try{for(f.s();!(h=f.n()).done;){if(h.value===c)break;d++}}catch(x){f.e(x)}finally{f.f()}var p=(360-this.rotation+this.parentRotation)%360/90*(b(this,Rr)[Rr].length/4);if(p!==d){if(p<d)for(var g=0;g<d-p;g++)b(this,Fr)[Fr].append(b(this,Fr)[Fr].firstChild);else if(p>d)for(var y=0;y<p-d;y++)b(this,Fr)[Fr].firstChild.before(b(this,Fr)[Fr].lastChild);var m,w=0,k=(0,v.Z)(i);try{for(k.s();!(m=k.n()).done;){var A=m.value,_=b(this,Rr)[Rr][w++].getAttribute("data-resizer-name");A.setAttribute("data-l10n-id",e._l10nResizer[_])}}catch(x){k.e(x)}finally{k.f()}}b(this,ma)[ma](0),b(this,qr)[qr]=!0,b(this,Fr)[Fr].firstChild.focus({focusVisible:!0}),t.preventDefault(),t.stopImmediatePropagation()}}},{key:"_resizeWithKeyboard",value:function(e,t){b(this,qr)[qr]&&b(this,la)[la](b(this,zr)[zr],{deltaX:e,deltaY:t,fromKeyboard:!0})}},{key:"_stopResizingWithKeyboard",value:function(){b(this,ba)[ba](),this.div.focus()}},{key:"select",value:function(){var e,t,i,n=this;this.isSelected&&this._editToolbar||(this.isSelected=!0,this.makeResizable(),null===(e=this.div)||void 0===e||e.classList.add("selectedEditor"),this._editToolbar?(null===(t=this._editToolbar)||void 0===t||t.show(),null===(i=b(this,Zr)[Zr])||void 0===i||i.toggleAltTextBadge(!1)):this.addEditToolbar().then((function(){var e,t;null!==(e=n.div)&&void 0!==e&&e.classList.contains("selectedEditor")&&(null===(t=n._editToolbar)||void 0===t||t.show())})))}},{key:"unselect",value:function(){var e,t,i,n,r;this.isSelected&&(this.isSelected=!1,null===(e=b(this,Fr)[Fr])||void 0===e||e.classList.add("hidden"),null===(t=this.div)||void 0===t||t.classList.remove("selectedEditor"),null!==(i=this.div)&&void 0!==i&&i.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus({preventScroll:!0}),null===(n=this._editToolbar)||void 0===n||n.hide(),null===(r=b(this,Zr)[Zr])||void 0===r||r.toggleAltTextBadge(!0))}},{key:"updateParams",value:function(e,t){}},{key:"disableEditing",value:function(){}},{key:"enableEditing",value:function(){}},{key:"canChangeContent",get:function(){return!1}},{key:"enterInEditMode",value:function(){this.canChangeContent&&(this.enableEditMode(),this.div.focus())}},{key:"dblclick",value:function(e){this.enterInEditMode(),this.parent.updateToolbar({mode:this.constructor._editorType,editId:this.id})}},{key:"getElementForAltText",value:function(){return this.div}},{key:"contentDiv",get:function(){return this.div}},{key:"isEditing",get:function(){return b(this,Vr)[Vr]},set:function(e){b(this,Vr)[Vr]=e,this.parent&&(e?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}},{key:"setAspectRatio",value:function(e,t){b(this,jr)[jr]=!0;var i=e/t,n=this.div.style;n.aspectRatio=i,n.height="auto"}},{key:"telemetryInitialData",get:function(){return{action:"added"}}},{key:"telemetryFinalData",get:function(){return null}},{key:"_reportTelemetry",value:function(t){var i=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(n){var r;(r=b(this,Qr))[Qr]||(r[Qr]=new Map);var a=t.action,s=b(this,Qr)[Qr].get(a);return s&&clearTimeout(s),s=setTimeout((function(){i._reportTelemetry(t),b(i,Qr)[Qr].delete(a),0===b(i,Qr)[Qr].size&&(b(i,Qr)[Qr]=null)}),e._telemetryTimeout),void b(this,Qr)[Qr].set(a,s)}t.type||(t.type=this.editorType),this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:t}})}},{key:"show",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._isVisible;this.div.classList.toggle("hidden",!e),this._isVisible=e}},{key:"enable",value:function(){this.div&&(this.div.tabIndex=0),b(this,Ir)[Ir]=!1}},{key:"disable",value:function(){this.div&&(this.div.tabIndex=-1),b(this,Ir)[Ir]=!0}},{key:"renderAnnotationElement",value:function(e){var t=e.container.querySelector(".annotationContent");if(t){if("CANVAS"===t.nodeName){var i=t;(t=document.createElement("div")).classList.add("annotationContent",this.editorType),i.before(t)}}else(t=document.createElement("div")).classList.add("annotationContent",this.editorType),e.container.prepend(t);return t}},{key:"resetAnnotationElement",value:function(e){var t=e.container.firstChild;"DIV"===(null===t||void 0===t?void 0:t.nodeName)&&t.classList.contains("annotationContent")&&t.remove()}}],[{key:"_resizerKeyboardManager",get:function(){var t=e.prototype._resizeWithKeyboard,i=xn.TRANSLATE_SMALL,n=xn.TRANSLATE_BIG;return Ee(this,"_resizerKeyboardManager",new li([[["ArrowLeft","mac+ArrowLeft"],t,{args:[-i,0]}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t,{args:[-n,0]}],[["ArrowRight","mac+ArrowRight"],t,{args:[i,0]}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t,{args:[n,0]}],[["ArrowUp","mac+ArrowUp"],t,{args:[0,-i]}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t,{args:[0,-n]}],[["ArrowDown","mac+ArrowDown"],t,{args:[0,i]}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t,{args:[0,n]}],[["Escape","mac+Escape"],e.prototype._stopResizingWithKeyboard]]))}},{key:"isDrawer",get:function(){return!1}},{key:"_defaultLineColor",get:function(){return Ee(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}},{key:"deleteAnnotationElement",value:function(e){var t=new Na({id:e.parent.getNextId(),parent:e.parent,uiManager:e._uiManager});t.annotationElementId=e.annotationElementId,t.deleted=!0,t._uiManager.addToAnnotationStorage(t)}},{key:"initialize",value:function(t,i){var n;if(null!==(n=e._l10n)&&void 0!==n||(e._l10n=t),e._l10nResizer||(e._l10nResizer=Object.freeze({topLeft:"pdfjs-editor-resizer-top-left",topMiddle:"pdfjs-editor-resizer-top-middle",topRight:"pdfjs-editor-resizer-top-right",middleRight:"pdfjs-editor-resizer-middle-right",bottomRight:"pdfjs-editor-resizer-bottom-right",bottomMiddle:"pdfjs-editor-resizer-bottom-middle",bottomLeft:"pdfjs-editor-resizer-bottom-left",middleLeft:"pdfjs-editor-resizer-middle-left"})),-1===e._borderLineWidth){var r=getComputedStyle(document.documentElement);e._borderLineWidth=parseFloat(r.getPropertyValue("--outline-width"))||0}}},{key:"updateDefaultParams",value:function(e,t){}},{key:"defaultPropertiesToUpdate",get:function(){return[]}},{key:"isHandlingMimeForPasting",value:function(e){return!1}},{key:"paste",value:function(e,t){Ae("Not implemented")}},{key:"_round",value:function(e){return Math.round(1e4*e)/1e4}},{key:"deserialize",value:function(){var e=(0,d.Z)((0,h.Z)().mark((function e(t,i,n){var r,a,s,o,l,u,d,v,f,p;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(r=new this.prototype.constructor({parent:i,id:i.getNextId(),uiManager:n,annotationElementId:t.annotationElementId})).rotation=t.rotation,b(r,Tr)[Tr]=t.accessibilityData,r._isCopy=t.isCopy||!1,a=(0,c.Z)(r.pageDimensions,2),s=a[0],o=a[1],l=r.getRectInCurrentCoords(t.rect,o),u=(0,c.Z)(l,4),d=u[0],v=u[1],f=u[2],p=u[3],r.x=d/s,r.y=v/o,r.width=f/s,r.height=p/o,e.abrupt("return",r);case 11:case"end":return e.stop()}}),e,this)})));return function(t,i,n){return e.apply(this,arguments)}}()},{key:"MIN_SIZE",get:function(){return 16}},{key:"canCreateNewEmptyEditor",value:function(){return!0}}]),e}();function ka(e,t,i){var n=(0,c.Z)(e,2),r=n[0],a=n[1],s=this.screenToPageTranslation(t,i),o=(0,c.Z)(s,2);t=o[0],i=o[1],this.x+=t/r,this.y+=i/a,this._onTranslating(this.x,this.y),this.fixAndSetPosition()}function Aa(e){switch(e){case 90:var t=(0,c.Z)(this.pageDimensions,2),i=t[0],n=t[1];return[0,-i/n,n/i,0];case 180:return[-1,0,0,-1];case 270:var r=(0,c.Z)(this.pageDimensions,2),a=r[0],s=r[1];return[0,a/s,-s/a,0];default:return[1,0,0,1]}}function _a(){if(!b(this,Fr)[Fr]){b(this,Fr)[Fr]=document.createElement("div"),b(this,Fr)[Fr].classList.add("resizers");for(var e=this._willKeepAspectRatio?["topLeft","topRight","bottomRight","bottomLeft"]:["topLeft","topMiddle","topRight","middleRight","bottomRight","bottomMiddle","bottomLeft","middleLeft"],t=this._uiManager._signal,i=0,n=e;i<n.length;i++){var r=n[i],a=document.createElement("div");b(this,Fr)[Fr].append(a),a.classList.add("resizer",r),a.setAttribute("data-resizer-name",r),a.addEventListener("pointerdown",b(this,aa)[aa].bind(this,r),{signal:t}),a.addEventListener("contextmenu",lt,{signal:t}),a.tabIndex=-1}this.div.prepend(b(this,Fr)[Fr])}}function xa(e,t){var i,n=this;t.preventDefault();var r=je.platform.isMac;if(!(0!==t.button||t.ctrlKey&&r)){null===(i=b(this,Zr)[Zr])||void 0===i||i.toggle(!1);var a=this._isDraggable;this._isDraggable=!1,b(this,Nr)[Nr]=[t.screenX,t.screenY];var s=new AbortController,o=this._uiManager.combinedSignal(s);this.parent.togglePointerEvents(!1),window.addEventListener("pointermove",b(this,la)[la].bind(this,e),{passive:!0,capture:!0,signal:o}),window.addEventListener("touchmove",ut,{passive:!1,signal:o}),window.addEventListener("contextmenu",lt,{signal:o}),b(this,Br)[Br]={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height};var l=this.parent.div.style.cursor,u=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(t.target).cursor;var h=function(){var e;s.abort(),n.parent.togglePointerEvents(!0),null===(e=b(n,Zr)[Zr])||void 0===e||e.toggle(!0),n._isDraggable=a,n.parent.div.style.cursor=l,n.div.style.cursor=u,b(n,oa)[oa]()};window.addEventListener("pointerup",h,{signal:o}),window.addEventListener("blur",h,{signal:o})}}function Pa(e,t,i,n){this.width=i,this.height=n,this.x=e,this.y=t;var r=(0,c.Z)(this.parentDimensions,2),a=r[0],s=r[1];this.setDims(a*i,s*n),this.fixAndSetPosition(),this._onResized()}function Sa(){if(b(this,Br)[Br]){var e=b(this,Br)[Br],t=e.savedX,i=e.savedY,n=e.savedWidth,r=e.savedHeight;b(this,Br)[Br]=null;var a=this.x,s=this.y,o=this.width,l=this.height;a===t&&s===i&&o===n&&l===r||this.addCommands({cmd:b(this,sa)[sa].bind(this,a,s,o,l),undo:b(this,sa)[sa].bind(this,t,i,n,r),mustExec:!0})}}function Ea(e,t){var i,n,r,a=(0,c.Z)(this.parentDimensions,2),s=a[0],o=a[1],l=this.x,h=this.y,d=this.width,v=this.height,f=wa.MIN_SIZE/s,p=wa.MIN_SIZE/o,g=b(this,na)[na](this.rotation),y=function(e,t){return[g[0]*e+g[2]*t,g[1]*e+g[3]*t]},m=b(this,na)[na](360-this.rotation),w=!1,k=!1;switch(e){case"topLeft":w=!0,n=function(e,t){return[0,0]},r=function(e,t){return[e,t]};break;case"topMiddle":n=function(e,t){return[e/2,0]},r=function(e,t){return[e/2,t]};break;case"topRight":w=!0,n=function(e,t){return[e,0]},r=function(e,t){return[0,t]};break;case"middleRight":k=!0,n=function(e,t){return[e,t/2]},r=function(e,t){return[0,t/2]};break;case"bottomRight":w=!0,n=function(e,t){return[e,t]},r=function(e,t){return[0,0]};break;case"bottomMiddle":n=function(e,t){return[e/2,t]},r=function(e,t){return[e/2,0]};break;case"bottomLeft":w=!0,n=function(e,t){return[0,t]},r=function(e,t){return[e,0]};break;case"middleLeft":k=!0,n=function(e,t){return[0,t/2]},r=function(e,t){return[e,t/2]}}var A,_,x=n(d,v),P=r(d,v),S=y.apply(void 0,(0,u.Z)(P)),E=wa._round(l+S[0]),C=wa._round(h+S[1]),O=1,M=1;if(t.fromKeyboard)A=t.deltaX,_=t.deltaY;else{var T=t.screenX,R=t.screenY,Z=(0,c.Z)(b(this,Nr)[Nr],2),I=Z[0],D=Z[1],L=this.screenToPageTranslation(T-I,R-D),j=(0,c.Z)(L,2);A=j[0],_=j[1],b(this,Nr)[Nr][0]=T,b(this,Nr)[Nr][1]=R}var F,N,B=(F=A/s,N=_/o,[m[0]*F+m[2]*N,m[1]*F+m[3]*N]),H=(0,c.Z)(B,2);if(A=H[0],_=H[1],w){var z=Math.hypot(d,v);O=M=Math.max(Math.min(Math.hypot(P[0]-x[0]-A,P[1]-x[1]-_)/z,1/d,1/v),f/d,p/v)}else k?O=Xe(Math.abs(P[0]-x[0]-A),f,1)/d:M=Xe(Math.abs(P[1]-x[1]-_),p,1)/v;var G=wa._round(d*O),U=wa._round(v*M),V=E-(S=y.apply(void 0,(0,u.Z)(r(G,U))))[0],W=C-S[1];(i=b(this,Ur))[Ur]||(i[Ur]=[this.x,this.y,this.width,this.height]),this.width=G,this.height=U,this.x=V,this.y=W,this.setDims(s*G,o*U),this.fixAndSetPosition(),this._onResizing()}function Ca(){var e;b(this,Br)[Br]={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height},null===(e=b(this,Zr)[Zr])||void 0===e||e.toggle(!1),this.parent.togglePointerEvents(!1)}function Oa(e,t,i){var n,r=i/t*.7+1-.7;if(1!==r){var a=b(this,na)[na](this.rotation),s=function(e,t){return[a[0]*e+a[2]*t,a[1]*e+a[3]*t]},o=(0,c.Z)(this.parentDimensions,2),l=o[0],u=o[1],h=this.x,d=this.y,v=this.width,f=this.height,p=wa.MIN_SIZE/l,g=wa.MIN_SIZE/u;r=Math.max(Math.min(r,1/v,1/f),p/v,g/f);var y=wa._round(v*r),m=wa._round(f*r);if(y!==v||m!==f){(n=b(this,Ur))[Ur]||(n[Ur]=[h,d,v,f]);var w=s(v/2,f/2),k=wa._round(h+w[0]),A=wa._round(d+w[1]),_=s(y/2,m/2);this.x=k-_[0],this.y=A-_[1],this.width=y,this.height=m,this.setDims(l*y,u*m),this.fixAndSetPosition(),this._onResizing()}}}function Ma(){var e;null===(e=b(this,Zr)[Zr])||void 0===e||e.toggle(!0),this.parent.togglePointerEvents(!0),b(this,oa)[oa]()}function Ta(e){var t=je.platform.isMac;e.ctrlKey&&!t||e.shiftKey||e.metaKey&&t?this.parent.toggleSelected(this):this.parent.setSelected(this)}function Ra(e){var t=this,i=this.isSelected;this._uiManager.setUpDragSession();var n=!1,r=new AbortController,a=this._uiManager.combinedSignal(r),s={capture:!0,passive:!1,signal:a},o=function(e){r.abort(),b(t,Dr)[Dr]=null,b(t,Gr)[Gr]=!1,t._uiManager.endDragSession()||b(t,da)[da](e),n&&t._onStopDragging()};i&&(b(this,Yr)[Yr]=e.clientX,b(this,Kr)[Kr]=e.clientY,b(this,Dr)[Dr]=e.pointerId,b(this,Lr)[Lr]=e.pointerType,window.addEventListener("pointermove",(function(e){n||(n=!0,t._onStartDragging());var i=e.clientX,r=e.clientY;if(e.pointerId===b(t,Dr)[Dr]){var a=t.screenToPageTranslation(i-b(t,Yr)[Yr],r-b(t,Kr)[Kr]),s=(0,c.Z)(a,2),o=s[0],l=s[1];b(t,Yr)[Yr]=i,b(t,Kr)[Kr]=r,t._uiManager.dragSelectedEditors(o,l)}else ut(e)}),s),window.addEventListener("touchmove",ut,s),window.addEventListener("pointerdown",(function(e){e.pointerType===b(t,Lr)[Lr]&&(b(t,Jr)[Jr]||e.isPrimary)&&o(e),ut(e)}),s));var l=function(e){b(t,Dr)[Dr]&&b(t,Dr)[Dr]!==e.pointerId?ut(e):o(e)};window.addEventListener("pointerup",l,{signal:a}),window.addEventListener("blur",l,{signal:a})}function Za(){if(!b(this,Hr)[Hr]&&this.div){b(this,Hr)[Hr]=new AbortController;var e=this._uiManager.combinedSignal(b(this,Hr)[Hr]);this.div.addEventListener("focusin",this.focusin.bind(this),{signal:e}),this.div.addEventListener("focusout",this.focusout.bind(this),{signal:e})}}function Ia(e){wa._resizerKeyboardManager.exec(this,e)}function Da(e){var t;b(this,qr)[qr]&&(null===(t=e.relatedTarget)||void 0===t?void 0:t.parentNode)!==b(this,Fr)[Fr]&&b(this,ba)[ba]()}function La(e){b(this,zr)[zr]=b(this,qr)[qr]?e:""}function ja(e){if(b(this,Rr)[Rr]){var t,i=(0,v.Z)(b(this,Rr)[Rr]);try{for(i.s();!(t=i.n()).done;){t.value.tabIndex=e}}catch(n){i.e(n)}finally{i.f()}}}function Fa(){b(this,qr)[qr]=!1,b(this,ma)[ma](-1),b(this,oa)[oa]()}Object.defineProperty(wa,ia,{value:function(e,t,i){switch(i){case 90:return[t,-e];case 180:return[-e,-t];case 270:return[-t,e];default:return[e,t]}}}),wa._l10n=null,wa._l10nResizer=null,wa._borderLineWidth=-1,wa._colorManager=new hi,wa._zIndex=1,wa._telemetryTimeout=1e3;var Na=function(e){P(i,e);var t=R(i);function i(e){var n;return(0,_.Z)(this,i),(n=t.call(this,e)).annotationElementId=e.annotationElementId,n.deleted=!0,n}return(0,A.Z)(i,[{key:"serialize",value:function(){return this.serializeDeleted()}}]),i}(wa),Ba=3285377520,Ha=4294901760,za=65535,Ga=function(){function e(t){(0,_.Z)(this,e),this.h1=t?4294967295&t:Ba,this.h2=t?4294967295&t:Ba}return(0,A.Z)(e,[{key:"update",value:function(e){var t,i;if("string"===typeof e){t=new Uint8Array(2*e.length),i=0;for(var n=0,r=e.length;n<r;n++){var a=e.charCodeAt(n);a<=255?t[i++]=a:(t[i++]=a>>>8,t[i++]=255&a)}}else{if(!ArrayBuffer.isView(e))throw new Error("Invalid data format, must be a string or TypedArray.");i=(t=e.slice()).byteLength}for(var s=i>>2,o=i-4*s,l=new Uint32Array(t.buffer,0,s),u=0,h=0,c=this.h1,d=this.h2,v=3432918353,f=461845907,p=11601,g=13715,y=0;y<s;y++)1&y?c=5*(c=(c^=u=(u=(u=(u=l[y])*v&Ha|u*p&za)<<15|u>>>17)*f&Ha|u*g&za)<<13|c>>>19)+3864292196:d=5*(d=(d^=h=(h=(h=(h=l[y])*v&Ha|h*p&za)<<15|h>>>17)*f&Ha|h*g&za)<<13|d>>>19)+3864292196;switch(u=0,o){case 3:u^=t[4*s+2]<<16;case 2:u^=t[4*s+1]<<8;case 1:u=(u=(u=(u^=t[4*s])*v&Ha|u*p&za)<<15|u>>>17)*f&Ha|u*g&za,1&s?c^=u:d^=u}this.h1=c,this.h2=d}},{key:"hexdigest",value:function(){var e=this.h1,t=this.h2;return e=3981806797*(e^=t>>>1)&Ha|36045*e&za,e=444984403*(e^=(t=4283543511*t&Ha|(2950163797*(t<<16|e>>>16)&Ha)>>>16)>>>1)&Ha|60499*e&za,((e^=(t=3301882366*t&Ha|(3120437893*(t<<16|e>>>16)&Ha)>>>16)>>>1)>>>0).toString(16).padStart(8,"0")+(t>>>0).toString(16).padStart(8,"0")}}]),e}(),Ua=Object.freeze({map:null,hash:"",transfer:void 0}),Va=k("modified"),Wa=k("modifiedIds"),qa=k("storage"),Xa=k("setModified");S=Symbol.iterator;var Ya=function(){function e(){(0,_.Z)(this,e),Object.defineProperty(this,Xa,{value:Ka}),Object.defineProperty(this,Va,{writable:!0,value:!1}),Object.defineProperty(this,Wa,{writable:!0,value:null}),Object.defineProperty(this,qa,{writable:!0,value:new Map}),this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}return(0,A.Z)(e,[{key:"getValue",value:function(e,t){var i=b(this,qa)[qa].get(e);return void 0===i?t:Object.assign(t,i)}},{key:"getRawValue",value:function(e){return b(this,qa)[qa].get(e)}},{key:"remove",value:function(e){if(b(this,qa)[qa].delete(e),0===b(this,qa)[qa].size&&this.resetModified(),"function"===typeof this.onAnnotationEditor){var t,i=(0,v.Z)(b(this,qa)[qa].values());try{for(i.s();!(t=i.n()).done;){if(t.value instanceof wa)return}}catch(n){i.e(n)}finally{i.f()}this.onAnnotationEditor(null)}}},{key:"setValue",value:function(e,t){var i=b(this,qa)[qa].get(e),n=!1;if(void 0!==i)for(var r=0,a=Object.entries(t);r<a.length;r++){var s=(0,c.Z)(a[r],2),o=s[0],l=s[1];i[o]!==l&&(n=!0,i[o]=l)}else n=!0,b(this,qa)[qa].set(e,t);n&&b(this,Xa)[Xa](),t instanceof wa&&"function"===typeof this.onAnnotationEditor&&this.onAnnotationEditor(t.constructor._type)}},{key:"has",value:function(e){return b(this,qa)[qa].has(e)}},{key:"size",get:function(){return b(this,qa)[qa].size}},{key:"resetModified",value:function(){b(this,Va)[Va]&&(b(this,Va)[Va]=!1,"function"===typeof this.onResetModified&&this.onResetModified())}},{key:"print",get:function(){return new Ja(this)}},{key:"serializable",get:function(){if(0===b(this,qa)[qa].size)return Ua;var e,t=new Map,i=new Ga,n=[],r=Object.create(null),a=!1,s=(0,v.Z)(b(this,qa)[qa]);try{for(s.s();!(e=s.n()).done;){var o=(0,c.Z)(e.value,2),l=o[0],u=o[1],h=u instanceof wa?u.serialize(!1,r):u;h&&(t.set(l,h),i.update("".concat(l,":").concat(JSON.stringify(h))),a||(a=!!h.bitmap))}}catch(g){s.e(g)}finally{s.f()}if(a){var d,f=(0,v.Z)(t.values());try{for(f.s();!(d=f.n()).done;){var p=d.value;p.bitmap&&n.push(p.bitmap)}}catch(g){f.e(g)}finally{f.f()}}return t.size>0?{map:t,hash:i.hexdigest(),transfer:n}:Ua}},{key:"editorStats",get:function(){var e,t=null,i=new Map,n=(0,v.Z)(b(this,qa)[qa].values());try{for(n.s();!(e=n.n()).done;){var r,a=e.value;if(a instanceof wa){var s=a.telemetryFinalData;if(s){var o=s.type;i.has(o)||i.set(o,Object.getPrototypeOf(a).constructor),t||(t=Object.create(null));for(var l=(r=t)[o]||(r[o]=new Map),u=0,h=Object.entries(s);u<h.length;u++){var d,f=(0,c.Z)(h[u],2),p=f[0],g=f[1];if("type"!==p){var y=l.get(p);y||(y=new Map,l.set(p,y));var m=null!==(d=y.get(g))&&void 0!==d?d:0;y.set(g,m+1)}}}}}}catch(P){n.e(P)}finally{n.f()}var w,k=(0,v.Z)(i);try{for(k.s();!(w=k.n()).done;){var A=(0,c.Z)(w.value,2),_=A[0],x=A[1];t[_]=x.computeTelemetryFinalData(t[_])}}catch(P){k.e(P)}finally{k.f()}return t}},{key:"resetModifiedIds",value:function(){b(this,Wa)[Wa]=null}},{key:"modifiedIds",get:function(){if(b(this,Wa)[Wa])return b(this,Wa)[Wa];var e,t=[],i=(0,v.Z)(b(this,qa)[qa].values());try{for(i.s();!(e=i.n()).done;){var n=e.value;n instanceof wa&&n.annotationElementId&&n.serialize()&&t.push(n.annotationElementId)}}catch(r){i.e(r)}finally{i.f()}return b(this,Wa)[Wa]={ids:new Set(t),hash:t.join(",")}}},{key:S,value:function(){return b(this,qa)[qa].entries()}}]),e}();function Ka(){b(this,Va)[Va]||(b(this,Va)[Va]=!0,"function"===typeof this.onSetModified&&this.onSetModified())}var Qa=k("serializable"),Ja=function(e){P(i,e);var t=R(i);function i(e){var n;(0,_.Z)(this,i),n=t.call(this),Object.defineProperty(o(n),Qa,{writable:!0,value:void 0});var r=e.serializable,a=r.map,s=r.hash,l=r.transfer,u=structuredClone(a,l?{transfer:l}:null);return b(o(n),Qa)[Qa]={map:u,hash:s,transfer:l},n}return(0,A.Z)(i,[{key:"print",get:function(){Ae("Should not call PrintAnnotationStorage.print")}},{key:"serializable",get:function(){return b(this,Qa)[Qa]}},{key:"modifiedIds",get:function(){return Ee(this,"modifiedIds",{ids:new Set,hash:""})}}]),i}(Ya),$a=k("systemFonts"),es=function(){function e(t){var i=t.ownerDocument,n=void 0===i?globalThis.document:i;t.styleElement;(0,_.Z)(this,e),Object.defineProperty(this,$a,{writable:!0,value:new Set}),this._document=n,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}return(0,A.Z)(e,[{key:"addNativeFontFace",value:function(e){this.nativeFontFaces.add(e),this._document.fonts.add(e)}},{key:"removeNativeFontFace",value:function(e){this.nativeFontFaces.delete(e),this._document.fonts.delete(e)}},{key:"insertRule",value:function(e){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));var t=this.styleElement.sheet;t.insertRule(e,t.cssRules.length)}},{key:"clear",value:function(){var e,t=(0,v.Z)(this.nativeFontFaces);try{for(t.s();!(e=t.n()).done;){var i=e.value;this._document.fonts.delete(i)}}catch(n){t.e(n)}finally{t.f()}this.nativeFontFaces.clear(),b(this,$a)[$a].clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}},{key:"loadSystemFont",value:function(){var e=(0,d.Z)((0,h.Z)().mark((function e(t){var i,n,r,a,s,o,l;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=t.systemFontInfo,n=t.disableFontFace,r=t._inspectFont,i&&!b(this,$a)[$a].has(i.loadedName)){e.next=3;break}return e.abrupt("return");case 3:if(_e(!n,"loadSystemFont shouldn't be called when `disableFontFace` is set."),!this.isFontLoadingAPISupported){e.next=20;break}return a=i.loadedName,s=i.src,o=i.style,l=new FontFace(a,s,o),this.addNativeFontFace(l),e.prev=8,e.next=11,l.load();case 11:b(this,$a)[$a].add(a),null===r||void 0===r||r(i),e.next=19;break;case 15:e.prev=15,e.t0=e.catch(8),ke("Cannot load system font: ".concat(i.baseFontName,", installing it could help to improve PDF rendering.")),this.removeNativeFontFace(l);case 19:return e.abrupt("return");case 20:Ae("Not implemented: loadSystemFont without the Font Loading API.");case 21:case"end":return e.stop()}}),e,this,[[8,15]])})));return function(t){return e.apply(this,arguments)}}()},{key:"bind",value:function(){var e=(0,d.Z)((0,h.Z)().mark((function e(t){var i,n,r=this;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.attached||t.missingFile&&!t.systemFontInfo)){e.next=2;break}return e.abrupt("return");case 2:if(t.attached=!0,!t.systemFontInfo){e.next=7;break}return e.next=6,this.loadSystemFont(t);case 6:case 21:return e.abrupt("return");case 7:if(!this.isFontLoadingAPISupported){e.next=22;break}if(!(i=t.createNativeFontFace())){e.next=21;break}return this.addNativeFontFace(i),e.prev=11,e.next=14,i.loaded;case 14:e.next=21;break;case 16:throw e.prev=16,e.t0=e.catch(11),ke("Failed to load font '".concat(i.family,"': '").concat(e.t0,"'.")),t.disableFontFace=!0,e.t0;case 22:if(!(n=t.createFontFaceRule())){e.next=29;break}if(this.insertRule(n),!this.isSyncFontLoadingSupported){e.next=27;break}return e.abrupt("return");case 27:return e.next=29,new Promise((function(e){var i=r._queueLoadingCallback(e);r._prepareFontLoadEvent(t,i)}));case 29:case"end":return e.stop()}}),e,this,[[11,16]])})));return function(t){return e.apply(this,arguments)}}()},{key:"isFontLoadingAPISupported",get:function(){var e;return Ee(this,"isFontLoadingAPISupported",!(null===(e=this._document)||void 0===e||!e.fonts))}},{key:"isSyncFontLoadingSupported",get:function(){return Ee(this,"isSyncFontLoadingSupported",D||je.platform.isFirefox)}},{key:"_queueLoadingCallback",value:function(e){var t=this.loadingRequests,i={done:!1,complete:function(){for(_e(!i.done,"completeRequest() cannot be called twice."),i.done=!0;t.length>0&&t[0].done;){var e=t.shift();setTimeout(e.callback,0)}},callback:e};return t.push(i),i}},{key:"_loadTestFont",get:function(){return Ee(this,"_loadTestFont",atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA=="))}},{key:"_prepareFontLoadEvent",value:function(e,t){function i(e,t){return e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|255&e.charCodeAt(t+3)}function n(e,t,i,n){return e.substring(0,t)+n+e.substring(t+i)}var r,a,s=this._document.createElement("canvas");s.width=1,s.height=1;var o=s.getContext("2d"),l=0;var u,h="lt".concat(Date.now()).concat(this.loadTestFontId++),c=this._loadTestFont,d=1482184792,v=i(c=n(c,976,h.length,h),16);for(r=0,a=h.length-3;r<a;r+=4)v=v-d+i(h,r)|0;r<h.length&&(v=v-d+i(h+"XXX",r)|0),c=n(c,16,4,(u=v,String.fromCharCode(u>>24&255,u>>16&255,u>>8&255,255&u)));var f="url(data:font/opentype;base64,".concat(btoa(c),");"),p='@font-face {font-family:"'.concat(h,'";src:').concat(f,"}");this.insertRule(p);var g=this._document.createElement("div");g.style.visibility="hidden",g.style.width=g.style.height="10px",g.style.position="absolute",g.style.top=g.style.left="0px";for(var y=0,m=[e.loadedName,h];y<m.length;y++){var b=m[y],w=this._document.createElement("span");w.textContent="Hi",w.style.fontFamily=b,g.append(w)}this._document.body.append(g),function e(t,i){if(++l>30)return ke("Load test font never loaded."),void i();o.font="30px "+t,o.fillText(".",0,20),o.getImageData(0,0,1,1).data[3]>0?i():setTimeout(e.bind(null,t,i))}(h,(function(){g.remove(),t.complete()}))}}]),e}(),ts=function(){function e(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;for(var n in(0,_.Z)(this,e),this.compiledGlyphs=Object.create(null),t)this[n]=t[n];this._inspectFont=i}return(0,A.Z)(e,[{key:"createNativeFontFace",value:function(){var e,t;if(!this.data||this.disableFontFace)return null;if(this.cssFontInfo){var i={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(i.style="oblique ".concat(this.cssFontInfo.italicAngle,"deg")),t=new FontFace(this.cssFontInfo.fontFamily,this.data,i)}else t=new FontFace(this.loadedName,this.data,{});return null===(e=this._inspectFont)||void 0===e||e.call(this,this),t}},{key:"createFontFaceRule",value:function(){var e;if(!this.data||this.disableFontFace)return null;var t,i="url(data:".concat(this.mimetype,";base64,").concat(Ye(this.data),");");if(this.cssFontInfo){var n="font-weight: ".concat(this.cssFontInfo.fontWeight,";");this.cssFontInfo.italicAngle&&(n+="font-style: oblique ".concat(this.cssFontInfo.italicAngle,"deg;")),t='@font-face {font-family:"'.concat(this.cssFontInfo.fontFamily,'";').concat(n,"src:").concat(i,"}")}else t='@font-face {font-family:"'.concat(this.loadedName,'";src:').concat(i,"}");return null===(e=this._inspectFont)||void 0===e||e.call(this,this,i),t}},{key:"getPathGenerator",value:function(e,t){if(void 0!==this.compiledGlyphs[t])return this.compiledGlyphs[t];var i,n=this.loadedName+"_path_"+t;try{i=e.get(n)}catch(a){ke('getPathGenerator - ignoring character: "'.concat(a,'".'))}var r=new Path2D(i||"");return this.fontExtraProperties||e.delete(n),this.compiledGlyphs[t]=r}}]),e}();function is(e){if(e instanceof URL)return e.href;if("string"===typeof e){if(D)return e;var t=URL.parse(e,window.location);if(t)return t.href}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}function ns(e){if(D&&"undefined"!==typeof Buffer&&e instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(e instanceof Uint8Array&&e.byteLength===e.buffer.byteLength)return e;if("string"===typeof e)return Le(e);if(e instanceof ArrayBuffer||ArrayBuffer.isView(e)||"object"===typeof e&&!isNaN(null===e||void 0===e?void 0:e.length))return new Uint8Array(e);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}function rs(e){if("string"!==typeof e)return null;if(e.endsWith("/"))return e;throw new Error('Invalid factory url: "'.concat(e,'" must include trailing slash.'))}var as=function(e){return"object"===typeof e&&Number.isInteger(null===e||void 0===e?void 0:e.num)&&e.num>=0&&Number.isInteger(null===e||void 0===e?void 0:e.gen)&&e.gen>=0},ss=function(e,t,i){if(!Array.isArray(i)||i.length<2)return!1;var n=m(i),r=n[0],a=n[1],s=n.slice(2);if(!e(r)&&!Number.isInteger(r))return!1;if(!t(a))return!1;var o=s.length,l=!0;switch(a.name){case"XYZ":if(o<2||o>3)return!1;break;case"Fit":case"FitB":return 0===o;case"FitH":case"FitBH":case"FitV":case"FitBV":if(o>1)return!1;break;case"FitR":if(4!==o)return!1;l=!1;break;default:return!1}var u,h=(0,v.Z)(s);try{for(h.s();!(u=h.n()).done;){var c=u.value;if(!("number"===typeof c||l&&null===c))return!1}}catch(d){h.e(d)}finally{h.f()}return!0}.bind(null,as,(function(e){return"object"===typeof e&&"string"===typeof(null===e||void 0===e?void 0:e.name)})),os=k("listeners"),ls=k("deferred"),us=function(){function e(){(0,_.Z)(this,e),Object.defineProperty(this,os,{writable:!0,value:new Map}),Object.defineProperty(this,ls,{writable:!0,value:Promise.resolve()})}return(0,A.Z)(e,[{key:"postMessage",value:function(e,t){var i=this,n={data:structuredClone(e,t?{transfer:t}:null)};b(this,ls)[ls].then((function(){var e,t=(0,v.Z)(b(i,os)[os]);try{for(t.s();!(e=t.n()).done;){(0,c.Z)(e.value,1)[0].call(i,n)}}catch(r){t.e(r)}finally{t.f()}}))}},{key:"addEventListener",value:function(e,t){var i=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=null;if((null===n||void 0===n?void 0:n.signal)instanceof AbortSignal){var a=n.signal;if(a.aborted)return void ke("LoopbackPort - cannot use an `aborted` signal.");var s=function(){return i.removeEventListener(e,t)};r=function(){return a.removeEventListener("abort",s)},a.addEventListener("abort",s)}b(this,os)[os].set(t,r)}},{key:"removeEventListener",value:function(e,t){var i=b(this,os)[os].get(t);null===i||void 0===i||i(),b(this,os)[os].delete(t)}},{key:"terminate",value:function(){var e,t=(0,v.Z)(b(this,os)[os]);try{for(t.s();!(e=t.n()).done;){var i=(0,c.Z)(e.value,2)[1];null===i||void 0===i||i()}}catch(n){t.e(n)}finally{t.f()}b(this,os)[os].clear()}}]),e}(),hs=1,cs=2,ds=1,vs=2,fs=3,ps=4,gs=5,ys=6,ms=7,bs=8;function ws(){}function ks(e){if(e instanceof Ie||e instanceof Te||e instanceof Oe||e instanceof Re||e instanceof Me)return e;switch(e instanceof Error||"object"===typeof e&&null!==e||Ae('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),e.name){case"AbortException":return new Ie(e.message);case"InvalidPDFException":return new Te(e.message);case"PasswordException":return new Oe(e.message,e.code);case"ResponseException":return new Re(e.message,e.status,e.missing);case"UnknownErrorException":return new Me(e.message,e.details)}return new Me(e.message,e.toString())}var As=k("messageAC"),_s=k("onMessage"),xs=k("createStreamSink"),Ps=k("processStreamMessage"),Ss=k("deleteStreamController"),Es=function(){function e(t,i,n){(0,_.Z)(this,e),Object.defineProperty(this,Ss,{value:Ts}),Object.defineProperty(this,Ps,{value:Ms}),Object.defineProperty(this,xs,{value:Os}),Object.defineProperty(this,_s,{value:Cs}),Object.defineProperty(this,As,{writable:!0,value:new AbortController}),this.sourceName=t,this.targetName=i,this.comObj=n,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),n.addEventListener("message",b(this,_s)[_s].bind(this),{signal:b(this,As)[As].signal})}return(0,A.Z)(e,[{key:"on",value:function(e,t){var i=this.actionHandler;if(i[e])throw new Error('There is already an actionName called "'.concat(e,'"'));i[e]=t}},{key:"send",value:function(e,t,i){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:e,data:t},i)}},{key:"sendWithPromise",value:function(e,t,i){var n=this.callbackId++,r=Promise.withResolvers();this.callbackCapabilities[n]=r;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:e,callbackId:n,data:t},i)}catch(a){r.reject(a)}return r.promise}},{key:"sendWithStream",value:function(e,t,i,n){var r=this,a=this.streamId++,s=this.sourceName,o=this.targetName,l=this.comObj;return new ReadableStream({start:function(i){var u=Promise.withResolvers();return r.streamControllers[a]={controller:i,startCall:u,pullCall:null,cancelCall:null,isClosed:!1},l.postMessage({sourceName:s,targetName:o,action:e,streamId:a,data:t,desiredSize:i.desiredSize},n),u.promise},pull:function(e){var t=Promise.withResolvers();return r.streamControllers[a].pullCall=t,l.postMessage({sourceName:s,targetName:o,stream:ys,streamId:a,desiredSize:e.desiredSize}),t.promise},cancel:function(e){_e(e instanceof Error,"cancel must have a valid reason");var t=Promise.withResolvers();return r.streamControllers[a].cancelCall=t,r.streamControllers[a].isClosed=!0,l.postMessage({sourceName:s,targetName:o,stream:ds,streamId:a,reason:ks(e)}),t.promise}},i)}},{key:"destroy",value:function(){var e;null===(e=b(this,As)[As])||void 0===e||e.abort(),b(this,As)[As]=null}}]),e}();function Cs(e){var t=e.data;if(t.targetName===this.sourceName)if(t.stream)b(this,Ps)[Ps](t);else if(t.callback){var i=t.callbackId,n=this.callbackCapabilities[i];if(!n)throw new Error("Cannot resolve callback ".concat(i));if(delete this.callbackCapabilities[i],t.callback===hs)n.resolve(t.data);else{if(t.callback!==cs)throw new Error("Unexpected callback case");n.reject(ks(t.reason))}}else{var r=this.actionHandler[t.action];if(!r)throw new Error("Unknown action from worker: ".concat(t.action));if(t.callbackId){var a=this.sourceName,s=t.sourceName,o=this.comObj;Promise.try(r,t.data).then((function(e){o.postMessage({sourceName:a,targetName:s,callback:hs,callbackId:t.callbackId,data:e})}),(function(e){o.postMessage({sourceName:a,targetName:s,callback:cs,callbackId:t.callbackId,reason:ks(e)})}))}else t.streamId?b(this,xs)[xs](t):r(t.data)}}function Os(e){var t=e.streamId,i=this.sourceName,n=e.sourceName,r=this.comObj,a=this,s=this.actionHandler[e.action],o={enqueue:function(e){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,s=arguments.length>2?arguments[2]:void 0;if(!this.isCancelled){var o=this.desiredSize;this.desiredSize-=a,o>0&&this.desiredSize<=0&&(this.sinkCapability=Promise.withResolvers(),this.ready=this.sinkCapability.promise),r.postMessage({sourceName:i,targetName:n,stream:ps,streamId:t,chunk:e},s)}},close:function(){this.isCancelled||(this.isCancelled=!0,r.postMessage({sourceName:i,targetName:n,stream:fs,streamId:t}),delete a.streamSinks[t])},error:function(e){_e(e instanceof Error,"error must have a valid reason"),this.isCancelled||(this.isCancelled=!0,r.postMessage({sourceName:i,targetName:n,stream:gs,streamId:t,reason:ks(e)}))},sinkCapability:Promise.withResolvers(),onPull:null,onCancel:null,isCancelled:!1,desiredSize:e.desiredSize,ready:null};o.sinkCapability.resolve(),o.ready=o.sinkCapability.promise,this.streamSinks[t]=o,Promise.try(s,e.data,o).then((function(){r.postMessage({sourceName:i,targetName:n,stream:bs,streamId:t,success:!0})}),(function(e){r.postMessage({sourceName:i,targetName:n,stream:bs,streamId:t,reason:ks(e)})}))}function Ms(e){var t=e.streamId,i=this.sourceName,n=e.sourceName,r=this.comObj,a=this.streamControllers[t],s=this.streamSinks[t];switch(e.stream){case bs:e.success?a.startCall.resolve():a.startCall.reject(ks(e.reason));break;case ms:e.success?a.pullCall.resolve():a.pullCall.reject(ks(e.reason));break;case ys:if(!s){r.postMessage({sourceName:i,targetName:n,stream:ms,streamId:t,success:!0});break}s.desiredSize<=0&&e.desiredSize>0&&s.sinkCapability.resolve(),s.desiredSize=e.desiredSize,Promise.try(s.onPull||ws).then((function(){r.postMessage({sourceName:i,targetName:n,stream:ms,streamId:t,success:!0})}),(function(e){r.postMessage({sourceName:i,targetName:n,stream:ms,streamId:t,reason:ks(e)})}));break;case ps:if(_e(a,"enqueue should have stream controller"),a.isClosed)break;a.controller.enqueue(e.chunk);break;case fs:if(_e(a,"close should have stream controller"),a.isClosed)break;a.isClosed=!0,a.controller.close(),b(this,Ss)[Ss](a,t);break;case gs:_e(a,"error should have stream controller"),a.controller.error(ks(e.reason)),b(this,Ss)[Ss](a,t);break;case vs:e.success?a.cancelCall.resolve():a.cancelCall.reject(ks(e.reason)),b(this,Ss)[Ss](a,t);break;case ds:if(!s)break;var o=ks(e.reason);Promise.try(s.onCancel||ws,o).then((function(){r.postMessage({sourceName:i,targetName:n,stream:vs,streamId:t,success:!0})}),(function(e){r.postMessage({sourceName:i,targetName:n,stream:vs,streamId:t,reason:ks(e)})})),s.sinkCapability.reject(o),s.isCancelled=!0,delete this.streamSinks[t];break;default:throw new Error("Unexpected stream case")}}function Ts(e,t){return Rs.apply(this,arguments)}function Rs(){return(Rs=(0,d.Z)((0,h.Z)().mark((function e(t,i){var n,r,a;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.allSettled([null===(n=t.startCall)||void 0===n?void 0:n.promise,null===(r=t.pullCall)||void 0===r?void 0:r.promise,null===(a=t.cancelCall)||void 0===a?void 0:a.promise]);case 2:delete this.streamControllers[i];case 3:case"end":return e.stop()}}),e,this)})))).apply(this,arguments)}var Zs=k("enableHWA"),Is=function(){function e(t){var i=t.enableHWA,n=void 0!==i&&i;(0,_.Z)(this,e),Object.defineProperty(this,Zs,{writable:!0,value:!1}),b(this,Zs)[Zs]=n}return(0,A.Z)(e,[{key:"create",value:function(e,t){if(e<=0||t<=0)throw new Error("Invalid canvas size");var i=this._createCanvas(e,t);return{canvas:i,context:i.getContext("2d",{willReadFrequently:!b(this,Zs)[Zs]})}}},{key:"reset",value:function(e,t,i){if(!e.canvas)throw new Error("Canvas is not specified");if(t<=0||i<=0)throw new Error("Invalid canvas size");e.canvas.width=t,e.canvas.height=i}},{key:"destroy",value:function(e){if(!e.canvas)throw new Error("Canvas is not specified");e.canvas.width=0,e.canvas.height=0,e.canvas=null,e.context=null}},{key:"_createCanvas",value:function(e,t){Ae("Abstract method `_createCanvas` called.")}}]),e}(),Ds=function(e){P(i,e);var t=R(i);function i(e){var n,r=e.ownerDocument,a=void 0===r?globalThis.document:r,s=e.enableHWA,o=void 0!==s&&s;return(0,_.Z)(this,i),(n=t.call(this,{enableHWA:o}))._document=a,n}return(0,A.Z)(i,[{key:"_createCanvas",value:function(e,t){var i=this._document.createElement("canvas");return i.width=e,i.height=t,i}}]),i}(Is),Ls=function(){function e(t){var i=t.baseUrl,n=void 0===i?null:i,r=t.isCompressed,a=void 0===r||r;(0,_.Z)(this,e),this.baseUrl=n,this.isCompressed=a}return(0,A.Z)(e,[{key:"fetch",value:function(){var e=(0,d.Z)((0,h.Z)().mark((function e(t){var i,n,r=this;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=t.name,this.baseUrl){e.next=3;break}throw new Error("Ensure that the `cMapUrl` and `cMapPacked` API parameters are provided.");case 3:if(i){e.next=5;break}throw new Error("CMap name must be specified.");case 5:return n=this.baseUrl+i+(this.isCompressed?".bcmap":""),e.abrupt("return",this._fetch(n).then((function(e){return{cMapData:e,isCompressed:r.isCompressed}})).catch((function(e){throw new Error("Unable to load ".concat(r.isCompressed?"binary ":"","CMap at: ").concat(n))})));case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_fetch",value:function(){var e=(0,d.Z)((0,h.Z)().mark((function e(t){return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:Ae("Abstract method `_fetch` called.");case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),js=function(e){P(i,e);var t=R(i);function i(){return(0,_.Z)(this,i),t.apply(this,arguments)}return(0,A.Z)(i,[{key:"_fetch",value:function(){var e=(0,d.Z)((0,h.Z)().mark((function e(t){var i;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Je(t,this.isCompressed?"arraybuffer":"text");case 2:return i=e.sent,e.abrupt("return",i instanceof ArrayBuffer?new Uint8Array(i):Le(i));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),i}(Ls),Fs=function(){function e(){(0,_.Z)(this,e)}return(0,A.Z)(e,[{key:"addFilter",value:function(e){return"none"}},{key:"addHCMFilter",value:function(e,t){return"none"}},{key:"addAlphaFilter",value:function(e){return"none"}},{key:"addLuminosityFilter",value:function(e){return"none"}},{key:"addHighlightHCMFilter",value:function(e,t,i,n,r){return"none"}},{key:"destroy",value:function(){}}]),e}(),Ns=k("baseUrl"),Bs=k("_cache"),Hs=k("_defs"),zs=k("docId"),Gs=k("document"),Us=k("_hcmCache"),Vs=k("id"),Ws=k("cache"),qs=k("hcmCache"),Xs=k("defs"),Ys=k("createTables"),Ks=k("createUrl"),Qs=k("addLuminosityConversion"),Js=k("addGrayConversion"),$s=k("createFilter"),eo=k("appendFeFunc"),to=k("addTransferMapConversion"),io=k("addTransferMapAlphaConversion"),no=k("getRGB"),ro=function(e){P(i,e);var t=R(i);function i(e){var n,r=e.docId,a=e.ownerDocument,s=void 0===a?globalThis.document:a;return(0,_.Z)(this,i),n=t.call(this),Object.defineProperty(o(n),no,{value:yo}),Object.defineProperty(o(n),io,{value:go}),Object.defineProperty(o(n),to,{value:po}),Object.defineProperty(o(n),eo,{value:fo}),Object.defineProperty(o(n),$s,{value:vo}),Object.defineProperty(o(n),Js,{value:co}),Object.defineProperty(o(n),Qs,{value:ho}),Object.defineProperty(o(n),Ks,{value:uo}),Object.defineProperty(o(n),Ys,{value:lo}),Object.defineProperty(o(n),Xs,{get:oo,set:void 0}),Object.defineProperty(o(n),qs,{get:so,set:void 0}),Object.defineProperty(o(n),Ws,{get:ao,set:void 0}),Object.defineProperty(o(n),Ns,{writable:!0,value:void 0}),Object.defineProperty(o(n),Bs,{writable:!0,value:void 0}),Object.defineProperty(o(n),Hs,{writable:!0,value:void 0}),Object.defineProperty(o(n),zs,{writable:!0,value:void 0}),Object.defineProperty(o(n),Gs,{writable:!0,value:void 0}),Object.defineProperty(o(n),Us,{writable:!0,value:void 0}),Object.defineProperty(o(n),Vs,{writable:!0,value:0}),b(o(n),zs)[zs]=r,b(o(n),Gs)[Gs]=s,n}return(0,A.Z)(i,[{key:"addFilter",value:function(e){if(!e)return"none";var t=b(this,Ws)[Ws].get(e);if(t)return t;var i=b(this,Ys)[Ys](e),n=(0,c.Z)(i,3),r=n[0],a=n[1],s=n[2],o=1===e.length?r:"".concat(r).concat(a).concat(s);if(t=b(this,Ws)[Ws].get(o))return b(this,Ws)[Ws].set(e,t),t;var l="g_".concat(b(this,zs)[zs],"_transfer_map_").concat(b(this,Vs)[Vs]++),u=b(this,Ks)[Ks](l);b(this,Ws)[Ws].set(e,u),b(this,Ws)[Ws].set(o,u);var h=b(this,$s)[$s](l);return b(this,to)[to](r,a,s,h),u}},{key:"addHCMFilter",value:function(e,t){var i,n,r="".concat(e,"-").concat(t),a="base",s=b(this,qs)[qs].get(a);if((null===(i=s)||void 0===i?void 0:i.key)===r)return s.url;s?(null===(n=s.filter)||void 0===n||n.remove(),s.key=r,s.url="none",s.filter=null):(s={key:r,url:"none",filter:null},b(this,qs)[qs].set(a,s));if(!e||!t)return s.url;var o=b(this,no)[no](e);e=He.makeHexColor.apply(He,(0,u.Z)(o));var l=b(this,no)[no](t);if(t=He.makeHexColor.apply(He,(0,u.Z)(l)),b(this,Xs)[Xs].style.color="","#000000"===e&&"#ffffff"===t||e===t)return s.url;for(var h=new Array(256),c=0;c<=255;c++){var d=c/255;h[c]=d<=.03928?d/12.92:Math.pow((d+.055)/1.055,2.4)}var v=h.join(","),f="g_".concat(b(this,zs)[zs],"_hcm_filter"),p=s.filter=b(this,$s)[$s](f);b(this,to)[to](v,v,v,p),b(this,Js)[Js](p);var g=function(e,t){for(var i=o[e]/255,n=l[e]/255,r=new Array(t+1),a=0;a<=t;a++)r[a]=i+a/t*(n-i);return r.join(",")};return b(this,to)[to](g(0,5),g(1,5),g(2,5),p),s.url=b(this,Ks)[Ks](f),s.url}},{key:"addAlphaFilter",value:function(e){var t=b(this,Ws)[Ws].get(e);if(t)return t;var i=b(this,Ys)[Ys]([e]),n=(0,c.Z)(i,1)[0],r="alpha_".concat(n);if(t=b(this,Ws)[Ws].get(r))return b(this,Ws)[Ws].set(e,t),t;var a="g_".concat(b(this,zs)[zs],"_alpha_map_").concat(b(this,Vs)[Vs]++),s=b(this,Ks)[Ks](a);b(this,Ws)[Ws].set(e,s),b(this,Ws)[Ws].set(r,s);var o=b(this,$s)[$s](a);return b(this,io)[io](n,o),s}},{key:"addLuminosityFilter",value:function(e){var t,i,n=b(this,Ws)[Ws].get(e||"luminosity");if(n)return n;if(e){var r=b(this,Ys)[Ys]([e]);t=(0,c.Z)(r,1)[0],i="luminosity_".concat(t)}else i="luminosity";if(n=b(this,Ws)[Ws].get(i))return b(this,Ws)[Ws].set(e,n),n;var a="g_".concat(b(this,zs)[zs],"_luminosity_map_").concat(b(this,Vs)[Vs]++),s=b(this,Ks)[Ks](a);b(this,Ws)[Ws].set(e,s),b(this,Ws)[Ws].set(i,s);var o=b(this,$s)[$s](a);return b(this,Qs)[Qs](o),e&&b(this,io)[io](t,o),s}},{key:"addHighlightHCMFilter",value:function(e,t,i,n,r){var a,s,o="".concat(t,"-").concat(i,"-").concat(n,"-").concat(r),l=b(this,qs)[qs].get(e);if((null===(a=l)||void 0===a?void 0:a.key)===o)return l.url;l?(null===(s=l.filter)||void 0===s||s.remove(),l.key=o,l.url="none",l.filter=null):(l={key:o,url:"none",filter:null},b(this,qs)[qs].set(e,l));if(!t||!i)return l.url;var u=[t,i].map(b(this,no)[no].bind(this)),h=(0,c.Z)(u,2),d=h[0],v=h[1],f=Math.round(.2126*d[0]+.7152*d[1]+.0722*d[2]),p=Math.round(.2126*v[0]+.7152*v[1]+.0722*v[2]),g=[n,r].map(b(this,no)[no].bind(this)),y=(0,c.Z)(g,2),m=y[0],w=y[1];if(p<f){var k=[p,f,w,m];f=k[0],p=k[1],m=k[2],w=k[3]}b(this,Xs)[Xs].style.color="";var A=function(e,t,i){for(var n=new Array(256),r=(p-f)/i,a=e/255,s=(t-e)/(255*i),o=0,l=0;l<=i;l++){for(var u=Math.round(f+l*r),h=a+l*s,c=o;c<=u;c++)n[c]=h;o=u+1}for(var d=o;d<256;d++)n[d]=n[o-1];return n.join(",")},_="g_".concat(b(this,zs)[zs],"_hcm_").concat(e,"_filter"),x=l.filter=b(this,$s)[$s](_);return b(this,Js)[Js](x),b(this,to)[to](A(m[0],w[0],5),A(m[1],w[1],5),A(m[2],w[2],5),x),l.url=b(this,Ks)[Ks](_),l.url}},{key:"destroy",value:function(){var e,t,i,n,r=arguments.length>0&&void 0!==arguments[0]&&arguments[0];r&&null!==(e=b(this,Us)[Us])&&void 0!==e&&e.size||(null===(t=b(this,Hs)[Hs])||void 0===t||t.parentNode.parentNode.remove(),b(this,Hs)[Hs]=null,null===(i=b(this,Bs)[Bs])||void 0===i||i.clear(),b(this,Bs)[Bs]=null,null===(n=b(this,Us)[Us])||void 0===n||n.clear(),b(this,Us)[Us]=null,b(this,Vs)[Vs]=0)}}]),i}(Fs);function ao(){var e;return(e=b(this,Bs))[Bs]||(e[Bs]=new Map)}function so(){var e;return(e=b(this,Us))[Us]||(e[Us]=new Map)}function oo(){if(!b(this,Hs)[Hs]){var e=b(this,Gs)[Gs].createElement("div"),t=e.style;t.visibility="hidden",t.contain="strict",t.width=t.height=0,t.position="absolute",t.top=t.left=0,t.zIndex=-1;var i=b(this,Gs)[Gs].createElementNS(Ke,"svg");i.setAttribute("width",0),i.setAttribute("height",0),b(this,Hs)[Hs]=b(this,Gs)[Gs].createElementNS(Ke,"defs"),e.append(i),i.append(b(this,Hs)[Hs]),b(this,Gs)[Gs].body.append(e)}return b(this,Hs)[Hs]}function lo(e){if(1===e.length){for(var t=e[0],i=new Array(256),n=0;n<256;n++)i[n]=t[n]/255;var r=i.join(",");return[r,r,r]}for(var a=(0,c.Z)(e,3),s=a[0],o=a[1],l=a[2],u=new Array(256),h=new Array(256),d=new Array(256),v=0;v<256;v++)u[v]=s[v]/255,h[v]=o[v]/255,d[v]=l[v]/255;return[u.join(","),h.join(","),d.join(",")]}function uo(e){if(void 0===b(this,Ns)[Ns]){b(this,Ns)[Ns]="";var t=b(this,Gs)[Gs].URL;t!==b(this,Gs)[Gs].baseURI&&(it(t)?ke('#createUrl: ignore "data:"-URL for performance reasons.'):b(this,Ns)[Ns]=Se(t,""))}return"url(".concat(b(this,Ns)[Ns],"#").concat(e,")")}function ho(e){var t=b(this,Gs)[Gs].createElementNS(Ke,"feColorMatrix");t.setAttribute("type","matrix"),t.setAttribute("values","0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.3 0.59 0.11 0 0"),e.append(t)}function co(e){var t=b(this,Gs)[Gs].createElementNS(Ke,"feColorMatrix");t.setAttribute("type","matrix"),t.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),e.append(t)}function vo(e){var t=b(this,Gs)[Gs].createElementNS(Ke,"filter");return t.setAttribute("color-interpolation-filters","sRGB"),t.setAttribute("id",e),b(this,Xs)[Xs].append(t),t}function fo(e,t,i){var n=b(this,Gs)[Gs].createElementNS(Ke,t);n.setAttribute("type","discrete"),n.setAttribute("tableValues",i),e.append(n)}function po(e,t,i,n){var r=b(this,Gs)[Gs].createElementNS(Ke,"feComponentTransfer");n.append(r),b(this,eo)[eo](r,"feFuncR",e),b(this,eo)[eo](r,"feFuncG",t),b(this,eo)[eo](r,"feFuncB",i)}function go(e,t){var i=b(this,Gs)[Gs].createElementNS(Ke,"feComponentTransfer");t.append(i),b(this,eo)[eo](i,"feFuncA",e)}function yo(e){return b(this,Xs)[Xs].style.color=e,vt(getComputedStyle(b(this,Xs)[Xs]).getPropertyValue("color"))}var mo=function(){function e(t){var i=t.baseUrl,n=void 0===i?null:i;(0,_.Z)(this,e),this.baseUrl=n}return(0,A.Z)(e,[{key:"fetch",value:function(){var e=(0,d.Z)((0,h.Z)().mark((function e(t){var i,n;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=t.filename,this.baseUrl){e.next=3;break}throw new Error("Ensure that the `standardFontDataUrl` API parameter is provided.");case 3:if(i){e.next=5;break}throw new Error("Font filename must be specified.");case 5:return n="".concat(this.baseUrl).concat(i),e.abrupt("return",this._fetch(n).catch((function(e){throw new Error("Unable to load font data at: ".concat(n))})));case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_fetch",value:function(){var e=(0,d.Z)((0,h.Z)().mark((function e(t){return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:Ae("Abstract method `_fetch` called.");case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),bo=function(e){P(i,e);var t=R(i);function i(){return(0,_.Z)(this,i),t.apply(this,arguments)}return(0,A.Z)(i,[{key:"_fetch",value:function(){var e=(0,d.Z)((0,h.Z)().mark((function e(t){var i;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Je(t,"arraybuffer");case 2:return i=e.sent,e.abrupt("return",new Uint8Array(i));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}]),i}(mo),wo=function(){function e(t){var i=t.baseUrl,n=void 0===i?null:i;(0,_.Z)(this,e),this.baseUrl=n}return(0,A.Z)(e,[{key:"fetch",value:function(){var e=(0,d.Z)((0,h.Z)().mark((function e(t){var i,n;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=t.filename,this.baseUrl){e.next=3;break}throw new Error("Ensure that the `wasmUrl` API parameter is provided.");case 3:if(i){e.next=5;break}throw new Error("Wasm filename must be specified.");case 5:return n="".concat(this.baseUrl).concat(i),e.abrupt("return",this._fetch(n).catch((function(e){throw new Error("Unable to load wasm data at: ".concat(n))})));case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_fetch",value:function(){var e=(0,d.Z)((0,h.Z)().mark((function e(t){return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:Ae("Abstract method `_fetch` called.");case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),ko=function(e){P(i,e);var t=R(i);function i(){return(0,_.Z)(this,i),t.apply(this,arguments)}return(0,A.Z)(i,[{key:"_fetch",value:function(){var e=(0,d.Z)((0,h.Z)().mark((function e(t){var i;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Je(t,"arraybuffer");case 2:return i=e.sent,e.abrupt("return",new Uint8Array(i));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}]),i}(wo);function Ao(e){return _o.apply(this,arguments)}function _o(){return(_o=(0,d.Z)((0,h.Z)().mark((function e(t){var i,n;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=process.getBuiltinModule("fs"),e.next=3,i.promises.readFile(t);case 3:return n=e.sent,e.abrupt("return",new Uint8Array(n));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}D&&ke("Please use the `legacy` build in Node.js environments.");var xo=function(e){P(i,e);var t=R(i);function i(){return(0,_.Z)(this,i),t.apply(this,arguments)}return(0,A.Z)(i)}(Fs),Po=function(e){P(i,e);var t=R(i);function i(){return(0,_.Z)(this,i),t.apply(this,arguments)}return(0,A.Z)(i,[{key:"_createCanvas",value:function(e,t){return process.getBuiltinModule("module").createRequire("file:///Users/ronenrabinovici/Development/Projects/TTSReader/ttsreader-player-i18n/src/helpers/pdfjs.js")("@napi-rs/canvas").createCanvas(e,t)}}]),i}(Is),So=function(e){P(i,e);var t=R(i);function i(){return(0,_.Z)(this,i),t.apply(this,arguments)}return(0,A.Z)(i,[{key:"_fetch",value:function(){var e=(0,d.Z)((0,h.Z)().mark((function e(t){return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Ao(t));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}]),i}(Ls),Eo=function(e){P(i,e);var t=R(i);function i(){return(0,_.Z)(this,i),t.apply(this,arguments)}return(0,A.Z)(i,[{key:"_fetch",value:function(){var e=(0,d.Z)((0,h.Z)().mark((function e(t){return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Ao(t));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}]),i}(mo),Co=function(e){P(i,e);var t=R(i);function i(){return(0,_.Z)(this,i),t.apply(this,arguments)}return(0,A.Z)(i,[{key:"_fetch",value:function(){var e=(0,d.Z)((0,h.Z)().mark((function e(t){return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Ao(t));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}]),i}(wo),Oo="Fill",Mo="Stroke",To="Shading";function Ro(e,t){if(t){var i=t[2]-t[0],n=t[3]-t[1],r=new Path2D;r.rect(t[0],t[1],i,n),e.clip(r)}}var Zo=function(){function e(){(0,_.Z)(this,e)}return(0,A.Z)(e,[{key:"isModifyingCurrentTransform",value:function(){return!1}},{key:"getPattern",value:function(){Ae("Abstract method `getPattern` called.")}}]),e}(),Io=function(e){P(i,e);var t=R(i);function i(e){var n;return(0,_.Z)(this,i),(n=t.call(this))._type=e[1],n._bbox=e[2],n._colorStops=e[3],n._p0=e[4],n._p1=e[5],n._r0=e[6],n._r1=e[7],n.matrix=null,n}return(0,A.Z)(i,[{key:"_createGradient",value:function(e){var t;"axial"===this._type?t=e.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):"radial"===this._type&&(t=e.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));var i,n=(0,v.Z)(this._colorStops);try{for(n.s();!(i=n.n()).done;){var r=i.value;t.addColorStop(r[0],r[1])}}catch(a){n.e(a)}finally{n.f()}return t}},{key:"getPattern",value:function(e,t,i,n){var r;if(n===Mo||n===Oo){var a=t.current.getClippedPathBoundingBox(n,ft(e))||[0,0,0,0],s=Math.ceil(a[2]-a[0])||1,o=Math.ceil(a[3]-a[1])||1,l=t.cachedCanvases.getCanvas("pattern",s,o),h=l.context;h.clearRect(0,0,h.canvas.width,h.canvas.height),h.beginPath(),h.rect(0,0,h.canvas.width,h.canvas.height),h.translate(-a[0],-a[1]),i=He.transform(i,[1,0,0,1,a[0],a[1]]),h.transform.apply(h,(0,u.Z)(t.baseTransform)),this.matrix&&h.transform.apply(h,(0,u.Z)(this.matrix)),Ro(h,this._bbox),h.fillStyle=this._createGradient(h),h.fill(),r=e.createPattern(l.canvas,"no-repeat");var c=new DOMMatrix(i);r.setTransform(c)}else Ro(e,this._bbox),r=this._createGradient(e);return r}}]),i}(Zo);function Do(e,t,i,n,r,a,s,o){var l,u=t.coords,h=t.colors,c=e.data,d=4*e.width;u[i+1]>u[n+1]&&(l=i,i=n,n=l,l=a,a=s,s=l),u[n+1]>u[r+1]&&(l=n,n=r,r=l,l=s,s=o,o=l),u[i+1]>u[n+1]&&(l=i,i=n,n=l,l=a,a=s,s=l);var v=(u[i]+t.offsetX)*t.scaleX,f=(u[i+1]+t.offsetY)*t.scaleY,p=(u[n]+t.offsetX)*t.scaleX,g=(u[n+1]+t.offsetY)*t.scaleY,y=(u[r]+t.offsetX)*t.scaleX,m=(u[r+1]+t.offsetY)*t.scaleY;if(!(f>=m))for(var b,w,k,A,_,x,P,S,E=h[a],C=h[a+1],O=h[a+2],M=h[s],T=h[s+1],R=h[s+2],Z=h[o],I=h[o+1],D=h[o+2],L=Math.round(f),j=Math.round(m),F=L;F<=j;F++){if(F<g){var N=F<f?0:(f-F)/(f-g);b=v-(v-p)*N,w=E-(E-M)*N,k=C-(C-T)*N,A=O-(O-R)*N}else{var B=void 0;b=p-(p-y)*(B=F>m?1:g===m?0:(g-F)/(g-m)),w=M-(M-Z)*B,k=T-(T-I)*B,A=R-(R-D)*B}var H=void 0;_=v-(v-y)*(H=F<f?0:F>m?1:(f-F)/(f-m)),x=E-(E-Z)*H,P=C-(C-I)*H,S=O-(O-D)*H;for(var z=Math.round(Math.min(b,_)),G=Math.round(Math.max(b,_)),U=d*F+4*z,V=z;V<=G;V++)(H=(b-V)/(b-_))<0?H=0:H>1&&(H=1),c[U++]=w-(w-x)*H|0,c[U++]=k-(k-P)*H|0,c[U++]=A-(A-S)*H|0,c[U++]=255}}function Lo(e,t,i){var n,r,a=t.coords,s=t.colors;switch(t.type){case"lattice":var o=t.verticesPerRow,l=Math.floor(a.length/o)-1,u=o-1;for(n=0;n<l;n++)for(var h=n*o,c=0;c<u;c++,h++)Do(e,i,a[h],a[h+1],a[h+o],s[h],s[h+1],s[h+o]),Do(e,i,a[h+o+1],a[h+1],a[h+o],s[h+o+1],s[h+1],s[h+o]);break;case"triangles":for(n=0,r=a.length;n<r;n+=3)Do(e,i,a[n],a[n+1],a[n+2],s[n],s[n+1],s[n+2]);break;default:throw new Error("illegal figure")}}var jo=function(e){P(i,e);var t=R(i);function i(e){var n;return(0,_.Z)(this,i),(n=t.call(this))._coords=e[2],n._colors=e[3],n._figures=e[4],n._bounds=e[5],n._bbox=e[6],n._background=e[7],n.matrix=null,n}return(0,A.Z)(i,[{key:"_createMeshCanvas",value:function(e,t,i){var n=Math.floor(this._bounds[0]),r=Math.floor(this._bounds[1]),a=Math.ceil(this._bounds[2])-n,s=Math.ceil(this._bounds[3])-r,o=Math.min(Math.ceil(Math.abs(a*e[0]*1.1)),3e3),l=Math.min(Math.ceil(Math.abs(s*e[1]*1.1)),3e3),u=a/o,h=s/l,c={coords:this._coords,colors:this._colors,offsetX:-n,offsetY:-r,scaleX:1/u,scaleY:1/h},d=o+4,f=l+4,p=i.getCanvas("mesh",d,f),g=p.context,y=g.createImageData(o,l);if(t)for(var m=y.data,b=0,w=m.length;b<w;b+=4)m[b]=t[0],m[b+1]=t[1],m[b+2]=t[2],m[b+3]=255;var k,A=(0,v.Z)(this._figures);try{for(A.s();!(k=A.n()).done;){Lo(y,k.value,c)}}catch(_){A.e(_)}finally{A.f()}return g.putImageData(y,2,2),{canvas:p.canvas,offsetX:n-2*u,offsetY:r-2*h,scaleX:u,scaleY:h}}},{key:"isModifyingCurrentTransform",value:function(){return!0}},{key:"getPattern",value:function(e,t,i,n){Ro(e,this._bbox);var r=new Float32Array(2);if(n===To)He.singularValueDecompose2dScale(ft(e),r);else if(this.matrix){He.singularValueDecompose2dScale(this.matrix,r);var a=(0,c.Z)(r,2),s=a[0],o=a[1];He.singularValueDecompose2dScale(t.baseTransform,r),r[0]*=s,r[1]*=o}else He.singularValueDecompose2dScale(t.baseTransform,r);var l=this._createMeshCanvas(r,n===To?null:this._background,t.cachedCanvases);return n!==To&&(e.setTransform.apply(e,(0,u.Z)(t.baseTransform)),this.matrix&&e.transform.apply(e,(0,u.Z)(this.matrix))),e.translate(l.offsetX,l.offsetY),e.scale(l.scaleX,l.scaleY),e.createPattern(l.canvas,"no-repeat")}}]),i}(Zo),Fo=function(e){P(i,e);var t=R(i);function i(){return(0,_.Z)(this,i),t.apply(this,arguments)}return(0,A.Z)(i,[{key:"getPattern",value:function(){return"hotpink"}}]),i}(Zo);function No(e){switch(e[0]){case"RadialAxial":return new Io(e);case"Mesh":return new jo(e);case"Dummy":return new Fo}throw new Error("Unknown IR type: ".concat(e[0]))}var Bo=1,Ho=2,zo=function(){function e(t,i,n,r){(0,_.Z)(this,e),this.color=t[1],this.operatorList=t[2],this.matrix=t[3],this.bbox=t[4],this.xstep=t[5],this.ystep=t[6],this.paintType=t[7],this.tilingType=t[8],this.ctx=i,this.canvasGraphicsFactory=n,this.baseTransform=r}return(0,A.Z)(e,[{key:"createPatternCanvas",value:function(e){var t=this.bbox,i=this.operatorList,n=this.paintType,r=this.tilingType,a=this.color,s=this.canvasGraphicsFactory,o=this.xstep,l=this.ystep;o=Math.abs(o),l=Math.abs(l),we("TilingType: "+r);var u=t[0],h=t[1],d=t[2],v=t[3],f=d-u,p=v-h,g=new Float32Array(2);He.singularValueDecompose2dScale(this.matrix,g);var y=(0,c.Z)(g,2),m=y[0],b=y[1];He.singularValueDecompose2dScale(this.baseTransform,g);var w=m*g[0],k=b*g[1],A=f,_=p,x=!1,P=!1,S=Math.ceil(o*w),E=Math.ceil(l*k);S>=Math.ceil(f*w)?A=o:x=!0,E>=Math.ceil(p*k)?_=l:P=!0;var C=this.getSizeAndScale(A,this.ctx.canvas.width,w),O=this.getSizeAndScale(_,this.ctx.canvas.height,k),M=e.cachedCanvases.getCanvas("pattern",C.size,O.size),T=M.context,R=s.createCanvasGraphics(T);if(R.groupLevel=e.groupLevel,this.setFillAndStrokeStyleToContext(R,n,a),T.translate(-C.scale*u,-O.scale*h),R.transform(C.scale,0,0,O.scale,0,0),T.save(),this.clipBbox(R,u,h,d,v),R.baseTransform=ft(R.ctx),R.executeOperatorList(i),R.endDrawing(),T.restore(),x||P){var Z=M.canvas;x&&(A=o),P&&(_=l);for(var I=this.getSizeAndScale(A,this.ctx.canvas.width,w),D=this.getSizeAndScale(_,this.ctx.canvas.height,k),L=I.size,j=D.size,F=e.cachedCanvases.getCanvas("pattern-workaround",L,j),N=F.context,B=x?Math.floor(f/o):0,H=P?Math.floor(p/l):0,z=0;z<=B;z++)for(var G=0;G<=H;G++)N.drawImage(Z,L*z,j*G,L,j,0,0,L,j);return{canvas:F.canvas,scaleX:I.scale,scaleY:D.scale,offsetX:u,offsetY:h}}return{canvas:M.canvas,scaleX:C.scale,scaleY:O.scale,offsetX:u,offsetY:h}}},{key:"getSizeAndScale",value:function(t,i,n){var r=Math.max(e.MAX_PATTERN_SIZE,i),a=Math.ceil(t*n);return a>=r?a=r:n=a/t,{scale:n,size:a}}},{key:"clipBbox",value:function(e,t,i,n,r){var a=n-t,s=r-i;e.ctx.rect(t,i,a,s),He.axialAlignedBoundingBox([t,i,n,r],ft(e.ctx),e.current.minMax),e.clip(),e.endPath()}},{key:"setFillAndStrokeStyleToContext",value:function(e,t,i){var n=e.ctx,r=e.current;switch(t){case Bo:var a=this.ctx,s=a.fillStyle,o=a.strokeStyle;n.fillStyle=r.fillColor=s,n.strokeStyle=r.strokeColor=o;break;case Ho:n.fillStyle=n.strokeStyle=i,r.fillColor=r.strokeColor=i;break;default:throw new Ze("Unsupported paint type: ".concat(t))}}},{key:"isModifyingCurrentTransform",value:function(){return!1}},{key:"getPattern",value:function(e,t,i,n){var r=i;n!==To&&(r=He.transform(r,t.baseTransform),this.matrix&&(r=He.transform(r,this.matrix)));var a=this.createPatternCanvas(t),s=new DOMMatrix(r);s=(s=s.translate(a.offsetX,a.offsetY)).scale(1/a.scaleX,1/a.scaleY);var o=e.createPattern(a.canvas,"repeat");return o.setTransform(s),o}}]),e}();function Go(e){var t=e.src,i=e.srcPos,n=void 0===i?0:i,r=e.dest,a=e.width,s=e.height,o=e.nonBlackColor,l=void 0===o?4294967295:o,u=e.inverseDecode,h=void 0!==u&&u,d=je.isLittleEndian?4278190080:255,v=h?[l,d]:[d,l],f=(0,c.Z)(v,2),p=f[0],g=f[1],y=a>>3,m=7&a,b=t.length;r=new Uint32Array(r.buffer);for(var w=0,k=0;k<s;k++){for(var A=n+y;n<A;n++){var _=n<b?t[n]:255;r[w++]=128&_?g:p,r[w++]=64&_?g:p,r[w++]=32&_?g:p,r[w++]=16&_?g:p,r[w++]=8&_?g:p,r[w++]=4&_?g:p,r[w++]=2&_?g:p,r[w++]=1&_?g:p}if(0!==m)for(var x=n<b?t[n++]:255,P=0;P<m;P++)r[w++]=x&1<<7-P?g:p}return{srcPos:n,destPos:w}}zo.MAX_PATTERN_SIZE=3e3;var Uo=16,Vo=new DOMMatrix,Wo=new Float32Array(2),qo=new Float32Array([1/0,1/0,-1/0,-1/0]);var Xo=function(){function e(t){(0,_.Z)(this,e),this.canvasFactory=t,this.cache=Object.create(null)}return(0,A.Z)(e,[{key:"getCanvas",value:function(e,t,i){var n;return void 0!==this.cache[e]?(n=this.cache[e],this.canvasFactory.reset(n,t,i)):(n=this.canvasFactory.create(t,i),this.cache[e]=n),n}},{key:"delete",value:function(e){delete this.cache[e]}},{key:"clear",value:function(){for(var e in this.cache){var t=this.cache[e];this.canvasFactory.destroy(t),delete this.cache[e]}}}]),e}();function Yo(e,t,i,n,r,a,s,o,l,u){var h=ft(e),d=(0,c.Z)(h,6),v=d[0],f=d[1],p=d[2],g=d[3],y=d[4],m=d[5];if(0===f&&0===p){var b=s*v+y,w=Math.round(b),k=o*g+m,A=Math.round(k),_=(s+l)*v+y,x=Math.abs(Math.round(_)-w)||1,P=(o+u)*g+m,S=Math.abs(Math.round(P)-A)||1;return e.setTransform(Math.sign(v),0,0,Math.sign(g),w,A),e.drawImage(t,i,n,r,a,0,0,x,S),e.setTransform(v,f,p,g,y,m),[x,S]}if(0===v&&0===g){var E=o*p+y,C=Math.round(E),O=s*f+m,M=Math.round(O),T=(o+u)*p+y,R=Math.abs(Math.round(T)-C)||1,Z=(s+l)*f+m,I=Math.abs(Math.round(Z)-M)||1;return e.setTransform(0,Math.sign(f),Math.sign(p),0,C,M),e.drawImage(t,i,n,r,a,0,0,I,R),e.setTransform(v,f,p,g,y,m),[I,R]}return e.drawImage(t,i,n,r,a,s,o,l,u),[Math.hypot(v,f)*l,Math.hypot(p,g)*u]}var Ko=function(){function e(t,i){(0,_.Z)(this,e),this.alphaIsShape=!1,this.fontSize=0,this.fontSizeScale=1,this.textMatrix=null,this.textMatrixScale=1,this.fontMatrix=L,this.leading=0,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRenderingMode=Q,this.textRise=0,this.fillColor="#000000",this.strokeColor="#000000",this.patternFill=!1,this.patternStroke=!1,this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.activeSMask=null,this.transferMaps="none",this.clipBox=new Float32Array([0,0,t,i]),this.minMax=qo.slice()}return(0,A.Z)(e,[{key:"clone",value:function(){var e=Object.create(this);return e.clipBox=this.clipBox.slice(),e.minMax=this.minMax.slice(),e}},{key:"getPathBoundingBox",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Oo,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=this.minMax.slice();if(e===Mo){t||Ae("Stroke bounding box must include transform."),He.singularValueDecompose2dScale(t,Wo);var n=Wo[0]*this.lineWidth/2,r=Wo[1]*this.lineWidth/2;i[0]-=n,i[1]-=r,i[2]+=n,i[3]+=r}return i}},{key:"updateClipFromPath",value:function(){var e=He.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(e||[0,0,0,0])}},{key:"isEmptyClip",value:function(){return this.minMax[0]===1/0}},{key:"startNewPathAndClipBox",value:function(e){this.clipBox.set(e,0),this.minMax.set(qo,0)}},{key:"getClippedPathBoundingBox",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Oo,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return He.intersect(this.clipBox,this.getPathBoundingBox(e,t))}}]),e}();function Qo(e,t){if(t instanceof ImageData)e.putImageData(t,0,0);else{var i,n,r,a,s,o=t.height,l=t.width,u=o%Uo,h=(o-u)/Uo,c=0===u?h:h+1,d=e.createImageData(l,Uo),v=0,f=t.data,p=d.data;if(t.kind===ne.GRAYSCALE_1BPP){var g=f.byteLength,y=new Uint32Array(p.buffer,0,p.byteLength>>2),m=y.length,b=l+7>>3,w=4294967295,k=je.isLittleEndian?4278190080:255;for(n=0;n<c;n++){for(a=n<h?Uo:u,i=0,r=0;r<a;r++){for(var A=g-v,_=0,x=A>b?l:8*A-7,P=-8&x,S=0,E=0;_<P;_+=8)E=f[v++],y[i++]=128&E?w:k,y[i++]=64&E?w:k,y[i++]=32&E?w:k,y[i++]=16&E?w:k,y[i++]=8&E?w:k,y[i++]=4&E?w:k,y[i++]=2&E?w:k,y[i++]=1&E?w:k;for(;_<x;_++)0===S&&(E=f[v++],S=128),y[i++]=E&S?w:k,S>>=1}for(;i<m;)y[i++]=0;e.putImageData(d,0,n*Uo)}}else if(t.kind===ne.RGBA_32BPP){for(r=0,s=l*Uo*4,n=0;n<h;n++)p.set(f.subarray(v,v+s)),v+=s,e.putImageData(d,0,r),r+=Uo;n<c&&(s=l*u*4,p.set(f.subarray(v,v+s)),e.putImageData(d,0,r))}else{if(t.kind!==ne.RGB_24BPP)throw new Error("bad image kind: ".concat(t.kind));for(s=l*(a=Uo),n=0;n<c;n++){for(n>=h&&(s=l*(a=u)),i=0,r=s;r--;)p[i++]=f[v++],p[i++]=f[v++],p[i++]=f[v++],p[i++]=255;e.putImageData(d,0,n*Uo)}}}}function Jo(e,t){if(t.bitmap)e.drawImage(t.bitmap,0,0);else for(var i=t.height,n=t.width,r=i%Uo,a=(i-r)/Uo,s=0===r?a:a+1,o=e.createImageData(n,Uo),l=0,u=t.data,h=o.data,c=0;c<s;c++){l=Go({src:u,srcPos:l,dest:h,width:n,height:c<a?Uo:r,nonBlackColor:0}).srcPos,e.putImageData(o,0,c*Uo)}}function $o(e,t){for(var i=0,n=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];i<n.length;i++){var r=n[i];void 0!==e[r]&&(t[r]=e[r])}void 0!==e.setLineDash&&(t.setLineDash(e.getLineDash()),t.lineDashOffset=e.lineDashOffset)}function el(e){e.strokeStyle=e.fillStyle="#000000",e.fillRule="nonzero",e.globalAlpha=1,e.lineWidth=1,e.lineCap="butt",e.lineJoin="miter",e.miterLimit=10,e.globalCompositeOperation="source-over",e.font="10px sans-serif",void 0!==e.setLineDash&&(e.setLineDash([]),e.lineDashOffset=0);var t=e.filter;"none"!==t&&""!==t&&(e.filter="none")}function tl(e,t){if(t)return!0;He.singularValueDecompose2dScale(e,Wo);var i=Math.fround(yt.pixelRatio*Qe.PDF_TO_CSS_UNITS);return Wo[0]<=i&&Wo[1]<=i}var il=["butt","round","square"],nl=["miter","round","bevel"],rl={},al={},sl=k("restoreInitialState"),ol=k("drawFilter"),ll=k("getScaledPath"),ul=function(){function e(t,i,n,r,a,s,o,l){var u=s.optionalContentConfig,h=s.markedContentStack,c=void 0===h?null:h;(0,_.Z)(this,e),Object.defineProperty(this,ll,{value:dl}),Object.defineProperty(this,ol,{value:cl}),Object.defineProperty(this,sl,{value:hl}),this.ctx=t,this.current=new Ko(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=i,this.objs=n,this.canvasFactory=r,this.filterFactory=a,this.groupStack=[],this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=c||[],this.optionalContentConfig=u,this.cachedCanvases=new Xo(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=o,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=l,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map}return(0,A.Z)(e,[{key:"getObject",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return"string"===typeof e?e.startsWith("g_")?this.commonObjs.get(e):this.objs.get(e):t}},{key:"beginDrawing",value:function(e){var t,i,n=e.transform,r=e.viewport,a=e.transparency,s=void 0!==a&&a,o=e.background,l=void 0===o?null:o,h=this.ctx.canvas.width,c=this.ctx.canvas.height,d=this.ctx.fillStyle;if(this.ctx.fillStyle=l||"#ffffff",this.ctx.fillRect(0,0,h,c),this.ctx.fillStyle=d,s){var v,f=this.cachedCanvases.getCanvas("transparent",h,c);this.compositeCtx=this.ctx,this.transparentCanvas=f.canvas,this.ctx=f.context,this.ctx.save(),(v=this.ctx).transform.apply(v,(0,u.Z)(ft(this.compositeCtx)))}(this.ctx.save(),el(this.ctx),n)&&((i=this.ctx).transform.apply(i,(0,u.Z)(n)),this.outputScaleX=n[0],this.outputScaleY=n[0]);(t=this.ctx).transform.apply(t,(0,u.Z)(r.transform)),this.viewportScale=r.scale,this.baseTransform=ft(this.ctx)}},{key:"executeOperatorList",value:function(e,t,i,n){var r=e.argsArray,a=e.fnArray,s=t||0,o=r.length;if(o===s)return s;for(var l,u=o-s>10&&"function"===typeof i,h=u?Date.now()+15:0,c=0,d=this.commonObjs,f=this.objs;;){if(void 0!==n&&s===n.nextBreakPoint)return n.breakIt(s,i),s;if((l=a[s])!==ce.dependency)this[l].apply(this,r[s]);else{var p,g=(0,v.Z)(r[s]);try{for(g.s();!(p=g.n()).done;){var y=p.value,m=y.startsWith("g_")?d:f;if(!m.has(y))return m.get(y,i),s}}catch(b){g.e(b)}finally{g.f()}}if(++s===o)return s;if(u&&++c>10){if(Date.now()>h)return i(),s;c=0}}}},{key:"endDrawing",value:function(){b(this,sl)[sl](),this.cachedCanvases.clear(),this.cachedPatterns.clear();var e,t=(0,v.Z)(this._cachedBitmapsMap.values());try{for(t.s();!(e=t.n()).done;){var i,n=e.value,r=(0,v.Z)(n.values());try{for(r.s();!(i=r.n()).done;){var a=i.value;"undefined"!==typeof HTMLCanvasElement&&a instanceof HTMLCanvasElement&&(a.width=a.height=0)}}catch(s){r.e(s)}finally{r.f()}n.clear()}}catch(s){t.e(s)}finally{t.f()}this._cachedBitmapsMap.clear(),b(this,ol)[ol]()}},{key:"_scaleImage",value:function(e,t){for(var i,n,r,a,s=null!==(i=e.width)&&void 0!==i?i:e.displayWidth,o=null!==(n=e.height)&&void 0!==n?n:e.displayHeight,l=Math.max(Math.hypot(t[0],t[1]),1),u=Math.max(Math.hypot(t[2],t[3]),1),h=s,c=o,d="prescale1";l>2&&h>1||u>2&&c>1;){var v=h,f=c;l>2&&h>1&&(l/=h/(v=h>=16384?Math.floor(h/2)-1||1:Math.ceil(h/2))),u>2&&c>1&&(u/=c/(f=c>=16384?Math.floor(c/2)-1||1:Math.ceil(c)/2)),(a=(r=this.cachedCanvases.getCanvas(d,v,f)).context).clearRect(0,0,v,f),a.drawImage(e,0,0,h,c,0,0,v,f),e=r.canvas,h=v,c=f,d="prescale1"===d?"prescale2":"prescale1"}return{img:e,paintWidth:h,paintHeight:c}}},{key:"_createMaskCanvas",value:function(e){var t,i,n,r,a=this.ctx,s=e.width,o=e.height,l=this.current.fillColor,h=this.current.patternFill,d=ft(a);if((e.bitmap||e.data)&&e.count>1){var v=e.bitmap||e.data.buffer;i=JSON.stringify(h?d:[d.slice(0,4),l]),(t=this._cachedBitmapsMap.get(v))||(t=new Map,this._cachedBitmapsMap.set(v,t));var f=t.get(i);if(f&&!h)return{canvas:f,offsetX:Math.round(Math.min(d[0],d[2])+d[4]),offsetY:Math.round(Math.min(d[1],d[3])+d[5])};n=f}n||Jo((r=this.cachedCanvases.getCanvas("maskCanvas",s,o)).context,e);var p=He.transform(d,[1/s,0,0,-1/o,0,0]);p=He.transform(p,[1,0,0,1,0,-o]);var g=qo.slice();He.axialAlignedBoundingBox([0,0,s,o],p,g);var y=(0,c.Z)(g,4),m=y[0],b=y[1],w=y[2],k=y[3],A=Math.round(w-m)||1,_=Math.round(k-b)||1,x=this.cachedCanvases.getCanvas("fillCanvas",A,_),P=x.context,S=m,E=b;P.translate(-S,-E),P.transform.apply(P,(0,u.Z)(p)),n||(n=(n=this._scaleImage(r.canvas,pt(P))).img,t&&h&&t.set(i,n)),P.imageSmoothingEnabled=tl(ft(P),e.interpolate),Yo(P,n,0,0,n.width,n.height,0,0,s,o),P.globalCompositeOperation="source-in";var C=He.transform(pt(P),[1,0,0,1,-S,-E]);return P.fillStyle=h?l.getPattern(a,this,C,Oo):l,P.fillRect(0,0,s,o),t&&!h&&(this.cachedCanvases.delete("fillCanvas"),t.set(i,x.canvas)),{canvas:x.canvas,offsetX:Math.round(S),offsetY:Math.round(E)}}},{key:"setLineWidth",value:function(e){e!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=e,this.ctx.lineWidth=e}},{key:"setLineCap",value:function(e){this.ctx.lineCap=il[e]}},{key:"setLineJoin",value:function(e){this.ctx.lineJoin=nl[e]}},{key:"setMiterLimit",value:function(e){this.ctx.miterLimit=e}},{key:"setDash",value:function(e,t){var i=this.ctx;void 0!==i.setLineDash&&(i.setLineDash(e),i.lineDashOffset=t)}},{key:"setRenderingIntent",value:function(e){}},{key:"setFlatness",value:function(e){}},{key:"setGState",value:function(e){var t,i=(0,v.Z)(e);try{for(i.s();!(t=i.n()).done;){var n=(0,c.Z)(t.value,2),r=n[0],a=n[1];switch(r){case"LW":this.setLineWidth(a);break;case"LC":this.setLineCap(a);break;case"LJ":this.setLineJoin(a);break;case"ML":this.setMiterLimit(a);break;case"D":this.setDash(a[0],a[1]);break;case"RI":this.setRenderingIntent(a);break;case"FL":this.setFlatness(a);break;case"Font":this.setFont(a[0],a[1]);break;case"CA":this.current.strokeAlpha=a;break;case"ca":this.ctx.globalAlpha=this.current.fillAlpha=a;break;case"BM":this.ctx.globalCompositeOperation=a;break;case"SMask":this.current.activeSMask=a?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(a)}}}catch(s){i.e(s)}finally{i.f()}}},{key:"inSMaskMode",get:function(){return!!this.suspendedCtx}},{key:"checkSMaskState",value:function(){var e=this.inSMaskMode;this.current.activeSMask&&!e?this.beginSMaskMode():!this.current.activeSMask&&e&&this.endSMaskMode()}},{key:"beginSMaskMode",value:function(){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");var e=this.ctx.canvas.width,t=this.ctx.canvas.height,i="smaskGroupAt"+this.groupLevel,n=this.cachedCanvases.getCanvas(i,e,t);this.suspendedCtx=this.ctx;var r=this.ctx=n.context;r.setTransform(this.suspendedCtx.getTransform()),$o(this.suspendedCtx,r),function(e,t){if(e._removeMirroring)throw new Error("Context is already forwarding operations.");e.__originalSave=e.save,e.__originalRestore=e.restore,e.__originalRotate=e.rotate,e.__originalScale=e.scale,e.__originalTranslate=e.translate,e.__originalTransform=e.transform,e.__originalSetTransform=e.setTransform,e.__originalResetTransform=e.resetTransform,e.__originalClip=e.clip,e.__originalMoveTo=e.moveTo,e.__originalLineTo=e.lineTo,e.__originalBezierCurveTo=e.bezierCurveTo,e.__originalRect=e.rect,e.__originalClosePath=e.closePath,e.__originalBeginPath=e.beginPath,e._removeMirroring=function(){e.save=e.__originalSave,e.restore=e.__originalRestore,e.rotate=e.__originalRotate,e.scale=e.__originalScale,e.translate=e.__originalTranslate,e.transform=e.__originalTransform,e.setTransform=e.__originalSetTransform,e.resetTransform=e.__originalResetTransform,e.clip=e.__originalClip,e.moveTo=e.__originalMoveTo,e.lineTo=e.__originalLineTo,e.bezierCurveTo=e.__originalBezierCurveTo,e.rect=e.__originalRect,e.closePath=e.__originalClosePath,e.beginPath=e.__originalBeginPath,delete e._removeMirroring},e.save=function(){t.save(),this.__originalSave()},e.restore=function(){t.restore(),this.__originalRestore()},e.translate=function(e,i){t.translate(e,i),this.__originalTranslate(e,i)},e.scale=function(e,i){t.scale(e,i),this.__originalScale(e,i)},e.transform=function(e,i,n,r,a,s){t.transform(e,i,n,r,a,s),this.__originalTransform(e,i,n,r,a,s)},e.setTransform=function(e,i,n,r,a,s){t.setTransform(e,i,n,r,a,s),this.__originalSetTransform(e,i,n,r,a,s)},e.resetTransform=function(){t.resetTransform(),this.__originalResetTransform()},e.rotate=function(e){t.rotate(e),this.__originalRotate(e)},e.clip=function(e){t.clip(e),this.__originalClip(e)},e.moveTo=function(e,i){t.moveTo(e,i),this.__originalMoveTo(e,i)},e.lineTo=function(e,i){t.lineTo(e,i),this.__originalLineTo(e,i)},e.bezierCurveTo=function(e,i,n,r,a,s){t.bezierCurveTo(e,i,n,r,a,s),this.__originalBezierCurveTo(e,i,n,r,a,s)},e.rect=function(e,i,n,r){t.rect(e,i,n,r),this.__originalRect(e,i,n,r)},e.closePath=function(){t.closePath(),this.__originalClosePath()},e.beginPath=function(){t.beginPath(),this.__originalBeginPath()}}(r,this.suspendedCtx),this.setGState([["BM","source-over"]])}},{key:"endSMaskMode",value:function(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),$o(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}},{key:"compose",value:function(e){if(this.current.activeSMask){e?(e[0]=Math.floor(e[0]),e[1]=Math.floor(e[1]),e[2]=Math.ceil(e[2]),e[3]=Math.ceil(e[3])):e=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];var t=this.current.activeSMask,i=this.suspendedCtx;this.composeSMask(i,t,this.ctx,e),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}}},{key:"composeSMask",value:function(e,t,i,n){var r=n[0],a=n[1],s=n[2]-r,o=n[3]-a;0!==s&&0!==o&&(this.genericComposeSMask(t.context,i,s,o,t.subtype,t.backdrop,t.transferMap,r,a,t.offsetX,t.offsetY),e.save(),e.globalAlpha=1,e.globalCompositeOperation="source-over",e.setTransform(1,0,0,1,0,0),e.drawImage(i.canvas,0,0),e.restore())}},{key:"genericComposeSMask",value:function(e,t,i,n,r,a,s,o,l,u,h){var c=e.canvas,d=o-u,v=l-h;if(a)if(d<0||v<0||d+i>c.width||v+n>c.height){var f=this.cachedCanvases.getCanvas("maskExtension",i,n),p=f.context;p.drawImage(c,-d,-v),p.globalCompositeOperation="destination-atop",p.fillStyle=a,p.fillRect(0,0,i,n),p.globalCompositeOperation="source-over",c=f.canvas,d=v=0}else{e.save(),e.globalAlpha=1,e.setTransform(1,0,0,1,0,0);var g=new Path2D;g.rect(d,v,i,n),e.clip(g),e.globalCompositeOperation="destination-atop",e.fillStyle=a,e.fillRect(d,v,i,n),e.restore()}t.save(),t.globalAlpha=1,t.setTransform(1,0,0,1,0,0),"Alpha"===r&&s?t.filter=this.filterFactory.addAlphaFilter(s):"Luminosity"===r&&(t.filter=this.filterFactory.addLuminosityFilter(s));var y=new Path2D;y.rect(o,l,i,n),t.clip(y),t.globalCompositeOperation="destination-in",t.drawImage(c,d,v,i,n,o,l,i,n),t.restore()}},{key:"save",value:function(){this.inSMaskMode&&$o(this.ctx,this.suspendedCtx),this.ctx.save();var e=this.current;this.stateStack.push(e),this.current=e.clone()}},{key:"restore",value:function(){0!==this.stateStack.length?(this.current=this.stateStack.pop(),this.ctx.restore(),this.inSMaskMode&&$o(this.suspendedCtx,this.ctx),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null):this.inSMaskMode&&this.endSMaskMode()}},{key:"transform",value:function(e,t,i,n,r,a){this.ctx.transform(e,t,i,n,r,a),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}},{key:"constructPath",value:function(e,t,i){var n=(0,c.Z)(t,1)[0];if(!i)return n||(n=t[0]=new Path2D),void this[e](n);if(!(n instanceof Path2D)){for(var r=t[0]=new Path2D,a=0,s=n.length;a<s;)switch(n[a++]){case de:r.moveTo(n[a++],n[a++]);break;case ve:r.lineTo(n[a++],n[a++]);break;case fe:r.bezierCurveTo(n[a++],n[a++],n[a++],n[a++],n[a++],n[a++]);break;case pe:r.closePath();break;default:ke("Unrecognized drawing path operator: ".concat(n[a-1]))}n=r}He.axialAlignedBoundingBox(i,ft(this.ctx),this.current.minMax),this[e](n)}},{key:"closePath",value:function(){this.ctx.closePath()}},{key:"stroke",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=this.ctx,n=this.current.strokeColor;if(i.globalAlpha=this.current.strokeAlpha,this.contentVisible)if("object"===typeof n&&null!==n&&void 0!==n&&n.getPattern){var r=n.isModifyingCurrentTransform()?i.getTransform():null;if(i.save(),i.strokeStyle=n.getPattern(i,this,pt(i),Mo),r){var a=new Path2D;a.addPath(e,i.getTransform().invertSelf().multiplySelf(r)),e=a}this.rescaleAndStroke(e,!1),i.restore()}else this.rescaleAndStroke(e,!0);t&&this.consumePath(e,this.current.getClippedPathBoundingBox(Mo,ft(this.ctx))),i.globalAlpha=this.current.fillAlpha}},{key:"closeStroke",value:function(e){this.stroke(e)}},{key:"fill",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=this.ctx,n=this.current.fillColor,r=this.current.patternFill,a=!1;if(r){var s=n.isModifyingCurrentTransform()?i.getTransform():null;if(i.save(),i.fillStyle=n.getPattern(i,this,pt(i),Oo),s){var o=new Path2D;o.addPath(e,i.getTransform().invertSelf().multiplySelf(s)),e=o}a=!0}var l=this.current.getClippedPathBoundingBox();this.contentVisible&&null!==l&&(this.pendingEOFill?(i.fill(e,"evenodd"),this.pendingEOFill=!1):i.fill(e)),a&&i.restore(),t&&this.consumePath(e,l)}},{key:"eoFill",value:function(e){this.pendingEOFill=!0,this.fill(e)}},{key:"fillStroke",value:function(e){this.fill(e,!1),this.stroke(e,!1),this.consumePath(e)}},{key:"eoFillStroke",value:function(e){this.pendingEOFill=!0,this.fillStroke(e)}},{key:"closeFillStroke",value:function(e){this.fillStroke(e)}},{key:"closeEOFillStroke",value:function(e){this.pendingEOFill=!0,this.fillStroke(e)}},{key:"endPath",value:function(e){this.consumePath(e)}},{key:"rawFillPath",value:function(e){this.ctx.fill(e)}},{key:"clip",value:function(){this.pendingClip=rl}},{key:"eoClip",value:function(){this.pendingClip=al}},{key:"beginText",value:function(){this.current.textMatrix=null,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}},{key:"endText",value:function(){var e=this.pendingTextPaths,t=this.ctx;if(void 0!==e){var i,n=new Path2D,r=t.getTransform().invertSelf(),a=(0,v.Z)(e);try{for(a.s();!(i=a.n()).done;){var s=i.value,o=s.transform,l=s.x,u=s.y,h=s.fontSize,c=s.path;n.addPath(c,new DOMMatrix(o).preMultiplySelf(r).translate(l,u).scale(h,-h))}}catch(d){a.e(d)}finally{a.f()}t.clip(n),delete this.pendingTextPaths}}},{key:"setCharSpacing",value:function(e){this.current.charSpacing=e}},{key:"setWordSpacing",value:function(e){this.current.wordSpacing=e}},{key:"setHScale",value:function(e){this.current.textHScale=e/100}},{key:"setLeading",value:function(e){this.current.leading=-e}},{key:"setFont",value:function(e,t){var i,n=this.commonObjs.get(e),r=this.current;if(!n)throw new Error("Can't find font for ".concat(e));if(r.fontMatrix=n.fontMatrix||L,0!==r.fontMatrix[0]&&0!==r.fontMatrix[3]||ke("Invalid font matrix for font "+e),t<0?(t=-t,r.fontDirection=-1):r.fontDirection=1,this.current.font=n,this.current.fontSize=t,!n.isType3Font){var a=n.loadedName||"sans-serif",s=(null===(i=n.systemFontInfo)||void 0===i?void 0:i.css)||'"'.concat(a,'", ').concat(n.fallbackName),o="normal";n.black?o="900":n.bold&&(o="bold");var l=n.italic?"italic":"normal",u=t;t<16?u=16:t>100&&(u=100),this.current.fontSizeScale=t/u,this.ctx.font="".concat(l," ").concat(o," ").concat(u,"px ").concat(s)}}},{key:"setTextRenderingMode",value:function(e){this.current.textRenderingMode=e}},{key:"setTextRise",value:function(e){this.current.textRise=e}},{key:"moveText",value:function(e,t){this.current.x=this.current.lineX+=e,this.current.y=this.current.lineY+=t}},{key:"setLeadingMoveText",value:function(e,t){this.setLeading(-t),this.moveText(e,t)}},{key:"setTextMatrix",value:function(e){var t=this.current;t.textMatrix=e,t.textMatrixScale=Math.hypot(e[0],e[1]),t.x=t.lineX=0,t.y=t.lineY=0}},{key:"nextLine",value:function(){this.moveText(0,this.current.leading)}},{key:"paintChar",value:function(e,t,i,n,r){var a,s=this.ctx,o=this.current,l=o.font,h=o.textRenderingMode,c=o.fontSize/o.fontSizeScale,d=h&te,v=!!(h&ie),f=o.patternFill&&!l.missingFile,p=o.patternStroke&&!l.missingFile;if((l.disableFontFace||v||f||p)&&(a=l.getPathGenerator(this.commonObjs,e)),l.disableFontFace||f||p){var g;if(s.save(),s.translate(t,i),s.scale(c,-c),d!==Q&&d!==$||(n?(g=s.getTransform(),s.setTransform.apply(s,(0,u.Z)(n)),s.fill(b(this,ll)[ll](a,g,n))):s.fill(a)),d===J||d===$)if(r){g||(g=s.getTransform()),s.setTransform.apply(s,(0,u.Z)(r));var y=g,m=y.a,w=y.b,k=y.c,A=y.d,_=He.inverseTransform(r),x=He.transform([m,w,k,A,0,0],_);He.singularValueDecompose2dScale(x,Wo),s.lineWidth*=Math.max(Wo[0],Wo[1])/c,s.stroke(b(this,ll)[ll](a,g,r))}else s.lineWidth/=c,s.stroke(a);s.restore()}else d!==Q&&d!==$||s.fillText(e,t,i),d!==J&&d!==$||s.strokeText(e,t,i);v&&(this.pendingTextPaths||(this.pendingTextPaths=[])).push({transform:ft(s),x:t,y:i,fontSize:c,path:a})}},{key:"isFontSubpixelAAEnabled",get:function(){var e=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10).context;e.scale(1.5,1),e.fillText("I",0,10);for(var t=e.getImageData(0,0,10,10).data,i=!1,n=3;n<t.length;n+=4)if(t[n]>0&&t[n]<255){i=!0;break}return Ee(this,"isFontSubpixelAAEnabled",i)}},{key:"showText",value:function(e){var t=this.current,i=t.font;if(i.isType3Font)return this.showType3Text(e);var n=t.fontSize;if(0!==n){var r,a,s=this.ctx,o=t.fontSizeScale,l=t.charSpacing,h=t.wordSpacing,c=t.fontDirection,d=t.textHScale*c,f=e.length,p=i.vertical,g=p?1:-1,y=i.defaultVMetrics,m=n*t.fontMatrix[0],b=t.textRenderingMode===Q&&!i.disableFontFace&&!t.patternFill;if(s.save(),t.textMatrix&&s.transform.apply(s,(0,u.Z)(t.textMatrix)),s.translate(t.x,t.y+t.textRise),c>0?s.scale(d,-1):s.scale(d,1),t.patternFill){s.save();var w=t.fillColor.getPattern(s,this,pt(s),Oo);r=ft(s),s.restore(),s.fillStyle=w}if(t.patternStroke){s.save();var k=t.strokeColor.getPattern(s,this,pt(s),Mo);a=ft(s),s.restore(),s.strokeStyle=k}var A=t.lineWidth,_=t.textMatrixScale;if(0===_||0===A){var x=t.textRenderingMode&te;x!==J&&x!==$||(A=this.getSinglePixelWidth())}else A/=_;if(1!==o&&(s.scale(o,o),A/=o),s.lineWidth=A,i.isInvalidPDFjsFont){var P,S=[],E=0,C=(0,v.Z)(e);try{for(C.s();!(P=C.n()).done;){var O=P.value;S.push(O.unicode),E+=O.width}}catch(q){C.e(q)}finally{C.f()}return s.fillText(S.join(""),0,0),t.x+=E*m*d,s.restore(),void this.compose()}var M,T=0;for(M=0;M<f;++M){var R=e[M];if("number"!==typeof R){var Z=!1,I=(R.isSpace?h:0)+l,D=R.fontChar,L=R.accent,j=void 0,F=void 0,N=R.width;if(p){var B=R.vmetric||y,H=-(R.vmetric?B[1]:.5*N)*m,z=B[2]*m;N=B?-B[0]:N,j=H/o,F=(T+z)/o}else j=T/o,F=0;if(i.remeasure&&N>0){var G=1e3*s.measureText(D).width/n*o;if(N<G&&this.isFontSubpixelAAEnabled){var U=N/G;Z=!0,s.save(),s.scale(U,1),j/=U}else N!==G&&(j+=(N-G)/2e3*n/o)}if(this.contentVisible&&(R.isInFont||i.missingFile))if(b&&!L)s.fillText(D,j,F);else if(this.paintChar(D,j,F,r,a),L){var V=j+n*L.offset.x/o,W=F-n*L.offset.y/o;this.paintChar(L.fontChar,V,W,r,a)}T+=p?N*m-I*c:N*m+I*c,Z&&s.restore()}else T+=g*R*n/1e3}p?t.y-=T:t.x+=T*d,s.restore(),this.compose()}}},{key:"showType3Text",value:function(e){var t,i,n,r,a=this.ctx,s=this.current,o=s.font,l=s.fontSize,h=s.fontDirection,c=o.vertical?1:-1,d=s.charSpacing,v=s.wordSpacing,f=s.textHScale*h,p=s.fontMatrix||L,g=e.length;if(!(s.textRenderingMode===ee)&&0!==l){for(this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,a.save(),s.textMatrix&&a.transform.apply(a,(0,u.Z)(s.textMatrix)),a.translate(s.x,s.y+s.textRise),a.scale(f,h),t=0;t<g;++t)if("number"!==typeof(i=e[t])){var y=(i.isSpace?v:0)+d,m=o.charProcOperatorList[i.operatorListId];m?this.contentVisible&&(this.save(),a.scale(l,l),a.transform.apply(a,(0,u.Z)(p)),this.executeOperatorList(m),this.restore()):ke('Type3 character "'.concat(i.operatorListId,'" is not available.'));var b=[i.width,0];He.applyTransform(b,p),n=b[0]*l+y,a.translate(n,0),s.x+=n*f}else r=c*i*l/1e3,this.ctx.translate(r,0),s.x+=r*f;a.restore()}}},{key:"setCharWidth",value:function(e,t){}},{key:"setCharWidthAndBounds",value:function(e,t,i,n,r,a){var s=new Path2D;s.rect(i,n,r-i,a-n),this.ctx.clip(s),this.endPath()}},{key:"getColorN_Pattern",value:function(t){var i,n=this;if("TilingPattern"===t[0]){var r=this.baseTransform||ft(this.ctx),a={createCanvasGraphics:function(t){return new e(t,n.commonObjs,n.objs,n.canvasFactory,n.filterFactory,{optionalContentConfig:n.optionalContentConfig,markedContentStack:n.markedContentStack})}};i=new zo(t,this.ctx,a,r)}else i=this._getPattern(t[1],t[2]);return i}},{key:"setStrokeColorN",value:function(){this.current.strokeColor=this.getColorN_Pattern(arguments),this.current.patternStroke=!0}},{key:"setFillColorN",value:function(){this.current.fillColor=this.getColorN_Pattern(arguments),this.current.patternFill=!0}},{key:"setStrokeRGBColor",value:function(e){this.ctx.strokeStyle=this.current.strokeColor=e,this.current.patternStroke=!1}},{key:"setStrokeTransparent",value:function(){this.ctx.strokeStyle=this.current.strokeColor="transparent",this.current.patternStroke=!1}},{key:"setFillRGBColor",value:function(e){this.ctx.fillStyle=this.current.fillColor=e,this.current.patternFill=!1}},{key:"setFillTransparent",value:function(){this.ctx.fillStyle=this.current.fillColor="transparent",this.current.patternFill=!1}},{key:"_getPattern",value:function(e){var t,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this.cachedPatterns.has(e)?t=this.cachedPatterns.get(e):(t=No(this.getObject(e)),this.cachedPatterns.set(e,t)),i&&(t.matrix=i),t}},{key:"shadingFill",value:function(e){if(this.contentVisible){var t=this.ctx;this.save();var i=this._getPattern(e);t.fillStyle=i.getPattern(t,this,pt(t),To);var n=pt(t);if(n){var r=t.canvas,a=r.width,s=r.height,o=qo.slice();He.axialAlignedBoundingBox([0,0,a,s],n,o);var l=(0,c.Z)(o,4),u=l[0],h=l[1],d=l[2],v=l[3];this.ctx.fillRect(u,h,d-u,v-h)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.compose(this.current.getClippedPathBoundingBox()),this.restore()}}},{key:"beginInlineImage",value:function(){Ae("Should not call beginInlineImage")}},{key:"beginImageData",value:function(){Ae("Should not call beginImageData")}},{key:"paintFormXObjectBegin",value:function(e,t){if(this.contentVisible&&(this.save(),this.baseTransformStack.push(this.baseTransform),e&&this.transform.apply(this,(0,u.Z)(e)),this.baseTransform=ft(this.ctx),t)){He.axialAlignedBoundingBox(t,this.baseTransform,this.current.minMax);var i=(0,c.Z)(t,4),n=i[0],r=i[1],a=i[2],s=i[3],o=new Path2D;o.rect(n,r,a-n,s-r),this.ctx.clip(o),this.endPath()}}},{key:"paintFormXObjectEnd",value:function(){this.contentVisible&&(this.restore(),this.baseTransform=this.baseTransformStack.pop())}},{key:"beginGroup",value:function(e){if(this.contentVisible){this.save(),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);var t=this.ctx;e.isolated||we("TODO: Support non-isolated groups."),e.knockout&&ke("Knockout groups not supported.");var i=ft(t);if(e.matrix&&t.transform.apply(t,(0,u.Z)(e.matrix)),!e.bbox)throw new Error("Bounding box is required.");var n=qo.slice();He.axialAlignedBoundingBox(e.bbox,ft(t),n);var r=[0,0,t.canvas.width,t.canvas.height];n=He.intersect(n,r)||[0,0,0,0];var a=Math.floor(n[0]),s=Math.floor(n[1]),o=Math.max(Math.ceil(n[2])-a,1),l=Math.max(Math.ceil(n[3])-s,1);this.current.startNewPathAndClipBox([0,0,o,l]);var h="groupAt"+this.groupLevel;e.smask&&(h+="_smask_"+this.smaskCounter++%2);var d=this.cachedCanvases.getCanvas(h,o,l),v=d.context;v.translate(-a,-s),v.transform.apply(v,(0,u.Z)(i));var f=new Path2D,p=(0,c.Z)(e.bbox,4),g=p[0],y=p[1],m=p[2],b=p[3];if(f.rect(g,y,m-g,b-y),e.matrix){var w=new Path2D;w.addPath(f,new DOMMatrix(e.matrix)),f=w}v.clip(f),e.smask?this.smaskStack.push({canvas:d.canvas,context:v,offsetX:a,offsetY:s,subtype:e.smask.subtype,backdrop:e.smask.backdrop,transferMap:e.smask.transferMap||null,startTransformInverse:null}):(t.setTransform(1,0,0,1,0,0),t.translate(a,s),t.save()),$o(t,v),this.ctx=v,this.setGState([["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(t),this.groupLevel++}}},{key:"endGroup",value:function(e){if(this.contentVisible){this.groupLevel--;var t=this.ctx,i=this.groupStack.pop();if(this.ctx=i,this.ctx.imageSmoothingEnabled=!1,e.smask)this.tempSMask=this.smaskStack.pop(),this.restore();else{var n;this.ctx.restore();var r=ft(this.ctx);this.restore(),this.ctx.save(),(n=this.ctx).setTransform.apply(n,(0,u.Z)(r));var a=qo.slice();He.axialAlignedBoundingBox([0,0,t.canvas.width,t.canvas.height],r,a),this.ctx.drawImage(t.canvas,0,0),this.ctx.restore(),this.compose(a)}}}},{key:"beginAnnotation",value:function(e,t,i,n,r){var a;(b(this,sl)[sl](),el(this.ctx),this.ctx.save(),this.save(),this.baseTransform)&&(a=this.ctx).setTransform.apply(a,(0,u.Z)(this.baseTransform));if(t){var s=t[2]-t[0],o=t[3]-t[1];if(r&&this.annotationCanvasMap){(i=i.slice())[4]-=t[0],i[5]-=t[1],(t=t.slice())[0]=t[1]=0,t[2]=s,t[3]=o,He.singularValueDecompose2dScale(ft(this.ctx),Wo);var l=this.viewportScale,h=Math.ceil(s*this.outputScaleX*l),c=Math.ceil(o*this.outputScaleY*l);this.annotationCanvas=this.canvasFactory.create(h,c);var d=this.annotationCanvas,v=d.canvas,f=d.context;this.annotationCanvasMap.set(e,v),this.annotationCanvas.savedCtx=this.ctx,this.ctx=f,this.ctx.save(),this.ctx.setTransform(Wo[0],0,0,-Wo[1],0,o*Wo[1]),el(this.ctx)}else{el(this.ctx),this.endPath();var p=new Path2D;p.rect(t[0],t[1],s,o),this.ctx.clip(p)}}this.current=new Ko(this.ctx.canvas.width,this.ctx.canvas.height),this.transform.apply(this,(0,u.Z)(i)),this.transform.apply(this,(0,u.Z)(n))}},{key:"endAnnotation",value:function(){this.annotationCanvas&&(this.ctx.restore(),b(this,ol)[ol](),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}},{key:"paintImageMaskXObject",value:function(e){if(this.contentVisible){var t=e.count;(e=this.getObject(e.data,e)).count=t;var i=this.ctx,n=this._createMaskCanvas(e),r=n.canvas;i.save(),i.setTransform(1,0,0,1,0,0),i.drawImage(r,n.offsetX,n.offsetY),i.restore(),this.compose()}}},{key:"paintImageMaskXObjectRepeat",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4?arguments[4]:void 0,a=arguments.length>5?arguments[5]:void 0;if(this.contentVisible){e=this.getObject(e.data,e);var s=this.ctx;s.save();var o=ft(s);s.transform(t,i,n,r,0,0);var l=this._createMaskCanvas(e);s.setTransform(1,0,0,1,l.offsetX-o[4],l.offsetY-o[5]);for(var u=0,h=a.length;u<h;u+=2){var c=He.transform(o,[t,i,n,r,a[u],a[u+1]]);s.drawImage(l.canvas,c[4],c[5])}s.restore(),this.compose()}}},{key:"paintImageMaskXObjectGroup",value:function(e){if(this.contentVisible){var t,i=this.ctx,n=this.current.fillColor,r=this.current.patternFill,a=(0,v.Z)(e);try{for(a.s();!(t=a.n()).done;){var s=t.value,o=s.data,l=s.width,h=s.height,c=s.transform,d=this.cachedCanvases.getCanvas("maskCanvas",l,h),f=d.context;f.save(),Jo(f,this.getObject(o,s)),f.globalCompositeOperation="source-in",f.fillStyle=r?n.getPattern(f,this,pt(i),Oo):n,f.fillRect(0,0,l,h),f.restore(),i.save(),i.transform.apply(i,(0,u.Z)(c)),i.scale(1,-1),Yo(i,d.canvas,0,0,l,h,0,-1,1,1),i.restore()}}catch(p){a.e(p)}finally{a.f()}this.compose()}}},{key:"paintImageXObject",value:function(e){if(this.contentVisible){var t=this.getObject(e);t?this.paintInlineImageXObject(t):ke("Dependent image isn't ready yet")}}},{key:"paintImageXObjectRepeat",value:function(e,t,i,n){if(this.contentVisible){var r=this.getObject(e);if(r){for(var a=r.width,s=r.height,o=[],l=0,u=n.length;l<u;l+=2)o.push({transform:[t,0,0,i,n[l],n[l+1]],x:0,y:0,w:a,h:s});this.paintInlineImageXObjectGroup(r,o)}else ke("Dependent image isn't ready yet")}}},{key:"applyTransferMapsToCanvas",value:function(e){return"none"!==this.current.transferMaps&&(e.filter=this.current.transferMaps,e.drawImage(e.canvas,0,0),e.filter="none"),e.canvas}},{key:"applyTransferMapsToBitmap",value:function(e){if("none"===this.current.transferMaps)return e.bitmap;var t=e.bitmap,i=e.width,n=e.height,r=this.cachedCanvases.getCanvas("inlineImage",i,n),a=r.context;return a.filter=this.current.transferMaps,a.drawImage(t,0,0),a.filter="none",r.canvas}},{key:"paintInlineImageXObject",value:function(e){if(this.contentVisible){var t=e.width,i=e.height,n=this.ctx;this.save();var r,a=n.filter;if("none"!==a&&""!==a&&(n.filter="none"),n.scale(1/t,-1/i),e.bitmap)r=this.applyTransferMapsToBitmap(e);else if("function"===typeof HTMLElement&&e instanceof HTMLElement||!e.data)r=e;else{var s=this.cachedCanvases.getCanvas("inlineImage",t,i).context;Qo(s,e),r=this.applyTransferMapsToCanvas(s)}var o=this._scaleImage(r,pt(n));n.imageSmoothingEnabled=tl(ft(n),e.interpolate),Yo(n,o.img,0,0,o.paintWidth,o.paintHeight,0,-i,t,i),this.compose(),this.restore()}}},{key:"paintInlineImageXObjectGroup",value:function(e,t){if(this.contentVisible){var i,n=this.ctx;if(e.bitmap)i=e.bitmap;else{var r=e.width,a=e.height,s=this.cachedCanvases.getCanvas("inlineImage",r,a).context;Qo(s,e),i=this.applyTransferMapsToCanvas(s)}var o,l=(0,v.Z)(t);try{for(l.s();!(o=l.n()).done;){var h=o.value;n.save(),n.transform.apply(n,(0,u.Z)(h.transform)),n.scale(1,-1),Yo(n,i,h.x,h.y,h.w,h.h,0,-1,1,1),n.restore()}}catch(c){l.e(c)}finally{l.f()}this.compose()}}},{key:"paintSolidColorImageMask",value:function(){this.contentVisible&&(this.ctx.fillRect(0,0,1,1),this.compose())}},{key:"markPoint",value:function(e){}},{key:"markPointProps",value:function(e,t){}},{key:"beginMarkedContent",value:function(e){this.markedContentStack.push({visible:!0})}},{key:"beginMarkedContentProps",value:function(e,t){"OC"===e?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(t)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}},{key:"endMarkedContent",value:function(){this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}},{key:"beginCompat",value:function(){}},{key:"endCompat",value:function(){}},{key:"consumePath",value:function(e,t){var i=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(t);var n=this.ctx;this.pendingClip&&(i||(this.pendingClip===al?n.clip(e,"evenodd"):n.clip(e)),this.pendingClip=null),this.current.startNewPathAndClipBox(this.current.clipBox)}},{key:"getSinglePixelWidth",value:function(){if(!this._cachedGetSinglePixelWidth){var e=ft(this.ctx);if(0===e[1]&&0===e[2])this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(e[0]),Math.abs(e[3]));else{var t=Math.abs(e[0]*e[3]-e[2]*e[1]),i=Math.hypot(e[0],e[2]),n=Math.hypot(e[1],e[3]);this._cachedGetSinglePixelWidth=Math.max(i,n)/t}}return this._cachedGetSinglePixelWidth}},{key:"getScaleForStroking",value:function(){if(-1===this._cachedScaleForStroking[0]){var e,t,i=this.current.lineWidth,n=this.ctx.getTransform(),r=n.a,a=n.b,s=n.c,o=n.d;if(0===a&&0===s){var l=Math.abs(r),u=Math.abs(o);if(l===u)if(0===i)e=t=1/l;else{var h=l*i;e=t=h<1?1/h:1}else if(0===i)e=1/l,t=1/u;else{var c=l*i,d=u*i;e=c<1?1/c:1,t=d<1?1/d:1}}else{var v=Math.abs(r*o-a*s),f=Math.hypot(r,a),p=Math.hypot(s,o);if(0===i)e=p/v,t=f/v;else{var g=i*v;e=p>g?p/g:1,t=f>g?f/g:1}}this._cachedScaleForStroking[0]=e,this._cachedScaleForStroking[1]=t}return this._cachedScaleForStroking}},{key:"rescaleAndStroke",value:function(e,t){var i=this.ctx,n=this.current.lineWidth,r=this.getScaleForStroking(),a=(0,c.Z)(r,2),s=a[0],o=a[1];if(s===o)return i.lineWidth=(n||1)*s,void i.stroke(e);var l=i.getLineDash();t&&i.save(),i.scale(s,o),Vo.a=1/s,Vo.d=1/o;var u=new Path2D;if(u.addPath(e,Vo),l.length>0){var h=Math.max(s,o);i.setLineDash(l.map((function(e){return e/h}))),i.lineDashOffset/=h}i.lineWidth=n||1,i.stroke(u),t&&i.restore()}},{key:"isContentVisible",value:function(){for(var e=this.markedContentStack.length-1;e>=0;e--)if(!this.markedContentStack[e].visible)return!1;return!0}}]),e}();function hl(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.current.activeSMask=null,this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)}function cl(){if(this.pageColors){var e=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if("none"!==e){var t=this.ctx.filter;this.ctx.filter=e,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=t}}}function dl(e,t,i){var n=new Path2D;return n.addPath(e,new DOMMatrix(i).invertSelf().multiplySelf(t)),n}for(var vl in ce)void 0!==ul.prototype[vl]&&(ul.prototype[ce[vl]]=ul.prototype[vl]);var fl=k("port"),pl=k("src"),gl=function(){function e(){(0,_.Z)(this,e)}return(0,A.Z)(e,null,[{key:"workerPort",get:function(){return b(this,fl)[fl]},set:function(e){if(!("undefined"!==typeof Worker&&e instanceof Worker)&&null!==e)throw new Error("Invalid `workerPort` type.");b(this,fl)[fl]=e}},{key:"workerSrc",get:function(){return b(this,pl)[pl]},set:function(e){if("string"!==typeof e)throw new Error("Invalid `workerSrc` type.");b(this,pl)[pl]=e}}]),e}();Object.defineProperty(gl,fl,{writable:!0,value:null}),Object.defineProperty(gl,pl,{writable:!0,value:""});var yl=k("map"),ml=k("data");E=Symbol.iterator;var bl=function(){function e(t){var i=t.parsedData,n=t.rawData;(0,_.Z)(this,e),Object.defineProperty(this,yl,{writable:!0,value:void 0}),Object.defineProperty(this,ml,{writable:!0,value:void 0}),b(this,yl)[yl]=i,b(this,ml)[ml]=n}return(0,A.Z)(e,[{key:"getRaw",value:function(){return b(this,ml)[ml]}},{key:"get",value:function(e){var t;return null!==(t=b(this,yl)[yl].get(e))&&void 0!==t?t:null}},{key:E,value:function(){return b(this,yl)[yl].entries()}}]),e}(),wl=Symbol("INTERNAL"),kl=k("isDisplay"),Al=k("isPrint"),_l=k("userSet"),xl=k("visible"),Pl=function(){function e(t,i){var n=i.name,r=i.intent,a=i.usage,s=i.rbGroups;(0,_.Z)(this,e),Object.defineProperty(this,kl,{writable:!0,value:!1}),Object.defineProperty(this,Al,{writable:!0,value:!1}),Object.defineProperty(this,_l,{writable:!0,value:!1}),Object.defineProperty(this,xl,{writable:!0,value:!0}),b(this,kl)[kl]=!!(t&N),b(this,Al)[Al]=!!(t&B),this.name=n,this.intent=r,this.usage=a,this.rbGroups=s}return(0,A.Z)(e,[{key:"visible",get:function(){if(b(this,_l)[_l])return b(this,xl)[xl];if(!b(this,xl)[xl])return!1;var e=this.usage,t=e.print,i=e.view;return b(this,kl)[kl]?"OFF"!==(null===i||void 0===i?void 0:i.viewState):!b(this,Al)[Al]||"OFF"!==(null===t||void 0===t?void 0:t.printState)}},{key:"_setVisible",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];e!==wl&&Ae("Internal method `_setVisible` called."),b(this,_l)[_l]=i,b(this,xl)[xl]=t}}]),e}(),Sl=k("cachedGetHash"),El=k("groups"),Cl=k("initialHash"),Ol=k("order"),Ml=k("evaluateVisibilityExpression");C=Symbol.iterator;var Tl=function(){function e(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:N;if((0,_.Z)(this,e),Object.defineProperty(this,Ml,{value:Rl}),Object.defineProperty(this,Sl,{writable:!0,value:null}),Object.defineProperty(this,El,{writable:!0,value:new Map}),Object.defineProperty(this,Cl,{writable:!0,value:null}),Object.defineProperty(this,Ol,{writable:!0,value:null}),this.renderingIntent=i,this.name=null,this.creator=null,null!==t){this.name=t.name,this.creator=t.creator,b(this,Ol)[Ol]=t.order;var n,r=(0,v.Z)(t.groups);try{for(r.s();!(n=r.n()).done;){var a=n.value;b(this,El)[El].set(a.id,new Pl(i,a))}}catch(g){r.e(g)}finally{r.f()}if("OFF"===t.baseState){var s,o=(0,v.Z)(b(this,El)[El].values());try{for(o.s();!(s=o.n()).done;){var l=s.value;l._setVisible(wl,!1)}}catch(g){o.e(g)}finally{o.f()}}var u,h=(0,v.Z)(t.on);try{for(h.s();!(u=h.n()).done;){var c=u.value;b(this,El)[El].get(c)._setVisible(wl,!0)}}catch(g){h.e(g)}finally{h.f()}var d,f=(0,v.Z)(t.off);try{for(f.s();!(d=f.n()).done;){var p=d.value;b(this,El)[El].get(p)._setVisible(wl,!1)}}catch(g){f.e(g)}finally{f.f()}b(this,Cl)[Cl]=this.getHash()}}return(0,A.Z)(e,[{key:"isVisible",value:function(e){if(0===b(this,El)[El].size)return!0;if(!e)return we("Optional content group not defined."),!0;if("OCG"===e.type)return b(this,El)[El].has(e.id)?b(this,El)[El].get(e.id).visible:(ke("Optional content group not found: ".concat(e.id)),!0);if("OCMD"===e.type){if(e.expression)return b(this,Ml)[Ml](e.expression);if(!e.policy||"AnyOn"===e.policy){var t,i=(0,v.Z)(e.ids);try{for(i.s();!(t=i.n()).done;){var n=t.value;if(!b(this,El)[El].has(n))return ke("Optional content group not found: ".concat(n)),!0;if(b(this,El)[El].get(n).visible)return!0}}catch(f){i.e(f)}finally{i.f()}return!1}if("AllOn"===e.policy){var r,a=(0,v.Z)(e.ids);try{for(a.s();!(r=a.n()).done;){var s=r.value;if(!b(this,El)[El].has(s))return ke("Optional content group not found: ".concat(s)),!0;if(!b(this,El)[El].get(s).visible)return!1}}catch(f){a.e(f)}finally{a.f()}return!0}if("AnyOff"===e.policy){var o,l=(0,v.Z)(e.ids);try{for(l.s();!(o=l.n()).done;){var u=o.value;if(!b(this,El)[El].has(u))return ke("Optional content group not found: ".concat(u)),!0;if(!b(this,El)[El].get(u).visible)return!0}}catch(f){l.e(f)}finally{l.f()}return!1}if("AllOff"===e.policy){var h,c=(0,v.Z)(e.ids);try{for(c.s();!(h=c.n()).done;){var d=h.value;if(!b(this,El)[El].has(d))return ke("Optional content group not found: ".concat(d)),!0;if(b(this,El)[El].get(d).visible)return!1}}catch(f){c.e(f)}finally{c.f()}return!0}return ke("Unknown optional content policy ".concat(e.policy,".")),!0}return ke("Unknown group type ".concat(e.type,".")),!0}},{key:"setVisibility",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=b(this,El)[El].get(e);if(n){if(i&&t&&n.rbGroups.length){var r,a=(0,v.Z)(n.rbGroups);try{for(a.s();!(r=a.n()).done;){var s,o=r.value,l=(0,v.Z)(o);try{for(l.s();!(s=l.n()).done;){var u,h=s.value;if(h!==e)null===(u=b(this,El)[El].get(h))||void 0===u||u._setVisible(wl,!1,!0)}}catch(c){l.e(c)}finally{l.f()}}}catch(c){a.e(c)}finally{a.f()}}n._setVisible(wl,!!t,!0),b(this,Sl)[Sl]=null}else ke("Optional content group not found: ".concat(e))}},{key:"setOCGState",value:function(e){var t,i,n=e.state,r=e.preserveRB,a=(0,v.Z)(n);try{for(a.s();!(i=a.n()).done;){var s=i.value;switch(s){case"ON":case"OFF":case"Toggle":t=s;continue}var o=b(this,El)[El].get(s);if(o)switch(t){case"ON":this.setVisibility(s,!0,r);break;case"OFF":this.setVisibility(s,!1,r);break;case"Toggle":this.setVisibility(s,!o.visible,r)}}}catch(l){a.e(l)}finally{a.f()}b(this,Sl)[Sl]=null}},{key:"hasInitialVisibility",get:function(){return null===b(this,Cl)[Cl]||this.getHash()===b(this,Cl)[Cl]}},{key:"getOrder",value:function(){return b(this,El)[El].size?b(this,Ol)[Ol]?b(this,Ol)[Ol].slice():(0,u.Z)(b(this,El)[El].keys()):null}},{key:"getGroup",value:function(e){return b(this,El)[El].get(e)||null}},{key:"getHash",value:function(){if(null!==b(this,Sl)[Sl])return b(this,Sl)[Sl];var e,t=new Ga,i=(0,v.Z)(b(this,El)[El]);try{for(i.s();!(e=i.n()).done;){var n=(0,c.Z)(e.value,2),r=n[0],a=n[1];t.update("".concat(r,":").concat(a.visible))}}catch(s){i.e(s)}finally{i.f()}return b(this,Sl)[Sl]=t.hexdigest()}},{key:C,value:function(){return b(this,El)[El].entries()}}]),e}();function Rl(e){var t=e.length;if(t<2)return!0;for(var i=e[0],n=1;n<t;n++){var r=e[n],a=void 0;if(Array.isArray(r))a=b(this,Ml)[Ml](r);else{if(!b(this,El)[El].has(r))return ke("Optional content group not found: ".concat(r)),!0;a=b(this,El)[El].get(r).visible}switch(i){case"And":if(!a)return!1;break;case"Or":if(a)return!0;break;case"Not":return!a;default:return!0}}return"And"===i}var Zl=function(){function e(t,i){var n=this,r=i.disableRange,a=void 0!==r&&r,s=i.disableStream,o=void 0!==s&&s;(0,_.Z)(this,e),_e(t,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.');var l=t.length,u=t.initialData,h=t.progressiveDone,c=t.contentDispositionFilename;if(this._queuedChunks=[],this._progressiveDone=h,this._contentDispositionFilename=c,(null===u||void 0===u?void 0:u.length)>0){var d=u instanceof Uint8Array&&u.byteLength===u.buffer.byteLength?u.buffer:new Uint8Array(u).buffer;this._queuedChunks.push(d)}this._pdfDataRangeTransport=t,this._isStreamingSupported=!o,this._isRangeSupported=!a,this._contentLength=l,this._fullRequestReader=null,this._rangeReaders=[],t.addRangeListener((function(e,t){n._onReceiveData({begin:e,chunk:t})})),t.addProgressListener((function(e,t){n._onProgress({loaded:e,total:t})})),t.addProgressiveReadListener((function(e){n._onReceiveData({chunk:e})})),t.addProgressiveDoneListener((function(){n._onProgressiveDone()})),t.transportReady()}return(0,A.Z)(e,[{key:"_onReceiveData",value:function(e){var t=e.begin,i=e.chunk,n=i instanceof Uint8Array&&i.byteLength===i.buffer.byteLength?i.buffer:new Uint8Array(i).buffer;void 0===t?this._fullRequestReader?this._fullRequestReader._enqueue(n):this._queuedChunks.push(n):_e(this._rangeReaders.some((function(e){return e._begin===t&&(e._enqueue(n),!0)})),"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}},{key:"_progressiveDataLength",get:function(){var e,t;return null!==(e=null===(t=this._fullRequestReader)||void 0===t?void 0:t._loaded)&&void 0!==e?e:0}},{key:"_onProgress",value:function(e){var t,i,n,r;void 0===e.total?null===(t=this._rangeReaders[0])||void 0===t||null===(i=t.onProgress)||void 0===i||i.call(t,{loaded:e.loaded}):null===(n=this._fullRequestReader)||void 0===n||null===(r=n.onProgress)||void 0===r||r.call(n,{loaded:e.loaded,total:e.total})}},{key:"_onProgressiveDone",value:function(){var e;null===(e=this._fullRequestReader)||void 0===e||e.progressiveDone(),this._progressiveDone=!0}},{key:"_removeRangeReader",value:function(e){var t=this._rangeReaders.indexOf(e);t>=0&&this._rangeReaders.splice(t,1)}},{key:"getFullReader",value:function(){_e(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");var e=this._queuedChunks;return this._queuedChunks=null,new Il(this,e,this._progressiveDone,this._contentDispositionFilename)}},{key:"getRangeReader",value:function(e,t){if(t<=this._progressiveDataLength)return null;var i=new Dl(this,e,t);return this._pdfDataRangeTransport.requestDataRange(e,t),this._rangeReaders.push(i),i}},{key:"cancelAllRequests",value:function(e){var t;null===(t=this._fullRequestReader)||void 0===t||t.cancel(e);var i,n=(0,v.Z)(this._rangeReaders.slice(0));try{for(n.s();!(i=n.n()).done;){i.value.cancel(e)}}catch(r){n.e(r)}finally{n.f()}this._pdfDataRangeTransport.abort()}}]),e}(),Il=function(){function e(t,i){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;(0,_.Z)(this,e),this._stream=t,this._done=n||!1,this._filename=nt(r)?r:null,this._queuedChunks=i||[],this._loaded=0;var a,s=(0,v.Z)(this._queuedChunks);try{for(s.s();!(a=s.n()).done;){var o=a.value;this._loaded+=o.byteLength}}catch(l){s.e(l)}finally{s.f()}this._requests=[],this._headersReady=Promise.resolve(),t._fullRequestReader=this,this.onProgress=null}return(0,A.Z)(e,[{key:"_enqueue",value:function(e){if(!this._done){if(this._requests.length>0)this._requests.shift().resolve({value:e,done:!1});else this._queuedChunks.push(e);this._loaded+=e.byteLength}}},{key:"headersReady",get:function(){return this._headersReady}},{key:"filename",get:function(){return this._filename}},{key:"isRangeSupported",get:function(){return this._stream._isRangeSupported}},{key:"isStreamingSupported",get:function(){return this._stream._isStreamingSupported}},{key:"contentLength",get:function(){return this._stream._contentLength}},{key:"read",value:function(){var e=(0,d.Z)((0,h.Z)().mark((function e(){var t,i;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this._queuedChunks.length>0)){e.next=3;break}return t=this._queuedChunks.shift(),e.abrupt("return",{value:t,done:!1});case 3:if(!this._done){e.next=5;break}return e.abrupt("return",{value:void 0,done:!0});case 5:return i=Promise.withResolvers(),this._requests.push(i),e.abrupt("return",i.promise);case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"cancel",value:function(e){this._done=!0;var t,i=(0,v.Z)(this._requests);try{for(i.s();!(t=i.n()).done;){t.value.resolve({value:void 0,done:!0})}}catch(n){i.e(n)}finally{i.f()}this._requests.length=0}},{key:"progressiveDone",value:function(){this._done||(this._done=!0)}}]),e}(),Dl=function(){function e(t,i,n){(0,_.Z)(this,e),this._stream=t,this._begin=i,this._end=n,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}return(0,A.Z)(e,[{key:"_enqueue",value:function(e){if(!this._done){if(0===this._requests.length)this._queuedChunk=e;else{this._requests.shift().resolve({value:e,done:!1});var t,i=(0,v.Z)(this._requests);try{for(i.s();!(t=i.n()).done;){t.value.resolve({value:void 0,done:!0})}}catch(n){i.e(n)}finally{i.f()}this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}},{key:"isStreamingSupported",get:function(){return!1}},{key:"read",value:function(){var e=(0,d.Z)((0,h.Z)().mark((function e(){var t,i;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._queuedChunk){e.next=4;break}return t=this._queuedChunk,this._queuedChunk=null,e.abrupt("return",{value:t,done:!1});case 4:if(!this._done){e.next=6;break}return e.abrupt("return",{value:void 0,done:!0});case 6:return i=Promise.withResolvers(),this._requests.push(i),e.abrupt("return",i.promise);case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"cancel",value:function(e){this._done=!0;var t,i=(0,v.Z)(this._requests);try{for(i.s();!(t=i.n()).done;){t.value.resolve({value:void 0,done:!0})}}catch(n){i.e(n)}finally{i.f()}this._requests.length=0,this._stream._removeRangeReader(this)}}]),e}();function Ll(e,t){var i=new Headers;if(!e||!t||"object"!==typeof t)return i;for(var n in t){var r=t[n];void 0!==r&&i.append(n,r)}return i}function jl(e){var t,i;return null!==(t=null===(i=URL.parse(e))||void 0===i?void 0:i.origin)&&void 0!==t?t:null}function Fl(e){var t=e.responseHeaders,i=e.isHttp,n=e.rangeChunkSize,r=e.disableRange,a={allowRangeRequests:!1,suggestedLength:void 0},s=parseInt(t.get("Content-Length"),10);return Number.isInteger(s)?(a.suggestedLength=s,s<=2*n||r||!i||"bytes"!==t.get("Accept-Ranges")||"identity"!==(t.get("Content-Encoding")||"identity")||(a.allowRangeRequests=!0),a):a}function Nl(e){var t=e.get("Content-Disposition");if(t){var i=function(e){var t=!0,i=a("filename\\*","i").exec(e);if(i){var n=l(i=i[1]);return o(n=h(n=u(n=unescape(n))))}if(i=function(e){for(var t,i=[],n=a("filename\\*((?!0\\d)\\d+)(\\*?)","ig");null!==(t=n.exec(e));){var r=t,s=(0,c.Z)(r,4),o=s[1],h=s[2],d=s[3];if((o=parseInt(o,10))in i){if(0===o)break}else i[o]=[h,d]}for(var v=[],f=0;f<i.length&&f in i;++f){var p=(0,c.Z)(i[f],2),g=p[0],y=p[1];y=l(y),g&&(y=unescape(y),0===f&&(y=u(y))),v.push(y)}return v.join("")}(e))return o(h(i));if(i=a("filename","i").exec(e)){var r=l(i=i[1]);return o(r=h(r))}function a(e,t){return new RegExp("(?:^|;)\\s*"+e+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',t)}function s(e,i){if(e){if(!/^[\x00-\xFF]+$/.test(i))return i;try{var n=new TextDecoder(e,{fatal:!0}),r=Le(i);i=n.decode(r),t=!1}catch(a){}}return i}function o(e){return t&&/[\x80-\xff]/.test(e)&&(e=s("utf-8",e),t&&(e=s("iso-8859-1",e))),e}function l(e){if(e.startsWith('"')){for(var t=e.slice(1).split('\\"'),i=0;i<t.length;++i){var n=t[i].indexOf('"');-1!==n&&(t[i]=t[i].slice(0,n),t.length=i+1),t[i]=t[i].replaceAll(/\\(.)/g,"$1")}e=t.join('"')}return e}function u(e){var t=e.indexOf("'");return-1===t?e:s(e.slice(0,t),e.slice(t+1).replace(/^[^']*'/,""))}function h(e){return!e.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(e)?e:e.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,(function(e,t,i,n){if("q"===i||"Q"===i)return s(t,n=(n=n.replaceAll("_"," ")).replaceAll(/=([0-9a-fA-F]{2})/g,(function(e,t){return String.fromCharCode(parseInt(t,16))})));try{n=atob(n)}catch(r){}return s(t,n)}))}return""}(t);if(i.includes("%"))try{i=decodeURIComponent(i)}catch(n){}if(nt(i))return i}return null}function Bl(e,t){return new Re("Unexpected server response (".concat(e,') while retrieving PDF "').concat(t,'".'),e,404===e||0===e&&t.startsWith("file:"))}function Hl(e){return 200===e||206===e}function zl(e,t,i){return{method:"GET",headers:e,signal:i.signal,mode:"cors",credentials:t?"include":"same-origin",redirect:"follow"}}function Gl(e){return e instanceof Uint8Array?e.buffer:e instanceof ArrayBuffer?e:(ke("getArrayBuffer - unexpected data format: ".concat(e)),new Uint8Array(e).buffer)}var Ul=function(){function e(t){(0,_.Z)(this,e),this._responseOrigin=null,this.source=t,this.isHttp=/^https?:/i.test(t.url),this.headers=Ll(this.isHttp,t.httpHeaders),this._fullRequestReader=null,this._rangeRequestReaders=[]}return(0,A.Z)(e,[{key:"_progressiveDataLength",get:function(){var e,t;return null!==(e=null===(t=this._fullRequestReader)||void 0===t?void 0:t._loaded)&&void 0!==e?e:0}},{key:"getFullReader",value:function(){return _e(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new Vl(this),this._fullRequestReader}},{key:"getRangeReader",value:function(e,t){if(t<=this._progressiveDataLength)return null;var i=new Wl(this,e,t);return this._rangeRequestReaders.push(i),i}},{key:"cancelAllRequests",value:function(e){var t;null===(t=this._fullRequestReader)||void 0===t||t.cancel(e);var i,n=(0,v.Z)(this._rangeRequestReaders.slice(0));try{for(n.s();!(i=n.n()).done;){i.value.cancel(e)}}catch(r){n.e(r)}finally{n.f()}}}]),e}(),Vl=function(){function e(t){var i=this;(0,_.Z)(this,e),this._stream=t,this._reader=null,this._loaded=0,this._filename=null;var n=t.source;this._withCredentials=n.withCredentials||!1,this._contentLength=n.length,this._headersCapability=Promise.withResolvers(),this._disableRange=n.disableRange||!1,this._rangeChunkSize=n.rangeChunkSize,this._rangeChunkSize||this._disableRange||(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!n.disableStream,this._isRangeSupported=!n.disableRange;var r=new Headers(t.headers),a=n.url;fetch(a,zl(r,this._withCredentials,this._abortController)).then((function(e){if(t._responseOrigin=jl(e.url),!Hl(e.status))throw Bl(e.status,a);i._reader=e.body.getReader(),i._headersCapability.resolve();var n=e.headers,r=Fl({responseHeaders:n,isHttp:t.isHttp,rangeChunkSize:i._rangeChunkSize,disableRange:i._disableRange}),s=r.allowRangeRequests,o=r.suggestedLength;i._isRangeSupported=s,i._contentLength=o||i._contentLength,i._filename=Nl(n),!i._isStreamingSupported&&i._isRangeSupported&&i.cancel(new Ie("Streaming is disabled."))})).catch(this._headersCapability.reject),this.onProgress=null}return(0,A.Z)(e,[{key:"headersReady",get:function(){return this._headersCapability.promise}},{key:"filename",get:function(){return this._filename}},{key:"contentLength",get:function(){return this._contentLength}},{key:"isRangeSupported",get:function(){return this._isRangeSupported}},{key:"isStreamingSupported",get:function(){return this._isStreamingSupported}},{key:"read",value:function(){var e=(0,d.Z)((0,h.Z)().mark((function e(){var t,i,n,r;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._headersCapability.promise;case 2:return e.next=4,this._reader.read();case 4:if(i=e.sent,n=i.value,!(r=i.done)){e.next=9;break}return e.abrupt("return",{value:n,done:r});case 9:return this._loaded+=n.byteLength,null===(t=this.onProgress)||void 0===t||t.call(this,{loaded:this._loaded,total:this._contentLength}),e.abrupt("return",{value:Gl(n),done:!1});case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"cancel",value:function(e){var t;null===(t=this._reader)||void 0===t||t.cancel(e),this._abortController.abort()}}]),e}(),Wl=function(){function e(t,i,n){var r=this;(0,_.Z)(this,e),this._stream=t,this._reader=null,this._loaded=0;var a=t.source;this._withCredentials=a.withCredentials||!1,this._readCapability=Promise.withResolvers(),this._isStreamingSupported=!a.disableStream,this._abortController=new AbortController;var s=new Headers(t.headers);s.append("Range","bytes=".concat(i,"-").concat(n-1));var o=a.url;fetch(o,zl(s,this._withCredentials,this._abortController)).then((function(e){var i=jl(e.url);if(i!==t._responseOrigin)throw new Error('Expected range response-origin "'.concat(i,'" to match "').concat(t._responseOrigin,'".'));if(!Hl(e.status))throw Bl(e.status,o);r._readCapability.resolve(),r._reader=e.body.getReader()})).catch(this._readCapability.reject),this.onProgress=null}return(0,A.Z)(e,[{key:"isStreamingSupported",get:function(){return this._isStreamingSupported}},{key:"read",value:function(){var e=(0,d.Z)((0,h.Z)().mark((function e(){var t,i,n,r;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._readCapability.promise;case 2:return e.next=4,this._reader.read();case 4:if(i=e.sent,n=i.value,!(r=i.done)){e.next=9;break}return e.abrupt("return",{value:n,done:r});case 9:return this._loaded+=n.byteLength,null===(t=this.onProgress)||void 0===t||t.call(this,{loaded:this._loaded}),e.abrupt("return",{value:Gl(n),done:!1});case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"cancel",value:function(e){var t;null===(t=this._reader)||void 0===t||t.cancel(e),this._abortController.abort()}}]),e}();var ql=function(){function e(t){var i=t.url,n=t.httpHeaders,r=t.withCredentials;(0,_.Z)(this,e),this._responseOrigin=null,this.url=i,this.isHttp=/^https?:/i.test(i),this.headers=Ll(this.isHttp,n),this.withCredentials=r||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}return(0,A.Z)(e,[{key:"request",value:function(e){var t=new XMLHttpRequest,i=this.currXhrId++,n=this.pendingRequests[i]={xhr:t};t.open("GET",this.url),t.withCredentials=this.withCredentials;var r,a=(0,v.Z)(this.headers);try{for(a.s();!(r=a.n()).done;){var s=(0,c.Z)(r.value,2),o=s[0],l=s[1];t.setRequestHeader(o,l)}}catch(u){a.e(u)}finally{a.f()}return this.isHttp&&"begin"in e&&"end"in e?(t.setRequestHeader("Range","bytes=".concat(e.begin,"-").concat(e.end-1)),n.expectedStatus=206):n.expectedStatus=200,t.responseType="arraybuffer",_e(e.onError,"Expected `onError` callback to be provided."),t.onerror=function(){e.onError(t.status)},t.onreadystatechange=this.onStateChange.bind(this,i),t.onprogress=this.onProgress.bind(this,i),n.onHeadersReceived=e.onHeadersReceived,n.onDone=e.onDone,n.onError=e.onError,n.onProgress=e.onProgress,t.send(null),i}},{key:"onProgress",value:function(e,t){var i,n=this.pendingRequests[e];n&&(null===(i=n.onProgress)||void 0===i||i.call(n,t))}},{key:"onStateChange",value:function(e,t){var i=this.pendingRequests[e];if(i){var n=i.xhr;if(n.readyState>=2&&i.onHeadersReceived&&(i.onHeadersReceived(),delete i.onHeadersReceived),4===n.readyState&&e in this.pendingRequests)if(delete this.pendingRequests[e],0===n.status&&this.isHttp)i.onError(n.status);else{var r=n.status||200;if(200===r&&206===i.expectedStatus||r===i.expectedStatus){var a=function(e){var t=e.response;return"string"!==typeof t?t:Le(t).buffer}(n);if(206===r){var s=n.getResponseHeader("Content-Range"),o=/bytes (\d+)-(\d+)\/(\d+)/.exec(s);o?i.onDone({begin:parseInt(o[1],10),chunk:a}):(ke('Missing or invalid "Content-Range" header.'),i.onError(0))}else a?i.onDone({begin:0,chunk:a}):i.onError(n.status)}else i.onError(n.status)}}}},{key:"getRequestXhr",value:function(e){return this.pendingRequests[e].xhr}},{key:"isPendingRequest",value:function(e){return e in this.pendingRequests}},{key:"abortRequest",value:function(e){var t=this.pendingRequests[e].xhr;delete this.pendingRequests[e],t.abort()}}]),e}(),Xl=function(){function e(t){(0,_.Z)(this,e),this._source=t,this._manager=new ql(t),this._rangeChunkSize=t.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}return(0,A.Z)(e,[{key:"_onRangeRequestReaderClosed",value:function(e){var t=this._rangeRequestReaders.indexOf(e);t>=0&&this._rangeRequestReaders.splice(t,1)}},{key:"getFullReader",value:function(){return _e(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new Yl(this._manager,this._source),this._fullRequestReader}},{key:"getRangeReader",value:function(e,t){var i=new Kl(this._manager,e,t);return i.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(i),i}},{key:"cancelAllRequests",value:function(e){var t;null===(t=this._fullRequestReader)||void 0===t||t.cancel(e);var i,n=(0,v.Z)(this._rangeRequestReaders.slice(0));try{for(n.s();!(i=n.n()).done;){i.value.cancel(e)}}catch(r){n.e(r)}finally{n.f()}}}]),e}(),Yl=function(){function e(t,i){(0,_.Z)(this,e),this._manager=t,this._url=i.url,this._fullRequestId=t.request({onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._headersCapability=Promise.withResolvers(),this._disableRange=i.disableRange||!1,this._contentLength=i.length,this._rangeChunkSize=i.rangeChunkSize,this._rangeChunkSize||this._disableRange||(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}return(0,A.Z)(e,[{key:"_onHeadersReceived",value:function(){var e=this._fullRequestId,t=this._manager.getRequestXhr(e);this._manager._responseOrigin=jl(t.responseURL);var i=t.getAllResponseHeaders(),n=new Headers(i?i.trimStart().replace(/[^\S ]+$/,"").split(/[\r\n]+/).map((function(e){var t=m(e.split(": "));return[t[0],t.slice(1).join(": ")]})):[]),r=Fl({responseHeaders:n,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange}),a=r.allowRangeRequests,s=r.suggestedLength;a&&(this._isRangeSupported=!0),this._contentLength=s||this._contentLength,this._filename=Nl(n),this._isRangeSupported&&this._manager.abortRequest(e),this._headersCapability.resolve()}},{key:"_onDone",value:function(e){e&&(this._requests.length>0?this._requests.shift().resolve({value:e.chunk,done:!1}):this._cachedChunks.push(e.chunk));if(this._done=!0,!(this._cachedChunks.length>0)){var t,i=(0,v.Z)(this._requests);try{for(i.s();!(t=i.n()).done;){t.value.resolve({value:void 0,done:!0})}}catch(n){i.e(n)}finally{i.f()}this._requests.length=0}}},{key:"_onError",value:function(e){this._storedError=Bl(e,this._url),this._headersCapability.reject(this._storedError);var t,i=(0,v.Z)(this._requests);try{for(i.s();!(t=i.n()).done;){t.value.reject(this._storedError)}}catch(n){i.e(n)}finally{i.f()}this._requests.length=0,this._cachedChunks.length=0}},{key:"_onProgress",value:function(e){var t;null===(t=this.onProgress)||void 0===t||t.call(this,{loaded:e.loaded,total:e.lengthComputable?e.total:this._contentLength})}},{key:"filename",get:function(){return this._filename}},{key:"isRangeSupported",get:function(){return this._isRangeSupported}},{key:"isStreamingSupported",get:function(){return this._isStreamingSupported}},{key:"contentLength",get:function(){return this._contentLength}},{key:"headersReady",get:function(){return this._headersCapability.promise}},{key:"read",value:function(){var e=(0,d.Z)((0,h.Z)().mark((function e(){var t,i;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._headersCapability.promise;case 2:if(!this._storedError){e.next=4;break}throw this._storedError;case 4:if(!(this._cachedChunks.length>0)){e.next=7;break}return t=this._cachedChunks.shift(),e.abrupt("return",{value:t,done:!1});case 7:if(!this._done){e.next=9;break}return e.abrupt("return",{value:void 0,done:!0});case 9:return i=Promise.withResolvers(),this._requests.push(i),e.abrupt("return",i.promise);case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"cancel",value:function(e){this._done=!0,this._headersCapability.reject(e);var t,i=(0,v.Z)(this._requests);try{for(i.s();!(t=i.n()).done;){t.value.resolve({value:void 0,done:!0})}}catch(n){i.e(n)}finally{i.f()}this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}]),e}(),Kl=function(){function e(t,i,n){(0,_.Z)(this,e),this._manager=t,this._url=t.url,this._requestId=t.request({begin:i,end:n,onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}return(0,A.Z)(e,[{key:"_onHeadersReceived",value:function(){var e,t=jl(null===(e=this._manager.getRequestXhr(this._requestId))||void 0===e?void 0:e.responseURL);t!==this._manager._responseOrigin&&(this._storedError=new Error('Expected range response-origin "'.concat(t,'" to match "').concat(this._manager._responseOrigin,'".')),this._onError(0))}},{key:"_close",value:function(){var e;null===(e=this.onClosed)||void 0===e||e.call(this,this)}},{key:"_onDone",value:function(e){var t=e.chunk;this._requests.length>0?this._requests.shift().resolve({value:t,done:!1}):this._queuedChunk=t;this._done=!0;var i,n=(0,v.Z)(this._requests);try{for(n.s();!(i=n.n()).done;){i.value.resolve({value:void 0,done:!0})}}catch(r){n.e(r)}finally{n.f()}this._requests.length=0,this._close()}},{key:"_onError",value:function(e){var t;null!==(t=this._storedError)&&void 0!==t||(this._storedError=Bl(e,this._url));var i,n=(0,v.Z)(this._requests);try{for(n.s();!(i=n.n()).done;){i.value.reject(this._storedError)}}catch(r){n.e(r)}finally{n.f()}this._requests.length=0,this._queuedChunk=null}},{key:"_onProgress",value:function(e){var t;this.isStreamingSupported||(null===(t=this.onProgress)||void 0===t||t.call(this,{loaded:e.loaded}))}},{key:"isStreamingSupported",get:function(){return!1}},{key:"read",value:function(){var e=(0,d.Z)((0,h.Z)().mark((function e(){var t,i;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._storedError){e.next=2;break}throw this._storedError;case 2:if(null===this._queuedChunk){e.next=6;break}return t=this._queuedChunk,this._queuedChunk=null,e.abrupt("return",{value:t,done:!1});case 6:if(!this._done){e.next=8;break}return e.abrupt("return",{value:void 0,done:!0});case 8:return i=Promise.withResolvers(),this._requests.push(i),e.abrupt("return",i.promise);case 11:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"cancel",value:function(e){this._done=!0;var t,i=(0,v.Z)(this._requests);try{for(i.s();!(t=i.n()).done;){t.value.resolve({value:void 0,done:!0})}}catch(n){i.e(n)}finally{i.f()}this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}]),e}(),Ql=/^[a-z][a-z0-9\-+.]+:/i;var Jl=function(){function e(t){(0,_.Z)(this,e),this.source=t,this.url=function(e){if(Ql.test(e))return new URL(e);var t=process.getBuiltinModule("url");return new URL(t.pathToFileURL(e))}(t.url),_e("file:"===this.url.protocol,"PDFNodeStream only supports file:// URLs."),this._fullRequestReader=null,this._rangeRequestReaders=[]}return(0,A.Z)(e,[{key:"_progressiveDataLength",get:function(){var e,t;return null!==(e=null===(t=this._fullRequestReader)||void 0===t?void 0:t._loaded)&&void 0!==e?e:0}},{key:"getFullReader",value:function(){return _e(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=new $l(this),this._fullRequestReader}},{key:"getRangeReader",value:function(e,t){if(t<=this._progressiveDataLength)return null;var i=new eu(this,e,t);return this._rangeRequestReaders.push(i),i}},{key:"cancelAllRequests",value:function(e){var t;null===(t=this._fullRequestReader)||void 0===t||t.cancel(e);var i,n=(0,v.Z)(this._rangeRequestReaders.slice(0));try{for(n.s();!(i=n.n()).done;){i.value.cancel(e)}}catch(r){n.e(r)}finally{n.f()}}}]),e}(),$l=function(){function e(t){var i=this;(0,_.Z)(this,e),this._url=t.url,this._done=!1,this._storedError=null,this.onProgress=null;var n=t.source;this._contentLength=n.length,this._loaded=0,this._filename=null,this._disableRange=n.disableRange||!1,this._rangeChunkSize=n.rangeChunkSize,this._rangeChunkSize||this._disableRange||(this._disableRange=!0),this._isStreamingSupported=!n.disableStream,this._isRangeSupported=!n.disableRange,this._readableStream=null,this._readCapability=Promise.withResolvers(),this._headersCapability=Promise.withResolvers();var r=process.getBuiltinModule("fs");r.promises.lstat(this._url).then((function(e){i._contentLength=e.size,i._setReadableStream(r.createReadStream(i._url)),i._headersCapability.resolve()}),(function(e){"ENOENT"===e.code&&(e=Bl(0,i._url.href)),i._storedError=e,i._headersCapability.reject(e)}))}return(0,A.Z)(e,[{key:"headersReady",get:function(){return this._headersCapability.promise}},{key:"filename",get:function(){return this._filename}},{key:"contentLength",get:function(){return this._contentLength}},{key:"isRangeSupported",get:function(){return this._isRangeSupported}},{key:"isStreamingSupported",get:function(){return this._isStreamingSupported}},{key:"read",value:function(){var e=(0,d.Z)((0,h.Z)().mark((function e(){var t,i,n;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._readCapability.promise;case 2:if(!this._done){e.next=4;break}return e.abrupt("return",{value:void 0,done:!0});case 4:if(!this._storedError){e.next=6;break}throw this._storedError;case 6:if(null!==(i=this._readableStream.read())){e.next=10;break}return this._readCapability=Promise.withResolvers(),e.abrupt("return",this.read());case 10:return this._loaded+=i.length,null===(t=this.onProgress)||void 0===t||t.call(this,{loaded:this._loaded,total:this._contentLength}),n=new Uint8Array(i).buffer,e.abrupt("return",{value:n,done:!1});case 14:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"cancel",value:function(e){this._readableStream?this._readableStream.destroy(e):this._error(e)}},{key:"_error",value:function(e){this._storedError=e,this._readCapability.resolve()}},{key:"_setReadableStream",value:function(e){var t=this;this._readableStream=e,e.on("readable",(function(){t._readCapability.resolve()})),e.on("end",(function(){e.destroy(),t._done=!0,t._readCapability.resolve()})),e.on("error",(function(e){t._error(e)})),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new Ie("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}]),e}(),eu=function(){function e(t,i,n){(0,_.Z)(this,e),this._url=t.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=Promise.withResolvers();var r=t.source;this._isStreamingSupported=!r.disableStream;var a=process.getBuiltinModule("fs");this._setReadableStream(a.createReadStream(this._url,{start:i,end:n-1}))}return(0,A.Z)(e,[{key:"isStreamingSupported",get:function(){return this._isStreamingSupported}},{key:"read",value:function(){var e=(0,d.Z)((0,h.Z)().mark((function e(){var t,i,n;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._readCapability.promise;case 2:if(!this._done){e.next=4;break}return e.abrupt("return",{value:void 0,done:!0});case 4:if(!this._storedError){e.next=6;break}throw this._storedError;case 6:if(null!==(i=this._readableStream.read())){e.next=10;break}return this._readCapability=Promise.withResolvers(),e.abrupt("return",this.read());case 10:return this._loaded+=i.length,null===(t=this.onProgress)||void 0===t||t.call(this,{loaded:this._loaded}),n=new Uint8Array(i).buffer,e.abrupt("return",{value:n,done:!1});case 14:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"cancel",value:function(e){this._readableStream?this._readableStream.destroy(e):this._error(e)}},{key:"_error",value:function(e){this._storedError=e,this._readCapability.resolve()}},{key:"_setReadableStream",value:function(e){var t=this;this._readableStream=e,e.on("readable",(function(){t._readCapability.resolve()})),e.on("end",(function(){e.destroy(),t._done=!0,t._readCapability.resolve()})),e.on("error",(function(e){t._error(e)})),this._storedError&&this._readableStream.destroy(this._storedError)}}]),e}(),tu=Symbol("INITIAL_DATA"),iu=k("objs"),nu=k("ensureObj");O=Symbol.iterator;var ru=function(){function e(){(0,_.Z)(this,e),Object.defineProperty(this,nu,{value:au}),Object.defineProperty(this,iu,{writable:!0,value:Object.create(null)})}return(0,A.Z)(e,[{key:"get",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(t){var i=b(this,nu)[nu](e);return i.promise.then((function(){return t(i.data)})),null}var n=b(this,iu)[iu][e];if(!n||n.data===tu)throw new Error("Requesting object that isn't resolved yet ".concat(e,"."));return n.data}},{key:"has",value:function(e){var t=b(this,iu)[iu][e];return!!t&&t.data!==tu}},{key:"delete",value:function(e){var t=b(this,iu)[iu][e];return!(!t||t.data===tu)&&(delete b(this,iu)[iu][e],!0)}},{key:"resolve",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=b(this,nu)[nu](e);i.data=t,i.resolve()}},{key:"clear",value:function(){for(var e in b(this,iu)[iu]){var t,i=b(this,iu)[iu][e].data;null===i||void 0===i||null===(t=i.bitmap)||void 0===t||t.close()}b(this,iu)[iu]=Object.create(null)}},{key:O,value:(0,h.Z)().mark((function e(){var t,i;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=(0,h.Z)().keys(b(this,iu)[iu]);case 1:if((e.t1=e.t0()).done){e.next=10;break}if(t=e.t1.value,(i=b(this,iu)[iu][t].data)!==tu){e.next=6;break}return e.abrupt("continue",1);case 6:return e.next=8,[t,i];case 8:e.next=1;break;case 10:case"end":return e.stop()}}),e,this)}))}]),e}();function au(e){var t;return(t=b(this,iu)[iu])[e]||(t[e]=(0,l.Z)((0,l.Z)({},Promise.withResolvers()),{},{data:tu}))}var su=k("capability"),ou=k("container"),lu=k("disableProcessItems"),uu=k("fontInspectorEnabled"),hu=k("lang"),cu=k("layoutTextParams"),du=k("pageHeight"),vu=k("pageWidth"),fu=k("reader"),pu=k("rootContainer"),gu=k("rotation"),yu=k("scale"),mu=k("styleCache"),bu=k("textContentItemsStr"),wu=k("textContentSource"),ku=k("textDivs"),Au=k("textDivProperties"),_u=k("transform"),xu=k("ascentCache"),Pu=k("canvasContexts"),Su=k("canvasCtxFonts"),Eu=k("minFontSize"),Cu=k("pendingTextLayers"),Ou=k("processItems"),Mu=k("appendText"),Tu=k("layout"),Ru=k("getCtx"),Zu=k("ensureCtxFont"),Iu=k("ensureMinFontSizeComputed"),Du=k("getAscent"),Lu=function(){function e(t){var i,n=this,r=t.textContentSource,a=t.container,s=t.viewport;if((0,_.Z)(this,e),Object.defineProperty(this,Tu,{value:Nu}),Object.defineProperty(this,Mu,{value:Fu}),Object.defineProperty(this,Ou,{value:ju}),Object.defineProperty(this,su,{writable:!0,value:Promise.withResolvers()}),Object.defineProperty(this,ou,{writable:!0,value:null}),Object.defineProperty(this,lu,{writable:!0,value:!1}),Object.defineProperty(this,uu,{writable:!0,value:!(null===(i=globalThis.FontInspector)||void 0===i||!i.enabled)}),Object.defineProperty(this,hu,{writable:!0,value:null}),Object.defineProperty(this,cu,{writable:!0,value:null}),Object.defineProperty(this,du,{writable:!0,value:0}),Object.defineProperty(this,vu,{writable:!0,value:0}),Object.defineProperty(this,fu,{writable:!0,value:null}),Object.defineProperty(this,pu,{writable:!0,value:null}),Object.defineProperty(this,gu,{writable:!0,value:0}),Object.defineProperty(this,yu,{writable:!0,value:0}),Object.defineProperty(this,mu,{writable:!0,value:Object.create(null)}),Object.defineProperty(this,bu,{writable:!0,value:[]}),Object.defineProperty(this,wu,{writable:!0,value:null}),Object.defineProperty(this,ku,{writable:!0,value:[]}),Object.defineProperty(this,Au,{writable:!0,value:new WeakMap}),Object.defineProperty(this,_u,{writable:!0,value:null}),r instanceof ReadableStream)b(this,wu)[wu]=r;else{if("object"!==typeof r)throw new Error('No "textContentSource" parameter specified.');b(this,wu)[wu]=new ReadableStream({start:function(e){e.enqueue(r),e.close()}})}b(this,ou)[ou]=b(this,pu)[pu]=a,b(this,yu)[yu]=s.scale*yt.pixelRatio,b(this,gu)[gu]=s.rotation,b(this,cu)[cu]={div:null,properties:null,ctx:null};var o=s.rawDims,l=o.pageWidth,u=o.pageHeight,h=o.pageX,c=o.pageY;b(this,_u)[_u]=[1,0,0,-1,-h,c+u],b(this,vu)[vu]=l,b(this,du)[du]=u,b(e,Iu)[Iu](),gt(a,s),b(this,su)[su].promise.finally((function(){b(e,Cu)[Cu].delete(n),b(n,cu)[cu]=null,b(n,mu)[mu]=null})).catch((function(){}))}return(0,A.Z)(e,[{key:"render",value:function(){var t=this;return b(this,fu)[fu]=b(this,wu)[wu].getReader(),b(e,Cu)[Cu].add(this),function e(){b(t,fu)[fu].read().then((function(i){var n,r,a=i.value;i.done?b(t,su)[su].resolve():(null!==(r=(n=b(t,hu))[hu])&&void 0!==r||(n[hu]=a.lang),Object.assign(b(t,mu)[mu],a.styles),b(t,Ou)[Ou](a.items),e())}),b(t,su)[su].reject)}(),b(this,su)[su].promise}},{key:"update",value:function(t){var i=t.viewport,n=t.onBefore,r=void 0===n?null:n,a=i.scale*yt.pixelRatio,s=i.rotation;if(s!==b(this,gu)[gu]&&(null===r||void 0===r||r(),b(this,gu)[gu]=s,gt(b(this,pu)[pu],{rotation:s})),a!==b(this,yu)[yu]){null===r||void 0===r||r(),b(this,yu)[yu]=a;var o,l={div:null,properties:null,ctx:b(e,Ru)[Ru](b(this,hu)[hu])},u=(0,v.Z)(b(this,ku)[ku]);try{for(u.s();!(o=u.n()).done;){var h=o.value;l.properties=b(this,Au)[Au].get(h),l.div=h,b(this,Tu)[Tu](l)}}catch(c){u.e(c)}finally{u.f()}}}},{key:"cancel",value:function(){var e,t=new Ie("TextLayer task cancelled.");null===(e=b(this,fu)[fu])||void 0===e||e.cancel(t).catch((function(){})),b(this,fu)[fu]=null,b(this,su)[su].reject(t)}},{key:"textDivs",get:function(){return b(this,ku)[ku]}},{key:"textContentItemsStr",get:function(){return b(this,bu)[bu]}}],[{key:"fontFamilyMap",get:function(){var e=je.platform,t=e.isWindows,i=e.isFirefox;return Ee(this,"fontFamilyMap",new Map([["sans-serif","".concat(t&&i?"Calibri, ":"","sans-serif")],["monospace","".concat(t&&i?"Lucida Console, ":"","monospace")]]))}},{key:"cleanup",value:function(){if(!(b(this,Cu)[Cu].size>0)){b(this,xu)[xu].clear();var e,t=(0,v.Z)(b(this,Pu)[Pu].values());try{for(t.s();!(e=t.n()).done;){e.value.canvas.remove()}}catch(i){t.e(i)}finally{t.f()}b(this,Pu)[Pu].clear()}}}]),e}();function ju(e){var t,i;if(!b(this,lu)[lu]){null!==(i=(t=b(this,cu)[cu]).ctx)&&void 0!==i||(t.ctx=b(Lu,Ru)[Ru](b(this,hu)[hu]));var n,r=b(this,ku)[ku],a=b(this,bu)[bu],s=(0,v.Z)(e);try{for(s.s();!(n=s.n()).done;){var o=n.value;if(r.length>1e5)return ke("Ignoring additional textDivs for performance reasons."),void(b(this,lu)[lu]=!0);if(void 0!==o.str)a.push(o.str),b(this,Mu)[Mu](o);else if("beginMarkedContentProps"===o.type||"beginMarkedContent"===o.type){var l=b(this,ou)[ou];b(this,ou)[ou]=document.createElement("span"),b(this,ou)[ou].classList.add("markedContent"),null!==o.id&&b(this,ou)[ou].setAttribute("id","".concat(o.id)),l.append(b(this,ou)[ou])}else"endMarkedContent"===o.type&&(b(this,ou)[ou]=b(this,ou)[ou].parentNode)}}catch(u){s.e(u)}finally{s.f()}}}function Fu(e){var t=document.createElement("span"),i={angle:0,canvasWidth:0,hasText:""!==e.str,hasEOL:e.hasEOL,fontSize:0};b(this,ku)[ku].push(t);var n=He.transform(b(this,_u)[_u],e.transform),r=Math.atan2(n[1],n[0]),a=b(this,mu)[mu][e.fontName];a.vertical&&(r+=Math.PI/2);var s=b(this,uu)[uu]&&a.fontSubstitution||a.fontFamily;s=Lu.fontFamilyMap.get(s)||s;var o,l,u=Math.hypot(n[2],n[3]),h=u*b(Lu,Du)[Du](s,a,b(this,hu)[hu]);0===r?(o=n[4],l=n[5]-h):(o=n[4]+h*Math.sin(r),l=n[5]-h*Math.cos(r));var c="calc(var(--total-scale-factor) *",d=t.style;b(this,ou)[ou]===b(this,pu)[pu]?(d.left="".concat((100*o/b(this,vu)[vu]).toFixed(2),"%"),d.top="".concat((100*l/b(this,du)[du]).toFixed(2),"%")):(d.left="".concat(c).concat(o.toFixed(2),"px)"),d.top="".concat(c).concat(l.toFixed(2),"px)")),d.fontSize="".concat(c).concat((b(Lu,Eu)[Eu]*u).toFixed(2),"px)"),d.fontFamily=s,i.fontSize=u,t.setAttribute("role","presentation"),t.textContent=e.str,t.dir=e.dir,b(this,uu)[uu]&&(t.dataset.fontName=a.fontSubstitutionLoadedName||e.fontName),0!==r&&(i.angle=r*(180/Math.PI));var v=!1;if(e.str.length>1)v=!0;else if(" "!==e.str&&e.transform[0]!==e.transform[3]){var f=Math.abs(e.transform[0]),p=Math.abs(e.transform[3]);f!==p&&Math.max(f,p)/Math.min(f,p)>1.5&&(v=!0)}if(v&&(i.canvasWidth=a.vertical?e.height:e.width),b(this,Au)[Au].set(t,i),b(this,cu)[cu].div=t,b(this,cu)[cu].properties=i,b(this,Tu)[Tu](b(this,cu)[cu]),i.hasText&&b(this,ou)[ou].append(t),i.hasEOL){var g=document.createElement("br");g.setAttribute("role","presentation"),b(this,ou)[ou].append(g)}}function Nu(e){var t=e.div,i=e.properties,n=e.ctx,r=t.style,a="";if(b(Lu,Eu)[Eu]>1&&(a="scale(".concat(1/b(Lu,Eu)[Eu],")")),0!==i.canvasWidth&&i.hasText){var s=r.fontFamily,o=i.canvasWidth,l=i.fontSize;b(Lu,Zu)[Zu](n,l*b(this,yu)[yu],s);var u=n.measureText(t.textContent).width;u>0&&(a="scaleX(".concat(o*b(this,yu)[yu]/u,") ").concat(a))}0!==i.angle&&(a="rotate(".concat(i.angle,"deg) ").concat(a)),a.length>0&&(r.transform=a)}Object.defineProperty(Lu,Du,{value:function(e,t,i){var n=b(this,xu)[xu].get(e);if(n)return n;var r=b(this,Ru)[Ru](i);r.canvas.width=r.canvas.height=30,b(this,Zu)[Zu](r,30,e);var a=r.measureText(""),s=a.fontBoundingBoxAscent,o=Math.abs(a.fontBoundingBoxDescent);r.canvas.width=r.canvas.height=0;var l=.8;return s?l=s/(s+o):(je.platform.isFirefox&&ke("Enable the `dom.textMetrics.fontBoundingBox.enabled` preference in `about:config` to improve TextLayer rendering."),t.ascent?l=t.ascent:t.descent&&(l=1+t.descent)),b(this,xu)[xu].set(e,l),l}}),Object.defineProperty(Lu,Iu,{value:function(){if(null===b(this,Eu)[Eu]){var e=document.createElement("div");e.style.opacity=0,e.style.lineHeight=1,e.style.fontSize="1px",e.style.position="absolute",e.textContent="X",document.body.append(e),b(this,Eu)[Eu]=e.getBoundingClientRect().height,e.remove()}}}),Object.defineProperty(Lu,Zu,{value:function(e,t,i){var n=b(this,Su)[Su].get(e);t===n.size&&i===n.family||(e.font="".concat(t,"px ").concat(i),n.size=t,n.family=i)}}),Object.defineProperty(Lu,Ru,{value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=b(this,Pu)[Pu].get(e||(e=""));if(!t){var i=document.createElement("canvas");i.className="hiddenCanvasElement",i.lang=e,document.body.append(i),t=i.getContext("2d",{alpha:!1,willReadFrequently:!0}),b(this,Pu)[Pu].set(e,t),b(this,Su)[Su].set(t,{size:0,family:""})}return t}}),Object.defineProperty(Lu,xu,{writable:!0,value:new Map}),Object.defineProperty(Lu,Pu,{writable:!0,value:new Map}),Object.defineProperty(Lu,Su,{writable:!0,value:new WeakMap}),Object.defineProperty(Lu,Eu,{writable:!0,value:null}),Object.defineProperty(Lu,Cu,{writable:!0,value:new Set});var Bu=function(){function e(){(0,_.Z)(this,e)}return(0,A.Z)(e,null,[{key:"textContent",value:function(t){var i=[],n={items:i,styles:Object.create(null)};return function t(n){var r;if(n){var a=null,s=n.name;if("#text"===s)a=n.value;else{if(!e.shouldBuildText(s))return;null!==n&&void 0!==n&&null!==(r=n.attributes)&&void 0!==r&&r.textContent?a=n.attributes.textContent:n.value&&(a=n.value)}if(null!==a&&i.push({str:a}),n.children){var o,l=(0,v.Z)(n.children);try{for(l.s();!(o=l.n()).done;){t(o.value)}}catch(u){l.e(u)}finally{l.f()}}}}(t),n}},{key:"shouldBuildText",value:function(e){return!("textarea"===e||"input"===e||"option"===e||"select"===e)}}]),e}();function Hu(){var e,t,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};"string"===typeof i||i instanceof URL?i={url:i}:(i instanceof ArrayBuffer||ArrayBuffer.isView(i))&&(i={data:i});var n=new Gu,r=n.docId,a=i.url?is(i.url):null,s=i.data?ns(i.data):null,o=i.httpHeaders||null,l=!0===i.withCredentials,u=null!==(e=i.password)&&void 0!==e?e:null,h=i.range instanceof Yu?i.range:null,c=Number.isInteger(i.rangeChunkSize)&&i.rangeChunkSize>0?i.rangeChunkSize:Math.pow(2,16),d=i.worker instanceof vh?i.worker:null,v=i.verbosity,f="string"!==typeof i.docBaseUrl||it(i.docBaseUrl)?null:i.docBaseUrl,p=rs(i.cMapUrl),g=!1!==i.cMapPacked,y=i.CMapReaderFactory||(D?So:js),m=rs(i.iccUrl),b=rs(i.standardFontDataUrl),w=i.StandardFontDataFactory||(D?Eo:bo),k=rs(i.wasmUrl),A=i.WasmFactory||(D?Co:ko),_=!0!==i.stopAtErrors,x=Number.isInteger(i.maxImageSize)&&i.maxImageSize>-1?i.maxImageSize:-1,P=!1!==i.isEvalSupported,S="boolean"===typeof i.isOffscreenCanvasSupported?i.isOffscreenCanvasSupported:!D,E="boolean"===typeof i.isImageDecoderSupported?i.isImageDecoderSupported:!D&&(je.platform.isFirefox||!globalThis.chrome),C=Number.isInteger(i.canvasMaxAreaInBytes)?i.canvasMaxAreaInBytes:-1,O="boolean"===typeof i.disableFontFace?i.disableFontFace:D,M=!0===i.fontExtraProperties,T=!0===i.enableXfa,R=i.ownerDocument||globalThis.document,Z=!0===i.disableRange,I=!0===i.disableStream,L=!0===i.disableAutoFetch,j=!0===i.pdfBug,F=i.CanvasFactory||(D?Po:Ds),N=i.FilterFactory||(D?xo:ro),B=!0===i.enableHWA,H=!1!==i.useWasm,z=h?h.length:null!==(t=i.length)&&void 0!==t?t:NaN,G="boolean"===typeof i.useSystemFonts?i.useSystemFonts:!D&&!O,U="boolean"===typeof i.useWorkerFetch?i.useWorkerFetch:!!(y===js&&w===bo&&A===ko&&p&&b&&k&&ot(p,document.baseURI)&&ot(b,document.baseURI)&&ot(k,document.baseURI)),V=null;me(v);var W={canvasFactory:new F({ownerDocument:R,enableHWA:B}),filterFactory:new N({docId:r,ownerDocument:R}),cMapReaderFactory:U?null:new y({baseUrl:p,isCompressed:g}),standardFontDataFactory:U?null:new w({baseUrl:b}),wasmFactory:U?null:new A({baseUrl:k})};d||(d=vh.create({verbosity:v,port:gl.workerPort}),n._worker=d);var q={docId:r,apiVersion:"5.3.93",data:s,password:u,disableAutoFetch:L,rangeChunkSize:c,length:z,docBaseUrl:f,enableXfa:T,evaluatorOptions:{maxImageSize:x,disableFontFace:O,ignoreErrors:_,isEvalSupported:P,isOffscreenCanvasSupported:S,isImageDecoderSupported:E,canvasMaxAreaInBytes:C,fontExtraProperties:M,useSystemFonts:G,useWasm:H,useWorkerFetch:U,cMapUrl:p,iccUrl:m,standardFontDataUrl:b,wasmUrl:k}},X={ownerDocument:R,pdfBug:j,styleElement:V,loadingParams:{disableAutoFetch:L,enableXfa:T}};return d.promise.then((function(){if(n.destroyed)throw new Error("Loading aborted");if(d.destroyed)throw new Error("Worker was destroyed");var e,t=d.messageHandler.sendWithPromise("GetDocRequest",q,s?[s.buffer]:null);if(h)e=new Zl(h,{disableRange:Z,disableStream:I});else if(!s){if(!a)throw new Error("getDocument - no `url` parameter provided.");var i=ot(a)?Ul:D?Jl:Xl;e=new i({url:a,length:z,httpHeaders:o,withCredentials:l,rangeChunkSize:c,disableRange:Z,disableStream:I})}return t.then((function(t){if(n.destroyed)throw new Error("Loading aborted");if(d.destroyed)throw new Error("Worker was destroyed");var i=new Es(r,t,d.port),a=new xh(i,n,e,X,W);n._transport=a,i.send("Ready",null)}))})).catch(n._capability.reject),n}var zu=k("docId"),Gu=function(){function e(){(0,_.Z)(this,e),this._capability=Promise.withResolvers(),this._transport=null,this._worker=null,this.docId="d".concat(b(e,zu)[zu]++),this.destroyed=!1,this.onPassword=null,this.onProgress=null}return(0,A.Z)(e,[{key:"promise",get:function(){return this._capability.promise}},{key:"destroy",value:function(){var e=(0,d.Z)((0,h.Z)().mark((function e(){var t,i,n,r;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.destroyed=!0,e.prev=1,null!==(i=this._worker)&&void 0!==i&&i.port&&(this._worker._pendingDestroy=!0),e.next=5,null===(n=this._transport)||void 0===n?void 0:n.destroy();case 5:e.next=11;break;case 7:throw e.prev=7,e.t0=e.catch(1),null!==(r=this._worker)&&void 0!==r&&r.port&&delete this._worker._pendingDestroy,e.t0;case 11:this._transport=null,null===(t=this._worker)||void 0===t||t.destroy(),this._worker=null;case 14:case"end":return e.stop()}}),e,this,[[1,7]])})));return function(){return e.apply(this,arguments)}}()},{key:"getData",value:function(){var e=(0,d.Z)((0,h.Z)().mark((function e(){return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._transport.getData());case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}();Object.defineProperty(Gu,zu,{writable:!0,value:0});var Uu=k("capability"),Vu=k("progressiveDoneListeners"),Wu=k("progressiveReadListeners"),qu=k("progressListeners"),Xu=k("rangeListeners"),Yu=function(){function e(t,i){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;(0,_.Z)(this,e),Object.defineProperty(this,Uu,{writable:!0,value:Promise.withResolvers()}),Object.defineProperty(this,Vu,{writable:!0,value:[]}),Object.defineProperty(this,Wu,{writable:!0,value:[]}),Object.defineProperty(this,qu,{writable:!0,value:[]}),Object.defineProperty(this,Xu,{writable:!0,value:[]}),this.length=t,this.initialData=i,this.progressiveDone=n,this.contentDispositionFilename=r}return(0,A.Z)(e,[{key:"addRangeListener",value:function(e){b(this,Xu)[Xu].push(e)}},{key:"addProgressListener",value:function(e){b(this,qu)[qu].push(e)}},{key:"addProgressiveReadListener",value:function(e){b(this,Wu)[Wu].push(e)}},{key:"addProgressiveDoneListener",value:function(e){b(this,Vu)[Vu].push(e)}},{key:"onDataRange",value:function(e,t){var i,n=(0,v.Z)(b(this,Xu)[Xu]);try{for(n.s();!(i=n.n()).done;){(0,i.value)(e,t)}}catch(r){n.e(r)}finally{n.f()}}},{key:"onDataProgress",value:function(e,t){var i=this;b(this,Uu)[Uu].promise.then((function(){var n,r=(0,v.Z)(b(i,qu)[qu]);try{for(r.s();!(n=r.n()).done;){(0,n.value)(e,t)}}catch(a){r.e(a)}finally{r.f()}}))}},{key:"onDataProgressiveRead",value:function(e){var t=this;b(this,Uu)[Uu].promise.then((function(){var i,n=(0,v.Z)(b(t,Wu)[Wu]);try{for(n.s();!(i=n.n()).done;){(0,i.value)(e)}}catch(r){n.e(r)}finally{n.f()}}))}},{key:"onDataProgressiveDone",value:function(){var e=this;b(this,Uu)[Uu].promise.then((function(){var t,i=(0,v.Z)(b(e,Vu)[Vu]);try{for(i.s();!(t=i.n()).done;){(0,t.value)()}}catch(n){i.e(n)}finally{i.f()}}))}},{key:"transportReady",value:function(){b(this,Uu)[Uu].resolve()}},{key:"requestDataRange",value:function(e,t){Ae("Abstract method PDFDataRangeTransport.requestDataRange")}},{key:"abort",value:function(){}}]),e}(),Ku=function(){function e(t,i){(0,_.Z)(this,e),this._pdfInfo=t,this._transport=i}return(0,A.Z)(e,[{key:"annotationStorage",get:function(){return this._transport.annotationStorage}},{key:"canvasFactory",get:function(){return this._transport.canvasFactory}},{key:"filterFactory",get:function(){return this._transport.filterFactory}},{key:"numPages",get:function(){return this._pdfInfo.numPages}},{key:"fingerprints",get:function(){return this._pdfInfo.fingerprints}},{key:"isPureXfa",get:function(){return Ee(this,"isPureXfa",!!this._transport._htmlForXfa)}},{key:"allXfaHtml",get:function(){return this._transport._htmlForXfa}},{key:"getPage",value:function(e){return this._transport.getPage(e)}},{key:"getPageIndex",value:function(e){return this._transport.getPageIndex(e)}},{key:"getDestinations",value:function(){return this._transport.getDestinations()}},{key:"getDestination",value:function(e){return this._transport.getDestination(e)}},{key:"getPageLabels",value:function(){return this._transport.getPageLabels()}},{key:"getPageLayout",value:function(){return this._transport.getPageLayout()}},{key:"getPageMode",value:function(){return this._transport.getPageMode()}},{key:"getViewerPreferences",value:function(){return this._transport.getViewerPreferences()}},{key:"getOpenAction",value:function(){return this._transport.getOpenAction()}},{key:"getAttachments",value:function(){return this._transport.getAttachments()}},{key:"getJSActions",value:function(){return this._transport.getDocJSActions()}},{key:"getOutline",value:function(){return this._transport.getOutline()}},{key:"getOptionalContentConfig",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.intent,i=void 0===t?"display":t,n=this._transport.getRenderingIntent(i),r=n.renderingIntent;return this._transport.getOptionalContentConfig(r)}},{key:"getPermissions",value:function(){return this._transport.getPermissions()}},{key:"getMetadata",value:function(){return this._transport.getMetadata()}},{key:"getMarkInfo",value:function(){return this._transport.getMarkInfo()}},{key:"getData",value:function(){return this._transport.getData()}},{key:"saveDocument",value:function(){return this._transport.saveDocument()}},{key:"getDownloadInfo",value:function(){return this._transport.downloadInfoCapability.promise}},{key:"cleanup",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this._transport.startCleanup(e||this.isPureXfa)}},{key:"destroy",value:function(){return this.loadingTask.destroy()}},{key:"cachedPageNumber",value:function(e){return this._transport.cachedPageNumber(e)}},{key:"loadingParams",get:function(){return this._transport.loadingParams}},{key:"loadingTask",get:function(){return this._transport.loadingTask}},{key:"getFieldObjects",value:function(){return this._transport.getFieldObjects()}},{key:"hasJSActions",value:function(){return this._transport.hasJSActions()}},{key:"getCalculationOrderIds",value:function(){return this._transport.getCalculationOrderIds()}}]),e}(),Qu=k("pendingCleanup"),Ju=k("tryCleanup"),$u=function(){function e(t,i,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];(0,_.Z)(this,e),Object.defineProperty(this,Ju,{value:eh}),Object.defineProperty(this,Qu,{writable:!0,value:!1}),this._pageIndex=t,this._pageInfo=i,this._transport=n,this._stats=r?new st:null,this._pdfBug=r,this.commonObjs=n.commonObjs,this.objs=new ru,this._intentStates=new Map,this.destroyed=!1}return(0,A.Z)(e,[{key:"pageNumber",get:function(){return this._pageIndex+1}},{key:"rotate",get:function(){return this._pageInfo.rotate}},{key:"ref",get:function(){return this._pageInfo.ref}},{key:"userUnit",get:function(){return this._pageInfo.userUnit}},{key:"view",get:function(){return this._pageInfo.view}},{key:"getViewport",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.scale,i=e.rotation,n=void 0===i?this.rotate:i,r=e.offsetX,a=void 0===r?0:r,s=e.offsetY,o=void 0===s?0:s,l=e.dontFlip,u=void 0!==l&&l;return new et({viewBox:this.view,userUnit:this.userUnit,scale:t,rotation:n,offsetX:a,offsetY:o,dontFlip:u})}},{key:"getAnnotations",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.intent,i=void 0===t?"display":t,n=this._transport.getRenderingIntent(i),r=n.renderingIntent;return this._transport.getAnnotations(this._pageIndex,r)}},{key:"getJSActions",value:function(){return this._transport.getPageJSActions(this._pageIndex)}},{key:"filterFactory",get:function(){return this._transport.filterFactory}},{key:"isPureXfa",get:function(){return Ee(this,"isPureXfa",!!this._transport._htmlForXfa)}},{key:"getXfa",value:function(){var e=(0,d.Z)((0,h.Z)().mark((function e(){var t;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(null===(t=this._transport._htmlForXfa)||void 0===t?void 0:t.children[this._pageIndex])||null);case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(e){var t,i,n=this,r=e.canvasContext,a=e.viewport,s=e.intent,o=void 0===s?"display":s,l=e.annotationMode,u=void 0===l?W.ENABLE:l,h=e.transform,d=void 0===h?null:h,v=e.background,f=void 0===v?null:v,p=e.optionalContentConfigPromise,g=void 0===p?null:p,y=e.annotationCanvasMap,m=void 0===y?null:y,w=e.pageColors,k=void 0===w?null:w,A=e.printAnnotationStorage,_=void 0===A?null:A,x=e.isEditing,P=void 0!==x&&x;null===(t=this._stats)||void 0===t||t.time("Overall");var S=this._transport.getRenderingIntent(o,u,_,P),E=S.renderingIntent,C=S.cacheKey;b(this,Qu)[Qu]=!1,g||(g=this._transport.getOptionalContentConfig(E));var O=this._intentStates.get(C);O||(O=Object.create(null),this._intentStates.set(C,O)),O.streamReaderCancelTimeout&&(clearTimeout(O.streamReaderCancelTimeout),O.streamReaderCancelTimeout=null);var M,T=!!(E&B);O.displayReadyCapability||(O.displayReadyCapability=Promise.withResolvers(),O.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},null===(M=this._stats)||void 0===M||M.time("Page Request"),this._pumpOperatorList(S));var R=function(e){var t;(O.renderTasks.delete(Z),T&&(b(n,Qu)[Qu]=!0),b(n,Ju)[Ju](),e?(Z.capability.reject(e),n._abortOperatorList({intentState:O,reason:e instanceof Error?e:new Error(e)})):Z.capability.resolve(),n._stats)&&(n._stats.timeEnd("Rendering"),n._stats.timeEnd("Overall"),null!==(t=globalThis.Stats)&&void 0!==t&&t.enabled&&globalThis.Stats.add(n.pageNumber,n._stats))},Z=new Mh({callback:R,params:{canvasContext:r,viewport:a,transform:d,background:f},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:m,operatorList:O.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!T,pdfBug:this._pdfBug,pageColors:k});((i=O).renderTasks||(i.renderTasks=new Set)).add(Z);var I=Z.task;return Promise.all([O.displayReadyCapability.promise,g]).then((function(e){var t,i=(0,c.Z)(e,2),r=i[0],a=i[1];if(n.destroyed)R();else{if(null===(t=n._stats)||void 0===t||t.time("Rendering"),!(a.renderingIntent&E))throw new Error("Must use the same `intent`-argument when calling the `PDFPageProxy.render` and `PDFDocumentProxy.getOptionalContentConfig` methods.");Z.initializeGraphics({transparency:r,optionalContentConfig:a}),Z.operatorListChanged()}})).catch(R),I}},{key:"getOperatorList",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.intent,i=void 0===t?"display":t,n=e.annotationMode,r=void 0===n?W.ENABLE:n,a=e.printAnnotationStorage,s=void 0===a?null:a,o=e.isEditing,l=void 0!==o&&o;function u(){f.operatorList.lastChunk&&(f.opListReadCapability.resolve(f.operatorList),f.renderTasks.delete(h))}var h,c,d,v=this._transport.getRenderingIntent(i,r,s,l,!0),f=this._intentStates.get(v.cacheKey);(f||(f=Object.create(null),this._intentStates.set(v.cacheKey,f)),f.opListReadCapability)||((h=Object.create(null)).operatorListChanged=u,f.opListReadCapability=Promise.withResolvers(),((c=f).renderTasks||(c.renderTasks=new Set)).add(h),f.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},null===(d=this._stats)||void 0===d||d.time("Page Request"),this._pumpOperatorList(v));return f.opListReadCapability.promise}},{key:"streamTextContent",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.includeMarkedContent,i=void 0!==t&&t,n=e.disableNormalization,r=void 0!==n&&n,a=100;return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:!0===i,disableNormalization:!0===r},{highWaterMark:a,size:function(e){return e.items.length}})}},{key:"getTextContent",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this._transport._htmlForXfa)return this.getXfa().then((function(e){return Bu.textContent(e)}));var t=this.streamTextContent(e);return new Promise((function(e,i){var n=t.getReader(),r={items:[],styles:Object.create(null),lang:null};!function t(){n.read().then((function(i){var n,a,s=i.value;i.done?e(r):(null!==(n=r.lang)&&void 0!==n||(r.lang=s.lang),Object.assign(r.styles,s.styles),(a=r.items).push.apply(a,(0,u.Z)(s.items)),t())}),i)}()}))}},{key:"getStructTree",value:function(){return this._transport.getStructTree(this._pageIndex)}},{key:"_destroy",value:function(){this.destroyed=!0;var e,t=[],i=(0,v.Z)(this._intentStates.values());try{for(i.s();!(e=i.n()).done;){var n=e.value;if(this._abortOperatorList({intentState:n,reason:new Error("Page was destroyed."),force:!0}),!n.opListReadCapability){var r,a=(0,v.Z)(n.renderTasks);try{for(a.s();!(r=a.n()).done;){var s=r.value;t.push(s.completed),s.cancel()}}catch(o){a.e(o)}finally{a.f()}}}}catch(o){i.e(o)}finally{i.f()}return this.objs.clear(),b(this,Qu)[Qu]=!1,Promise.all(t)}},{key:"cleanup",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];b(this,Qu)[Qu]=!0;var t=b(this,Ju)[Ju]();return e&&t&&this._stats&&(this._stats=new st),t}},{key:"_startRenderPage",value:function(e,t){var i,n,r=this._intentStates.get(t);r&&(null===(i=this._stats)||void 0===i||i.timeEnd("Page Request"),null===(n=r.displayReadyCapability)||void 0===n||n.resolve(e))}},{key:"_renderPageChunk",value:function(e,t){for(var i=0,n=e.length;i<n;i++)t.operatorList.fnArray.push(e.fnArray[i]),t.operatorList.argsArray.push(e.argsArray[i]);t.operatorList.lastChunk=e.lastChunk,t.operatorList.separateAnnots=e.separateAnnots;var r,a=(0,v.Z)(t.renderTasks);try{for(a.s();!(r=a.n()).done;){r.value.operatorListChanged()}}catch(s){a.e(s)}finally{a.f()}e.lastChunk&&b(this,Ju)[Ju]()}},{key:"_pumpOperatorList",value:function(e){var t=this,i=e.renderingIntent,n=e.cacheKey,r=e.annotationStorageSerializable,a=e.modifiedIds,s=r.map,o=r.transfer,l=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:i,cacheKey:n,annotationStorage:s,modifiedIds:a},o).getReader(),u=this._intentStates.get(n);u.streamReader=l;!function e(){l.read().then((function(i){var n=i.value;i.done?u.streamReader=null:t._transport.destroyed||(t._renderPageChunk(n,u),e())}),(function(e){if(u.streamReader=null,!t._transport.destroyed){if(u.operatorList){u.operatorList.lastChunk=!0;var i,n=(0,v.Z)(u.renderTasks);try{for(n.s();!(i=n.n()).done;){i.value.operatorListChanged()}}catch(r){n.e(r)}finally{n.f()}b(t,Ju)[Ju]()}if(u.displayReadyCapability)u.displayReadyCapability.reject(e);else{if(!u.opListReadCapability)throw e;u.opListReadCapability.reject(e)}}}))}()}},{key:"_abortOperatorList",value:function(e){var t=this,i=e.intentState,n=e.reason,r=e.force,a=void 0!==r&&r;if(i.streamReader){if(i.streamReaderCancelTimeout&&(clearTimeout(i.streamReaderCancelTimeout),i.streamReaderCancelTimeout=null),!a){if(i.renderTasks.size>0)return;if(n instanceof tt){var s=100;return n.extraDelay>0&&n.extraDelay<1e3&&(s+=n.extraDelay),void(i.streamReaderCancelTimeout=setTimeout((function(){i.streamReaderCancelTimeout=null,t._abortOperatorList({intentState:i,reason:n,force:!0})}),s))}}if(i.streamReader.cancel(new Ie(n.message)).catch((function(){})),i.streamReader=null,!this._transport.destroyed){var o,l=(0,v.Z)(this._intentStates);try{for(l.s();!(o=l.n()).done;){var u=(0,c.Z)(o.value,2),h=u[0];if(u[1]===i){this._intentStates.delete(h);break}}}catch(d){l.e(d)}finally{l.f()}this.cleanup()}}}},{key:"stats",get:function(){return this._stats}}]),e}();function eh(){if(!b(this,Qu)[Qu]||this.destroyed)return!1;var e,t=(0,v.Z)(this._intentStates.values());try{for(t.s();!(e=t.n()).done;){var i=e.value,n=i.renderTasks,r=i.operatorList;if(n.size>0||!r.lastChunk)return!1}}catch(a){t.e(a)}finally{t.f()}return this._intentStates.clear(),this.objs.clear(),b(this,Qu)[Qu]=!1,!0}var th=k("capability"),ih=k("messageHandler"),nh=k("port"),rh=k("webWorker"),ah=k("fakeWorkerId"),sh=k("isWorkerDisabled"),oh=k("workerPorts"),lh=k("resolve"),uh=k("initializeFromPort"),hh=k("initialize"),ch=k("setupFakeWorker"),dh=k("mainThreadWorkerMessageHandler"),vh=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=t.name,n=void 0===i?null:i,r=t.port,a=void 0===r?null:r,s=t.verbosity,o=void 0===s?be():s;if((0,_.Z)(this,e),Object.defineProperty(this,ch,{value:yh}),Object.defineProperty(this,hh,{value:gh}),Object.defineProperty(this,uh,{value:ph}),Object.defineProperty(this,lh,{value:fh}),Object.defineProperty(this,th,{writable:!0,value:Promise.withResolvers()}),Object.defineProperty(this,ih,{writable:!0,value:null}),Object.defineProperty(this,nh,{writable:!0,value:null}),Object.defineProperty(this,rh,{writable:!0,value:null}),this.name=n,this.destroyed=!1,this.verbosity=o,a){if(b(e,oh)[oh].has(a))throw new Error("Cannot use more than one PDFWorker per port.");b(e,oh)[oh].set(a,this),b(this,uh)[uh](a)}else b(this,hh)[hh]()}return(0,A.Z)(e,[{key:"promise",get:function(){return b(this,th)[th].promise}},{key:"port",get:function(){return b(this,nh)[nh]}},{key:"messageHandler",get:function(){return b(this,ih)[ih]}},{key:"destroy",value:function(){var t,i;this.destroyed=!0,null===(t=b(this,rh)[rh])||void 0===t||t.terminate(),b(this,rh)[rh]=null,b(e,oh)[oh].delete(b(this,nh)[nh]),b(this,nh)[nh]=null,null===(i=b(this,ih)[ih])||void 0===i||i.destroy(),b(this,ih)[ih]=null}}],[{key:"create",value:function(t){var i=b(this,oh)[oh].get(null===t||void 0===t?void 0:t.port);if(i){if(i._pendingDestroy)throw new Error("PDFWorker.create - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return i}return new e(t)}},{key:"workerSrc",get:function(){if(gl.workerSrc)return gl.workerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}},{key:"_setupFakeWorkerGlobal",get:function(){var e=this,t=function(){var t=(0,d.Z)((0,h.Z)().mark((function t(){var i;return(0,h.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!b(e,dh)[dh]){t.next=2;break}return t.abrupt("return",b(e,dh)[dh]);case 2:return t.next=4,import(e.workerSrc);case 4:return i=t.sent,t.abrupt("return",i.WorkerMessageHandler);case 6:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();return Ee(this,"_setupFakeWorkerGlobal",t())}}]),e}();function fh(){b(this,th)[th].resolve(),b(this,ih)[ih].send("configure",{verbosity:this.verbosity})}function ph(e){b(this,nh)[nh]=e,b(this,ih)[ih]=new Es("main","worker",e),b(this,ih)[ih].on("ready",(function(){})),b(this,lh)[lh]()}function gh(){var e=this;if(b(vh,sh)[sh]||b(vh,dh)[dh])b(this,ch)[ch]();else{var t=vh.workerSrc;try{vh._isSameOrigin(window.location,t)||(t=vh._createCDNWrapper(new URL(t,window.location).href));var i=new Worker(t,{type:"module"}),n=new Es("main","worker",i),r=function(){a.abort(),n.destroy(),i.terminate(),e.destroyed?b(e,th)[th].reject(new Error("Worker was destroyed")):b(e,ch)[ch]()},a=new AbortController;i.addEventListener("error",(function(){b(e,rh)[rh]||r()}),{signal:a.signal}),n.on("test",(function(t){a.abort(),!e.destroyed&&t?(b(e,ih)[ih]=n,b(e,nh)[nh]=i,b(e,rh)[rh]=i,b(e,lh)[lh]()):r()})),n.on("ready",(function(t){if(a.abort(),e.destroyed)r();else try{s()}catch(i){b(e,ch)[ch]()}}));var s=function(){var e=new Uint8Array;n.send("test",e,[e.buffer])};return void s()}catch(o){we("The worker has been disabled.")}b(this,ch)[ch]()}}function yh(){var e=this;b(vh,sh)[sh]||(ke("Setting up fake worker."),b(vh,sh)[sh]=!0),vh._setupFakeWorkerGlobal.then((function(t){if(e.destroyed)b(e,th)[th].reject(new Error("Worker was destroyed"));else{var i=new us;b(e,nh)[nh]=i;var n="fake".concat(b(vh,ah)[ah]++),r=new Es(n+"_worker",n,i);t.setup(r,i),b(e,ih)[ih]=new Es(n,n+"_worker",i),b(e,lh)[lh]()}})).catch((function(t){b(e,th)[th].reject(new Error('Setting up fake worker failed: "'.concat(t.message,'".')))}))}Object.defineProperty(vh,dh,{get:function(){try{var e;return(null===(e=globalThis.pdfjsWorker)||void 0===e?void 0:e.WorkerMessageHandler)||null}catch(t){return null}},set:void 0}),Object.defineProperty(vh,ah,{writable:!0,value:0}),Object.defineProperty(vh,sh,{writable:!0,value:!1}),Object.defineProperty(vh,oh,{writable:!0,value:new WeakMap}),D&&(b(vh,sh)[sh]=!0,gl.workerSrc||(gl.workerSrc="./pdf.worker.mjs")),vh._isSameOrigin=function(e,t){var i=URL.parse(e);if(null===i||void 0===i||!i.origin||"null"===i.origin)return!1;var n=new URL(t,i);return i.origin===n.origin},vh._createCDNWrapper=function(e){var t='await import("'.concat(e,'");');return URL.createObjectURL(new Blob([t],{type:"text/javascript"}))},vh.fromPort=function(e){var t;if(t="`PDFWorker.fromPort` - please use `PDFWorker.create` instead.",console.log("Deprecated API usage: "+t),null===e||void 0===e||!e.port)throw new Error("PDFWorker.fromPort - invalid method signature.");return vh.create(e)};var mh=k("methodPromises"),bh=k("pageCache"),wh=k("pagePromises"),kh=k("pageRefCache"),Ah=k("passwordCapability"),_h=k("cacheSimpleMethod"),xh=function(){function e(t,i,n,r,a){(0,_.Z)(this,e),Object.defineProperty(this,_h,{value:Ph}),Object.defineProperty(this,mh,{writable:!0,value:new Map}),Object.defineProperty(this,bh,{writable:!0,value:new Map}),Object.defineProperty(this,wh,{writable:!0,value:new Map}),Object.defineProperty(this,kh,{writable:!0,value:new Map}),Object.defineProperty(this,Ah,{writable:!0,value:null}),this.messageHandler=t,this.loadingTask=i,this.commonObjs=new ru,this.fontLoader=new es({ownerDocument:r.ownerDocument,styleElement:r.styleElement}),this.loadingParams=r.loadingParams,this._params=r,this.canvasFactory=a.canvasFactory,this.filterFactory=a.filterFactory,this.cMapReaderFactory=a.cMapReaderFactory,this.standardFontDataFactory=a.standardFontDataFactory,this.wasmFactory=a.wasmFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=n,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=Promise.withResolvers(),this.setupMessageHandler()}return(0,A.Z)(e,[{key:"annotationStorage",get:function(){return Ee(this,"annotationStorage",new Ya)}},{key:"getRenderingIntent",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:W.ENABLE,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=N,s=Ua;switch(e){case"any":a=F;break;case"display":break;case"print":a=B;break;default:ke("getRenderingIntent - invalid intent: ".concat(e))}var o=a&B&&i instanceof Ja?i:this.annotationStorage;switch(t){case W.DISABLE:a+=G;break;case W.ENABLE:break;case W.ENABLE_FORMS:a+=H;break;case W.ENABLE_STORAGE:a+=z,s=o.serializable;break;default:ke("getRenderingIntent - invalid annotationMode: ".concat(t))}n&&(a+=U),r&&(a+=V);var l=o.modifiedIds,u=l.ids,h=l.hash,c=[a,s.hash,h];return{renderingIntent:a,cacheKey:c.join("_"),annotationStorageSerializable:s,modifiedIds:u}}},{key:"destroy",value:function(){var e,t=this;if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=Promise.withResolvers(),null===(e=b(this,Ah)[Ah])||void 0===e||e.reject(new Error("Worker was destroyed during onPassword callback"));var i,n=[],r=(0,v.Z)(b(this,bh)[bh].values());try{for(r.s();!(i=r.n()).done;){var a=i.value;n.push(a._destroy())}}catch(o){r.e(o)}finally{r.f()}b(this,bh)[bh].clear(),b(this,wh)[wh].clear(),b(this,kh)[kh].clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();var s=this.messageHandler.sendWithPromise("Terminate",null);return n.push(s),Promise.all(n).then((function(){var e,i;t.commonObjs.clear(),t.fontLoader.clear(),b(t,mh)[mh].clear(),t.filterFactory.destroy(),Lu.cleanup(),null===(e=t._networkStream)||void 0===e||e.cancelAllRequests(new Ie("Worker was terminated.")),null===(i=t.messageHandler)||void 0===i||i.destroy(),t.messageHandler=null,t.destroyCapability.resolve()}),this.destroyCapability.reject),this.destroyCapability.promise}},{key:"setupMessageHandler",value:function(){var e=this,t=this.messageHandler,i=this.loadingTask;t.on("GetReader",(function(t,i){_e(e._networkStream,"GetReader - no `IPDFStream` instance available."),e._fullReader=e._networkStream.getFullReader(),e._fullReader.onProgress=function(t){e._lastProgress={loaded:t.loaded,total:t.total}},i.onPull=function(){e._fullReader.read().then((function(e){var t=e.value;e.done?i.close():(_e(t instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),i.enqueue(new Uint8Array(t),1,[t]))})).catch((function(e){i.error(e)}))},i.onCancel=function(t){e._fullReader.cancel(t),i.ready.catch((function(t){if(!e.destroyed)throw t}))}})),t.on("ReaderHeadersReady",function(){var t=(0,d.Z)((0,h.Z)().mark((function t(n){var r,a,s,o,l;return(0,h.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e._fullReader.headersReady;case 2:return r=e._fullReader,a=r.isStreamingSupported,s=r.isRangeSupported,o=r.contentLength,a&&s||(e._lastProgress&&(null===(l=i.onProgress)||void 0===l||l.call(i,e._lastProgress)),e._fullReader.onProgress=function(e){var t;null===(t=i.onProgress)||void 0===t||t.call(i,{loaded:e.loaded,total:e.total})}),t.abrupt("return",{isStreamingSupported:a,isRangeSupported:s,contentLength:o});case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),t.on("GetRangeReader",(function(t,i){_e(e._networkStream,"GetRangeReader - no `IPDFStream` instance available.");var n=e._networkStream.getRangeReader(t.begin,t.end);n?(i.onPull=function(){n.read().then((function(e){var t=e.value;e.done?i.close():(_e(t instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),i.enqueue(new Uint8Array(t),1,[t]))})).catch((function(e){i.error(e)}))},i.onCancel=function(t){n.cancel(t),i.ready.catch((function(t){if(!e.destroyed)throw t}))}):i.close()})),t.on("GetDoc",(function(t){var n=t.pdfInfo;e._numPages=n.numPages,e._htmlForXfa=n.htmlForXfa,delete n.htmlForXfa,i._capability.resolve(new Ku(n,e))})),t.on("DocException",(function(e){i._capability.reject(ks(e))})),t.on("PasswordRequest",(function(t){b(e,Ah)[Ah]=Promise.withResolvers();try{if(!i.onPassword)throw ks(t);i.onPassword((function(t){t instanceof Error?b(e,Ah)[Ah].reject(t):b(e,Ah)[Ah].resolve({password:t})}),t.code)}catch(n){b(e,Ah)[Ah].reject(n)}return b(e,Ah)[Ah].promise})),t.on("DataLoaded",(function(t){var n;null===(n=i.onProgress)||void 0===n||n.call(i,{loaded:t.length,total:t.length}),e.downloadInfoCapability.resolve(t)})),t.on("StartRenderPage",(function(t){e.destroyed||b(e,bh)[bh].get(t.pageIndex)._startRenderPage(t.transparency,t.cacheKey)})),t.on("commonobj",(function(i){var n,r=(0,c.Z)(i,3),a=r[0],s=r[1],o=r[2];if(e.destroyed)return null;if(e.commonObjs.has(a))return null;switch(s){case"Font":if("error"in o){var l=o.error;ke("Error during font loading: ".concat(l)),e.commonObjs.resolve(a,l);break}var u=e._params.pdfBug&&null!==(n=globalThis.FontInspector)&&void 0!==n&&n.enabled?function(e,t){return globalThis.FontInspector.fontAdded(e,t)}:null,h=new ts(o,u);e.fontLoader.bind(h).catch((function(){return t.sendWithPromise("FontFallback",{id:a})})).finally((function(){!h.fontExtraProperties&&h.data&&(h.data=null),e.commonObjs.resolve(a,h)}));break;case"CopyLocalImage":var d=o.imageRef;_e(d,"The imageRef must be defined.");var f,p=(0,v.Z)(b(e,bh)[bh].values());try{for(p.s();!(f=p.n()).done;){var g,y=f.value,m=(0,v.Z)(y.objs);try{for(m.s();!(g=m.n()).done;){var w=(0,c.Z)(g.value,2)[1];if((null===w||void 0===w?void 0:w.ref)===d)return w.dataLen?(e.commonObjs.resolve(a,structuredClone(w)),w.dataLen):null}}catch(k){m.e(k)}finally{m.f()}}}catch(k){p.e(k)}finally{p.f()}break;case"FontPath":case"Image":case"Pattern":e.commonObjs.resolve(a,o);break;default:throw new Error("Got unknown common object type ".concat(s))}return null})),t.on("obj",(function(t){var i=(0,c.Z)(t,4),n=i[0],r=i[1],a=i[2],s=i[3];if(!e.destroyed){var o,l=b(e,bh)[bh].get(r);if(!l.objs.has(n))if(0!==l._intentStates.size)switch(a){case"Image":case"Pattern":l.objs.resolve(n,s);break;default:throw new Error("Got unknown object type ".concat(a))}else null===s||void 0===s||null===(o=s.bitmap)||void 0===o||o.close()}})),t.on("DocProgress",(function(t){var n;e.destroyed||null===(n=i.onProgress)||void 0===n||n.call(i,{loaded:t.loaded,total:t.total})})),t.on("FetchBinaryData",function(){var t=(0,d.Z)((0,h.Z)().mark((function t(i){var n;return(0,h.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.destroyed){t.next=2;break}throw new Error("Worker was destroyed.");case 2:if(n=e[i.type]){t.next=5;break}throw new Error("".concat(i.type," not initialized, see the `useWorkerFetch` parameter."));case 5:return t.abrupt("return",n.fetch(i));case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}},{key:"getData",value:function(){return this.messageHandler.sendWithPromise("GetData",null)}},{key:"saveDocument",value:function(){var e,t,i=this;this.annotationStorage.size<=0&&ke("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");var n=this.annotationStorage.serializable,r=n.map,a=n.transfer;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:r,filename:null!==(e=null===(t=this._fullReader)||void 0===t?void 0:t.filename)&&void 0!==e?e:null},a).finally((function(){i.annotationStorage.resetModified()}))}},{key:"getPage",value:function(e){var t=this;if(!Number.isInteger(e)||e<=0||e>this._numPages)return Promise.reject(new Error("Invalid page request."));var i=e-1,n=b(this,wh)[wh].get(i);if(n)return n;var r=this.messageHandler.sendWithPromise("GetPage",{pageIndex:i}).then((function(n){if(t.destroyed)throw new Error("Transport destroyed");n.refStr&&b(t,kh)[kh].set(n.refStr,e);var r=new $u(i,n,t,t._params.pdfBug);return b(t,bh)[bh].set(i,r),r}));return b(this,wh)[wh].set(i,r),r}},{key:"getPageIndex",value:function(e){return as(e)?this.messageHandler.sendWithPromise("GetPageIndex",{num:e.num,gen:e.gen}):Promise.reject(new Error("Invalid pageIndex request."))}},{key:"getAnnotations",value:function(e,t){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:e,intent:t})}},{key:"getFieldObjects",value:function(){return b(this,_h)[_h]("GetFieldObjects")}},{key:"hasJSActions",value:function(){return b(this,_h)[_h]("HasJSActions")}},{key:"getCalculationOrderIds",value:function(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}},{key:"getDestinations",value:function(){return this.messageHandler.sendWithPromise("GetDestinations",null)}},{key:"getDestination",value:function(e){return"string"!==typeof e?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:e})}},{key:"getPageLabels",value:function(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}},{key:"getPageLayout",value:function(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}},{key:"getPageMode",value:function(){return this.messageHandler.sendWithPromise("GetPageMode",null)}},{key:"getViewerPreferences",value:function(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}},{key:"getOpenAction",value:function(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}},{key:"getAttachments",value:function(){return this.messageHandler.sendWithPromise("GetAttachments",null)}},{key:"getDocJSActions",value:function(){return b(this,_h)[_h]("GetDocJSActions")}},{key:"getPageJSActions",value:function(e){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:e})}},{key:"getStructTree",value:function(e){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:e})}},{key:"getOutline",value:function(){return this.messageHandler.sendWithPromise("GetOutline",null)}},{key:"getOptionalContentConfig",value:function(e){return b(this,_h)[_h]("GetOptionalContentConfig").then((function(t){return new Tl(t,e)}))}},{key:"getPermissions",value:function(){return this.messageHandler.sendWithPromise("GetPermissions",null)}},{key:"getMetadata",value:function(){var e=this,t="GetMetadata",i=b(this,mh)[mh].get(t);if(i)return i;var n=this.messageHandler.sendWithPromise(t,null).then((function(t){var i,n,r,a;return{info:t[0],metadata:t[1]?new bl(t[1]):null,contentDispositionFilename:null!==(i=null===(n=e._fullReader)||void 0===n?void 0:n.filename)&&void 0!==i?i:null,contentLength:null!==(r=null===(a=e._fullReader)||void 0===a?void 0:a.contentLength)&&void 0!==r?r:null}}));return b(this,mh)[mh].set(t,n),n}},{key:"getMarkInfo",value:function(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}},{key:"startCleanup",value:function(){var e=(0,d.Z)((0,h.Z)().mark((function e(){var t,i,n,r,a=arguments;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=a.length>0&&void 0!==a[0]&&a[0],!this.destroyed){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,this.messageHandler.sendWithPromise("Cleanup",null);case 5:i=(0,v.Z)(b(this,bh)[bh].values()),e.prev=6,i.s();case 8:if((n=i.n()).done){e.next=15;break}if(r=n.value,r.cleanup()){e.next=13;break}throw new Error("startCleanup: Page ".concat(r.pageNumber," is currently rendering."));case 13:e.next=8;break;case 15:e.next=20;break;case 17:e.prev=17,e.t0=e.catch(6),i.e(e.t0);case 20:return e.prev=20,i.f(),e.finish(20);case 23:this.commonObjs.clear(),t||this.fontLoader.clear(),b(this,mh)[mh].clear(),this.filterFactory.destroy(!0),Lu.cleanup();case 28:case"end":return e.stop()}}),e,this,[[6,17,20,23]])})));return function(){return e.apply(this,arguments)}}()},{key:"cachedPageNumber",value:function(e){var t;if(!as(e))return null;var i=0===e.gen?"".concat(e.num,"R"):"".concat(e.num,"R").concat(e.gen);return null!==(t=b(this,kh)[kh].get(i))&&void 0!==t?t:null}}]),e}();function Ph(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=b(this,mh)[mh].get(e);if(i)return i;var n=this.messageHandler.sendWithPromise(e,t);return b(this,mh)[mh].set(e,n),n}var Sh=k("internalRenderTask"),Eh=function(){function e(t){(0,_.Z)(this,e),Object.defineProperty(this,Sh,{writable:!0,value:null}),this.onContinue=null,this.onError=null,b(this,Sh)[Sh]=t}return(0,A.Z)(e,[{key:"promise",get:function(){return b(this,Sh)[Sh].capability.promise}},{key:"cancel",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;b(this,Sh)[Sh].cancel(null,e)}},{key:"separateAnnots",get:function(){var e=b(this,Sh)[Sh].operatorList.separateAnnots;if(!e)return!1;var t=b(this,Sh)[Sh].annotationCanvasMap;return e.form||e.canvas&&(null===t||void 0===t?void 0:t.size)>0}}]),e}(),Ch=k("rAF"),Oh=k("canvasInUse"),Mh=function(){function e(t){var i=t.callback,n=t.params,r=t.objs,a=t.commonObjs,s=t.annotationCanvasMap,o=t.operatorList,l=t.pageIndex,u=t.canvasFactory,h=t.filterFactory,c=t.useRequestAnimationFrame,d=void 0!==c&&c,v=t.pdfBug,f=void 0!==v&&v,p=t.pageColors,g=void 0===p?null:p;(0,_.Z)(this,e),Object.defineProperty(this,Ch,{writable:!0,value:null}),this.callback=i,this.params=n,this.objs=r,this.commonObjs=a,this.annotationCanvasMap=s,this.operatorListIdx=null,this.operatorList=o,this._pageIndex=l,this.canvasFactory=u,this.filterFactory=h,this._pdfBug=f,this.pageColors=g,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=!0===d&&"undefined"!==typeof window,this.cancelled=!1,this.capability=Promise.withResolvers(),this.task=new Eh(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=n.canvasContext.canvas}return(0,A.Z)(e,[{key:"completed",get:function(){return this.capability.promise.catch((function(){}))}},{key:"initializeGraphics",value:function(t){var i,n,r=t.transparency,a=void 0!==r&&r,s=t.optionalContentConfig;if(!this.cancelled){if(this._canvas){if(b(e,Oh)[Oh].has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");b(e,Oh)[Oh].add(this._canvas)}this._pdfBug&&null!==(i=globalThis.StepperManager)&&void 0!==i&&i.enabled&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());var o=this.params,l=o.canvasContext,u=o.viewport,h=o.transform,c=o.background;this.gfx=new ul(l,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:s},this.annotationCanvasMap,this.pageColors),this.gfx.beginDrawing({transform:h,viewport:u,transparency:a,background:c}),this.operatorListIdx=0,this.graphicsReady=!0,null===(n=this.graphicsReadyCallback)||void 0===n||n.call(this)}}},{key:"cancel",value:function(){var t,i,n,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.running=!1,this.cancelled=!0,null===(t=this.gfx)||void 0===t||t.endDrawing(),b(this,Ch)[Ch]&&(window.cancelAnimationFrame(b(this,Ch)[Ch]),b(this,Ch)[Ch]=null),b(e,Oh)[Oh].delete(this._canvas),r||(r=new tt("Rendering cancelled, page ".concat(this._pageIndex+1),a)),this.callback(r),null===(i=(n=this.task).onError)||void 0===i||i.call(n,r)}},{key:"operatorListChanged",value:function(){var e;this.graphicsReady?(null===(e=this.stepper)||void 0===e||e.updateOperatorList(this.operatorList),this.running||this._continue()):this.graphicsReadyCallback||(this.graphicsReadyCallback=this._continueBound)}},{key:"_continue",value:function(){this.running=!0,this.cancelled||(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}},{key:"_scheduleNext",value:function(){var e=this;this._useRequestAnimationFrame?b(this,Ch)[Ch]=window.requestAnimationFrame((function(){b(e,Ch)[Ch]=null,e._nextBound().catch(e._cancelBound)})):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}},{key:"_next",value:function(){var t=(0,d.Z)((0,h.Z)().mark((function t(){return(0,h.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.cancelled){t.next=2;break}return t.abrupt("return");case 2:this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),b(e,Oh)[Oh].delete(this._canvas),this.callback()));case 4:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()}]),e}();Object.defineProperty(Mh,Oh,{writable:!0,value:new WeakSet});var Th="5.3.93",Rh="cbeef3233";function Zh(e){return Math.floor(255*Math.max(0,Math.min(1,e))).toString(16).padStart(2,"0")}function Ih(e){return Math.max(0,Math.min(255,255*e))}var Dh=function(){function e(){(0,_.Z)(this,e)}return(0,A.Z)(e,null,[{key:"CMYK_G",value:function(e){var t=(0,c.Z)(e,4),i=t[0],n=t[1],r=t[2],a=t[3];return["G",1-Math.min(1,.3*i+.59*r+.11*n+a)]}},{key:"G_CMYK",value:function(e){return["CMYK",0,0,0,1-(0,c.Z)(e,1)[0]]}},{key:"G_RGB",value:function(e){var t=(0,c.Z)(e,1)[0];return["RGB",t,t,t]}},{key:"G_rgb",value:function(e){var t=(0,c.Z)(e,1)[0];return[t=Ih(t),t,t]}},{key:"G_HTML",value:function(e){var t=Zh((0,c.Z)(e,1)[0]);return"#".concat(t).concat(t).concat(t)}},{key:"RGB_G",value:function(e){var t=(0,c.Z)(e,3);return["G",.3*t[0]+.59*t[1]+.11*t[2]]}},{key:"RGB_rgb",value:function(e){return e.map(Ih)}},{key:"RGB_HTML",value:function(e){return"#".concat(e.map(Zh).join(""))}},{key:"T_HTML",value:function(){return"#00000000"}},{key:"T_rgb",value:function(){return[null]}},{key:"CMYK_RGB",value:function(e){var t=(0,c.Z)(e,4),i=t[0],n=t[1],r=t[2],a=t[3];return["RGB",1-Math.min(1,i+a),1-Math.min(1,r+a),1-Math.min(1,n+a)]}},{key:"CMYK_rgb",value:function(e){var t=(0,c.Z)(e,4),i=t[0],n=t[1],r=t[2],a=t[3];return[Ih(1-Math.min(1,i+a)),Ih(1-Math.min(1,r+a)),Ih(1-Math.min(1,n+a))]}},{key:"CMYK_HTML",value:function(e){var t=this.CMYK_RGB(e).slice(1);return this.RGB_HTML(t)}},{key:"RGB_CMYK",value:function(e){var t=(0,c.Z)(e,3),i=1-t[0],n=1-t[1],r=1-t[2];return["CMYK",i,n,r,Math.min(i,n,r)]}}]),e}(),Lh=function(){function e(){(0,_.Z)(this,e)}return(0,A.Z)(e,[{key:"create",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(e<=0||t<=0)throw new Error("Invalid SVG dimensions");var n=this._createSVG("svg:svg");return n.setAttribute("version","1.1"),i||(n.setAttribute("width","".concat(e,"px")),n.setAttribute("height","".concat(t,"px"))),n.setAttribute("preserveAspectRatio","none"),n.setAttribute("viewBox","0 0 ".concat(e," ").concat(t)),n}},{key:"createElement",value:function(e){if("string"!==typeof e)throw new Error("Invalid SVG element type");return this._createSVG(e)}},{key:"_createSVG",value:function(e){Ae("Abstract method `_createSVG` called.")}}]),e}(),jh=function(e){P(i,e);var t=R(i);function i(){return(0,_.Z)(this,i),t.apply(this,arguments)}return(0,A.Z)(i,[{key:"_createSVG",value:function(e){return document.createElementNS(Ke,e)}}]),i}(Lh),Fh=function(){function e(){(0,_.Z)(this,e)}return(0,A.Z)(e,null,[{key:"setupStorage",value:function(e,t,i,n,r){var a=n.getValue(t,{value:null});switch(i.name){case"textarea":if(null!==a.value&&(e.textContent=a.value),"print"===r)break;e.addEventListener("input",(function(e){n.setValue(t,{value:e.target.value})}));break;case"input":if("radio"===i.attributes.type||"checkbox"===i.attributes.type){if(a.value===i.attributes.xfaOn?e.setAttribute("checked",!0):a.value===i.attributes.xfaOff&&e.removeAttribute("checked"),"print"===r)break;e.addEventListener("change",(function(e){n.setValue(t,{value:e.target.checked?e.target.getAttribute("xfaOn"):e.target.getAttribute("xfaOff")})}))}else{if(null!==a.value&&e.setAttribute("value",a.value),"print"===r)break;e.addEventListener("input",(function(e){n.setValue(t,{value:e.target.value})}))}break;case"select":if(null!==a.value){e.setAttribute("value",a.value);var s,o=(0,v.Z)(i.children);try{for(o.s();!(s=o.n()).done;){var l=s.value;l.attributes.value===a.value?l.attributes.selected=!0:l.attributes.hasOwnProperty("selected")&&delete l.attributes.selected}}catch(u){o.e(u)}finally{o.f()}}e.addEventListener("input",(function(e){var i=e.target.options,r=-1===i.selectedIndex?"":i[i.selectedIndex].value;n.setValue(t,{value:r})}))}}},{key:"setAttributes",value:function(e){var t=e.html,i=e.element,n=e.storage,r=void 0===n?null:n,a=e.intent,s=e.linkService,o=i.attributes,l=t instanceof HTMLAnchorElement;"radio"===o.type&&(o.name="".concat(o.name,"-").concat(a));for(var u=0,h=Object.entries(o);u<h.length;u++){var d=(0,c.Z)(h[u],2),v=d[0],f=d[1];if(null!==f&&void 0!==f)switch(v){case"class":f.length&&t.setAttribute(v,f.join(" "));break;case"dataId":break;case"id":t.setAttribute("data-element-id",f);break;case"style":Object.assign(t.style,f);break;case"textContent":t.textContent=f;break;default:(!l||"href"!==v&&"newWindow"!==v)&&t.setAttribute(v,f)}}l&&s.addLinkAttributes(t,o.href,o.newWindow),r&&o.dataId&&this.setupStorage(t,o.dataId,i,r)}},{key:"render",value:function(e){var t=e.annotationStorage,i=e.linkService,n=e.xfaHtml,r=e.intent||"display",a=document.createElement(n.name);n.attributes&&this.setAttributes({html:a,element:n,intent:r,linkService:i});var s="richText"!==r,o=e.div;if(o.append(a),e.viewport){var l="matrix(".concat(e.viewport.transform.join(","),")");o.style.transform=l}s&&o.setAttribute("class","xfaLayer xfaFont");var u=[];if(0===n.children.length){if(n.value){var h=document.createTextNode(n.value);a.append(h),s&&Bu.shouldBuildText(n.name)&&u.push(h)}return{textDivs:u}}for(var d=[[n,-1,a]];d.length>0;){var f,p,g=d.at(-1),y=(0,c.Z)(g,3),m=y[0],b=y[1],w=y[2];if(b+1!==m.children.length){var k=m.children[++d.at(-1)[1]];if(null!==k){var A=k.name;if("#text"!==A){var _=null!==k&&void 0!==k&&null!==(f=k.attributes)&&void 0!==f&&f.xmlns?document.createElementNS(k.attributes.xmlns,A):document.createElement(A);if(w.append(_),k.attributes&&this.setAttributes({html:_,element:k,storage:t,intent:r,linkService:i}),(null===(p=k.children)||void 0===p?void 0:p.length)>0)d.push([k,-1,_]);else if(k.value){var x=document.createTextNode(k.value);s&&Bu.shouldBuildText(A)&&u.push(x),_.append(x)}}else{var P=document.createTextNode(k.value);u.push(P),w.append(P)}}}else d.pop()}var S,E=(0,v.Z)(o.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"));try{for(E.s();!(S=E.n()).done;){S.value.setAttribute("readOnly",!0)}}catch(C){E.e(C)}finally{E.f()}return{textDivs:u}}},{key:"update",value:function(e){var t="matrix(".concat(e.viewport.transform.join(","),")");e.div.style.transform=t,e.div.hidden=!1}}]),e}(),Nh=new WeakSet,Bh=function(){function e(){(0,_.Z)(this,e)}return(0,A.Z)(e,null,[{key:"create",value:function(e){switch(e.data.annotationType){case re.LINK:return new Kh(e);case re.TEXT:return new ec(e);case re.WIDGET:switch(e.data.fieldType){case"Tx":return new ic(e);case"Btn":return e.data.radioButton?new ac(e):e.data.checkBox?new rc(e):new sc(e);case"Ch":return new oc(e);case"Sig":return new nc(e)}return new tc(e);case re.POPUP:return new lc(e);case re.FREETEXT:return new qc(e);case re.LINE:return new Yc(e);case re.SQUARE:return new Qc(e);case re.CIRCLE:return new $c(e);case re.POLYLINE:return new td(e);case re.CARET:return new nd(e);case re.INK:return new od(e);case re.POLYGON:return new id(e);case re.HIGHLIGHT:return new ud(e);case re.UNDERLINE:return new hd(e);case re.SQUIGGLY:return new cd(e);case re.STRIKEOUT:return new dd(e);case re.STAMP:return new vd(e);case re.FILEATTACHMENT:return new gd(e);default:return new Vh(e)}}}]),e}(),Hh=k("updates"),zh=k("hasBorder"),Gh=k("popupElement"),Uh=k("setRectEdited"),Vh=function(){function e(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=i.isRenderable,r=void 0!==n&&n,a=i.ignoreBorder,s=void 0!==a&&a,o=i.createQuadrilaterals,l=void 0!==o&&o;(0,_.Z)(this,e),Object.defineProperty(this,Uh,{value:Wh}),Object.defineProperty(this,Hh,{writable:!0,value:null}),Object.defineProperty(this,zh,{writable:!0,value:!1}),Object.defineProperty(this,Gh,{writable:!0,value:null}),this.isRenderable=r,this.data=t.data,this.layer=t.layer,this.linkService=t.linkService,this.downloadManager=t.downloadManager,this.imageResourcesPath=t.imageResourcesPath,this.renderForms=t.renderForms,this.svgFactory=t.svgFactory,this.annotationStorage=t.annotationStorage,this.enableScripting=t.enableScripting,this.hasJSActions=t.hasJSActions,this._fieldObjects=t.fieldObjects,this.parent=t.parent,r&&(this.container=this._createContainer(s)),l&&this._createQuadrilaterals()}return(0,A.Z)(e,[{key:"_isEditable",get:function(){return this.data.isEditable}},{key:"hasPopupData",get:function(){return e._hasPopupData(this.data)}},{key:"updateEdited",value:function(e){var t,i;if(this.container){(t=b(this,Hh))[Hh]||(t[Hh]={rect:this.data.rect.slice(0)});var n=e.rect;n&&b(this,Uh)[Uh](n),null===(i=b(this,Gh)[Gh])||void 0===i||i.popup.updateEdited(e)}}},{key:"resetEdited",value:function(){var e;b(this,Hh)[Hh]&&(b(this,Uh)[Uh](b(this,Hh)[Hh].rect),null===(e=b(this,Gh)[Gh])||void 0===e||e.popup.resetEdited(),b(this,Hh)[Hh]=null)}},{key:"_createContainer",value:function(e){var t=this.data,i=this.parent,n=i.page,r=i.viewport,a=document.createElement("section");a.setAttribute("data-annotation-id",t.id),this instanceof tc||(a.tabIndex=0);var s=a.style;if(s.zIndex=this.parent.zIndex++,t.alternativeText&&(a.title=t.alternativeText),t.noRotate&&a.classList.add("norotate"),!t.rect||this instanceof lc){var o=t.rotation;return t.hasOwnCanvas||0===o||this.setRotation(o,a),a}var l=this.width,u=this.height;if(!e&&t.borderStyle.width>0){s.borderWidth="".concat(t.borderStyle.width,"px");var h=t.borderStyle.horizontalCornerRadius,c=t.borderStyle.verticalCornerRadius;if(h>0||c>0){var d="calc(".concat(h,"px * var(--total-scale-factor)) / calc(").concat(c,"px * var(--total-scale-factor))");s.borderRadius=d}else if(this instanceof ac){var v="calc(".concat(l,"px * var(--total-scale-factor)) / calc(").concat(u,"px * var(--total-scale-factor))");s.borderRadius=v}switch(t.borderStyle.style){case ae:s.borderStyle="solid";break;case se:s.borderStyle="dashed";break;case oe:ke("Unimplemented border style: beveled");break;case le:ke("Unimplemented border style: inset");break;case ue:s.borderBottomStyle="solid"}var f=t.borderColor||null;f?(b(this,zh)[zh]=!0,s.borderColor=He.makeHexColor(0|f[0],0|f[1],0|f[2])):s.borderWidth=0}var p=He.normalizeRect([t.rect[0],n.view[3]-t.rect[1]+n.view[1],t.rect[2],n.view[3]-t.rect[3]+n.view[1]]),g=r.rawDims,y=g.pageWidth,m=g.pageHeight,w=g.pageX,k=g.pageY;s.left="".concat(100*(p[0]-w)/y,"%"),s.top="".concat(100*(p[1]-k)/m,"%");var A=t.rotation;return t.hasOwnCanvas||0===A?(s.width="".concat(100*l/y,"%"),s.height="".concat(100*u/m,"%")):this.setRotation(A,a),a}},{key:"setRotation",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.container;if(this.data.rect){var i=this.parent.viewport.rawDims,n=i.pageWidth,r=i.pageHeight,a=this.width,s=this.height;if(e%180!==0){var o=[s,a];a=o[0],s=o[1]}t.style.width="".concat(100*a/n,"%"),t.style.height="".concat(100*s/r,"%"),t.setAttribute("data-main-rotation",(360-e)%360)}}},{key:"_commonActions",get:function(){var e=this,t=function(t,i,n){var r=n.detail[t],a=r[0],o=r.slice(1);n.target.style[i]=Dh["".concat(a,"_HTML")](o),e.annotationStorage.setValue(e.data.id,(0,s.Z)({},i,Dh["".concat(a,"_rgb")](o)))};return Ee(this,"_commonActions",{display:function(t){var i=t.detail.display,n=i%2===1;e.container.style.visibility=n?"hidden":"visible",e.annotationStorage.setValue(e.data.id,{noView:n,noPrint:1===i||2===i})},print:function(t){e.annotationStorage.setValue(e.data.id,{noPrint:!t.detail.print})},hidden:function(t){var i=t.detail.hidden;e.container.style.visibility=i?"hidden":"visible",e.annotationStorage.setValue(e.data.id,{noPrint:i,noView:i})},focus:function(e){setTimeout((function(){return e.target.focus({preventScroll:!1})}),0)},userName:function(e){e.target.title=e.detail.userName},readonly:function(e){e.target.disabled=e.detail.readonly},required:function(t){e._setRequired(t.target,t.detail.required)},bgColor:function(e){t("bgColor","backgroundColor",e)},fillColor:function(e){t("fillColor","backgroundColor",e)},fgColor:function(e){t("fgColor","color",e)},textColor:function(e){t("textColor","color",e)},borderColor:function(e){t("borderColor","borderColor",e)},strokeColor:function(e){t("strokeColor","borderColor",e)},rotation:function(t){var i=t.detail.rotation;e.setRotation(i),e.annotationStorage.setValue(e.data.id,{rotation:i})}})}},{key:"_dispatchEventFromSandbox",value:function(e,t){for(var i=this._commonActions,n=0,r=Object.keys(t.detail);n<r.length;n++){var a=r[n],s=e[a]||i[a];null===s||void 0===s||s(t)}}},{key:"_setDefaultPropertiesFromJS",value:function(e){if(this.enableScripting){var t=this.annotationStorage.getRawValue(this.data.id);if(t)for(var i=this._commonActions,n=0,r=Object.entries(t);n<r.length;n++){var a=(0,c.Z)(r[n],2),o=a[0],l=a[1],u=i[o];if(u)u({detail:(0,s.Z)({},o,l),target:e}),delete t[o]}}}},{key:"_createQuadrilaterals",value:function(){if(this.container){var e=this.data.quadPoints;if(e){var t=this.data.rect.map((function(e){return Math.fround(e)})),i=(0,c.Z)(t,4),n=i[0],r=i[1],a=i[2],s=i[3];if(8===e.length){var o=e.subarray(2,6),l=(0,c.Z)(o,4),u=l[0],h=l[1],d=l[2],v=l[3];if(a===u&&s===h&&n===d&&r===v)return}var f,p=this.container.style;if(b(this,zh)[zh]){var g=p.borderColor,y=p.borderWidth;p.borderWidth=0,f=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">','<g fill="transparent" stroke="'.concat(g,'" stroke-width="').concat(y,'">')],this.container.classList.add("hasBorder")}var m=a-n,w=s-r,k=this.svgFactory,A=k.createElement("svg");A.classList.add("quadrilateralsContainer"),A.setAttribute("width",0),A.setAttribute("height",0),A.role="none";var _=k.createElement("defs");A.append(_);var x=k.createElement("clipPath"),P="clippath_".concat(this.data.id);x.setAttribute("id",P),x.setAttribute("clipPathUnits","objectBoundingBox"),_.append(x);for(var S=2,E=e.length;S<E;S+=8){var C,O=e[S],M=e[S+1],T=e[S+2],R=e[S+3],Z=k.createElement("rect"),I=(T-n)/m,D=(s-M)/w,L=(O-T)/m,j=(M-R)/w;Z.setAttribute("x",I),Z.setAttribute("y",D),Z.setAttribute("width",L),Z.setAttribute("height",j),x.append(Z),null===(C=f)||void 0===C||C.push('<rect vector-effect="non-scaling-stroke" x="'.concat(I,'" y="').concat(D,'" width="').concat(L,'" height="').concat(j,'"/>'))}b(this,zh)[zh]&&(f.push("</g></svg>')"),p.backgroundImage=f.join("")),this.container.append(A),this.container.style.clipPath="url(#".concat(P,")")}}}},{key:"_createPopup",value:function(){var e=this.data,t=b(this,Gh)[Gh]=new lc({data:{color:e.color,titleObj:e.titleObj,modificationDate:e.modificationDate,contentsObj:e.contentsObj,richText:e.richText,parentRect:e.rect,borderStyle:0,id:"popup_".concat(e.id),rotation:e.rotation,noRotate:!0},parent:this.parent,elements:[this]});this.parent.div.append(t.render())}},{key:"render",value:function(){Ae("Abstract method `AnnotationElement.render` called")}},{key:"_getElementsByName",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=[];if(this._fieldObjects){var n=this._fieldObjects[e];if(n){var r,a=(0,v.Z)(n);try{for(a.s();!(r=a.n()).done;){var s=r.value,o=s.page,l=s.id,u=s.exportValues;if(-1!==o&&l!==t){var h="string"===typeof u?u:null,c=document.querySelector('[data-element-id="'.concat(l,'"]'));!c||Nh.has(c)?i.push({id:l,exportValue:h,domElement:c}):ke("_getElementsByName - element not allowed: ".concat(l))}}}catch(m){a.e(m)}finally{a.f()}}return i}var d,f=(0,v.Z)(document.getElementsByName(e));try{for(f.s();!(d=f.n()).done;){var p=d.value,g=p.exportValue,y=p.getAttribute("data-element-id");y!==t&&(Nh.has(p)&&i.push({id:y,exportValue:g,domElement:p}))}}catch(m){f.e(m)}finally{f.f()}return i}},{key:"show",value:function(){var e;this.container&&(this.container.hidden=!1),null===(e=this.popup)||void 0===e||e.maybeShow()}},{key:"hide",value:function(){var e;this.container&&(this.container.hidden=!0),null===(e=this.popup)||void 0===e||e.forceHide()}},{key:"getElementsToTriggerPopup",value:function(){return this.container}},{key:"addHighlightArea",value:function(){var e=this.getElementsToTriggerPopup();if(Array.isArray(e)){var t,i=(0,v.Z)(e);try{for(i.s();!(t=i.n()).done;){t.value.classList.add("highlightArea")}}catch(n){i.e(n)}finally{i.f()}}else e.classList.add("highlightArea")}},{key:"_editOnDoubleClick",value:function(){var e=this;if(this._isEditable){var t=this.annotationEditorType,i=this.data.id;this.container.addEventListener("dblclick",(function(){var n;null===(n=e.linkService.eventBus)||void 0===n||n.dispatch("switchannotationeditormode",{source:e,mode:t,editId:i,mustEnterInEditMode:!0})}))}}},{key:"width",get:function(){return this.data.rect[2]-this.data.rect[0]}},{key:"height",get:function(){return this.data.rect[3]-this.data.rect[1]}}],[{key:"_hasPopupData",value:function(e){var t=e.contentsObj,i=e.richText;return!!(null!==t&&void 0!==t&&t.str||null!==i&&void 0!==i&&i.str)}}]),e}();function Wh(e){var t=this.container.style,i=this.data,n=i.rect,r=i.rotation,a=this.parent.viewport.rawDims,s=a.pageWidth,o=a.pageHeight,l=a.pageX,h=a.pageY;null===n||void 0===n||n.splice.apply(n,[0,4].concat((0,u.Z)(e))),t.left="".concat(100*(e[0]-l)/s,"%"),t.top="".concat(100*(o-e[3]+h)/o,"%"),0===r?(t.width="".concat(100*(e[2]-e[0])/s,"%"),t.height="".concat(100*(e[3]-e[1])/o,"%")):this.setRotation(r)}var qh=k("setInternalLink"),Xh=k("bindAttachment"),Yh=k("bindSetOCGState"),Kh=function(e){P(i,e);var t=R(i);function i(e){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return(0,_.Z)(this,i),n=t.call(this,e,{isRenderable:!0,ignoreBorder:!(null===r||void 0===r||!r.ignoreBorder),createQuadrilaterals:!0}),Object.defineProperty(o(n),Yh,{value:$h}),Object.defineProperty(o(n),Xh,{value:Jh}),Object.defineProperty(o(n),qh,{value:Qh}),n.isTooltipOnly=e.data.isTooltipOnly,n}return(0,A.Z)(i,[{key:"render",value:function(){var e=this.data,t=this.linkService,i=document.createElement("a");i.setAttribute("data-element-id",e.id);var n=!1;return e.url?(t.addLinkAttributes(i,e.url,e.newWindow),n=!0):e.action?(this._bindNamedAction(i,e.action),n=!0):e.attachment?(b(this,Xh)[Xh](i,e.attachment,e.attachmentDest),n=!0):e.setOCGState?(b(this,Yh)[Yh](i,e.setOCGState),n=!0):e.dest?(this._bindLink(i,e.dest),n=!0):(e.actions&&(e.actions.Action||e.actions["Mouse Up"]||e.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(i,e),n=!0),e.resetForm?(this._bindResetFormAction(i,e.resetForm),n=!0):this.isTooltipOnly&&!n&&(this._bindLink(i,""),n=!0)),this.container.classList.add("linkAnnotation"),n&&this.container.append(i),this.container}},{key:"_bindLink",value:function(e,t){var i=this;e.href=this.linkService.getDestinationHash(t),e.onclick=function(){return t&&i.linkService.goToDestination(t),!1},(t||""===t)&&b(this,qh)[qh]()}},{key:"_bindNamedAction",value:function(e,t){var i=this;e.href=this.linkService.getAnchorUrl(""),e.onclick=function(){return i.linkService.executeNamedAction(t),!1},b(this,qh)[qh]()}},{key:"_bindJSAction",value:function(e,t){var i=this;e.href=this.linkService.getAnchorUrl("");for(var n=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]),r=function(){var r=s[a],o=n.get(r);if(!o)return"continue";e[o]=function(){var e;return null===(e=i.linkService.eventBus)||void 0===e||e.dispatch("dispatcheventinsandbox",{source:i,detail:{id:t.id,name:r}}),!1}},a=0,s=Object.keys(t.actions);a<s.length;a++)r();e.onclick||(e.onclick=function(){return!1}),b(this,qh)[qh]()}},{key:"_bindResetFormAction",value:function(e,t){var i=this,n=e.onclick;if(n||(e.href=this.linkService.getAnchorUrl("")),b(this,qh)[qh](),!this._fieldObjects)return ke('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),void(n||(e.onclick=function(){return!1}));e.onclick=function(){null===n||void 0===n||n();var e=t.fields,r=t.refs,a=t.include,s=[];if(0!==e.length||0!==r.length){var o,l=new Set(r),h=(0,v.Z)(e);try{for(h.s();!(o=h.n()).done;){var c,d=o.value,f=i._fieldObjects[d]||[],p=(0,v.Z)(f);try{for(p.s();!(c=p.n()).done;){var g=c.value.id;l.add(g)}}catch(j){p.e(j)}finally{p.f()}}}catch(j){h.e(j)}finally{h.f()}for(var y=0,m=Object.values(i._fieldObjects);y<m.length;y++){var b,w=m[y],k=(0,v.Z)(w);try{for(k.s();!(b=k.n()).done;){var A=b.value;l.has(A.id)===a&&s.push(A)}}catch(j){k.e(j)}finally{k.f()}}}else for(var _=0,x=Object.values(i._fieldObjects);_<x.length;_++){var P=x[_];s.push.apply(s,(0,u.Z)(P))}for(var S,E=i.annotationStorage,C=[],O=0,M=s;O<M.length;O++){var T=M[O],R=T.id;switch(C.push(R),T.type){case"text":var Z=T.defaultValue||"";E.setValue(R,{value:Z});break;case"checkbox":case"radiobutton":var I=T.defaultValue===T.exportValues;E.setValue(R,{value:I});break;case"combobox":case"listbox":var D=T.defaultValue||"";E.setValue(R,{value:D});break;default:continue}var L=document.querySelector('[data-element-id="'.concat(R,'"]'));L&&(Nh.has(L)?L.dispatchEvent(new Event("resetform")):ke("_bindResetFormAction - element not allowed: ".concat(R)))}i.enableScripting&&(null===(S=i.linkService.eventBus)||void 0===S||S.dispatch("dispatcheventinsandbox",{source:i,detail:{id:"app",ids:C,name:"ResetForm"}}));return!1}}}]),i}(Vh);function Qh(){this.container.setAttribute("data-internal-link","")}function Jh(e,t){var i=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;e.href=this.linkService.getAnchorUrl(""),t.description&&(e.title=t.description),e.onclick=function(){var e;return null===(e=i.downloadManager)||void 0===e||e.openOrDownloadData(t.content,t.filename,n),!1},b(this,qh)[qh]()}function $h(e,t){var i=this;e.href=this.linkService.getAnchorUrl(""),e.onclick=function(){return i.linkService.executeSetOCGState(t),!1},b(this,qh)[qh]()}var ec=function(e){P(i,e);var t=R(i);function i(e){return(0,_.Z)(this,i),t.call(this,e,{isRenderable:!0})}return(0,A.Z)(i,[{key:"render",value:function(){this.container.classList.add("textAnnotation");var e=document.createElement("img");return e.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",e.setAttribute("data-l10n-id","pdfjs-text-annotation-type"),e.setAttribute("data-l10n-args",JSON.stringify({type:this.data.name})),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.append(e),this.container}}]),i}(Vh),tc=function(e){P(i,e);var t=R(i);function i(){return(0,_.Z)(this,i),t.apply(this,arguments)}return(0,A.Z)(i,[{key:"render",value:function(){return this.container}},{key:"showElementAndHideCanvas",value:function(e){var t;this.data.hasOwnCanvas&&("CANVAS"===(null===(t=e.previousSibling)||void 0===t?void 0:t.nodeName)&&(e.previousSibling.hidden=!0),e.hidden=!1)}},{key:"_getKeyModifier",value:function(e){return je.platform.isMac?e.metaKey:e.ctrlKey}},{key:"_setEventListener",value:function(e,t,i,n,r){var a=this;i.includes("mouse")?e.addEventListener(i,(function(e){var t;null===(t=a.linkService.eventBus)||void 0===t||t.dispatch("dispatcheventinsandbox",{source:a,detail:{id:a.data.id,name:n,value:r(e),shift:e.shiftKey,modifier:a._getKeyModifier(e)}})})):e.addEventListener(i,(function(e){var s;if("blur"===i){if(!t.focused||!e.relatedTarget)return;t.focused=!1}else if("focus"===i){if(t.focused)return;t.focused=!0}r&&(null===(s=a.linkService.eventBus)||void 0===s||s.dispatch("dispatcheventinsandbox",{source:a,detail:{id:a.data.id,name:n,value:r(e)}}))}))}},{key:"_setEventListeners",value:function(e,t,i,n){var r,a=(0,v.Z)(i);try{for(a.s();!(r=a.n()).done;){var s,o,l,u=(0,c.Z)(r.value,2),h=u[0],d=u[1];if("Action"===d||null!==(s=this.data.actions)&&void 0!==s&&s[d])"Focus"!==d&&"Blur"!==d||t||(t={focused:!1}),this._setEventListener(e,t,h,d,n),"Focus"!==d||null!==(o=this.data.actions)&&void 0!==o&&o.Blur?"Blur"!==d||null!==(l=this.data.actions)&&void 0!==l&&l.Focus||this._setEventListener(e,t,"focus","Focus",null):this._setEventListener(e,t,"blur","Blur",null)}}catch(f){a.e(f)}finally{a.f()}}},{key:"_setBackgroundColor",value:function(e){var t=this.data.backgroundColor||null;e.style.backgroundColor=null===t?"transparent":He.makeHexColor(t[0],t[1],t[2])}},{key:"_setTextStyle",value:function(e){var t,i=this.data.defaultAppearanceData.fontColor,n=this.data.defaultAppearanceData.fontSize||9,r=e.style,a=function(e){return Math.round(10*e)/10};if(this.data.multiLine){var s=Math.abs(this.data.rect[3]-this.data.rect[1]-2),o=s/(Math.round(s/(j*n))||1);t=Math.min(n,a(o/j))}else{var l=Math.abs(this.data.rect[3]-this.data.rect[1]-2);t=Math.min(n,a(l/j))}r.fontSize="calc(".concat(t,"px * var(--total-scale-factor))"),r.color=He.makeHexColor(i[0],i[1],i[2]),null!==this.data.textAlignment&&(r.textAlign=["left","center","right"][this.data.textAlignment])}},{key:"_setRequired",value:function(e,t){t?e.setAttribute("required",!0):e.removeAttribute("required"),e.setAttribute("aria-required",t)}}]),i}(Vh),ic=function(e){P(i,e);var t=R(i);function i(e){(0,_.Z)(this,i);var n=e.renderForms||e.data.hasOwnCanvas||!e.data.hasAppearance&&!!e.data.fieldValue;return t.call(this,e,{isRenderable:n})}return(0,A.Z)(i,[{key:"setPropertyOnSiblings",value:function(e,t,i,n){var r,a=this.annotationStorage,o=(0,v.Z)(this._getElementsByName(e.name,e.id));try{for(o.s();!(r=o.n()).done;){var l=r.value;l.domElement&&(l.domElement[t]=i),a.setValue(l.id,(0,s.Z)({},n,i))}}catch(u){o.e(u)}finally{o.f()}}},{key:"render",value:function(){var e=this,t=this.annotationStorage,i=this.data.id;this.container.classList.add("textWidgetAnnotation");var n=null;if(this.renderForms){var r,a=t.getValue(i,{value:this.data.fieldValue}),s=a.value||"",o=t.getValue(i,{charLimit:this.data.maxLen}).charLimit;o&&s.length>o&&(s=s.slice(0,o));var l=a.formattedValue||(null===(r=this.data.textContent)||void 0===r?void 0:r.join("\n"))||null;l&&this.data.comb&&(l=l.replaceAll(/\s+/g,""));var h,c,d={userValue:s,formattedValue:l,lastCommittedValue:null,commitKey:1,focused:!1};if(this.data.multiLine)(n=document.createElement("textarea")).textContent=null!==(h=l)&&void 0!==h?h:s,this.data.doNotScroll&&(n.style.overflowY="hidden");else(n=document.createElement("input")).type=this.data.password?"password":"text",n.setAttribute("value",null!==(c=l)&&void 0!==c?c:s),this.data.doNotScroll&&(n.style.overflowX="hidden");this.data.hasOwnCanvas&&(n.hidden=!0),Nh.add(n),n.setAttribute("data-element-id",i),n.disabled=this.data.readOnly,n.name=this.data.fieldName,n.tabIndex=0;var v=this.data.dateFormat||this.data.timeFormat;v&&(n.title=v),this._setRequired(n,this.data.required),o&&(n.maxLength=o),n.addEventListener("input",(function(r){t.setValue(i,{value:r.target.value}),e.setPropertyOnSiblings(n,"value",r.target.value,"value"),d.formattedValue=null})),n.addEventListener("resetform",(function(t){var i,r=null!==(i=e.data.defaultFieldValue)&&void 0!==i?i:"";n.value=d.userValue=r,d.formattedValue=null}));var f=function(e){var t=d.formattedValue;null!==t&&void 0!==t&&(e.target.value=t),e.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){var p;n.addEventListener("focus",(function(t){var i;if(!d.focused){var n=t.target;d.userValue&&(n.value=d.userValue),d.lastCommittedValue=n.value,d.commitKey=1,null!==(i=e.data.actions)&&void 0!==i&&i.Focus||(d.focused=!0)}})),n.addEventListener("updatefromsandbox",(function(n){e.showElementAndHideCanvas(n.target);var r={value:function(e){var n;d.userValue=null!==(n=e.detail.value)&&void 0!==n?n:"",t.setValue(i,{value:d.userValue.toString()}),e.target.value=d.userValue},formattedValue:function(e){var n=e.detail.formattedValue;d.formattedValue=n,null!==n&&void 0!==n&&e.target!==document.activeElement&&(e.target.value=n),t.setValue(i,{formattedValue:n})},selRange:function(e){var t;(t=e.target).setSelectionRange.apply(t,(0,u.Z)(e.detail.selRange))},charLimit:function(n){var r,a=n.detail.charLimit,s=n.target;if(0!==a){s.setAttribute("maxLength",a);var o=d.userValue;!o||o.length<=a||(o=o.slice(0,a),s.value=d.userValue=o,t.setValue(i,{value:o}),null===(r=e.linkService.eventBus)||void 0===r||r.dispatch("dispatcheventinsandbox",{source:e,detail:{id:i,name:"Keystroke",value:o,willCommit:!0,commitKey:1,selStart:s.selectionStart,selEnd:s.selectionEnd}}))}else s.removeAttribute("maxLength")}};e._dispatchEventFromSandbox(r,n)})),n.addEventListener("keydown",(function(t){var n;d.commitKey=1;var r=-1;if("Escape"===t.key?r=0:"Enter"!==t.key||e.data.multiLine?"Tab"===t.key&&(d.commitKey=3):r=2,-1!==r){var a=t.target.value;d.lastCommittedValue!==a&&(d.lastCommittedValue=a,d.userValue=a,null===(n=e.linkService.eventBus)||void 0===n||n.dispatch("dispatcheventinsandbox",{source:e,detail:{id:i,name:"Keystroke",value:a,willCommit:!0,commitKey:r,selStart:t.target.selectionStart,selEnd:t.target.selectionEnd}}))}}));var g=f;f=null,n.addEventListener("blur",(function(t){var n;if(d.focused&&t.relatedTarget){null!==(n=e.data.actions)&&void 0!==n&&n.Blur||(d.focused=!1);var r,a=t.target.value;if(d.userValue=a,d.lastCommittedValue!==a)null===(r=e.linkService.eventBus)||void 0===r||r.dispatch("dispatcheventinsandbox",{source:e,detail:{id:i,name:"Keystroke",value:a,willCommit:!0,commitKey:d.commitKey,selStart:t.target.selectionStart,selEnd:t.target.selectionEnd}});g(t)}})),null!==(p=this.data.actions)&&void 0!==p&&p.Keystroke&&n.addEventListener("beforeinput",(function(t){var n;d.lastCommittedValue=null;var r=t.data,a=t.target,s=a.value,o=a.selectionStart,l=a.selectionEnd,u=o,h=l;switch(t.inputType){case"deleteWordBackward":var c=s.substring(0,o).match(/\w*[^\w]*$/);c&&(u-=c[0].length);break;case"deleteWordForward":var v=s.substring(o).match(/^[^\w]*\w*/);v&&(h+=v[0].length);break;case"deleteContentBackward":o===l&&(u-=1);break;case"deleteContentForward":o===l&&(h+=1)}t.preventDefault(),null===(n=e.linkService.eventBus)||void 0===n||n.dispatch("dispatcheventinsandbox",{source:e,detail:{id:i,name:"Keystroke",value:s,change:r||"",willCommit:!1,selStart:u,selEnd:h}})})),this._setEventListeners(n,d,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],(function(e){return e.target.value}))}if(f&&n.addEventListener("blur",f),this.data.comb){var y=(this.data.rect[2]-this.data.rect[0])/o;n.classList.add("comb"),n.style.letterSpacing="calc(".concat(y,"px * var(--total-scale-factor) - 1ch)")}}else(n=document.createElement("div")).textContent=this.data.fieldValue,n.style.verticalAlign="middle",n.style.display="table-cell",this.data.hasOwnCanvas&&(n.hidden=!0);return this._setTextStyle(n),this._setBackgroundColor(n),this._setDefaultPropertiesFromJS(n),this.container.append(n),this.container}}]),i}(tc),nc=function(e){P(i,e);var t=R(i);function i(e){return(0,_.Z)(this,i),t.call(this,e,{isRenderable:!!e.data.hasOwnCanvas})}return(0,A.Z)(i)}(tc),rc=function(e){P(i,e);var t=R(i);function i(e){return(0,_.Z)(this,i),t.call(this,e,{isRenderable:e.renderForms})}return(0,A.Z)(i,[{key:"render",value:function(){var e=this,t=this.annotationStorage,i=this.data,n=i.id,r=t.getValue(n,{value:i.exportValue===i.fieldValue}).value;"string"===typeof r&&(r="Off"!==r,t.setValue(n,{value:r})),this.container.classList.add("buttonWidgetAnnotation","checkBox");var a=document.createElement("input");return Nh.add(a),a.setAttribute("data-element-id",n),a.disabled=i.readOnly,this._setRequired(a,this.data.required),a.type="checkbox",a.name=i.fieldName,r&&a.setAttribute("checked",!0),a.setAttribute("exportValue",i.exportValue),a.tabIndex=0,a.addEventListener("change",(function(r){var a,s=r.target,o=s.name,l=s.checked,u=(0,v.Z)(e._getElementsByName(o,n));try{for(u.s();!(a=u.n()).done;){var h=a.value,c=l&&h.exportValue===i.exportValue;h.domElement&&(h.domElement.checked=c),t.setValue(h.id,{value:c})}}catch(d){u.e(d)}finally{u.f()}t.setValue(n,{value:l})})),a.addEventListener("resetform",(function(e){var t=i.defaultFieldValue||"Off";e.target.checked=t===i.exportValue})),this.enableScripting&&this.hasJSActions&&(a.addEventListener("updatefromsandbox",(function(i){var r={value:function(e){e.target.checked="Off"!==e.detail.value,t.setValue(n,{value:e.target.checked})}};e._dispatchEventFromSandbox(r,i)})),this._setEventListeners(a,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],(function(e){return e.target.checked}))),this._setBackgroundColor(a),this._setDefaultPropertiesFromJS(a),this.container.append(a),this.container}}]),i}(tc),ac=function(e){P(i,e);var t=R(i);function i(e){return(0,_.Z)(this,i),t.call(this,e,{isRenderable:e.renderForms})}return(0,A.Z)(i,[{key:"render",value:function(){var e=this;this.container.classList.add("buttonWidgetAnnotation","radioButton");var t=this.annotationStorage,i=this.data,n=i.id,r=t.getValue(n,{value:i.fieldValue===i.buttonValue}).value;if("string"===typeof r&&(r=r!==i.buttonValue,t.setValue(n,{value:r})),r){var a,s=(0,v.Z)(this._getElementsByName(i.fieldName,n));try{for(s.s();!(a=s.n()).done;){var o=a.value;t.setValue(o.id,{value:!1})}}catch(h){s.e(h)}finally{s.f()}}var l=document.createElement("input");if(Nh.add(l),l.setAttribute("data-element-id",n),l.disabled=i.readOnly,this._setRequired(l,this.data.required),l.type="radio",l.name=i.fieldName,r&&l.setAttribute("checked",!0),l.tabIndex=0,l.addEventListener("change",(function(i){var r,a=i.target,s=a.name,o=a.checked,l=(0,v.Z)(e._getElementsByName(s,n));try{for(l.s();!(r=l.n()).done;){var u=r.value;t.setValue(u.id,{value:!1})}}catch(h){l.e(h)}finally{l.f()}t.setValue(n,{value:o})})),l.addEventListener("resetform",(function(e){var t=i.defaultFieldValue;e.target.checked=null!==t&&void 0!==t&&t===i.buttonValue})),this.enableScripting&&this.hasJSActions){var u=i.buttonValue;l.addEventListener("updatefromsandbox",(function(i){var r={value:function(i){var r,a=u===i.detail.value,s=(0,v.Z)(e._getElementsByName(i.target.name));try{for(s.s();!(r=s.n()).done;){var o=r.value,l=a&&o.id===n;o.domElement&&(o.domElement.checked=l),t.setValue(o.id,{value:l})}}catch(h){s.e(h)}finally{s.f()}}};e._dispatchEventFromSandbox(r,i)})),this._setEventListeners(l,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],(function(e){return e.target.checked}))}return this._setBackgroundColor(l),this._setDefaultPropertiesFromJS(l),this.container.append(l),this.container}}]),i}(tc),sc=function(e){P(i,e);var t=R(i);function i(e){return(0,_.Z)(this,i),t.call(this,e,{ignoreBorder:e.data.hasAppearance})}return(0,A.Z)(i,[{key:"render",value:function(){var e=this,t=a(n(i.prototype),"render",this).call(this);t.classList.add("buttonWidgetAnnotation","pushButton");var r=t.lastChild;return this.enableScripting&&this.hasJSActions&&r&&(this._setDefaultPropertiesFromJS(r),r.addEventListener("updatefromsandbox",(function(t){e._dispatchEventFromSandbox({},t)}))),t}}]),i}(Kh),oc=function(e){P(i,e);var t=R(i);function i(e){return(0,_.Z)(this,i),t.call(this,e,{isRenderable:e.renderForms})}return(0,A.Z)(i,[{key:"render",value:function(){var e=this;this.container.classList.add("choiceWidgetAnnotation");var t=this.annotationStorage,i=this.data.id,n=t.getValue(i,{value:this.data.fieldValue}),r=document.createElement("select");Nh.add(r),r.setAttribute("data-element-id",i),r.disabled=this.data.readOnly,this._setRequired(r,this.data.required),r.name=this.data.fieldName,r.tabIndex=0;var a=this.data.combo&&this.data.options.length>0;this.data.combo||(r.size=this.data.options.length,this.data.multiSelect&&(r.multiple=!0)),r.addEventListener("resetform",(function(t){var i,n=e.data.defaultFieldValue,a=(0,v.Z)(r.options);try{for(a.s();!(i=a.n()).done;){var s=i.value;s.selected=s.value===n}}catch(o){a.e(o)}finally{a.f()}}));var s,o=(0,v.Z)(this.data.options);try{for(o.s();!(s=o.n()).done;){var l=s.value,u=document.createElement("option");u.textContent=l.displayValue,u.value=l.exportValue,n.value.includes(l.exportValue)&&(u.setAttribute("selected",!0),a=!1),r.append(u)}}catch(g){o.e(g)}finally{o.f()}var h=null;if(a){var c=document.createElement("option");c.value=" ",c.setAttribute("hidden",!0),c.setAttribute("selected",!0),r.prepend(c),h=function(){c.remove(),r.removeEventListener("input",h),h=null},r.addEventListener("input",h)}var d=function(e){var t=e?"value":"textContent",i=r.options;return r.multiple?Array.prototype.filter.call(i,(function(e){return e.selected})).map((function(e){return e[t]})):-1===i.selectedIndex?null:i[i.selectedIndex][t]},f=d(!1),p=function(e){var t=e.target.options;return Array.prototype.map.call(t,(function(e){return{displayValue:e.textContent,exportValue:e.value}}))};return this.enableScripting&&this.hasJSActions?(r.addEventListener("updatefromsandbox",(function(n){var a={value:function(e){var n;null===(n=h)||void 0===n||n();var a,s=e.detail.value,o=new Set(Array.isArray(s)?s:[s]),l=(0,v.Z)(r.options);try{for(l.s();!(a=l.n()).done;){var u=a.value;u.selected=o.has(u.value)}}catch(g){l.e(g)}finally{l.f()}t.setValue(i,{value:d(!0)}),f=d(!1)},multipleSelection:function(e){r.multiple=!0},remove:function(e){var n=r.options,a=e.detail.remove;if(n[a].selected=!1,r.remove(a),n.length>0){var s=Array.prototype.findIndex.call(n,(function(e){return e.selected}));-1===s&&(n[0].selected=!0)}t.setValue(i,{value:d(!0),items:p(e)}),f=d(!1)},clear:function(e){for(;0!==r.length;)r.remove(0);t.setValue(i,{value:null,items:[]}),f=d(!1)},insert:function(e){var n=e.detail.insert,a=n.index,s=n.displayValue,o=n.exportValue,l=r.children[a],u=document.createElement("option");u.textContent=s,u.value=o,l?l.before(u):r.append(u),t.setValue(i,{value:d(!0),items:p(e)}),f=d(!1)},items:function(e){for(var n=e.detail.items;0!==r.length;)r.remove(0);var a,s=(0,v.Z)(n);try{for(s.s();!(a=s.n()).done;){var o=a.value,l=o.displayValue,u=o.exportValue,h=document.createElement("option");h.textContent=l,h.value=u,r.append(h)}}catch(g){s.e(g)}finally{s.f()}r.options.length>0&&(r.options[0].selected=!0),t.setValue(i,{value:d(!0),items:p(e)}),f=d(!1)},indices:function(e){var n,r=new Set(e.detail.indices),a=(0,v.Z)(e.target.options);try{for(a.s();!(n=a.n()).done;){var s=n.value;s.selected=r.has(s.index)}}catch(g){a.e(g)}finally{a.f()}t.setValue(i,{value:d(!0)}),f=d(!1)},editable:function(e){e.target.disabled=!e.detail.editable}};e._dispatchEventFromSandbox(a,n)})),r.addEventListener("input",(function(n){var r,a=d(!0),s=d(!1);t.setValue(i,{value:a}),n.preventDefault(),null===(r=e.linkService.eventBus)||void 0===r||r.dispatch("dispatcheventinsandbox",{source:e,detail:{id:i,name:"Keystroke",value:f,change:s,changeEx:a,willCommit:!1,commitKey:1,keyDown:!1}})})),this._setEventListeners(r,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],(function(e){return e.target.value}))):r.addEventListener("input",(function(e){t.setValue(i,{value:d(!0)})})),this.data.combo&&this._setTextStyle(r),this._setBackgroundColor(r),this._setDefaultPropertiesFromJS(r),this.container.append(r),this.container}}]),i}(tc),lc=function(e){P(i,e);var t=R(i);function i(e){var n;(0,_.Z)(this,i);var r=e.data,a=e.elements;return(n=t.call(this,e,{isRenderable:Vh._hasPopupData(r)})).elements=a,n.popup=null,n}return(0,A.Z)(i,[{key:"render",value:function(){var e=this.container;e.classList.add("popupAnnotation"),e.role="comment";var t,i=this.popup=new jc({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open}),n=[],r=(0,v.Z)(this.elements);try{for(r.s();!(t=r.n()).done;){var a=t.value;a.popup=i,a.container.ariaHasPopup="dialog",n.push(a.data.id),a.addHighlightArea()}}catch(s){r.e(s)}finally{r.f()}return this.container.setAttribute("aria-controls",n.map((function(e){return"".concat(qe).concat(e)})).join(",")),this.container}}]),i}(Vh),uc=k("boundKeyDown"),hc=k("boundHide"),cc=k("boundShow"),dc=k("boundToggle"),vc=k("color"),fc=k("container"),pc=k("contentsObj"),gc=k("dateObj"),yc=k("elements"),mc=k("parent"),bc=k("parentRect"),wc=k("pinned"),kc=k("popup"),Ac=k("position"),_c=k("rect"),xc=k("richText"),Pc=k("titleObj"),Sc=k("updates"),Ec=k("wasVisible"),Cc=k("html"),Oc=k("fontSize"),Mc=k("fontColor"),Tc=k("makePopupContent"),Rc=k("keyDown"),Zc=k("setPosition"),Ic=k("toggle"),Dc=k("show"),Lc=k("hide"),jc=function(){function e(t){var i=t.container,n=t.color,r=t.elements,a=t.titleObj,s=t.modificationDate,o=t.contentsObj,l=t.richText,u=t.parent,h=t.rect,c=t.parentRect,d=t.open;(0,_.Z)(this,e),Object.defineProperty(this,Lc,{value:Wc}),Object.defineProperty(this,Dc,{value:Vc}),Object.defineProperty(this,Ic,{value:Uc}),Object.defineProperty(this,Zc,{value:Gc}),Object.defineProperty(this,Rc,{value:zc}),Object.defineProperty(this,Tc,{value:Hc}),Object.defineProperty(this,Mc,{get:Bc,set:void 0}),Object.defineProperty(this,Oc,{get:Nc,set:void 0}),Object.defineProperty(this,Cc,{get:Fc,set:void 0}),Object.defineProperty(this,uc,{writable:!0,value:b(this,Rc)[Rc].bind(this)}),Object.defineProperty(this,hc,{writable:!0,value:b(this,Lc)[Lc].bind(this)}),Object.defineProperty(this,cc,{writable:!0,value:b(this,Dc)[Dc].bind(this)}),Object.defineProperty(this,dc,{writable:!0,value:b(this,Ic)[Ic].bind(this)}),Object.defineProperty(this,vc,{writable:!0,value:null}),Object.defineProperty(this,fc,{writable:!0,value:null}),Object.defineProperty(this,pc,{writable:!0,value:null}),Object.defineProperty(this,gc,{writable:!0,value:null}),Object.defineProperty(this,yc,{writable:!0,value:null}),Object.defineProperty(this,mc,{writable:!0,value:null}),Object.defineProperty(this,bc,{writable:!0,value:null}),Object.defineProperty(this,wc,{writable:!0,value:!1}),Object.defineProperty(this,kc,{writable:!0,value:null}),Object.defineProperty(this,Ac,{writable:!0,value:null}),Object.defineProperty(this,_c,{writable:!0,value:null}),Object.defineProperty(this,xc,{writable:!0,value:null}),Object.defineProperty(this,Pc,{writable:!0,value:null}),Object.defineProperty(this,Sc,{writable:!0,value:null}),Object.defineProperty(this,Ec,{writable:!0,value:!1}),b(this,fc)[fc]=i,b(this,Pc)[Pc]=a,b(this,pc)[pc]=o,b(this,xc)[xc]=l,b(this,mc)[mc]=u,b(this,vc)[vc]=n,b(this,_c)[_c]=h,b(this,bc)[bc]=c,b(this,yc)[yc]=r,b(this,gc)[gc]=ct.toDateObject(s),this.trigger=r.flatMap((function(e){return e.getElementsToTriggerPopup()}));var f,p=(0,v.Z)(this.trigger);try{for(p.s();!(f=p.n()).done;){var g=f.value;g.addEventListener("click",b(this,dc)[dc]),g.addEventListener("mouseenter",b(this,cc)[cc]),g.addEventListener("mouseleave",b(this,hc)[hc]),g.classList.add("popupTriggerArea")}}catch(k){p.e(k)}finally{p.f()}var y,m=(0,v.Z)(r);try{for(m.s();!(y=m.n()).done;){var w;null===(w=y.value.container)||void 0===w||w.addEventListener("keydown",b(this,uc)[uc])}}catch(k){m.e(k)}finally{m.f()}b(this,fc)[fc].hidden=!0,d&&b(this,Ic)[Ic]()}return(0,A.Z)(e,[{key:"render",value:function(){if(!b(this,kc)[kc]){var e=b(this,kc)[kc]=document.createElement("div");if(e.className="popup",b(this,vc)[vc]){var t=e.style.outlineColor=He.makeHexColor.apply(He,(0,u.Z)(b(this,vc)[vc]));e.style.backgroundColor="color-mix(in srgb, ".concat(t," 30%, white)")}var i=document.createElement("span");i.className="header";var n=document.createElement("h1");i.append(n);var r=b(this,Pc)[Pc];if(n.dir=r.dir,n.textContent=r.str,e.append(i),b(this,gc)[gc]){var a=document.createElement("time");a.classList.add("popupDate"),a.setAttribute("data-l10n-id","pdfjs-annotation-date-time-string"),a.setAttribute("data-l10n-args",JSON.stringify({dateObj:b(this,gc)[gc].valueOf()})),a.dateTime=b(this,gc)[gc].toISOString(),i.append(a)}var s=b(this,Cc)[Cc];if(s)Fh.render({xfaHtml:s,intent:"richText",div:e}),e.lastChild.classList.add("richText","popupContent");else{var o=this._formatContents(b(this,pc)[pc]);e.append(o)}b(this,fc)[fc].append(e)}}},{key:"_formatContents",value:function(e){var t=e.str,i=e.dir,n=document.createElement("p");n.classList.add("popupContent"),n.dir=i;for(var r=t.split(/(?:\r\n?|\n)/),a=0,s=r.length;a<s;++a){var o=r[a];n.append(document.createTextNode(o)),a<s-1&&n.append(document.createElement("br"))}return n}},{key:"updateEdited",value:function(e){var t,i,n=e.rect,r=e.popupContent;(t=b(this,Sc))[Sc]||(t[Sc]={contentsObj:b(this,pc)[pc],richText:b(this,xc)[xc]}),n&&(b(this,Ac)[Ac]=null),r&&(b(this,xc)[xc]=b(this,Tc)[Tc](r),b(this,pc)[pc]=null),null===(i=b(this,kc)[kc])||void 0===i||i.remove(),b(this,kc)[kc]=null}},{key:"resetEdited",value:function(){var e;if(b(this,Sc)[Sc]){var t=b(this,Sc)[Sc];b(this,pc)[pc]=t.contentsObj,b(this,xc)[xc]=t.richText,b(this,Sc)[Sc]=null,null===(e=b(this,kc)[kc])||void 0===e||e.remove(),b(this,kc)[kc]=null,b(this,Ac)[Ac]=null}}},{key:"forceHide",value:function(){b(this,Ec)[Ec]=this.isVisible,b(this,Ec)[Ec]&&(b(this,fc)[fc].hidden=!0)}},{key:"maybeShow",value:function(){b(this,Ec)[Ec]&&(b(this,kc)[kc]||b(this,Dc)[Dc](),b(this,Ec)[Ec]=!1,b(this,fc)[fc].hidden=!1)}},{key:"isVisible",get:function(){return!1===b(this,fc)[fc].hidden}}]),e}();function Fc(){var e=b(this,xc)[xc],t=b(this,pc)[pc];return null===e||void 0===e||!e.str||null!==t&&void 0!==t&&t.str&&t.str!==e.str?null:b(this,xc)[xc].html||null}function Nc(){var e,t,i;return(null===(e=b(this,Cc)[Cc])||void 0===e||null===(t=e.attributes)||void 0===t||null===(i=t.style)||void 0===i?void 0:i.fontSize)||0}function Bc(){var e,t,i;return(null===(e=b(this,Cc)[Cc])||void 0===e||null===(t=e.attributes)||void 0===t||null===(i=t.style)||void 0===i?void 0:i.color)||null}function Hc(e){var t,i=[],n={str:e,html:{name:"div",attributes:{dir:"auto"},children:[{name:"p",children:i}]}},r={style:{color:b(this,Mc)[Mc],fontSize:b(this,Oc)[Oc]?"calc(".concat(b(this,Oc)[Oc],"px * var(--total-scale-factor))"):""}},a=(0,v.Z)(e.split("\n"));try{for(a.s();!(t=a.n()).done;){var s=t.value;i.push({name:"span",value:s,attributes:r})}}catch(o){a.e(o)}finally{a.f()}return n}function zc(e){e.altKey||e.shiftKey||e.ctrlKey||e.metaKey||("Enter"===e.key||"Escape"===e.key&&b(this,wc)[wc])&&b(this,Ic)[Ic]()}function Gc(){if(null===b(this,Ac)[Ac]){var e,t=b(this,mc)[mc],i=t.page.view,n=t.viewport.rawDims,r=n.pageWidth,a=n.pageHeight,s=n.pageX,o=n.pageY,l=!!b(this,bc)[bc],u=l?b(this,bc)[bc]:b(this,_c)[_c],h=(0,v.Z)(b(this,yc)[yc]);try{for(h.s();!(e=h.n()).done;){var c=e.value;if(!u||null!==He.intersect(c.data.rect,u)){u=c.data.rect,l=!0;break}}}catch(m){h.e(m)}finally{h.f()}var d=He.normalizeRect([u[0],i[3]-u[1]+i[1],u[2],i[3]-u[3]+i[1]]),f=l?u[2]-u[0]+5:0,p=d[0]+f,g=d[1];b(this,Ac)[Ac]=[100*(p-s)/r,100*(g-o)/a];var y=b(this,fc)[fc].style;y.left="".concat(b(this,Ac)[Ac][0],"%"),y.top="".concat(b(this,Ac)[Ac][1],"%")}}function Uc(){b(this,wc)[wc]=!b(this,wc)[wc],b(this,wc)[wc]?(b(this,Dc)[Dc](),b(this,fc)[fc].addEventListener("click",b(this,dc)[dc]),b(this,fc)[fc].addEventListener("keydown",b(this,uc)[uc])):(b(this,Lc)[Lc](),b(this,fc)[fc].removeEventListener("click",b(this,dc)[dc]),b(this,fc)[fc].removeEventListener("keydown",b(this,uc)[uc]))}function Vc(){b(this,kc)[kc]||this.render(),this.isVisible?b(this,wc)[wc]&&b(this,fc)[fc].classList.add("focused"):(b(this,Zc)[Zc](),b(this,fc)[fc].hidden=!1,b(this,fc)[fc].style.zIndex=parseInt(b(this,fc)[fc].style.zIndex)+1e3)}function Wc(){b(this,fc)[fc].classList.remove("focused"),!b(this,wc)[wc]&&this.isVisible&&(b(this,fc)[fc].hidden=!0,b(this,fc)[fc].style.zIndex=parseInt(b(this,fc)[fc].style.zIndex)-1e3)}var qc=function(e){P(i,e);var t=R(i);function i(e){var n;return(0,_.Z)(this,i),(n=t.call(this,e,{isRenderable:!0,ignoreBorder:!0})).textContent=e.data.textContent,n.textPosition=e.data.textPosition,n.annotationEditorType=X.FREETEXT,n}return(0,A.Z)(i,[{key:"render",value:function(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){var e=document.createElement("div");e.classList.add("annotationTextContent"),e.setAttribute("role","comment");var t,i=(0,v.Z)(this.textContent);try{for(i.s();!(t=i.n()).done;){var n=t.value,r=document.createElement("span");r.textContent=n,e.append(r)}}catch(a){i.e(a)}finally{i.f()}this.container.append(e)}return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}]),i}(Vh),Xc=k("line"),Yc=function(e){P(i,e);var t=R(i);function i(e){var n;return(0,_.Z)(this,i),n=t.call(this,e,{isRenderable:!0,ignoreBorder:!0}),Object.defineProperty(o(n),Xc,{writable:!0,value:null}),n}return(0,A.Z)(i,[{key:"render",value:function(){this.container.classList.add("lineAnnotation");var e=this.data,t=this.width,i=this.height,n=this.svgFactory.create(t,i,!0),r=b(this,Xc)[Xc]=this.svgFactory.createElement("svg:line");return r.setAttribute("x1",e.rect[2]-e.lineCoordinates[0]),r.setAttribute("y1",e.rect[3]-e.lineCoordinates[1]),r.setAttribute("x2",e.rect[2]-e.lineCoordinates[2]),r.setAttribute("y2",e.rect[3]-e.lineCoordinates[3]),r.setAttribute("stroke-width",e.borderStyle.width||1),r.setAttribute("stroke","transparent"),r.setAttribute("fill","transparent"),n.append(r),this.container.append(n),!e.popupRef&&this.hasPopupData&&this._createPopup(),this.container}},{key:"getElementsToTriggerPopup",value:function(){return b(this,Xc)[Xc]}},{key:"addHighlightArea",value:function(){this.container.classList.add("highlightArea")}}]),i}(Vh),Kc=k("square"),Qc=function(e){P(i,e);var t=R(i);function i(e){var n;return(0,_.Z)(this,i),n=t.call(this,e,{isRenderable:!0,ignoreBorder:!0}),Object.defineProperty(o(n),Kc,{writable:!0,value:null}),n}return(0,A.Z)(i,[{key:"render",value:function(){this.container.classList.add("squareAnnotation");var e=this.data,t=this.width,i=this.height,n=this.svgFactory.create(t,i,!0),r=e.borderStyle.width,a=b(this,Kc)[Kc]=this.svgFactory.createElement("svg:rect");return a.setAttribute("x",r/2),a.setAttribute("y",r/2),a.setAttribute("width",t-r),a.setAttribute("height",i-r),a.setAttribute("stroke-width",r||1),a.setAttribute("stroke","transparent"),a.setAttribute("fill","transparent"),n.append(a),this.container.append(n),!e.popupRef&&this.hasPopupData&&this._createPopup(),this.container}},{key:"getElementsToTriggerPopup",value:function(){return b(this,Kc)[Kc]}},{key:"addHighlightArea",value:function(){this.container.classList.add("highlightArea")}}]),i}(Vh),Jc=k("circle"),$c=function(e){P(i,e);var t=R(i);function i(e){var n;return(0,_.Z)(this,i),n=t.call(this,e,{isRenderable:!0,ignoreBorder:!0}),Object.defineProperty(o(n),Jc,{writable:!0,value:null}),n}return(0,A.Z)(i,[{key:"render",value:function(){this.container.classList.add("circleAnnotation");var e=this.data,t=this.width,i=this.height,n=this.svgFactory.create(t,i,!0),r=e.borderStyle.width,a=b(this,Jc)[Jc]=this.svgFactory.createElement("svg:ellipse");return a.setAttribute("cx",t/2),a.setAttribute("cy",i/2),a.setAttribute("rx",t/2-r/2),a.setAttribute("ry",i/2-r/2),a.setAttribute("stroke-width",r||1),a.setAttribute("stroke","transparent"),a.setAttribute("fill","transparent"),n.append(a),this.container.append(n),!e.popupRef&&this.hasPopupData&&this._createPopup(),this.container}},{key:"getElementsToTriggerPopup",value:function(){return b(this,Jc)[Jc]}},{key:"addHighlightArea",value:function(){this.container.classList.add("highlightArea")}}]),i}(Vh),ed=k("polyline"),td=function(e){P(i,e);var t=R(i);function i(e){var n;return(0,_.Z)(this,i),n=t.call(this,e,{isRenderable:!0,ignoreBorder:!0}),Object.defineProperty(o(n),ed,{writable:!0,value:null}),n.containerClassName="polylineAnnotation",n.svgElementName="svg:polyline",n}return(0,A.Z)(i,[{key:"render",value:function(){this.container.classList.add(this.containerClassName);var e=this.data,t=e.rect,i=e.vertices,n=e.borderStyle,r=e.popupRef,a=this.width,s=this.height;if(!i)return this.container;for(var o=this.svgFactory.create(a,s,!0),l=[],u=0,h=i.length;u<h;u+=2){var c=i[u]-t[0],d=t[3]-i[u+1];l.push("".concat(c,",").concat(d))}l=l.join(" ");var v=b(this,ed)[ed]=this.svgFactory.createElement(this.svgElementName);return v.setAttribute("points",l),v.setAttribute("stroke-width",n.width||1),v.setAttribute("stroke","transparent"),v.setAttribute("fill","transparent"),o.append(v),this.container.append(o),!r&&this.hasPopupData&&this._createPopup(),this.container}},{key:"getElementsToTriggerPopup",value:function(){return b(this,ed)[ed]}},{key:"addHighlightArea",value:function(){this.container.classList.add("highlightArea")}}]),i}(Vh),id=function(e){P(i,e);var t=R(i);function i(e){var n;return(0,_.Z)(this,i),(n=t.call(this,e)).containerClassName="polygonAnnotation",n.svgElementName="svg:polygon",n}return(0,A.Z)(i)}(td),nd=function(e){P(i,e);var t=R(i);function i(e){return(0,_.Z)(this,i),t.call(this,e,{isRenderable:!0,ignoreBorder:!0})}return(0,A.Z)(i,[{key:"render",value:function(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}}]),i}(Vh),rd=k("polylinesGroupElement"),ad=k("polylines"),sd=k("getTransform"),od=function(e){P(i,e);var t=R(i);function i(e){var n;return(0,_.Z)(this,i),n=t.call(this,e,{isRenderable:!0,ignoreBorder:!0}),Object.defineProperty(o(n),sd,{value:ld}),Object.defineProperty(o(n),rd,{writable:!0,value:null}),Object.defineProperty(o(n),ad,{writable:!0,value:[]}),n.containerClassName="inkAnnotation",n.svgElementName="svg:polyline",n.annotationEditorType="InkHighlight"===n.data.it?X.HIGHLIGHT:X.INK,n}return(0,A.Z)(i,[{key:"render",value:function(){this.container.classList.add(this.containerClassName);var e=this.data,t=e.rect,i=e.rotation,n=e.inkLists,r=e.borderStyle,a=e.popupRef,s=b(this,sd)[sd](i,t),o=s.transform,l=s.width,u=s.height,h=this.svgFactory.create(l,u,!0),c=b(this,rd)[rd]=this.svgFactory.createElement("svg:g");h.append(c),c.setAttribute("stroke-width",r.width||1),c.setAttribute("stroke-linecap","round"),c.setAttribute("stroke-linejoin","round"),c.setAttribute("stroke-miterlimit",10),c.setAttribute("stroke","transparent"),c.setAttribute("fill","transparent"),c.setAttribute("transform",o);for(var d=0,v=n.length;d<v;d++){var f=this.svgFactory.createElement(this.svgElementName);b(this,ad)[ad].push(f),f.setAttribute("points",n[d].join(",")),c.append(f)}return!a&&this.hasPopupData&&this._createPopup(),this.container.append(h),this._editOnDoubleClick(),this.container}},{key:"updateEdited",value:function(e){a(n(i.prototype),"updateEdited",this).call(this,e);var t=e.thickness,r=e.points,s=e.rect,o=b(this,rd)[rd];if(t>=0&&o.setAttribute("stroke-width",t||1),r)for(var l=0,u=b(this,ad)[ad].length;l<u;l++)b(this,ad)[ad][l].setAttribute("points",r[l].join(","));if(s){var h=b(this,sd)[sd](this.data.rotation,s),c=h.transform,d=h.width,v=h.height;o.parentElement.setAttribute("viewBox","0 0 ".concat(d," ").concat(v)),o.setAttribute("transform",c)}}},{key:"getElementsToTriggerPopup",value:function(){return b(this,ad)[ad]}},{key:"addHighlightArea",value:function(){this.container.classList.add("highlightArea")}}]),i}(Vh);function ld(e,t){switch(e){case 90:return{transform:"rotate(90) translate(".concat(-t[0],",").concat(t[1],") scale(1,-1)"),width:t[3]-t[1],height:t[2]-t[0]};case 180:return{transform:"rotate(180) translate(".concat(-t[2],",").concat(t[1],") scale(1,-1)"),width:t[2]-t[0],height:t[3]-t[1]};case 270:return{transform:"rotate(270) translate(".concat(-t[2],",").concat(t[3],") scale(1,-1)"),width:t[3]-t[1],height:t[2]-t[0]};default:return{transform:"translate(".concat(-t[0],",").concat(t[3],") scale(1,-1)"),width:t[2]-t[0],height:t[3]-t[1]}}}var ud=function(e){P(i,e);var t=R(i);function i(e){var n;return(0,_.Z)(this,i),(n=t.call(this,e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})).annotationEditorType=X.HIGHLIGHT,n}return(0,A.Z)(i,[{key:"render",value:function(){var e=this.data,t=e.overlaidText;if(!e.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("highlightAnnotation"),this._editOnDoubleClick(),t){var i=document.createElement("mark");i.classList.add("overlaidText"),i.textContent=t,this.container.append(i)}return this.container}}]),i}(Vh),hd=function(e){P(i,e);var t=R(i);function i(e){return(0,_.Z)(this,i),t.call(this,e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}return(0,A.Z)(i,[{key:"render",value:function(){var e=this.data,t=e.overlaidText;if(!e.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("underlineAnnotation"),t){var i=document.createElement("u");i.classList.add("overlaidText"),i.textContent=t,this.container.append(i)}return this.container}}]),i}(Vh),cd=function(e){P(i,e);var t=R(i);function i(e){return(0,_.Z)(this,i),t.call(this,e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}return(0,A.Z)(i,[{key:"render",value:function(){var e=this.data,t=e.overlaidText;if(!e.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("squigglyAnnotation"),t){var i=document.createElement("u");i.classList.add("overlaidText"),i.textContent=t,this.container.append(i)}return this.container}}]),i}(Vh),dd=function(e){P(i,e);var t=R(i);function i(e){return(0,_.Z)(this,i),t.call(this,e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}return(0,A.Z)(i,[{key:"render",value:function(){var e=this.data,t=e.overlaidText;if(!e.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("strikeoutAnnotation"),t){var i=document.createElement("s");i.classList.add("overlaidText"),i.textContent=t,this.container.append(i)}return this.container}}]),i}(Vh),vd=function(e){P(i,e);var t=R(i);function i(e){var n;return(0,_.Z)(this,i),(n=t.call(this,e,{isRenderable:!0,ignoreBorder:!0})).annotationEditorType=X.STAMP,n}return(0,A.Z)(i,[{key:"render",value:function(){return this.container.classList.add("stampAnnotation"),this.container.setAttribute("role","img"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}]),i}(Vh),fd=k("trigger"),pd=k("download"),gd=function(e){P(i,e);var t=R(i);function i(e){var n,r;(0,_.Z)(this,i),r=t.call(this,e,{isRenderable:!0}),Object.defineProperty(o(r),pd,{value:yd}),Object.defineProperty(o(r),fd,{writable:!0,value:null});var a=r.data.file;return r.filename=a.filename,r.content=a.content,null===(n=r.linkService.eventBus)||void 0===n||n.dispatch("fileattachmentannotation",(0,l.Z)({source:o(r)},a)),r}return(0,A.Z)(i,[{key:"render",value:function(){var e=this;this.container.classList.add("fileAttachmentAnnotation");var t,i=this.container,n=this.data;n.hasAppearance||0===n.fillAlpha?t=document.createElement("div"):((t=document.createElement("img")).src="".concat(this.imageResourcesPath,"annotation-").concat(/paperclip/i.test(n.name)?"paperclip":"pushpin",".svg"),n.fillAlpha&&n.fillAlpha<1&&(t.style="filter: opacity(".concat(Math.round(100*n.fillAlpha),"%);"))),t.addEventListener("dblclick",b(this,pd)[pd].bind(this)),b(this,fd)[fd]=t;var r=je.platform.isMac;return i.addEventListener("keydown",(function(t){"Enter"===t.key&&(r?t.metaKey:t.ctrlKey)&&b(e,pd)[pd]()})),!n.popupRef&&this.hasPopupData?this._createPopup():t.classList.add("popupTriggerArea"),i.append(t),i}},{key:"getElementsToTriggerPopup",value:function(){return b(this,fd)[fd]}},{key:"addHighlightArea",value:function(){this.container.classList.add("highlightArea")}}]),i}(Vh);function yd(){var e;null===(e=this.downloadManager)||void 0===e||e.openOrDownloadData(this.content,this.filename)}var md=k("accessibilityManager"),bd=k("annotationCanvasMap"),wd=k("editableAnnotations"),kd=k("structTreeLayer"),Ad=k("appendElement"),_d=k("setAnnotationCanvasMap"),xd=function(){function e(t){var i=t.div,n=t.accessibilityManager,r=t.annotationCanvasMap,a=t.annotationEditorUIManager,s=t.page,o=t.viewport,l=t.structTreeLayer;(0,_.Z)(this,e),Object.defineProperty(this,_d,{value:Ed}),Object.defineProperty(this,Ad,{value:Pd}),Object.defineProperty(this,md,{writable:!0,value:null}),Object.defineProperty(this,bd,{writable:!0,value:null}),Object.defineProperty(this,wd,{writable:!0,value:new Map}),Object.defineProperty(this,kd,{writable:!0,value:null}),this.div=i,b(this,md)[md]=n,b(this,bd)[bd]=r,b(this,kd)[kd]=l||null,this.page=s,this.viewport=o,this.zIndex=0,this._annotationEditorUIManager=a}return(0,A.Z)(e,[{key:"hasEditableAnnotations",value:function(){return b(this,wd)[wd].size>0}},{key:"render",value:function(){var e=(0,d.Z)((0,h.Z)().mark((function e(t){var i,n,r,a,s,o,l,u,c,d,f,p,g;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=t.annotations,gt(n=this.div,this.viewport),r=new Map,a={data:null,layer:n,linkService:t.linkService,downloadManager:t.downloadManager,imageResourcesPath:t.imageResourcesPath||"",renderForms:!1!==t.renderForms,svgFactory:new jh,annotationStorage:t.annotationStorage||new Ya,enableScripting:!0===t.enableScripting,hasJSActions:t.hasJSActions,fieldObjects:t.fieldObjects,parent:this,elements:null},s=(0,v.Z)(i),e.prev=6,s.s();case 8:if((o=s.n()).done){e.next=34;break}if(!(l=o.value).noHTML){e.next=12;break}return e.abrupt("continue",32);case 12:if(u=l.annotationType===re.POPUP){e.next=18;break}if(l.rect[2]!==l.rect[0]&&l.rect[3]!==l.rect[1]){e.next=16;break}return e.abrupt("continue",32);case 16:e.next=22;break;case 18:if(c=r.get(l.id)){e.next=21;break}return e.abrupt("continue",32);case 21:a.elements=c;case 22:if(a.data=l,(d=Bh.create(a)).isRenderable){e.next=26;break}return e.abrupt("continue",32);case 26:return!u&&l.popupRef&&((f=r.get(l.popupRef))?f.push(d):r.set(l.popupRef,[d])),p=d.render(),l.hidden&&(p.style.visibility="hidden"),e.next=31,b(this,Ad)[Ad](p,l.id,a.elements);case 31:d._isEditable&&(b(this,wd)[wd].set(d.data.id,d),null===(g=this._annotationEditorUIManager)||void 0===g||g.renderAnnotationElement(d));case 32:e.next=8;break;case 34:e.next=39;break;case 36:e.prev=36,e.t0=e.catch(6),s.e(e.t0);case 39:return e.prev=39,s.f(),e.finish(39);case 42:b(this,_d)[_d]();case 43:case"end":return e.stop()}}),e,this,[[6,36,39,42]])})));return function(t){return e.apply(this,arguments)}}()},{key:"addLinkAnnotations",value:function(){var t=(0,d.Z)((0,h.Z)().mark((function t(i,n){var r,a,s,o,l,u;return(0,h.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r={data:null,layer:this.div,linkService:n,svgFactory:new jh,parent:this},a=(0,v.Z)(i),t.prev=2,a.s();case 4:if((s=a.n()).done){t.next=16;break}if((o=s.value).borderStyle||(o.borderStyle=e._defaultBorderStyle),r.data=o,(l=Bh.create(r)).isRenderable){t.next=11;break}return t.abrupt("continue",14);case 11:return u=l.render(),t.next=14,b(this,Ad)[Ad](u,o.id,null);case 14:t.next=4;break;case 16:t.next=21;break;case 18:t.prev=18,t.t0=t.catch(2),a.e(t.t0);case 21:return t.prev=21,a.f(),t.finish(21);case 24:case"end":return t.stop()}}),t,this,[[2,18,21,24]])})));return function(e,i){return t.apply(this,arguments)}}()},{key:"update",value:function(e){var t=e.viewport,i=this.div;this.viewport=t,gt(i,{rotation:t.rotation}),b(this,_d)[_d](),i.hidden=!1}},{key:"getEditableAnnotations",value:function(){return Array.from(b(this,wd)[wd].values())}},{key:"getEditableAnnotation",value:function(e){return b(this,wd)[wd].get(e)}}],[{key:"_defaultBorderStyle",get:function(){return Ee(this,"_defaultBorderStyle",Object.freeze({width:1,rawWidth:1,style:ae,dashArray:[3],horizontalCornerRadius:0,verticalCornerRadius:0}))}}]),e}();function Pd(e,t,i){return Sd.apply(this,arguments)}function Sd(){return Sd=(0,d.Z)((0,h.Z)().mark((function e(t,i,n){var r,a,s,o,l,u,d,f,p,g;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.firstChild||t,s=a.id="".concat(qe).concat(i),e.next=4,null===(r=b(this,kd)[kd])||void 0===r?void 0:r.getAriaAttributes(s);case 4:if(o=e.sent){l=(0,v.Z)(o);try{for(l.s();!(u=l.n()).done;)d=(0,c.Z)(u.value,2),f=d[0],p=d[1],a.setAttribute(f,p)}catch(h){l.e(h)}finally{l.f()}}n?n.at(-1).container.after(t):(this.div.append(t),null===(g=b(this,md)[md])||void 0===g||g.moveElementInDOM(this.div,t,a,!1));case 7:case"end":return e.stop()}}),e,this)}))),Sd.apply(this,arguments)}function Ed(){if(b(this,bd)[bd]){var e,t=this.div,i=(0,v.Z)(b(this,bd)[bd]);try{for(i.s();!(e=i.n()).done;){var n=(0,c.Z)(e.value,2),r=n[0],a=n[1],s=t.querySelector('[data-annotation-id="'.concat(r,'"]'));if(s){a.className="annotationContent";var o=s.firstChild;o?"CANVAS"===o.nodeName?o.replaceWith(a):o.classList.contains("annotationContent")?o.after(a):o.before(a):s.append(a);var l,u=b(this,wd)[wd].get(r);if(u)if(u._hasNoCanvas)null===(l=this._annotationEditorUIManager)||void 0===l||l.setMissingCanvas(r,s.id,a),u._hasNoCanvas=!1;else u.canvas=a}}}catch(h){i.e(h)}finally{i.f()}b(this,bd)[bd].clear()}}var Cd=/\r\n?|\n/g,Od=k("color"),Md=k("content"),Td=k("editorDivId"),Rd=k("editModeAC"),Zd=k("fontSize"),Id=k("updateFontSize"),Dd=k("updateColor"),Ld=k("extractText"),jd=k("setEditorDimensions"),Fd=k("getNodeContent"),Nd=k("setContent"),Bd=k("serializeContent"),Hd=k("deserializeContent"),zd=k("hasElementChanged"),Gd=function(e){P(i,e);var t=R(i);function i(e){var n;return(0,_.Z)(this,i),n=t.call(this,(0,l.Z)((0,l.Z)({},e),{},{name:"freeTextEditor"})),Object.defineProperty(o(n),zd,{value:Kd}),Object.defineProperty(o(n),Bd,{value:Yd}),Object.defineProperty(o(n),Nd,{value:Xd}),Object.defineProperty(o(n),jd,{value:qd}),Object.defineProperty(o(n),Ld,{value:Wd}),Object.defineProperty(o(n),Dd,{value:Vd}),Object.defineProperty(o(n),Id,{value:Ud}),Object.defineProperty(o(n),Od,{writable:!0,value:void 0}),Object.defineProperty(o(n),Md,{writable:!0,value:""}),Object.defineProperty(o(n),Td,{writable:!0,value:"".concat(n.id,"-editor")}),Object.defineProperty(o(n),Rd,{writable:!0,value:null}),Object.defineProperty(o(n),Zd,{writable:!0,value:void 0}),b(o(n),Od)[Od]=e.color||i._defaultColor||wa._defaultLineColor,b(o(n),Zd)[Zd]=e.fontSize||i._defaultFontSize,n.annotationElementId||n._uiManager.a11yAlert("pdfjs-editor-freetext-added-alert"),n}return(0,A.Z)(i,[{key:"updateParams",value:function(e,t){switch(e){case Y.FREETEXT_SIZE:b(this,Id)[Id](t);break;case Y.FREETEXT_COLOR:b(this,Dd)[Dd](t)}}},{key:"propertiesToUpdate",get:function(){return[[Y.FREETEXT_SIZE,b(this,Zd)[Zd]],[Y.FREETEXT_COLOR,b(this,Od)[Od]]]}},{key:"_translateEmpty",value:function(e,t){this._uiManager.translateSelectedEditors(e,t,!0)}},{key:"getInitialTranslation",value:function(){var e=this.parentScale;return[-i._internalPadding*e,-(i._internalPadding+b(this,Zd)[Zd])*e]}},{key:"rebuild",value:function(){this.parent&&(a(n(i.prototype),"rebuild",this).call(this),null!==this.div&&(this.isAttachedToDOM||this.parent.add(this)))}},{key:"enableEditMode",value:function(){if(!a(n(i.prototype),"enableEditMode",this).call(this))return!1;this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant"),b(this,Rd)[Rd]=new AbortController;var e=this._uiManager.combinedSignal(b(this,Rd)[Rd]);return this.editorDiv.addEventListener("keydown",this.editorDivKeydown.bind(this),{signal:e}),this.editorDiv.addEventListener("focus",this.editorDivFocus.bind(this),{signal:e}),this.editorDiv.addEventListener("blur",this.editorDivBlur.bind(this),{signal:e}),this.editorDiv.addEventListener("input",this.editorDivInput.bind(this),{signal:e}),this.editorDiv.addEventListener("paste",this.editorDivPaste.bind(this),{signal:e}),!0}},{key:"disableEditMode",value:function(){var e;return!!a(n(i.prototype),"disableEditMode",this).call(this)&&(this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",b(this,Td)[Td]),this._isDraggable=!0,null===(e=b(this,Rd)[Rd])||void 0===e||e.abort(),b(this,Rd)[Rd]=null,this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freetextEditing"),!0)}},{key:"focusin",value:function(e){this._focusEventsAllowed&&(a(n(i.prototype),"focusin",this).call(this,e),e.target!==this.editorDiv&&this.editorDiv.focus())}},{key:"onceAdded",value:function(e){var t;this.width||(this.enableEditMode(),e&&this.editorDiv.focus(),null!==(t=this._initialOptions)&&void 0!==t&&t.isCentered&&this.center(),this._initialOptions=null)}},{key:"isEmpty",value:function(){return!this.editorDiv||""===this.editorDiv.innerText.trim()}},{key:"remove",value:function(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freetextEditing")),a(n(i.prototype),"remove",this).call(this)}},{key:"commit",value:function(){var e=this;if(this.isInEditMode()){a(n(i.prototype),"commit",this).call(this),this.disableEditMode();var t=b(this,Md)[Md],r=b(this,Md)[Md]=b(this,Ld)[Ld]().trimEnd();if(t!==r){var s=function(t){b(e,Md)[Md]=t,t?(b(e,Nd)[Nd](),e._uiManager.rebuild(e),b(e,jd)[jd]()):e.remove()};this.addCommands({cmd:function(){s(r)},undo:function(){s(t)},mustExec:!1}),b(this,jd)[jd]()}}}},{key:"shouldGetKeyboardEvents",value:function(){return this.isInEditMode()}},{key:"enterInEditMode",value:function(){this.enableEditMode(),this.editorDiv.focus()}},{key:"keydown",value:function(e){e.target===this.div&&"Enter"===e.key&&(this.enterInEditMode(),e.preventDefault())}},{key:"editorDivKeydown",value:function(e){i._keyboardManager.exec(this,e)}},{key:"editorDivFocus",value:function(e){this.isEditing=!0}},{key:"editorDivBlur",value:function(e){this.isEditing=!1}},{key:"editorDivInput",value:function(e){this.parent.div.classList.toggle("freetextEditing",this.isEmpty())}},{key:"disableEditing",value:function(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}},{key:"enableEditing",value:function(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}},{key:"canChangeContent",get:function(){return!0}},{key:"render",value:function(){if(this.div)return this.div;var e,t;(this._isCopy||this.annotationElementId)&&(e=this.x,t=this.y),a(n(i.prototype),"render",this).call(this),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",b(this,Td)[Td]),this.editorDiv.setAttribute("data-l10n-id","pdfjs-free-text2"),this.editorDiv.setAttribute("data-l10n-attrs","default-content"),this.enableEditing(),this.editorDiv.contentEditable=!0;var r=this.editorDiv.style;if(r.fontSize="calc(".concat(b(this,Zd)[Zd],"px * var(--total-scale-factor))"),r.color=b(this,Od)[Od],this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),this._isCopy||this.annotationElementId){var s=(0,c.Z)(this.parentDimensions,2),o=s[0],l=s[1];if(this.annotationElementId){var u=this._initialData.position,h=this.getInitialTranslation(),d=(0,c.Z)(h,2),v=d[0],f=d[1],p=this.pageTranslationToScreen(v,f),g=(0,c.Z)(p,2);v=g[0],f=g[1];var y,m,w=(0,c.Z)(this.pageDimensions,2),k=w[0],A=w[1],_=(0,c.Z)(this.pageTranslation,2),x=_[0],P=_[1];switch(this.rotation){case 0:y=e+(u[0]-x)/k,m=t+this.height-(u[1]-P)/A;break;case 90:y=e+(u[0]-x)/k,m=t-(u[1]-P)/A;var S=[f,-v];v=S[0],f=S[1];break;case 180:y=e-this.width+(u[0]-x)/k,m=t-(u[1]-P)/A;var E=[-v,-f];v=E[0],f=E[1];break;case 270:y=e+(u[0]-x-this.height*A)/k,m=t+(u[1]-P-this.width*k)/A;var C=[-f,v];v=C[0],f=C[1]}this.setAt(y*o,m*l,v,f)}else this._moveAfterPaste(e,t);b(this,Nd)[Nd](),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}},{key:"editorDivPaste",value:function(e){var t=e.clipboardData||window.clipboardData,n=t.types;if(1!==n.length||"text/plain"!==n[0]){e.preventDefault();var r=b(i,Hd)[Hd](t.getData("text")||"").replaceAll(Cd,"\n");if(r){var a=window.getSelection();if(a.rangeCount){this.editorDiv.normalize(),a.deleteFromDocument();var s=a.getRangeAt(0);if(!r.includes("\n"))return s.insertNode(document.createTextNode(r)),this.editorDiv.normalize(),void a.collapseToStart();var o=s.startContainer,l=s.startOffset,u=[],h=[];if(o.nodeType===Node.TEXT_NODE){var c=o.parentElement;if(h.push(o.nodeValue.slice(l).replaceAll(Cd,"")),c!==this.editorDiv){var d,f=u,p=(0,v.Z)(this.editorDiv.childNodes);try{for(p.s();!(d=p.n()).done;){var g=d.value;g!==c?f.push(b(i,Fd)[Fd](g)):f=h}}catch(O){p.e(O)}finally{p.f()}}u.push(o.nodeValue.slice(0,l).replaceAll(Cd,""))}else if(o===this.editorDiv){var y,m=u,w=0,k=(0,v.Z)(this.editorDiv.childNodes);try{for(k.s();!(y=k.n()).done;){var A=y.value;w++===l&&(m=h),m.push(b(i,Fd)[Fd](A))}}catch(O){k.e(O)}finally{k.f()}}b(this,Md)[Md]="".concat(u.join("\n")).concat(r).concat(h.join("\n")),b(this,Nd)[Nd]();var _,x=new Range,P=Math.sumPrecise(u.map((function(e){return e.length}))),S=(0,v.Z)(this.editorDiv.childNodes);try{for(S.s();!(_=S.n()).done;){var E=_.value.firstChild;if(E.nodeType===Node.TEXT_NODE){var C=E.nodeValue.length;if(P<=C){x.setStart(E,P),x.setEnd(E,P);break}P-=C}}}catch(O){S.e(O)}finally{S.f()}a.removeAllRanges(),a.addRange(x)}}}}},{key:"contentDiv",get:function(){return this.editorDiv}},{key:"serialize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();var t=i._internalPadding*this.parentScale,n=this.getRect(t,t),r=wa._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:b(this,Od)[Od]),a={annotationType:X.FREETEXT,color:r,fontSize:b(this,Zd)[Zd],value:b(this,Bd)[Bd](),pageIndex:this.pageIndex,rect:n,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return e?(a.isCopy=!0,a):this.annotationElementId&&!b(this,zd)[zd](a)?null:(a.id=this.annotationElementId,a)}},{key:"renderAnnotationElement",value:function(e){var t=a(n(i.prototype),"renderAnnotationElement",this).call(this,e);if(this.deleted)return t;var r=t.style;r.fontSize="calc(".concat(b(this,Zd)[Zd],"px * var(--total-scale-factor))"),r.color=b(this,Od)[Od],t.replaceChildren();var s,o=(0,v.Z)(b(this,Md)[Md].split("\n"));try{for(o.s();!(s=o.n()).done;){var l=s.value,u=document.createElement("div");u.append(l?document.createTextNode(l):document.createElement("br")),t.append(u)}}catch(c){o.e(c)}finally{o.f()}var h=i._internalPadding*this.parentScale;return e.updateEdited({rect:this.getRect(h,h),popupContent:b(this,Md)[Md]}),t}},{key:"resetAnnotationElement",value:function(e){a(n(i.prototype),"resetAnnotationElement",this).call(this,e),e.resetEdited()}}],[{key:"_keyboardManager",get:function(){var e=i.prototype,t=function(e){return e.isEmpty()},n=xn.TRANSLATE_SMALL,r=xn.TRANSLATE_BIG;return Ee(this,"_keyboardManager",new li([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],e.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],e.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],e._translateEmpty,{args:[-n,0],checker:t}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e._translateEmpty,{args:[-r,0],checker:t}],[["ArrowRight","mac+ArrowRight"],e._translateEmpty,{args:[n,0],checker:t}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e._translateEmpty,{args:[r,0],checker:t}],[["ArrowUp","mac+ArrowUp"],e._translateEmpty,{args:[0,-n],checker:t}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e._translateEmpty,{args:[0,-r],checker:t}],[["ArrowDown","mac+ArrowDown"],e._translateEmpty,{args:[0,n],checker:t}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e._translateEmpty,{args:[0,r],checker:t}]]))}},{key:"initialize",value:function(e,t){wa.initialize(e,t);var i=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(i.getPropertyValue("--freetext-padding"))}},{key:"updateDefaultParams",value:function(e,t){switch(e){case Y.FREETEXT_SIZE:i._defaultFontSize=t;break;case Y.FREETEXT_COLOR:i._defaultColor=t}}},{key:"defaultPropertiesToUpdate",get:function(){return[[Y.FREETEXT_SIZE,i._defaultFontSize],[Y.FREETEXT_COLOR,i._defaultColor||wa._defaultLineColor]]}},{key:"deserialize",value:function(){var e=(0,d.Z)((0,h.Z)().mark((function e(t,r,s){var o,l,c,d,v,f,p,g,y,m,w,k,A,_;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=null,!(t instanceof qc)){e.next=6;break}if(c=(l=t).data,d=c.defaultAppearanceData,v=d.fontSize,f=d.fontColor,p=c.rect,g=c.rotation,y=c.id,m=c.popupRef,w=l.textContent,k=l.textPosition,A=l.parent.page.pageNumber,w&&0!==w.length){e.next=5;break}return e.abrupt("return",null);case 5:o=t={annotationType:X.FREETEXT,color:Array.from(f),fontSize:v,value:w.join("\n"),position:k,pageIndex:A-1,rect:p.slice(0),rotation:g,annotationElementId:y,id:y,deleted:!1,popupRef:m};case 6:return e.next=8,a(n(i),"deserialize",this).call(this,t,r,s);case 8:return b(_=e.sent,Zd)[Zd]=t.fontSize,b(_,Od)[Od]=He.makeHexColor.apply(He,(0,u.Z)(t.color)),b(_,Md)[Md]=b(i,Hd)[Hd](t.value),_._initialData=o,e.abrupt("return",_);case 14:case"end":return e.stop()}}),e,this)})));return function(t,i,n){return e.apply(this,arguments)}}()}]),i}(wa);function Ud(e){var t=this,i=function(e){t.editorDiv.style.fontSize="calc(".concat(e,"px * var(--total-scale-factor))"),t.translate(0,-(e-b(t,Zd)[Zd])*t.parentScale),b(t,Zd)[Zd]=e,b(t,jd)[jd]()},n=b(this,Zd)[Zd];this.addCommands({cmd:i.bind(this,e),undo:i.bind(this,n),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Y.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})}function Vd(e){var t=this,i=function(e){b(t,Od)[Od]=t.editorDiv.style.color=e},n=b(this,Od)[Od];this.addCommands({cmd:i.bind(this,e),undo:i.bind(this,n),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Y.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})}function Wd(){var e=[];this.editorDiv.normalize();var t,i=null,n=(0,v.Z)(this.editorDiv.childNodes);try{for(n.s();!(t=n.n()).done;){var r,a=t.value;(null===(r=i)||void 0===r?void 0:r.nodeType)===Node.TEXT_NODE&&"BR"===a.nodeName||(e.push(b(Gd,Fd)[Fd](a)),i=a)}}catch(s){n.e(s)}finally{n.f()}return e.join("\n")}function qd(){var e,t=(0,c.Z)(this.parentDimensions,2),i=t[0],n=t[1];if(this.isAttachedToDOM)e=this.div.getBoundingClientRect();else{var r=this.currentLayer,a=this.div,s=a.style.display,o=a.classList.contains("hidden");a.classList.remove("hidden"),a.style.display="hidden",r.div.append(this.div),e=a.getBoundingClientRect(),a.remove(),a.style.display=s,a.classList.toggle("hidden",o)}this.rotation%180===this.parentRotation%180?(this.width=e.width/i,this.height=e.height/n):(this.width=e.height/i,this.height=e.width/n),this.fixAndSetPosition()}function Xd(){if(this.editorDiv.replaceChildren(),b(this,Md)[Md]){var e,t=(0,v.Z)(b(this,Md)[Md].split("\n"));try{for(t.s();!(e=t.n()).done;){var i=e.value,n=document.createElement("div");n.append(i?document.createTextNode(i):document.createElement("br")),this.editorDiv.append(n)}}catch(r){t.e(r)}finally{t.f()}}}function Yd(){return b(this,Md)[Md].replaceAll("\xa0"," ")}function Kd(e){var t=this._initialData,i=t.value,n=t.fontSize,r=t.color,a=t.pageIndex;return this._hasBeenMoved||e.value!==i||e.fontSize!==n||e.color.some((function(e,t){return e!==r[t]}))||e.pageIndex!==a}Object.defineProperty(Gd,Hd,{value:function(e){return e.replaceAll(" ","\xa0")}}),Object.defineProperty(Gd,Fd,{value:function(e){return(e.nodeType===Node.TEXT_NODE?e.nodeValue:e.innerText).replaceAll(Cd,"")}}),Gd._freeTextDefaultContent="",Gd._internalPadding=0,Gd._defaultColor=null,Gd._defaultFontSize=10,Gd._type="freetext",Gd._editorType=X.FREETEXT;var Qd=function(){function e(){(0,_.Z)(this,e)}return(0,A.Z)(e,[{key:"toSVGPath",value:function(){Ae("Abstract method `toSVGPath` must be implemented.")}},{key:"box",get:function(){Ae("Abstract getter `box` must be implemented.")}},{key:"serialize",value:function(e,t){Ae("Abstract method `serialize` must be implemented.")}}],[{key:"_rescale",value:function(e,t,i,n,r,a){a||(a=new Float32Array(e.length));for(var s=0,o=e.length;s<o;s+=2)a[s]=t+e[s]*n,a[s+1]=i+e[s+1]*r;return a}},{key:"_rescaleAndSwap",value:function(e,t,i,n,r,a){a||(a=new Float32Array(e.length));for(var s=0,o=e.length;s<o;s+=2)a[s]=t+e[s+1]*n,a[s+1]=i+e[s]*r;return a}},{key:"_translate",value:function(e,t,i,n){n||(n=new Float32Array(e.length));for(var r=0,a=e.length;r<a;r+=2)n[r]=t+e[r],n[r+1]=i+e[r+1];return n}},{key:"svgRound",value:function(e){return Math.round(1e4*e)}},{key:"_normalizePoint",value:function(e,t,i,n,r){switch(r){case 90:return[1-t/i,e/n];case 180:return[1-e/i,1-t/n];case 270:return[t/i,1-e/n];default:return[e/i,t/n]}}},{key:"_normalizePagePoint",value:function(e,t,i){switch(i){case 90:return[1-t,e];case 180:return[1-e,1-t];case 270:return[t,1-e];default:return[e,t]}}},{key:"createBezierPoints",value:function(e,t,i,n,r,a){return[(e+5*i)/6,(t+5*n)/6,(5*i+r)/6,(5*n+a)/6,(i+r)/2,(n+a)/2]}}]),e}();Qd.PRECISION=1e-4;var Jd=k("box"),$d=k("bottom"),ev=k("innerMargin"),tv=k("isLTR"),iv=k("top"),nv=k("last"),rv=k("lastX"),av=k("lastY"),sv=k("min"),ov=k("min_dist"),lv=k("scaleFactor"),uv=k("thickness"),hv=k("points"),cv=k("MIN_DIST"),dv=k("MIN_DIFF"),vv=k("MIN"),fv=k("getLastCoords"),pv=k("toSVGPathTwoPoints"),gv=k("toSVGPathStart"),yv=k("toSVGPathEnd"),mv=k("getOutlineTwoPoints"),bv=k("getOutlineStart"),wv=k("getOutlineEnd"),kv=function(){function e(t,i,n,r,a){var s=t.x,o=t.y,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;(0,_.Z)(this,e),Object.defineProperty(this,wv,{value:Cv}),Object.defineProperty(this,bv,{value:Ev}),Object.defineProperty(this,mv,{value:Sv}),Object.defineProperty(this,yv,{value:Pv}),Object.defineProperty(this,gv,{value:xv}),Object.defineProperty(this,pv,{value:_v}),Object.defineProperty(this,fv,{value:Av}),Object.defineProperty(this,Jd,{writable:!0,value:void 0}),Object.defineProperty(this,$d,{writable:!0,value:[]}),Object.defineProperty(this,ev,{writable:!0,value:void 0}),Object.defineProperty(this,tv,{writable:!0,value:void 0}),Object.defineProperty(this,iv,{writable:!0,value:[]}),Object.defineProperty(this,nv,{writable:!0,value:new Float32Array(18)}),Object.defineProperty(this,rv,{writable:!0,value:void 0}),Object.defineProperty(this,av,{writable:!0,value:void 0}),Object.defineProperty(this,sv,{writable:!0,value:void 0}),Object.defineProperty(this,ov,{writable:!0,value:void 0}),Object.defineProperty(this,lv,{writable:!0,value:void 0}),Object.defineProperty(this,uv,{writable:!0,value:void 0}),Object.defineProperty(this,hv,{writable:!0,value:[]}),b(this,Jd)[Jd]=i,b(this,uv)[uv]=r*n,b(this,tv)[tv]=a,b(this,nv)[nv].set([NaN,NaN,NaN,NaN,s,o],6),b(this,ev)[ev]=l,b(this,ov)[ov]=b(e,cv)[cv]*n,b(this,sv)[sv]=b(e,vv)[vv]*n,b(this,lv)[lv]=n,b(this,hv)[hv].push(s,o)}return(0,A.Z)(e,[{key:"isEmpty",value:function(){return isNaN(b(this,nv)[nv][8])}},{key:"add",value:function(e){var t,i=e.x,n=e.y;b(this,rv)[rv]=i,b(this,av)[av]=n;var r=(0,c.Z)(b(this,Jd)[Jd],4),a=r[0],s=r[1],o=r[2],l=r[3],u=b(this,nv)[nv].subarray(8,12),h=(0,c.Z)(u,4),d=h[0],v=h[1],f=h[2],p=h[3],g=i-f,y=n-p,m=Math.hypot(g,y);if(m<b(this,sv)[sv])return!1;var w=m-b(this,ov)[ov],k=w/m,A=k*g,_=k*y,x=d,P=v;d=f,v=p,f+=A,p+=_,null===(t=b(this,hv)[hv])||void 0===t||t.push(i,n);var S=A/w,E=-_/w*b(this,uv)[uv],C=S*b(this,uv)[uv];if(b(this,nv)[nv].set(b(this,nv)[nv].subarray(2,8),0),b(this,nv)[nv].set([f+E,p+C],4),b(this,nv)[nv].set(b(this,nv)[nv].subarray(14,18),12),b(this,nv)[nv].set([f-E,p-C],16),isNaN(b(this,nv)[nv][6]))return 0===b(this,iv)[iv].length&&(b(this,nv)[nv].set([d+E,v+C],2),b(this,iv)[iv].push(NaN,NaN,NaN,NaN,(d+E-a)/o,(v+C-s)/l),b(this,nv)[nv].set([d-E,v-C],14),b(this,$d)[$d].push(NaN,NaN,NaN,NaN,(d-E-a)/o,(v-C-s)/l)),b(this,nv)[nv].set([x,P,d,v,f,p],6),!this.isEmpty();if(b(this,nv)[nv].set([x,P,d,v,f,p],6),Math.abs(Math.atan2(P-v,x-d)-Math.atan2(_,A))<Math.PI/2){var O=b(this,nv)[nv].subarray(2,6),M=(0,c.Z)(O,4);d=M[0],v=M[1],f=M[2],p=M[3],b(this,iv)[iv].push(NaN,NaN,NaN,NaN,((d+f)/2-a)/o,((v+p)/2-s)/l);var T=b(this,nv)[nv].subarray(14,18),R=(0,c.Z)(T,4);return d=R[0],v=R[1],x=R[2],P=R[3],b(this,$d)[$d].push(NaN,NaN,NaN,NaN,((x+d)/2-a)/o,((P+v)/2-s)/l),!0}var Z=b(this,nv)[nv].subarray(0,6),I=(0,c.Z)(Z,6);x=I[0],P=I[1],d=I[2],v=I[3],f=I[4],p=I[5],b(this,iv)[iv].push(((x+5*d)/6-a)/o,((P+5*v)/6-s)/l,((5*d+f)/6-a)/o,((5*v+p)/6-s)/l,((d+f)/2-a)/o,((v+p)/2-s)/l);var D=b(this,nv)[nv].subarray(12,18),L=(0,c.Z)(D,6);return f=L[0],p=L[1],d=L[2],v=L[3],x=L[4],P=L[5],b(this,$d)[$d].push(((x+5*d)/6-a)/o,((P+5*v)/6-s)/l,((5*d+f)/6-a)/o,((5*v+p)/6-s)/l,((d+f)/2-a)/o,((v+p)/2-s)/l),!0}},{key:"toSVGPath",value:function(){if(this.isEmpty())return"";var e=b(this,iv)[iv],t=b(this,$d)[$d];if(isNaN(b(this,nv)[nv][6])&&!this.isEmpty())return b(this,pv)[pv]();var i=[];i.push("M".concat(e[4]," ").concat(e[5]));for(var n=6;n<e.length;n+=6)isNaN(e[n])?i.push("L".concat(e[n+4]," ").concat(e[n+5])):i.push("C".concat(e[n]," ").concat(e[n+1]," ").concat(e[n+2]," ").concat(e[n+3]," ").concat(e[n+4]," ").concat(e[n+5]));b(this,yv)[yv](i);for(var r=t.length-6;r>=6;r-=6)isNaN(t[r])?i.push("L".concat(t[r+4]," ").concat(t[r+5])):i.push("C".concat(t[r]," ").concat(t[r+1]," ").concat(t[r+2]," ").concat(t[r+3]," ").concat(t[r+4]," ").concat(t[r+5]));return b(this,gv)[gv](i),i.join(" ")}},{key:"newFreeDrawOutline",value:function(e,t,i,n,r,a){return new jv(e,t,i,n,r,a)}},{key:"getOutlines",value:function(){for(var e,t,i=b(this,iv)[iv],n=b(this,$d)[$d],r=b(this,nv)[nv],a=(0,c.Z)(b(this,Jd)[Jd],4),s=a[0],o=a[1],l=a[2],u=a[3],h=new Float32Array((null!==(e=null===(t=b(this,hv)[hv])||void 0===t?void 0:t.length)&&void 0!==e?e:0)+2),d=0,v=h.length-2;d<v;d+=2)h[d]=(b(this,hv)[hv][d]-s)/l,h[d+1]=(b(this,hv)[hv][d+1]-o)/u;if(h[h.length-2]=(b(this,rv)[rv]-s)/l,h[h.length-1]=(b(this,av)[av]-o)/u,isNaN(r[6])&&!this.isEmpty())return b(this,mv)[mv](h);for(var f=new Float32Array(b(this,iv)[iv].length+24+b(this,$d)[$d].length),p=i.length,g=0;g<p;g+=2)isNaN(i[g])?f[g]=f[g+1]=NaN:(f[g]=i[g],f[g+1]=i[g+1]);p=b(this,wv)[wv](f,p);for(var y=n.length-6;y>=6;y-=6)for(var m=0;m<6;m+=2)isNaN(n[y+m])?(f[p]=f[p+1]=NaN,p+=2):(f[p]=n[y+m],f[p+1]=n[y+m+1],p+=2);return b(this,bv)[bv](f,p),this.newFreeDrawOutline(f,h,b(this,Jd)[Jd],b(this,lv)[lv],b(this,ev)[ev],b(this,tv)[tv])}}]),e}();function Av(){var e=b(this,nv)[nv].subarray(4,6),t=b(this,nv)[nv].subarray(16,18),i=(0,c.Z)(b(this,Jd)[Jd],4),n=i[0],r=i[1],a=i[2],s=i[3];return[(b(this,rv)[rv]+(e[0]-t[0])/2-n)/a,(b(this,av)[av]+(e[1]-t[1])/2-r)/s,(b(this,rv)[rv]+(t[0]-e[0])/2-n)/a,(b(this,av)[av]+(t[1]-e[1])/2-r)/s]}function _v(){var e=(0,c.Z)(b(this,Jd)[Jd],4),t=e[0],i=e[1],n=e[2],r=e[3],a=b(this,fv)[fv](),s=(0,c.Z)(a,4),o=s[0],l=s[1],u=s[2],h=s[3];return"M".concat((b(this,nv)[nv][2]-t)/n," ").concat((b(this,nv)[nv][3]-i)/r," L").concat((b(this,nv)[nv][4]-t)/n," ").concat((b(this,nv)[nv][5]-i)/r," L").concat(o," ").concat(l," L").concat(u," ").concat(h," L").concat((b(this,nv)[nv][16]-t)/n," ").concat((b(this,nv)[nv][17]-i)/r," L").concat((b(this,nv)[nv][14]-t)/n," ").concat((b(this,nv)[nv][15]-i)/r," Z")}function xv(e){var t=b(this,$d)[$d];e.push("L".concat(t[4]," ").concat(t[5]," Z"))}function Pv(e){var t=(0,c.Z)(b(this,Jd)[Jd],4),i=t[0],n=t[1],r=t[2],a=t[3],s=b(this,nv)[nv].subarray(4,6),o=b(this,nv)[nv].subarray(16,18),l=b(this,fv)[fv](),u=(0,c.Z)(l,4),h=u[0],d=u[1],v=u[2],f=u[3];e.push("L".concat((s[0]-i)/r," ").concat((s[1]-n)/a," L").concat(h," ").concat(d," L").concat(v," ").concat(f," L").concat((o[0]-i)/r," ").concat((o[1]-n)/a))}function Sv(e){var t=b(this,nv)[nv],i=(0,c.Z)(b(this,Jd)[Jd],4),n=i[0],r=i[1],a=i[2],s=i[3],o=b(this,fv)[fv](),l=(0,c.Z)(o,4),u=l[0],h=l[1],d=l[2],v=l[3],f=new Float32Array(36);return f.set([NaN,NaN,NaN,NaN,(t[2]-n)/a,(t[3]-r)/s,NaN,NaN,NaN,NaN,(t[4]-n)/a,(t[5]-r)/s,NaN,NaN,NaN,NaN,u,h,NaN,NaN,NaN,NaN,d,v,NaN,NaN,NaN,NaN,(t[16]-n)/a,(t[17]-r)/s,NaN,NaN,NaN,NaN,(t[14]-n)/a,(t[15]-r)/s],0),this.newFreeDrawOutline(f,e,b(this,Jd)[Jd],b(this,lv)[lv],b(this,ev)[ev],b(this,tv)[tv])}function Ev(e,t){var i=b(this,$d)[$d];return e.set([NaN,NaN,NaN,NaN,i[4],i[5]],t),t+6}function Cv(e,t){var i=b(this,nv)[nv].subarray(4,6),n=b(this,nv)[nv].subarray(16,18),r=(0,c.Z)(b(this,Jd)[Jd],4),a=r[0],s=r[1],o=r[2],l=r[3],u=b(this,fv)[fv](),h=(0,c.Z)(u,4),d=h[0],v=h[1],f=h[2],p=h[3];return e.set([NaN,NaN,NaN,NaN,(i[0]-a)/o,(i[1]-s)/l,NaN,NaN,NaN,NaN,d,v,NaN,NaN,NaN,NaN,f,p,NaN,NaN,NaN,NaN,(n[0]-a)/o,(n[1]-s)/l],t),t+24}Object.defineProperty(kv,cv,{writable:!0,value:8}),Object.defineProperty(kv,dv,{writable:!0,value:2}),Object.defineProperty(kv,vv,{writable:!0,value:b(kv,cv)[cv]+b(kv,dv)[dv]});var Ov=k("box"),Mv=k("bbox"),Tv=k("innerMargin"),Rv=k("isLTR"),Zv=k("points"),Iv=k("scaleFactor"),Dv=k("outline"),Lv=k("computeMinMax"),jv=function(e){P(i,e);var t=R(i);function i(e,n,r,a,s,l){var u;(0,_.Z)(this,i),u=t.call(this),Object.defineProperty(o(u),Lv,{value:Fv}),Object.defineProperty(o(u),Ov,{writable:!0,value:void 0}),Object.defineProperty(o(u),Mv,{writable:!0,value:new Float32Array(4)}),Object.defineProperty(o(u),Tv,{writable:!0,value:void 0}),Object.defineProperty(o(u),Rv,{writable:!0,value:void 0}),Object.defineProperty(o(u),Zv,{writable:!0,value:void 0}),Object.defineProperty(o(u),Iv,{writable:!0,value:void 0}),Object.defineProperty(o(u),Dv,{writable:!0,value:void 0}),b(o(u),Dv)[Dv]=e,b(o(u),Zv)[Zv]=n,b(o(u),Ov)[Ov]=r,b(o(u),Iv)[Iv]=a,b(o(u),Tv)[Tv]=s,b(o(u),Rv)[Rv]=l,u.lastPoint=[NaN,NaN],b(o(u),Lv)[Lv](l);for(var h=(0,c.Z)(b(o(u),Mv)[Mv],4),d=h[0],v=h[1],f=h[2],p=h[3],g=0,y=e.length;g<y;g+=2)e[g]=(e[g]-d)/f,e[g+1]=(e[g+1]-v)/p;for(var m=0,w=n.length;m<w;m+=2)n[m]=(n[m]-d)/f,n[m+1]=(n[m+1]-v)/p;return u}return(0,A.Z)(i,[{key:"toSVGPath",value:function(){for(var e=["M".concat(b(this,Dv)[Dv][4]," ").concat(b(this,Dv)[Dv][5])],t=6,i=b(this,Dv)[Dv].length;t<i;t+=6)isNaN(b(this,Dv)[Dv][t])?e.push("L".concat(b(this,Dv)[Dv][t+4]," ").concat(b(this,Dv)[Dv][t+5])):e.push("C".concat(b(this,Dv)[Dv][t]," ").concat(b(this,Dv)[Dv][t+1]," ").concat(b(this,Dv)[Dv][t+2]," ").concat(b(this,Dv)[Dv][t+3]," ").concat(b(this,Dv)[Dv][t+4]," ").concat(b(this,Dv)[Dv][t+5]));return e.push("Z"),e.join(" ")}},{key:"serialize",value:function(e,t){var i,n,r=(0,c.Z)(e,4),a=r[0],s=r[1],o=r[2],l=r[3],u=o-a,h=l-s;switch(t){case 0:i=Qd._rescale(b(this,Dv)[Dv],a,l,u,-h),n=Qd._rescale(b(this,Zv)[Zv],a,l,u,-h);break;case 90:i=Qd._rescaleAndSwap(b(this,Dv)[Dv],a,s,u,h),n=Qd._rescaleAndSwap(b(this,Zv)[Zv],a,s,u,h);break;case 180:i=Qd._rescale(b(this,Dv)[Dv],o,s,-u,h),n=Qd._rescale(b(this,Zv)[Zv],o,s,-u,h);break;case 270:i=Qd._rescaleAndSwap(b(this,Dv)[Dv],o,l,-u,-h),n=Qd._rescaleAndSwap(b(this,Zv)[Zv],o,l,-u,-h)}return{outline:Array.from(i),points:[Array.from(n)]}}},{key:"box",get:function(){return b(this,Mv)[Mv]}},{key:"newOutliner",value:function(e,t,i,n,r){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;return new kv(e,t,i,n,r,a)}},{key:"getNewOutline",value:function(e,t){for(var i=(0,c.Z)(b(this,Mv)[Mv],4),n=i[0],r=i[1],a=i[2],s=i[3],o=(0,c.Z)(b(this,Ov)[Ov],4),l=o[0],u=o[1],h=o[2],d=o[3],v=a*h,f=s*d,p=n*h+l,g=r*d+u,y=this.newOutliner({x:b(this,Zv)[Zv][0]*v+p,y:b(this,Zv)[Zv][1]*f+g},b(this,Ov)[Ov],b(this,Iv)[Iv],e,b(this,Rv)[Rv],null!==t&&void 0!==t?t:b(this,Tv)[Tv]),m=2;m<b(this,Zv)[Zv].length;m+=2)y.add({x:b(this,Zv)[Zv][m]*v+p,y:b(this,Zv)[Zv][m+1]*f+g});return y.getOutlines()}}]),i}(Qd);function Fv(e){for(var t=b(this,Dv)[Dv],i=t[4],n=t[5],r=[i,n,i,n],a=i,s=n,o=e?Math.max:Math.min,l=6,h=t.length;l<h;l+=6){var c=t[l+4],d=t[l+5];if(isNaN(t[l]))He.pointBoundingBox(c,d,r),s<d?(a=c,s=d):s===d&&(a=o(a,c));else{var v=[1/0,1/0,-1/0,-1/0];He.bezierBoundingBox.apply(He,[i,n].concat((0,u.Z)(t.slice(l,l+6)),[v])),He.rectBoundingBox.apply(He,v.concat([r])),s<v[3]?(a=v[2],s=v[3]):s===v[3]&&(a=o(a,v[2]))}i=c,n=d}var f=b(this,Mv)[Mv];f[0]=r[0]-b(this,Tv)[Tv],f[1]=r[1]-b(this,Tv)[Tv],f[2]=r[2]-r[0]+2*b(this,Tv)[Tv],f[3]=r[3]-r[1]+2*b(this,Tv)[Tv],this.lastPoint=[a,s]}var Nv=k("box"),Bv=k("lastPoint"),Hv=k("verticalEdges"),zv=k("intervals"),Gv=k("getOutlines"),Uv=k("binarySearch"),Vv=k("insert"),Wv=k("remove"),qv=k("breakEdge"),Xv=function(){function e(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];(0,_.Z)(this,e),Object.defineProperty(this,qv,{value:$v}),Object.defineProperty(this,Wv,{value:Jv}),Object.defineProperty(this,Vv,{value:Qv}),Object.defineProperty(this,Uv,{value:Kv}),Object.defineProperty(this,Gv,{value:Yv}),Object.defineProperty(this,Nv,{writable:!0,value:void 0}),Object.defineProperty(this,Bv,{writable:!0,value:void 0}),Object.defineProperty(this,Hv,{writable:!0,value:[]}),Object.defineProperty(this,zv,{writable:!0,value:[]});var a,s=[1/0,1/0,-1/0,-1/0],o=4,l=Math.pow(10,-o),u=(0,v.Z)(t);try{for(u.s();!(a=u.n()).done;){var h=a.value,d=h.x,f=h.y,p=h.width,g=h.height,y=Math.floor((d-i)/l)*l,m=Math.ceil((d+p+i)/l)*l,w=Math.floor((f-i)/l)*l,k=Math.ceil((f+g+i)/l)*l,A=[y,w,k,!0],x=[m,w,k,!1];b(this,Hv)[Hv].push(A,x),He.rectBoundingBox(y,w,m,k,s)}}catch(F){u.e(F)}finally{u.f()}var P,S=s[2]-s[0]+2*n,E=s[3]-s[1]+2*n,C=s[0]-n,O=s[1]-n,M=b(this,Hv)[Hv].at(r?-1:-2),T=[M[0],M[2]],R=(0,v.Z)(b(this,Hv)[Hv]);try{for(R.s();!(P=R.n()).done;){var Z=P.value,I=(0,c.Z)(Z,3),D=I[0],L=I[1],j=I[2];Z[0]=(D-C)/S,Z[1]=(L-O)/E,Z[2]=(j-O)/E}}catch(F){R.e(F)}finally{R.f()}b(this,Nv)[Nv]=new Float32Array([C,O,S,E]),b(this,Bv)[Bv]=T}return(0,A.Z)(e,[{key:"getOutlines",value:function(){b(this,Hv)[Hv].sort((function(e,t){return e[0]-t[0]||e[1]-t[1]||e[2]-t[2]}));var e,t=[],i=(0,v.Z)(b(this,Hv)[Hv]);try{for(i.s();!(e=i.n()).done;){var n=e.value;n[3]?(t.push.apply(t,(0,u.Z)(b(this,qv)[qv](n))),b(this,Vv)[Vv](n)):(b(this,Wv)[Wv](n),t.push.apply(t,(0,u.Z)(b(this,qv)[qv](n))))}}catch(r){i.e(r)}finally{i.f()}return b(this,Gv)[Gv](t)}}]),e}();function Yv(e){var t,i=[],n=new Set,r=(0,v.Z)(e);try{for(r.s();!(t=r.n()).done;){var a=t.value,s=(0,c.Z)(a,3),o=s[0],l=s[1],u=s[2];i.push([o,l,a],[o,u,a])}}catch(T){r.e(T)}finally{r.f()}i.sort((function(e,t){return e[1]-t[1]||e[0]-t[0]}));for(var h=0,d=i.length;h<d;h+=2){var f=i[h][2],p=i[h+1][2];f.push(p),p.push(f),n.add(f),n.add(p)}for(var g,y=[];n.size>0;){var m=n.values().next().value,w=(0,c.Z)(m,5),k=w[0],A=w[1],_=w[2],x=w[3],P=w[4];n.delete(m);var S=k,E=A;for(g=[k,_],y.push(g);;){var C=void 0;if(n.has(x))C=x;else{if(!n.has(P))break;C=P}n.delete(C);var O=C,M=(0,c.Z)(O,5);k=M[0],A=M[1],_=M[2],x=M[3],P=M[4],S!==k&&(g.push(S,E,k,E===A?A:_),S=k),E=E===A?_:A}g.push(S,E)}return new nf(y,b(this,Nv)[Nv],b(this,Bv)[Bv])}function Kv(e){for(var t=b(this,zv)[zv],i=0,n=t.length-1;i<=n;){var r=i+n>>1,a=t[r][0];if(a===e)return r;a<e?i=r+1:n=r-1}return n+1}function Qv(e){var t=(0,c.Z)(e,3),i=t[1],n=t[2],r=b(this,Uv)[Uv](i);b(this,zv)[zv].splice(r,0,[i,n])}function Jv(e){for(var t=(0,c.Z)(e,3),i=t[1],n=t[2],r=b(this,Uv)[Uv](i),a=r;a<b(this,zv)[zv].length;a++){var s=(0,c.Z)(b(this,zv)[zv][a],2),o=s[0],l=s[1];if(o!==i)break;if(o===i&&l===n)return void b(this,zv)[zv].splice(a,1)}for(var u=r-1;u>=0;u--){var h=(0,c.Z)(b(this,zv)[zv][u],2),d=h[0],v=h[1];if(d!==i)break;if(d===i&&v===n)return void b(this,zv)[zv].splice(u,1)}}function $v(e){for(var t=(0,c.Z)(e,3),i=t[0],n=t[1],r=t[2],a=[[i,n,r]],s=b(this,Uv)[Uv](r),o=0;o<s;o++)for(var l=(0,c.Z)(b(this,zv)[zv][o],2),u=l[0],h=l[1],d=0,v=a.length;d<v;d++){var f=(0,c.Z)(a[d],3),p=f[1],g=f[2];if(!(h<=p||g<=u))if(p>=u)if(g>h)a[d][1]=h;else{if(1===v)return[];a.splice(d,1),d--,v--}else a[d][2]=u,g>h&&a.push([i,h,g])}return a}var ef=k("box"),tf=k("outlines"),nf=function(e){P(i,e);var t=R(i);function i(e,n,r){var a;return(0,_.Z)(this,i),a=t.call(this),Object.defineProperty(o(a),ef,{writable:!0,value:void 0}),Object.defineProperty(o(a),tf,{writable:!0,value:void 0}),b(o(a),tf)[tf]=e,b(o(a),ef)[ef]=n,a.lastPoint=r,a}return(0,A.Z)(i,[{key:"toSVGPath",value:function(){var e,t=[],i=(0,v.Z)(b(this,tf)[tf]);try{for(i.s();!(e=i.n()).done;){var n=e.value,r=(0,c.Z)(n,2),a=r[0],s=r[1];t.push("M".concat(a," ").concat(s));for(var o=2;o<n.length;o+=2){var l=n[o],u=n[o+1];l===a?(t.push("V".concat(u)),s=u):u===s&&(t.push("H".concat(l)),a=l)}t.push("Z")}}catch(h){i.e(h)}finally{i.f()}return t.join(" ")}},{key:"serialize",value:function(e,t){var i,n=(0,c.Z)(e,4),r=n[0],a=n[1],s=n[2],o=n[3],l=[],u=s-r,h=o-a,d=(0,v.Z)(b(this,tf)[tf]);try{for(d.s();!(i=d.n()).done;){for(var f=i.value,p=new Array(f.length),g=0;g<f.length;g+=2)p[g]=r+f[g]*u,p[g+1]=o-f[g+1]*h;l.push(p)}}catch(y){d.e(y)}finally{d.f()}return l}},{key:"box",get:function(){return b(this,ef)[ef]}},{key:"classNamesForOutlining",get:function(){return["highlightOutline"]}}]),i}(Qd),rf=function(e){P(i,e);var t=R(i);function i(){return(0,_.Z)(this,i),t.apply(this,arguments)}return(0,A.Z)(i,[{key:"newFreeDrawOutline",value:function(e,t,i,n,r,a){return new af(e,t,i,n,r,a)}}]),i}(kv),af=function(e){P(i,e);var t=R(i);function i(){return(0,_.Z)(this,i),t.apply(this,arguments)}return(0,A.Z)(i,[{key:"newOutliner",value:function(e,t,i,n,r){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;return new rf(e,t,i,n,r,a)}}]),i}(jv),sf=k("button"),of=k("buttonSwatch"),lf=k("defaultColor"),uf=k("dropdown"),hf=k("dropdownWasFromKeyboard"),cf=k("isMainColorPicker"),df=k("editor"),vf=k("eventBus"),ff=k("openDropdownAC"),pf=k("uiManager"),gf=k("type"),yf=k("l10nColor"),mf=k("getDropdownRoot"),bf=k("colorSelect"),wf=k("keyDown"),kf=k("openDropdown"),Af=k("pointerDown"),_f=k("isDropdownVisible"),xf=function(){function e(t){var i,n,r,a=t.editor,s=void 0===a?null:a,o=t.uiManager,l=void 0===o?null:o;(0,_.Z)(this,e),Object.defineProperty(this,_f,{get:Mf,set:void 0}),Object.defineProperty(this,Af,{value:Of}),Object.defineProperty(this,kf,{value:Cf}),Object.defineProperty(this,wf,{value:Ef}),Object.defineProperty(this,bf,{value:Sf}),Object.defineProperty(this,mf,{value:Pf}),Object.defineProperty(this,sf,{writable:!0,value:null}),Object.defineProperty(this,of,{writable:!0,value:null}),Object.defineProperty(this,lf,{writable:!0,value:void 0}),Object.defineProperty(this,uf,{writable:!0,value:null}),Object.defineProperty(this,hf,{writable:!0,value:!1}),Object.defineProperty(this,cf,{writable:!0,value:!1}),Object.defineProperty(this,df,{writable:!0,value:null}),Object.defineProperty(this,vf,{writable:!0,value:void 0}),Object.defineProperty(this,ff,{writable:!0,value:null}),Object.defineProperty(this,pf,{writable:!0,value:null}),Object.defineProperty(this,gf,{writable:!0,value:void 0}),s?(b(this,cf)[cf]=!1,b(this,gf)[gf]=Y.HIGHLIGHT_COLOR,b(this,df)[df]=s):(b(this,cf)[cf]=!0,b(this,gf)[gf]=Y.HIGHLIGHT_DEFAULT_COLOR),b(this,pf)[pf]=(null===s||void 0===s?void 0:s._uiManager)||l,b(this,vf)[vf]=b(this,pf)[pf]._eventBus,b(this,lf)[lf]=(null===s||void 0===s||null===(i=s.color)||void 0===i?void 0:i.toUpperCase())||(null===(n=b(this,pf)[pf])||void 0===n?void 0:n.highlightColors.values().next().value)||"#FFFF98",(r=b(e,yf))[yf]||(r[yf]=Object.freeze({blue:"pdfjs-editor-colorpicker-blue",green:"pdfjs-editor-colorpicker-green",pink:"pdfjs-editor-colorpicker-pink",red:"pdfjs-editor-colorpicker-red",yellow:"pdfjs-editor-colorpicker-yellow"}))}return(0,A.Z)(e,[{key:"renderButton",value:function(){var e=b(this,sf)[sf]=document.createElement("button");e.className="colorPicker",e.tabIndex="0",e.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-button"),e.ariaHasPopup="true",b(this,df)[df]&&(e.ariaControls="".concat(b(this,df)[df].id,"_colorpicker_dropdown"));var t=b(this,pf)[pf]._signal;e.addEventListener("click",b(this,kf)[kf].bind(this),{signal:t}),e.addEventListener("keydown",b(this,wf)[wf].bind(this),{signal:t});var i=b(this,of)[of]=document.createElement("span");return i.className="swatch",i.ariaHidden="true",i.style.backgroundColor=b(this,lf)[lf],e.append(i),e}},{key:"renderMainDropdown",value:function(){var e=b(this,uf)[uf]=b(this,mf)[mf]();return e.ariaOrientation="horizontal",e.ariaLabelledBy="highlightColorPickerLabel",e}},{key:"_colorSelectFromKeyboard",value:function(e){if(e.target!==b(this,sf)[sf]){var t=e.target.getAttribute("data-color");t&&b(this,bf)[bf](t,e)}else b(this,kf)[kf](e)}},{key:"_moveToNext",value:function(e){var t,i;b(this,_f)[_f]?e.target!==b(this,sf)[sf]?null===(t=e.target.nextSibling)||void 0===t||t.focus():null===(i=b(this,uf)[uf].firstChild)||void 0===i||i.focus():b(this,kf)[kf](e)}},{key:"_moveToPrevious",value:function(e){var t,i;e.target!==(null===(t=b(this,uf)[uf])||void 0===t?void 0:t.firstChild)&&e.target!==b(this,sf)[sf]?(b(this,_f)[_f]||b(this,kf)[kf](e),null===(i=e.target.previousSibling)||void 0===i||i.focus()):b(this,_f)[_f]&&this._hideDropdownFromKeyboard()}},{key:"_moveToBeginning",value:function(e){var t;b(this,_f)[_f]?null===(t=b(this,uf)[uf].firstChild)||void 0===t||t.focus():b(this,kf)[kf](e)}},{key:"_moveToEnd",value:function(e){var t;b(this,_f)[_f]?null===(t=b(this,uf)[uf].lastChild)||void 0===t||t.focus():b(this,kf)[kf](e)}},{key:"hideDropdown",value:function(){var e,t;null===(e=b(this,uf)[uf])||void 0===e||e.classList.add("hidden"),b(this,sf)[sf].ariaExpanded="false",null===(t=b(this,ff)[ff])||void 0===t||t.abort(),b(this,ff)[ff]=null}},{key:"_hideDropdownFromKeyboard",value:function(){var e;b(this,cf)[cf]||(b(this,_f)[_f]?(this.hideDropdown(),b(this,sf)[sf].focus({preventScroll:!0,focusVisible:b(this,hf)[hf]})):null===(e=b(this,df)[df])||void 0===e||e.unselect())}},{key:"updateColor",value:function(e){if(b(this,of)[of]&&(b(this,of)[of].style.backgroundColor=e),b(this,uf)[uf]){var t,i=b(this,pf)[pf].highlightColors.values(),n=(0,v.Z)(b(this,uf)[uf].children);try{for(n.s();!(t=n.n()).done;){t.value.ariaSelected=i.next().value===e.toUpperCase()}}catch(r){n.e(r)}finally{n.f()}}}},{key:"destroy",value:function(){var e,t;null===(e=b(this,sf)[sf])||void 0===e||e.remove(),b(this,sf)[sf]=null,b(this,of)[of]=null,null===(t=b(this,uf)[uf])||void 0===t||t.remove(),b(this,uf)[uf]=null}}],[{key:"_keyboardManager",get:function(){return Ee(this,"_keyboardManager",new li([[["Escape","mac+Escape"],e.prototype._hideDropdownFromKeyboard],[[" ","mac+ "],e.prototype._colorSelectFromKeyboard],[["ArrowDown","ArrowRight","mac+ArrowDown","mac+ArrowRight"],e.prototype._moveToNext],[["ArrowUp","ArrowLeft","mac+ArrowUp","mac+ArrowLeft"],e.prototype._moveToPrevious],[["Home","mac+Home"],e.prototype._moveToBeginning],[["End","mac+End"],e.prototype._moveToEnd]]))}}]),e}();function Pf(){var e=document.createElement("div"),t=b(this,pf)[pf]._signal;e.addEventListener("contextmenu",lt,{signal:t}),e.className="dropdown",e.role="listbox",e.ariaMultiSelectable="false",e.ariaOrientation="vertical",e.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-dropdown"),b(this,df)[df]&&(e.id="".concat(b(this,df)[df].id,"_colorpicker_dropdown"));var i,n=(0,v.Z)(b(this,pf)[pf].highlightColors);try{for(n.s();!(i=n.n()).done;){var r=(0,c.Z)(i.value,2),a=r[0],s=r[1],o=document.createElement("button");o.tabIndex="0",o.role="option",o.setAttribute("data-color",s),o.title=a,o.setAttribute("data-l10n-id",b(xf,yf)[yf][a]);var l=document.createElement("span");o.append(l),l.className="swatch",l.style.backgroundColor=s,o.ariaSelected=s===b(this,lf)[lf],o.addEventListener("click",b(this,bf)[bf].bind(this,s),{signal:t}),e.append(o)}}catch(u){n.e(u)}finally{n.f()}return e.addEventListener("keydown",b(this,wf)[wf].bind(this),{signal:t}),e}function Sf(e,t){t.stopPropagation(),b(this,vf)[vf].dispatch("switchannotationeditorparams",{source:this,type:b(this,gf)[gf],value:e})}function Ef(e){xf._keyboardManager.exec(this,e)}function Cf(e){if(b(this,_f)[_f])this.hideDropdown();else if(b(this,hf)[hf]=0===e.detail,b(this,ff)[ff]||(b(this,ff)[ff]=new AbortController,window.addEventListener("pointerdown",b(this,Af)[Af].bind(this),{signal:b(this,pf)[pf].combinedSignal(b(this,ff)[ff])})),b(this,sf)[sf].ariaExpanded="true",b(this,uf)[uf])b(this,uf)[uf].classList.remove("hidden");else{var t=b(this,uf)[uf]=b(this,mf)[mf]();b(this,sf)[sf].append(t)}}function Of(e){var t;null!==(t=b(this,uf)[uf])&&void 0!==t&&t.contains(e.target)||this.hideDropdown()}function Mf(){return b(this,uf)[uf]&&!b(this,uf)[uf].classList.contains("hidden")}Object.defineProperty(xf,yf,{writable:!0,value:null});var Tf=k("anchorNode"),Rf=k("anchorOffset"),Zf=k("boxes"),If=k("clipPathId"),Df=k("colorPicker"),Lf=k("focusOutlines"),jf=k("focusNode"),Ff=k("focusOffset"),Nf=k("highlightDiv"),Bf=k("highlightOutlines"),Hf=k("id"),zf=k("isFreeHighlight"),Gf=k("lastPoint"),Uf=k("opacity"),Vf=k("outlineId"),Wf=k("text"),qf=k("thickness"),Xf=k("methodOfCreation"),Yf=k("createOutlines"),Kf=k("createFreeOutlines"),Qf=k("updateColor"),Jf=k("updateThickness"),$f=k("changeThickness"),ep=k("cleanDrawLayer"),tp=k("addToDrawLayer"),ip=k("rotateBbox"),np=k("keydown"),rp=k("setCaret"),ap=k("getRotation"),sp=k("serializeBoxes"),op=k("serializeOutlines"),lp=k("highlightMove"),up=k("endHighlight"),hp=k("hasElementChanged"),cp=function(e){P(i,e);var t=R(i);function i(e){var n;return(0,_.Z)(this,i),n=t.call(this,(0,l.Z)((0,l.Z)({},e),{},{name:"highlightEditor"})),Object.defineProperty(o(n),hp,{value:xp}),Object.defineProperty(o(n),op,{value:_p}),Object.defineProperty(o(n),sp,{value:Ap}),Object.defineProperty(o(n),ap,{value:kp}),Object.defineProperty(o(n),rp,{value:wp}),Object.defineProperty(o(n),np,{value:bp}),Object.defineProperty(o(n),tp,{value:mp}),Object.defineProperty(o(n),ep,{value:yp}),Object.defineProperty(o(n),$f,{value:gp}),Object.defineProperty(o(n),Jf,{value:pp}),Object.defineProperty(o(n),Qf,{value:fp}),Object.defineProperty(o(n),Kf,{value:vp}),Object.defineProperty(o(n),Yf,{value:dp}),Object.defineProperty(o(n),Tf,{writable:!0,value:null}),Object.defineProperty(o(n),Rf,{writable:!0,value:0}),Object.defineProperty(o(n),Zf,{writable:!0,value:void 0}),Object.defineProperty(o(n),If,{writable:!0,value:null}),Object.defineProperty(o(n),Df,{writable:!0,value:null}),Object.defineProperty(o(n),Lf,{writable:!0,value:null}),Object.defineProperty(o(n),jf,{writable:!0,value:null}),Object.defineProperty(o(n),Ff,{writable:!0,value:0}),Object.defineProperty(o(n),Nf,{writable:!0,value:null}),Object.defineProperty(o(n),Bf,{writable:!0,value:null}),Object.defineProperty(o(n),Hf,{writable:!0,value:null}),Object.defineProperty(o(n),zf,{writable:!0,value:!1}),Object.defineProperty(o(n),Gf,{writable:!0,value:null}),Object.defineProperty(o(n),Uf,{writable:!0,value:void 0}),Object.defineProperty(o(n),Vf,{writable:!0,value:null}),Object.defineProperty(o(n),Wf,{writable:!0,value:""}),Object.defineProperty(o(n),qf,{writable:!0,value:void 0}),Object.defineProperty(o(n),Xf,{writable:!0,value:""}),n.color=e.color||i._defaultColor,b(o(n),qf)[qf]=e.thickness||i._defaultThickness,b(o(n),Uf)[Uf]=e.opacity||i._defaultOpacity,b(o(n),Zf)[Zf]=e.boxes||null,b(o(n),Xf)[Xf]=e.methodOfCreation||"",b(o(n),Wf)[Wf]=e.text||"",n._isDraggable=!1,n.defaultL10nId="pdfjs-editor-highlight-editor",e.highlightId>-1?(b(o(n),zf)[zf]=!0,b(o(n),Kf)[Kf](e),b(o(n),tp)[tp]()):b(o(n),Zf)[Zf]&&(b(o(n),Tf)[Tf]=e.anchorNode,b(o(n),Rf)[Rf]=e.anchorOffset,b(o(n),jf)[jf]=e.focusNode,b(o(n),Ff)[Ff]=e.focusOffset,b(o(n),Yf)[Yf](),b(o(n),tp)[tp](),n.rotate(n.rotation)),n.annotationElementId||n._uiManager.a11yAlert("pdfjs-editor-highlight-added-alert"),n}return(0,A.Z)(i,[{key:"telemetryInitialData",get:function(){return{action:"added",type:b(this,zf)[zf]?"free_highlight":"highlight",color:this._uiManager.highlightColorNames.get(this.color),thickness:b(this,qf)[qf],methodOfCreation:b(this,Xf)[Xf]}}},{key:"telemetryFinalData",get:function(){return{type:"highlight",color:this._uiManager.highlightColorNames.get(this.color)}}},{key:"translateInPage",value:function(e,t){}},{key:"toolbarPosition",get:function(){return b(this,Gf)[Gf]}},{key:"updateParams",value:function(e,t){switch(e){case Y.HIGHLIGHT_COLOR:b(this,Qf)[Qf](t);break;case Y.HIGHLIGHT_THICKNESS:b(this,Jf)[Jf](t)}}},{key:"propertiesToUpdate",get:function(){return[[Y.HIGHLIGHT_COLOR,this.color||i._defaultColor],[Y.HIGHLIGHT_THICKNESS,b(this,qf)[qf]||i._defaultThickness],[Y.HIGHLIGHT_FREE,b(this,zf)[zf]]]}},{key:"toolbarButtons",get:function(){return this._uiManager.highlightColors?[["colorPicker",b(this,Df)[Df]=new xf({editor:this})]]:a(n(i.prototype),"toolbarButtons",this)}},{key:"disableEditing",value:function(){a(n(i.prototype),"disableEditing",this).call(this),this.div.classList.toggle("disabled",!0)}},{key:"enableEditing",value:function(){a(n(i.prototype),"enableEditing",this).call(this),this.div.classList.toggle("disabled",!1)}},{key:"fixAndSetPosition",value:function(){return a(n(i.prototype),"fixAndSetPosition",this).call(this,b(this,ap)[ap]())}},{key:"getBaseTranslation",value:function(){return[0,0]}},{key:"getRect",value:function(e,t){return a(n(i.prototype),"getRect",this).call(this,e,t,b(this,ap)[ap]())}},{key:"onceAdded",value:function(e){this.annotationElementId||this.parent.addUndoableEditor(this),e&&this.div.focus()}},{key:"remove",value:function(){b(this,ep)[ep](),this._reportTelemetry({action:"deleted"}),a(n(i.prototype),"remove",this).call(this)}},{key:"rebuild",value:function(){this.parent&&(a(n(i.prototype),"rebuild",this).call(this),null!==this.div&&(b(this,tp)[tp](),this.isAttachedToDOM||this.parent.add(this)))}},{key:"setParent",value:function(e){var t=!1;if(this.parent&&!e)b(this,ep)[ep]();else if(e){var r;b(this,tp)[tp](e),t=!this.parent&&(null===(r=this.div)||void 0===r?void 0:r.classList.contains("selectedEditor"))}a(n(i.prototype),"setParent",this).call(this,e),this.show(this._isVisible),t&&this.select()}},{key:"rotate",value:function(e){var t,n=this.parent.drawLayer;b(this,zf)[zf]?(e=(e-this.rotation+360)%360,t=b(i,ip)[ip](b(this,Bf)[Bf].box,e)):t=b(i,ip)[ip]([this.x,this.y,this.width,this.height],e),n.updateProperties(b(this,Hf)[Hf],{bbox:t,root:{"data-main-rotation":e}}),n.updateProperties(b(this,Vf)[Vf],{bbox:b(i,ip)[ip](b(this,Lf)[Lf].box,e),root:{"data-main-rotation":e}})}},{key:"render",value:function(){if(this.div)return this.div;var e=a(n(i.prototype),"render",this).call(this);b(this,Wf)[Wf]&&(e.setAttribute("aria-label",b(this,Wf)[Wf]),e.setAttribute("role","mark")),b(this,zf)[zf]?e.classList.add("free"):this.div.addEventListener("keydown",b(this,np)[np].bind(this),{signal:this._uiManager._signal});var t=b(this,Nf)[Nf]=document.createElement("div");e.append(t),t.setAttribute("aria-hidden","true"),t.className="internal",t.style.clipPath=b(this,If)[If];var r=(0,c.Z)(this.parentDimensions,2),s=r[0],o=r[1];return this.setDims(this.width*s,this.height*o),Wt(this,b(this,Nf)[Nf],["pointerover","pointerleave"]),this.enableEditing(),e}},{key:"pointerover",value:function(){var e;this.isSelected||(null===(e=this.parent)||void 0===e||e.drawLayer.updateProperties(b(this,Vf)[Vf],{rootClass:{hovered:!0}}))}},{key:"pointerleave",value:function(){var e;this.isSelected||(null===(e=this.parent)||void 0===e||e.drawLayer.updateProperties(b(this,Vf)[Vf],{rootClass:{hovered:!1}}))}},{key:"_moveCaret",value:function(e){switch(this.parent.unselect(this),e){case 0:case 2:b(this,rp)[rp](!0);break;case 1:case 3:b(this,rp)[rp](!1)}}},{key:"select",value:function(){var e;a(n(i.prototype),"select",this).call(this),b(this,Vf)[Vf]&&(null===(e=this.parent)||void 0===e||e.drawLayer.updateProperties(b(this,Vf)[Vf],{rootClass:{hovered:!1,selected:!0}}))}},{key:"unselect",value:function(){var e;a(n(i.prototype),"unselect",this).call(this),b(this,Vf)[Vf]&&(null===(e=this.parent)||void 0===e||e.drawLayer.updateProperties(b(this,Vf)[Vf],{rootClass:{selected:!1}}),b(this,zf)[zf]||b(this,rp)[rp](!1))}},{key:"_mustFixPosition",get:function(){return!b(this,zf)[zf]}},{key:"show",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._isVisible;a(n(i.prototype),"show",this).call(this,e),this.parent&&(this.parent.drawLayer.updateProperties(b(this,Hf)[Hf],{rootClass:{hidden:!e}}),this.parent.drawLayer.updateProperties(b(this,Vf)[Vf],{rootClass:{hidden:!e}}))}},{key:"serialize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.isEmpty()||e)return null;if(this.deleted)return this.serializeDeleted();var t=this.getRect(0,0),i=wa._colorManager.convert(this.color),n={annotationType:X.HIGHLIGHT,color:i,opacity:b(this,Uf)[Uf],thickness:b(this,qf)[qf],quadPoints:b(this,sp)[sp](),outlines:b(this,op)[op](t),pageIndex:this.pageIndex,rect:t,rotation:b(this,ap)[ap](),structTreeParentId:this._structTreeParentId};return this.annotationElementId&&!b(this,hp)[hp](n)?null:(n.id=this.annotationElementId,n)}},{key:"renderAnnotationElement",value:function(e){return e.updateEdited({rect:this.getRect(0,0)}),null}}],[{key:"_keyboardManager",get:function(){var e=i.prototype;return Ee(this,"_keyboardManager",new li([[["ArrowLeft","mac+ArrowLeft"],e._moveCaret,{args:[0]}],[["ArrowRight","mac+ArrowRight"],e._moveCaret,{args:[1]}],[["ArrowUp","mac+ArrowUp"],e._moveCaret,{args:[2]}],[["ArrowDown","mac+ArrowDown"],e._moveCaret,{args:[3]}]]))}},{key:"computeTelemetryFinalData",value:function(e){return{numberOfColors:e.get("color").size}}},{key:"initialize",value:function(e,t){var n;wa.initialize(e,t),i._defaultColor||(i._defaultColor=(null===(n=t.highlightColors)||void 0===n?void 0:n.values().next().value)||"#fff066")}},{key:"updateDefaultParams",value:function(e,t){switch(e){case Y.HIGHLIGHT_DEFAULT_COLOR:i._defaultColor=t;break;case Y.HIGHLIGHT_THICKNESS:i._defaultThickness=t}}},{key:"defaultPropertiesToUpdate",get:function(){return[[Y.HIGHLIGHT_DEFAULT_COLOR,i._defaultColor],[Y.HIGHLIGHT_THICKNESS,i._defaultThickness]]}},{key:"startHighlighting",value:function(e,t,i){var n=this,r=i.target,a=i.x,s=i.y,o=r.getBoundingClientRect(),l=o.x,u=o.y,h=o.width,c=o.height,d=new AbortController,v=e.combinedSignal(d),f=function(t){d.abort(),b(n,up)[up](e,t)};window.addEventListener("blur",f,{signal:v}),window.addEventListener("pointerup",f,{signal:v}),window.addEventListener("pointerdown",ut,{capture:!0,passive:!1,signal:v}),window.addEventListener("contextmenu",lt,{signal:v}),r.addEventListener("pointermove",b(this,lp)[lp].bind(this,e),{signal:v}),this._freeHighlight=new rf({x:a,y:s},[l,u,h,c],e.scale,this._defaultThickness/2,t,.001);var p=e.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:this._defaultColor,"fill-opacity":this._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:this._freeHighlight.toSVGPath()}},!0,!0);this._freeHighlightId=p.id,this._freeHighlightClipId=p.clipPathId}},{key:"deserialize",value:function(){var e=(0,d.Z)((0,h.Z)().mark((function e(t,r,s){var o,l,d,v,f,p,g,y,m,w,k,A,_,x,P,S,E,C,O,M,T,R,Z,I,D,L,j,F,N,B,H,z,G,U,V,W,q,Y,K,Q,J,$,ee;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=null,t instanceof ud?(d=(l=t).data,v=d.quadPoints,f=d.rect,p=d.rotation,g=d.id,y=d.color,m=d.opacity,w=d.popupRef,k=l.parent.page.pageNumber,o=t={annotationType:X.HIGHLIGHT,color:Array.from(y),opacity:m,quadPoints:v,boxes:null,pageIndex:k-1,rect:f.slice(0),rotation:p,annotationElementId:g,id:g,deleted:!1,popupRef:w}):t instanceof od&&(_=(A=t).data,x=_.inkLists,P=_.rect,S=_.rotation,E=_.id,C=_.color,O=_.borderStyle.rawWidth,M=_.popupRef,T=A.parent.page.pageNumber,o=t={annotationType:X.HIGHLIGHT,color:Array.from(C),thickness:O,inkLists:x,boxes:null,pageIndex:T-1,rect:P.slice(0),rotation:S,annotationElementId:E,id:E,deleted:!1,popupRef:M}),Z=(R=t).color,I=R.quadPoints,D=R.inkLists,L=R.opacity,e.next=5,a(n(i),"deserialize",this).call(this,t,r,s);case 5:if((j=e.sent).color=He.makeHexColor.apply(He,(0,u.Z)(Z)),b(j,Uf)[Uf]=L||1,D&&(b(j,qf)[qf]=t.thickness),j._initialData=o,F=(0,c.Z)(j.pageDimensions,2),N=F[0],B=F[1],H=(0,c.Z)(j.pageTranslation,2),z=H[0],G=H[1],I){for(U=b(j,Zf)[Zf]=[],V=0;V<I.length;V+=8)U.push({x:(I[V]-z)/N,y:1-(I[V+1]-G)/B,width:(I[V+2]-I[V])/N,height:(I[V+1]-I[V+5])/B});b(j,Yf)[Yf](),b(j,tp)[tp](),j.rotate(j.rotation)}else if(D){for(b(j,zf)[zf]=!0,W=D[0],q={x:W[0]-z,y:B-(W[1]-G)},Y=new rf(q,[0,0,N,B],1,b(j,qf)[qf]/2,!0,.001),K=0,Q=W.length;K<Q;K+=2)q.x=W[K]-z,q.y=B-(W[K+1]-G),Y.add(q);J=r.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:j.color,"fill-opacity":j._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:Y.toSVGPath()}},!0,!0),$=J.id,ee=J.clipPathId,b(j,Kf)[Kf]({highlightOutlines:Y.getOutlines(),highlightId:$,clipPathId:ee}),b(j,tp)[tp](),j.rotate(j.parentRotation)}return e.abrupt("return",j);case 14:case"end":return e.stop()}}),e,this)})));return function(t,i,n){return e.apply(this,arguments)}}()},{key:"canCreateNewEmptyEditor",value:function(){return!1}}]),i}(wa);function dp(){var e=new Xv(b(this,Zf)[Zf],.001);b(this,Bf)[Bf]=e.getOutlines();var t=(0,c.Z)(b(this,Bf)[Bf].box,4);this.x=t[0],this.y=t[1],this.width=t[2],this.height=t[3];var i=new Xv(b(this,Zf)[Zf],.0025,.001,"ltr"===this._uiManager.direction);b(this,Lf)[Lf]=i.getOutlines();var n=b(this,Lf)[Lf].lastPoint;b(this,Gf)[Gf]=[(n[0]-this.x)/this.width,(n[1]-this.y)/this.height]}function vp(e){var t=e.highlightOutlines,i=e.highlightId,n=e.clipPathId;b(this,Bf)[Bf]=t;if(b(this,Lf)[Lf]=t.getNewOutline(b(this,qf)[qf]/2+1.5,.0025),i>=0)b(this,Hf)[Hf]=i,b(this,If)[If]=n,this.parent.drawLayer.finalizeDraw(i,{bbox:t.box,path:{d:t.toSVGPath()}}),b(this,Vf)[Vf]=this.parent.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:!0},bbox:b(this,Lf)[Lf].box,path:{d:b(this,Lf)[Lf].toSVGPath()}},!0);else if(this.parent){var r=this.parent.viewport.rotation;this.parent.drawLayer.updateProperties(b(this,Hf)[Hf],{bbox:b(cp,ip)[ip](b(this,Bf)[Bf].box,(r-this.rotation+360)%360),path:{d:t.toSVGPath()}}),this.parent.drawLayer.updateProperties(b(this,Vf)[Vf],{bbox:b(cp,ip)[ip](b(this,Lf)[Lf].box,r),path:{d:b(this,Lf)[Lf].toSVGPath()}})}var a=(0,c.Z)(t.box,4),s=a[0],o=a[1],l=a[2],u=a[3];switch(this.rotation){case 0:this.x=s,this.y=o,this.width=l,this.height=u;break;case 90:var h=(0,c.Z)(this.parentDimensions,2),d=h[0],v=h[1];this.x=o,this.y=1-s,this.width=l*v/d,this.height=u*d/v;break;case 180:this.x=1-s,this.y=1-o,this.width=l,this.height=u;break;case 270:var f=(0,c.Z)(this.parentDimensions,2),p=f[0],g=f[1];this.x=1-o,this.y=s,this.width=l*g/p,this.height=u*p/g}var y=b(this,Lf)[Lf].lastPoint;b(this,Gf)[Gf]=[(y[0]-s)/l,(y[1]-o)/u]}function fp(e){var t=this,i=function(e,i){var n,r;t.color=e,b(t,Uf)[Uf]=i,null===(n=t.parent)||void 0===n||n.drawLayer.updateProperties(b(t,Hf)[Hf],{root:{fill:e,"fill-opacity":i}}),null===(r=b(t,Df)[Df])||void 0===r||r.updateColor(e)},n=this.color,r=b(this,Uf)[Uf];this.addCommands({cmd:i.bind(this,e,cp._defaultOpacity),undo:i.bind(this,n,r),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Y.HIGHLIGHT_COLOR,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"color_changed",color:this._uiManager.highlightColorNames.get(e)},!0)}function pp(e){var t=this,i=b(this,qf)[qf],n=function(e){b(t,qf)[qf]=e,b(t,$f)[$f](e)};this.addCommands({cmd:n.bind(this,e),undo:n.bind(this,i),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Y.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"thickness_changed",thickness:e},!0)}function gp(e){if(b(this,zf)[zf]){b(this,Kf)[Kf]({highlightOutlines:b(this,Bf)[Bf].getNewOutline(e/2)}),this.fixAndSetPosition();var t=(0,c.Z)(this.parentDimensions,2),i=t[0],n=t[1];this.setDims(this.width*i,this.height*n)}}function yp(){null!==b(this,Hf)[Hf]&&this.parent&&(this.parent.drawLayer.remove(b(this,Hf)[Hf]),b(this,Hf)[Hf]=null,this.parent.drawLayer.remove(b(this,Vf)[Vf]),b(this,Vf)[Vf]=null)}function mp(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.parent;if(null===b(this,Hf)[Hf]){var t=e.drawLayer.draw({bbox:b(this,Bf)[Bf].box,root:{viewBox:"0 0 1 1",fill:this.color,"fill-opacity":b(this,Uf)[Uf]},rootClass:{highlight:!0,free:b(this,zf)[zf]},path:{d:b(this,Bf)[Bf].toSVGPath()}},!1,!0);b(this,Hf)[Hf]=t.id,b(this,If)[If]=t.clipPathId,b(this,Vf)[Vf]=e.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:b(this,zf)[zf]},bbox:b(this,Lf)[Lf].box,path:{d:b(this,Lf)[Lf].toSVGPath()}},b(this,zf)[zf]),b(this,Nf)[Nf]&&(b(this,Nf)[Nf].style.clipPath=b(this,If)[If])}}function bp(e){cp._keyboardManager.exec(this,e)}function wp(e){if(b(this,Tf)[Tf]){var t=window.getSelection();e?t.setPosition(b(this,Tf)[Tf],b(this,Rf)[Rf]):t.setPosition(b(this,jf)[jf],b(this,Ff)[Ff])}}function kp(){return b(this,zf)[zf]?this.rotation:0}function Ap(){if(b(this,zf)[zf])return null;var e,t=(0,c.Z)(this.pageDimensions,2),i=t[0],n=t[1],r=(0,c.Z)(this.pageTranslation,2),a=r[0],s=r[1],o=b(this,Zf)[Zf],l=new Float32Array(8*o.length),u=0,h=(0,v.Z)(o);try{for(h.s();!(e=h.n()).done;){var d=e.value,f=d.x,p=d.y,g=d.width,y=d.height,m=f*i+a,w=(1-p)*n+s;l[u]=l[u+4]=m,l[u+1]=l[u+3]=w,l[u+2]=l[u+6]=m+g*i,l[u+5]=l[u+7]=w-y*n,u+=8}}catch(k){h.e(k)}finally{h.f()}return l}function _p(e){return b(this,Bf)[Bf].serialize(e,b(this,ap)[ap]())}function xp(e){var t=this._initialData.color;return e.color.some((function(e,i){return e!==t[i]}))}Object.defineProperty(cp,up,{value:function(e,t){this._freeHighlight.isEmpty()?e.drawLayer.remove(this._freeHighlightId):e.createAndAddNewEditor(t,!1,{highlightId:this._freeHighlightId,highlightOutlines:this._freeHighlight.getOutlines(),clipPathId:this._freeHighlightClipId,methodOfCreation:"main_toolbar"}),this._freeHighlightId=-1,this._freeHighlight=null,this._freeHighlightClipId=""}}),Object.defineProperty(cp,lp,{value:function(e,t){this._freeHighlight.add(t)&&e.drawLayer.updateProperties(this._freeHighlightId,{path:{d:this._freeHighlight.toSVGPath()}})}}),Object.defineProperty(cp,ip,{value:function(e,t){var i=(0,c.Z)(e,4),n=i[0],r=i[1],a=i[2],s=i[3];switch(t){case 90:return[1-r-s,n,s,a];case 180:return[1-n-a,1-r-s,a,s];case 270:return[r,1-n-a,s,a]}return[n,r,a,s]}}),cp._defaultColor=null,cp._defaultOpacity=1,cp._defaultThickness=12,cp._type="highlight",cp._editorType=X.HIGHLIGHT,cp._freeHighlightId=-1,cp._freeHighlight=null,cp._freeHighlightClipId="";var Pp=k("svgProperties"),Sp=function(){function e(){(0,_.Z)(this,e),Object.defineProperty(this,Pp,{writable:!0,value:Object.create(null)})}return(0,A.Z)(e,[{key:"updateProperty",value:function(e,t){this[e]=t,this.updateSVGProperty(e,t)}},{key:"updateProperties",value:function(e){if(e)for(var t=0,i=Object.entries(e);t<i.length;t++){var n=(0,c.Z)(i[t],2),r=n[0],a=n[1];r.startsWith("_")||this.updateProperty(r,a)}}},{key:"updateSVGProperty",value:function(e,t){b(this,Pp)[Pp][e]=t}},{key:"toSVGProperties",value:function(){var e=b(this,Pp)[Pp];return b(this,Pp)[Pp]=Object.create(null),{root:e}}},{key:"reset",value:function(){b(this,Pp)[Pp]=Object.create(null)}},{key:"updateAll",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this;this.updateProperties(e)}},{key:"clone",value:function(){Ae("Not implemented")}}]),e}(),Ep=k("drawOutlines"),Cp=k("mustBeCommitted"),Op=k("currentDraw"),Mp=k("currentDrawingAC"),Tp=k("currentDrawingOptions"),Rp=k("currentPointerId"),Zp=k("currentPointerType"),Ip=k("currentPointerIds"),Dp=k("currentMoveTimestamp"),Lp=k("createDrawOutlines"),jp=k("createDrawing"),Fp=k("cleanDrawLayer"),Np=k("addToDrawLayer"),Bp=k("convertToParentSpace"),Hp=k("convertToDrawSpace"),zp=k("updateBbox"),Gp=k("rotateBox"),Up=function(e){P(i,e);var t=R(i);function i(e){var n;return(0,_.Z)(this,i),n=t.call(this,e),Object.defineProperty(o(n),Gp,{value:Jp}),Object.defineProperty(o(n),zp,{value:Qp}),Object.defineProperty(o(n),Hp,{value:Kp}),Object.defineProperty(o(n),Bp,{value:Yp}),Object.defineProperty(o(n),Np,{value:Xp}),Object.defineProperty(o(n),Fp,{value:qp}),Object.defineProperty(o(n),jp,{value:Wp}),Object.defineProperty(o(n),Lp,{value:Vp}),Object.defineProperty(o(n),Ep,{writable:!0,value:null}),Object.defineProperty(o(n),Cp,{writable:!0,value:void 0}),n._drawId=null,b(o(n),Cp)[Cp]=e.mustBeCommitted||!1,n._addOutlines(e),n}return(0,A.Z)(i,[{key:"_addOutlines",value:function(e){e.drawOutlines&&(b(this,Lp)[Lp](e),b(this,Np)[Np]())}},{key:"updateParams",value:function(e,t){var i=this.constructor.typesMap.get(e);i&&this._updateProperty(e,i,t)}},{key:"propertiesToUpdate",get:function(){var e,t=[],i=this._drawingOptions,n=(0,v.Z)(this.constructor.typesMap);try{for(n.s();!(e=n.n()).done;){var r=(0,c.Z)(e.value,2),a=r[0],s=r[1];t.push([a,i[s]])}}catch(o){n.e(o)}finally{n.f()}return t}},{key:"_updateProperty",value:function(e,t,i){var n=this,r=this._drawingOptions,a=r[t],s=function(e){var i;r.updateProperty(t,e);var a=b(n,Ep)[Ep].updateProperty(t,e);a&&b(n,zp)[zp](a),null===(i=n.parent)||void 0===i||i.drawLayer.updateProperties(n._drawId,r.toSVGProperties())};this.addCommands({cmd:s.bind(this,i),undo:s.bind(this,a),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:e,overwriteIfSameType:!0,keepUndo:!0})}},{key:"_onResizing",value:function(){var e;null===(e=this.parent)||void 0===e||e.drawLayer.updateProperties(this._drawId,i._mergeSVGProperties(b(this,Ep)[Ep].getPathResizingSVGProperties(b(this,Hp)[Hp]()),{bbox:b(this,Gp)[Gp]()}))}},{key:"_onResized",value:function(){var e;null===(e=this.parent)||void 0===e||e.drawLayer.updateProperties(this._drawId,i._mergeSVGProperties(b(this,Ep)[Ep].getPathResizedSVGProperties(b(this,Hp)[Hp]()),{bbox:b(this,Gp)[Gp]()}))}},{key:"_onTranslating",value:function(e,t){var i;null===(i=this.parent)||void 0===i||i.drawLayer.updateProperties(this._drawId,{bbox:b(this,Gp)[Gp]()})}},{key:"_onTranslated",value:function(){var e;null===(e=this.parent)||void 0===e||e.drawLayer.updateProperties(this._drawId,i._mergeSVGProperties(b(this,Ep)[Ep].getPathTranslatedSVGProperties(b(this,Hp)[Hp](),this.parentDimensions),{bbox:b(this,Gp)[Gp]()}))}},{key:"_onStartDragging",value:function(){var e;null===(e=this.parent)||void 0===e||e.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!0}})}},{key:"_onStopDragging",value:function(){var e;null===(e=this.parent)||void 0===e||e.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!1}})}},{key:"commit",value:function(){a(n(i.prototype),"commit",this).call(this),this.disableEditMode(),this.disableEditing()}},{key:"disableEditing",value:function(){a(n(i.prototype),"disableEditing",this).call(this),this.div.classList.toggle("disabled",!0)}},{key:"enableEditing",value:function(){a(n(i.prototype),"enableEditing",this).call(this),this.div.classList.toggle("disabled",!1)}},{key:"getBaseTranslation",value:function(){return[0,0]}},{key:"isResizable",get:function(){return!0}},{key:"onceAdded",value:function(e){this.annotationElementId||this.parent.addUndoableEditor(this),this._isDraggable=!0,b(this,Cp)[Cp]&&(b(this,Cp)[Cp]=!1,this.commit(),this.parent.setSelected(this),e&&this.isOnScreen&&this.div.focus())}},{key:"remove",value:function(){b(this,Fp)[Fp](),a(n(i.prototype),"remove",this).call(this)}},{key:"rebuild",value:function(){this.parent&&(a(n(i.prototype),"rebuild",this).call(this),null!==this.div&&(b(this,Np)[Np](),b(this,zp)[zp](b(this,Ep)[Ep].box),this.isAttachedToDOM||this.parent.add(this)))}},{key:"setParent",value:function(e){var t=!1;if(this.parent&&!e)this._uiManager.removeShouldRescale(this),b(this,Fp)[Fp]();else if(e){var r;this._uiManager.addShouldRescale(this),b(this,Np)[Np](e),t=!this.parent&&(null===(r=this.div)||void 0===r?void 0:r.classList.contains("selectedEditor"))}a(n(i.prototype),"setParent",this).call(this,e),t&&this.select()}},{key:"rotate",value:function(){this.parent&&this.parent.drawLayer.updateProperties(this._drawId,i._mergeSVGProperties({bbox:b(this,Gp)[Gp]()},b(this,Ep)[Ep].updateRotation((this.parentRotation-this.rotation+360)%360)))}},{key:"onScaleChanging",value:function(){this.parent&&b(this,zp)[zp](b(this,Ep)[Ep].updateParentDimensions(this.parentDimensions,this.parent.scale))}},{key:"render",value:function(){if(this.div)return this.div;var e,t;this._isCopy&&(e=this.x,t=this.y);var r=a(n(i.prototype),"render",this).call(this);r.classList.add("draw");var s=document.createElement("div");r.append(s),s.setAttribute("aria-hidden","true"),s.className="internal";var o=(0,c.Z)(this.parentDimensions,2),l=o[0],u=o[1];return this.setDims(this.width*l,this.height*u),this._uiManager.addShouldRescale(this),this.disableEditing(),this._isCopy&&this._moveAfterPaste(e,t),r}},{key:"createDrawingOptions",value:function(e){}},{key:"serializeDraw",value:function(e){var t=(0,c.Z)(this.pageTranslation,2),i=t[0],n=t[1],r=(0,c.Z)(this.pageDimensions,2),a=r[0],s=r[1];return b(this,Ep)[Ep].serialize([i,n,a,s],e)}},{key:"renderAnnotationElement",value:function(e){return e.updateEdited({rect:this.getRect(0,0)}),null}}],[{key:"_mergeSVGProperties",value:function(e,t){for(var i=new Set(Object.keys(e)),n=0,r=Object.entries(t);n<r.length;n++){var a=(0,c.Z)(r[n],2),s=a[0],o=a[1];i.has(s)?Object.assign(e[s],o):e[s]=o}return e}},{key:"getDefaultDrawingOptions",value:function(e){Ae("Not implemented")}},{key:"typesMap",get:function(){Ae("Not implemented")}},{key:"isDrawer",get:function(){return!0}},{key:"supportMultipleDrawings",get:function(){return!1}},{key:"updateDefaultParams",value:function(e,t){var n=this.typesMap.get(e);n&&this._defaultDrawingOptions.updateProperty(n,t),this._currentParent&&(b(i,Op)[Op].updateProperty(n,t),this._currentParent.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}},{key:"defaultPropertiesToUpdate",get:function(){var e,t=[],i=this._defaultDrawingOptions,n=(0,v.Z)(this.typesMap);try{for(n.s();!(e=n.n()).done;){var r=(0,c.Z)(e.value,2),a=r[0],s=r[1];t.push([a,i[s]])}}catch(o){n.e(o)}finally{n.f()}return t}},{key:"onScaleChangingWhenDrawing",value:function(){}},{key:"createDrawerInstance",value:function(e,t,i,n,r){Ae("Not implemented")}},{key:"startDrawing",value:function(e,t,n,r){var a,s,o,l,u=this,h=r.target,c=r.offsetX,d=r.offsetY,v=r.pointerId,f=r.pointerType;if(!b(i,Zp)[Zp]||b(i,Zp)[Zp]===f){var p=e.viewport.rotation,g=h.getBoundingClientRect(),y=g.width,m=g.height,w=b(i,Mp)[Mp]=new AbortController,k=e.combinedSignal(w);if((a=b(i,Rp))[Rp]||(a[Rp]=v),null!==(o=(s=b(i,Zp))[Zp])&&void 0!==o||(s[Zp]=f),window.addEventListener("pointerup",(function(e){var t;b(i,Rp)[Rp]===e.pointerId?u._endDraw(e):null===(t=b(i,Ip)[Ip])||void 0===t||t.delete(e.pointerId)}),{signal:k}),window.addEventListener("pointercancel",(function(e){var t;b(i,Rp)[Rp]===e.pointerId?u._currentParent.endDrawingSession():null===(t=b(i,Ip)[Ip])||void 0===t||t.delete(e.pointerId)}),{signal:k}),window.addEventListener("pointerdown",(function(e){var t;b(i,Zp)[Zp]===e.pointerType&&(((t=b(i,Ip))[Ip]||(t[Ip]=new Set)).add(e.pointerId),b(i,Op)[Op].isCancellable()&&(b(i,Op)[Op].removeLastElement(),b(i,Op)[Op].isEmpty()?u._currentParent.endDrawingSession(!0):u._endDraw(null)))}),{capture:!0,passive:!1,signal:k}),window.addEventListener("contextmenu",lt,{signal:k}),h.addEventListener("pointermove",this._drawMove.bind(this),{signal:k}),h.addEventListener("touchmove",(function(e){e.timeStamp===b(i,Dp)[Dp]&&ut(e)}),{signal:k}),e.toggleDrawing(),null===(l=t._editorUndoBar)||void 0===l||l.hide(),b(i,Op)[Op])e.drawLayer.updateProperties(this._currentDrawId,b(i,Op)[Op].startNew(c,d,y,m,p));else{t.updateUIForDefaultProperties(this),b(i,Op)[Op]=this.createDrawerInstance(c,d,y,m,p),b(i,Tp)[Tp]=this.getDefaultDrawingOptions(),this._currentParent=e;var A=e.drawLayer.draw(this._mergeSVGProperties(b(i,Tp)[Tp].toSVGProperties(),b(i,Op)[Op].defaultSVGProperties),!0,!1);this._currentDrawId=A.id}}}},{key:"_drawMove",value:function(e){var t;if(b(i,Dp)[Dp]=-1,b(i,Op)[Op]){var n=e.offsetX,r=e.offsetY,a=e.pointerId;b(i,Rp)[Rp]===a&&((null===(t=b(i,Ip)[Ip])||void 0===t?void 0:t.size)>=1?this._endDraw(e):(this._currentParent.drawLayer.updateProperties(this._currentDrawId,b(i,Op)[Op].add(n,r)),b(i,Dp)[Dp]=e.timeStamp,ut(e)))}}},{key:"_cleanup",value:function(e){e&&(this._currentDrawId=-1,this._currentParent=null,b(i,Op)[Op]=null,b(i,Tp)[Tp]=null,b(i,Zp)[Zp]=null,b(i,Dp)[Dp]=NaN),b(i,Mp)[Mp]&&(b(i,Mp)[Mp].abort(),b(i,Mp)[Mp]=null,b(i,Rp)[Rp]=NaN,b(i,Ip)[Ip]=null)}},{key:"_endDraw",value:function(e){var t=this._currentParent;if(t)if(t.toggleDrawing(!0),this._cleanup(!1),(null===e||void 0===e?void 0:e.target)===t.div&&t.drawLayer.updateProperties(this._currentDrawId,b(i,Op)[Op].end(e.offsetX,e.offsetY)),this.supportMultipleDrawings){var n=b(i,Op)[Op],r=this._currentDrawId,a=n.getLastElement();t.addCommands({cmd:function(){t.drawLayer.updateProperties(r,n.setLastElement(a))},undo:function(){t.drawLayer.updateProperties(r,n.removeLastElement())},mustExec:!1,type:Y.DRAW_STEP})}else this.endDrawing(!1)}},{key:"endDrawing",value:function(e){var t=this._currentParent;if(!t)return null;if(t.toggleDrawing(!0),t.cleanUndoStack(Y.DRAW_STEP),!b(i,Op)[Op].isEmpty()){var n=(0,c.Z)(t.pageDimensions,2),r=n[0],a=n[1],s=t.scale,o=t.createAndAddNewEditor({offsetX:0,offsetY:0},!1,{drawId:this._currentDrawId,drawOutlines:b(i,Op)[Op].getOutlines(r*s,a*s,s,this._INNER_MARGIN),drawingOptions:b(i,Tp)[Tp],mustBeCommitted:!e});return this._cleanup(!0),o}return t.drawLayer.remove(this._currentDrawId),this._cleanup(!0),null}},{key:"deserializeDraw",value:function(e,t,i,n,r,a){Ae("Not implemented")}},{key:"deserialize",value:function(){var e=(0,d.Z)((0,h.Z)().mark((function e(t,r,s){var o,l,u,c,d,v,f;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=r.viewport.rawDims,l=o.pageWidth,u=o.pageHeight,c=o.pageX,d=o.pageY,v=this.deserializeDraw(c,d,l,u,this._INNER_MARGIN,t),e.next=4,a(n(i),"deserialize",this).call(this,t,r,s);case 4:return(f=e.sent).createDrawingOptions(t),b(f,Lp)[Lp]({drawOutlines:v}),b(f,Np)[Np](),f.onScaleChanging(),f.rotate(),e.abrupt("return",f);case 11:case"end":return e.stop()}}),e,this)})));return function(t,i,n){return e.apply(this,arguments)}}()},{key:"canCreateNewEmptyEditor",value:function(){return!1}}]),i}(wa);function Vp(e){var t=e.drawOutlines,i=e.drawId,n=e.drawingOptions;b(this,Ep)[Ep]=t,this._drawingOptions||(this._drawingOptions=n),this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-".concat(this.editorType,"-added-alert")),i>=0?(this._drawId=i,this.parent.drawLayer.finalizeDraw(i,t.defaultProperties)):this._drawId=b(this,jp)[jp](t,this.parent),b(this,zp)[zp](t.box)}function Wp(e,t){return t.drawLayer.draw(Up._mergeSVGProperties(this._drawingOptions.toSVGProperties(),e.defaultSVGProperties),!1,!1).id}function qp(){null!==this._drawId&&this.parent&&(this.parent.drawLayer.remove(this._drawId),this._drawId=null,this._drawingOptions.reset())}function Xp(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.parent;null!==this._drawId&&this.parent===e||(null===this._drawId?(this._drawingOptions.updateAll(),this._drawId=b(this,jp)[jp](b(this,Ep)[Ep],e)):this.parent.drawLayer.updateParent(this._drawId,e.drawLayer))}function Yp(e){var t=(0,c.Z)(e,4),i=t[0],n=t[1],r=t[2],a=t[3],s=(0,c.Z)(this.parentDimensions,2),o=s[0],l=s[1];switch(this.rotation){case 90:return[n,1-i,r*(l/o),a*(o/l)];case 180:return[1-i,1-n,r,a];case 270:return[1-n,i,r*(l/o),a*(o/l)];default:return[i,n,r,a]}}function Kp(){var e=this.x,t=this.y,i=this.width,n=this.height,r=(0,c.Z)(this.parentDimensions,2),a=r[0],s=r[1];switch(this.rotation){case 90:return[1-t,e,i*(a/s),n*(s/a)];case 180:return[1-e,1-t,i,n];case 270:return[t,1-e,i*(a/s),n*(s/a)];default:return[e,t,i,n]}}function Qp(e){var t=b(this,Bp)[Bp](e),i=(0,c.Z)(t,4);if(this.x=i[0],this.y=i[1],this.width=i[2],this.height=i[3],this.div){this.fixAndSetPosition();var n=(0,c.Z)(this.parentDimensions,2),r=n[0],a=n[1];this.setDims(this.width*r,this.height*a)}this._onResized()}function Jp(){var e=this.x,t=this.y,i=this.width,n=this.height,r=this.rotation,a=this.parentRotation,s=(0,c.Z)(this.parentDimensions,2),o=s[0],l=s[1];switch((4*r+a)/90){case 1:return[1-t-n,e,n,i];case 2:return[1-e-i,1-t-n,i,n];case 3:return[t,1-e-i,n,i];case 4:return[e,t-i*(o/l),n*(l/o),i*(o/l)];case 5:return[1-t,e,i*(o/l),n*(l/o)];case 6:return[1-e-n*(l/o),1-t,n*(l/o),i*(o/l)];case 7:return[t-i*(o/l),1-e-n*(l/o),i*(o/l),n*(l/o)];case 8:return[e-i,t-n,i,n];case 9:return[1-t,e-i,n,i];case 10:return[1-e,1-t,i,n];case 11:return[t-n,1-e,n,i];case 12:return[e-n*(l/o),t,n*(l/o),i*(o/l)];case 13:return[1-t-i*(o/l),e-n*(l/o),i*(o/l),n*(l/o)];case 14:return[1-e,1-t-i*(o/l),n*(l/o),i*(o/l)];case 15:return[t,1-e,i*(o/l),n*(l/o)];default:return[e,t,i,n]}}Up._currentDrawId=-1,Up._currentParent=null,Object.defineProperty(Up,Op,{writable:!0,value:null}),Object.defineProperty(Up,Mp,{writable:!0,value:null}),Object.defineProperty(Up,Tp,{writable:!0,value:null}),Object.defineProperty(Up,Rp,{writable:!0,value:NaN}),Object.defineProperty(Up,Zp,{writable:!0,value:null}),Object.defineProperty(Up,Ip,{writable:!0,value:null}),Object.defineProperty(Up,Dp,{writable:!0,value:NaN}),Up._INNER_MARGIN=3;var $p=k("last"),eg=k("line"),tg=k("lines"),ig=k("rotation"),ng=k("thickness"),rg=k("points"),ag=k("lastSVGPath"),sg=k("lastIndex"),og=k("outlines"),lg=k("parentWidth"),ug=k("parentHeight"),hg=k("normalizePoint"),cg=function(){function e(t,i,n,r,a,s){(0,_.Z)(this,e),Object.defineProperty(this,hg,{value:dg}),Object.defineProperty(this,$p,{writable:!0,value:new Float64Array(6)}),Object.defineProperty(this,eg,{writable:!0,value:void 0}),Object.defineProperty(this,tg,{writable:!0,value:void 0}),Object.defineProperty(this,ig,{writable:!0,value:void 0}),Object.defineProperty(this,ng,{writable:!0,value:void 0}),Object.defineProperty(this,rg,{writable:!0,value:void 0}),Object.defineProperty(this,ag,{writable:!0,value:""}),Object.defineProperty(this,sg,{writable:!0,value:0}),Object.defineProperty(this,og,{writable:!0,value:new Sg}),Object.defineProperty(this,lg,{writable:!0,value:void 0}),Object.defineProperty(this,ug,{writable:!0,value:void 0}),b(this,lg)[lg]=n,b(this,ug)[ug]=r,b(this,ig)[ig]=a,b(this,ng)[ng]=s;var o=b(this,hg)[hg](t,i),l=(0,c.Z)(o,2);t=l[0],i=l[1];var u=b(this,eg)[eg]=[NaN,NaN,NaN,NaN,t,i];b(this,rg)[rg]=[t,i],b(this,tg)[tg]=[{line:u,points:b(this,rg)[rg]}],b(this,$p)[$p].set(u,0)}return(0,A.Z)(e,[{key:"updateProperty",value:function(e,t){"stroke-width"===e&&(b(this,ng)[ng]=t)}},{key:"isEmpty",value:function(){return!b(this,tg)[tg]||0===b(this,tg)[tg].length}},{key:"isCancellable",value:function(){return b(this,rg)[rg].length<=10}},{key:"add",value:function(e,t){var i,n=b(this,hg)[hg](e,t),r=(0,c.Z)(n,2);e=r[0],t=r[1];var a=b(this,$p)[$p].subarray(2,6),s=(0,c.Z)(a,4),o=s[0],l=s[1],h=s[2],d=s[3],v=e-h,f=t-d;return Math.hypot(b(this,lg)[lg]*v,b(this,ug)[ug]*f)<=2?null:(b(this,rg)[rg].push(e,t),isNaN(o)?(b(this,$p)[$p].set([h,d,e,t],2),b(this,eg)[eg].push(NaN,NaN,NaN,NaN,e,t),{path:{d:this.toSVGPath()}}):(isNaN(b(this,$p)[$p][0])&&b(this,eg)[eg].splice(6,6),b(this,$p)[$p].set([o,l,h,d,e,t],0),(i=b(this,eg)[eg]).push.apply(i,(0,u.Z)(Qd.createBezierPoints(o,l,h,d,e,t))),{path:{d:this.toSVGPath()}}))}},{key:"end",value:function(e,t){var i=this.add(e,t);return i||(2===b(this,rg)[rg].length?{path:{d:this.toSVGPath()}}:null)}},{key:"startNew",value:function(e,t,i,n,r){b(this,lg)[lg]=i,b(this,ug)[ug]=n,b(this,ig)[ig]=r;var a=b(this,hg)[hg](e,t),s=(0,c.Z)(a,2);e=s[0],t=s[1];var o=b(this,eg)[eg]=[NaN,NaN,NaN,NaN,e,t];b(this,rg)[rg]=[e,t];var l=b(this,tg)[tg].at(-1);return l&&(l.line=new Float32Array(l.line),l.points=new Float32Array(l.points)),b(this,tg)[tg].push({line:o,points:b(this,rg)[rg]}),b(this,$p)[$p].set(o,0),b(this,sg)[sg]=0,this.toSVGPath(),null}},{key:"getLastElement",value:function(){return b(this,tg)[tg].at(-1)}},{key:"setLastElement",value:function(e){return b(this,tg)[tg]?(b(this,tg)[tg].push(e),b(this,eg)[eg]=e.line,b(this,rg)[rg]=e.points,b(this,sg)[sg]=0,{path:{d:this.toSVGPath()}}):b(this,og)[og].setLastElement(e)}},{key:"removeLastElement",value:function(){if(!b(this,tg)[tg])return b(this,og)[og].removeLastElement();b(this,tg)[tg].pop(),b(this,ag)[ag]="";for(var e=0,t=b(this,tg)[tg].length;e<t;e++){var i=b(this,tg)[tg][e],n=i.line,r=i.points;b(this,eg)[eg]=n,b(this,rg)[rg]=r,b(this,sg)[sg]=0,this.toSVGPath()}return{path:{d:b(this,ag)[ag]}}}},{key:"toSVGPath",value:function(){var e=Qd.svgRound(b(this,eg)[eg][4]),t=Qd.svgRound(b(this,eg)[eg][5]);if(2===b(this,rg)[rg].length)return b(this,ag)[ag]="".concat(b(this,ag)[ag]," M ").concat(e," ").concat(t," Z"),b(this,ag)[ag];if(b(this,rg)[rg].length<=6){var i=b(this,ag)[ag].lastIndexOf("M");b(this,ag)[ag]="".concat(b(this,ag)[ag].slice(0,i)," M ").concat(e," ").concat(t),b(this,sg)[sg]=6}if(4===b(this,rg)[rg].length){var n=Qd.svgRound(b(this,eg)[eg][10]),r=Qd.svgRound(b(this,eg)[eg][11]);return b(this,ag)[ag]="".concat(b(this,ag)[ag]," L ").concat(n," ").concat(r),b(this,sg)[sg]=12,b(this,ag)[ag]}var a=[];0===b(this,sg)[sg]&&(a.push("M ".concat(e," ").concat(t)),b(this,sg)[sg]=6);for(var s=b(this,sg)[sg],o=b(this,eg)[eg].length;s<o;s+=6){var l=b(this,eg)[eg].slice(s,s+6).map(Qd.svgRound),u=(0,c.Z)(l,6),h=u[0],d=u[1],v=u[2],f=u[3],p=u[4],g=u[5];a.push("C".concat(h," ").concat(d," ").concat(v," ").concat(f," ").concat(p," ").concat(g))}return b(this,ag)[ag]+=a.join(" "),b(this,sg)[sg]=b(this,eg)[eg].length,b(this,ag)[ag]}},{key:"getOutlines",value:function(e,t,i,n){var r=b(this,tg)[tg].at(-1);return r.line=new Float32Array(r.line),r.points=new Float32Array(r.points),b(this,og)[og].build(b(this,tg)[tg],e,t,i,b(this,ig)[ig],b(this,ng)[ng],n),b(this,$p)[$p]=null,b(this,eg)[eg]=null,b(this,tg)[tg]=null,b(this,ag)[ag]=null,b(this,og)[og]}},{key:"defaultSVGProperties",get:function(){return{root:{viewBox:"0 0 10000 10000"},rootClass:{draw:!0},bbox:[0,0,1,1]}}}]),e}();function dg(e,t){return Qd._normalizePoint(e,t,b(this,lg)[lg],b(this,ug)[ug],b(this,ig)[ig])}var vg=k("bbox"),fg=k("currentRotation"),pg=k("innerMargin"),gg=k("lines"),yg=k("parentWidth"),mg=k("parentHeight"),bg=k("parentScale"),wg=k("rotation"),kg=k("thickness"),Ag=k("getMarginComponents"),_g=k("getBBoxWithNoMargin"),xg=k("computeBbox"),Pg=k("updateThickness"),Sg=function(e){P(i,e);var t=R(i);function i(){var e;(0,_.Z)(this,i);for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return e=t.call.apply(t,[this].concat(r)),Object.defineProperty(o(e),Pg,{value:Mg}),Object.defineProperty(o(e),xg,{value:Og}),Object.defineProperty(o(e),_g,{value:Cg}),Object.defineProperty(o(e),Ag,{value:Eg}),Object.defineProperty(o(e),vg,{writable:!0,value:void 0}),Object.defineProperty(o(e),fg,{writable:!0,value:0}),Object.defineProperty(o(e),pg,{writable:!0,value:void 0}),Object.defineProperty(o(e),gg,{writable:!0,value:void 0}),Object.defineProperty(o(e),yg,{writable:!0,value:void 0}),Object.defineProperty(o(e),mg,{writable:!0,value:void 0}),Object.defineProperty(o(e),bg,{writable:!0,value:void 0}),Object.defineProperty(o(e),wg,{writable:!0,value:void 0}),Object.defineProperty(o(e),kg,{writable:!0,value:void 0}),e}return(0,A.Z)(i,[{key:"build",value:function(e,t,i,n,r,a,s){b(this,yg)[yg]=t,b(this,mg)[mg]=i,b(this,bg)[bg]=n,b(this,wg)[wg]=r,b(this,kg)[kg]=a,b(this,pg)[pg]=null!==s&&void 0!==s?s:0,b(this,gg)[gg]=e,b(this,xg)[xg]()}},{key:"thickness",get:function(){return b(this,kg)[kg]}},{key:"setLastElement",value:function(e){return b(this,gg)[gg].push(e),{path:{d:this.toSVGPath()}}}},{key:"removeLastElement",value:function(){return b(this,gg)[gg].pop(),{path:{d:this.toSVGPath()}}}},{key:"toSVGPath",value:function(){var e,t=[],i=(0,v.Z)(b(this,gg)[gg]);try{for(i.s();!(e=i.n()).done;){var n=e.value.line;if(t.push("M".concat(Qd.svgRound(n[4])," ").concat(Qd.svgRound(n[5]))),6!==n.length)if(12===n.length&&isNaN(n[6]))t.push("L".concat(Qd.svgRound(n[10])," ").concat(Qd.svgRound(n[11])));else for(var r=6,a=n.length;r<a;r+=6){var s=n.subarray(r,r+6).map(Qd.svgRound),o=(0,c.Z)(s,6),l=o[0],u=o[1],h=o[2],d=o[3],f=o[4],p=o[5];t.push("C".concat(l," ").concat(u," ").concat(h," ").concat(d," ").concat(f," ").concat(p))}else t.push("Z")}}catch(g){i.e(g)}finally{i.f()}return t.join("")}},{key:"serialize",value:function(e,t){var i,n,r,a,s,o,l,u,h,d=(0,c.Z)(e,4),f=d[0],p=d[1],g=d[2],y=d[3],m=[],w=[],k=b(this,_g)[_g](),A=(0,c.Z)(k,4),_=A[0],x=A[1],P=A[2],S=A[3];switch(b(this,wg)[wg]){case 0:h=Qd._rescale,i=f,n=p+y,r=g,a=-y,s=f+_*g,o=p+(1-x-S)*y,l=f+(_+P)*g,u=p+(1-x)*y;break;case 90:h=Qd._rescaleAndSwap,i=f,n=p,r=g,a=y,s=f+x*g,o=p+_*y,l=f+(x+S)*g,u=p+(_+P)*y;break;case 180:h=Qd._rescale,i=f+g,n=p,r=-g,a=y,s=f+(1-_-P)*g,o=p+x*y,l=f+(1-_)*g,u=p+(x+S)*y;break;case 270:h=Qd._rescaleAndSwap,i=f+g,n=p+y,r=-g,a=-y,s=f+(1-x-S)*g,o=p+(1-_-P)*y,l=f+(1-x)*g,u=p+(1-_)*y}var E,C=(0,v.Z)(b(this,gg)[gg]);try{for(C.s();!(E=C.n()).done;){var O=E.value,M=O.line,T=O.points;m.push(h(M,i,n,r,a,t?new Array(M.length):null)),w.push(h(T,i,n,r,a,t?new Array(T.length):null))}}catch(R){C.e(R)}finally{C.f()}return{lines:m,points:w,rect:[s,o,l,u]}}},{key:"box",get:function(){return b(this,vg)[vg]}},{key:"updateProperty",value:function(e,t){return"stroke-width"===e?b(this,Pg)[Pg](t):null}},{key:"updateParentDimensions",value:function(e,t){var i=(0,c.Z)(e,2),n=i[0],r=i[1],a=b(this,Ag)[Ag](),s=(0,c.Z)(a,2),o=s[0],l=s[1];b(this,yg)[yg]=n,b(this,mg)[mg]=r,b(this,bg)[bg]=t;var u=b(this,Ag)[Ag](),h=(0,c.Z)(u,2),d=h[0]-o,v=h[1]-l,f=b(this,vg)[vg];return f[0]-=d,f[1]-=v,f[2]+=2*d,f[3]+=2*v,f}},{key:"updateRotation",value:function(e){return b(this,fg)[fg]=e,{path:{transform:this.rotationTransform}}}},{key:"viewBox",get:function(){return b(this,vg)[vg].map(Qd.svgRound).join(" ")}},{key:"defaultProperties",get:function(){var e=(0,c.Z)(b(this,vg)[vg],2),t=e[0],i=e[1];return{root:{viewBox:this.viewBox},path:{"transform-origin":"".concat(Qd.svgRound(t)," ").concat(Qd.svgRound(i))}}}},{key:"rotationTransform",get:function(){var e=(0,c.Z)(b(this,vg)[vg],4),t=e[2],i=e[3],n=0,r=0,a=0,s=0,o=0,l=0;switch(b(this,fg)[fg]){case 90:r=i/t,a=-t/i,o=t;break;case 180:n=-1,s=-1,o=t,l=i;break;case 270:r=-i/t,a=t/i,l=i;break;default:return""}return"matrix(".concat(n," ").concat(r," ").concat(a," ").concat(s," ").concat(Qd.svgRound(o)," ").concat(Qd.svgRound(l),")")}},{key:"getPathResizingSVGProperties",value:function(e){var t=(0,c.Z)(e,4),i=t[0],n=t[1],r=t[2],a=t[3],s=b(this,Ag)[Ag](),o=(0,c.Z)(s,2),l=o[0],u=o[1],h=(0,c.Z)(b(this,vg)[vg],4),d=h[0],v=h[1],f=h[2],p=h[3];if(Math.abs(f-l)<=Qd.PRECISION||Math.abs(p-u)<=Qd.PRECISION){var g=i+r/2-(d+f/2),y=n+a/2-(v+p/2);return{path:{"transform-origin":"".concat(Qd.svgRound(i)," ").concat(Qd.svgRound(n)),transform:"".concat(this.rotationTransform," translate(").concat(g," ").concat(y,")")}}}var m=(r-2*l)/(f-2*l),w=(a-2*u)/(p-2*u),k=f/r,A=p/a;return{path:{"transform-origin":"".concat(Qd.svgRound(d)," ").concat(Qd.svgRound(v)),transform:"".concat(this.rotationTransform," scale(").concat(k," ").concat(A,") ")+"translate(".concat(Qd.svgRound(l)," ").concat(Qd.svgRound(u),") scale(").concat(m," ").concat(w,") ")+"translate(".concat(Qd.svgRound(-l)," ").concat(Qd.svgRound(-u),")")}}}},{key:"getPathResizedSVGProperties",value:function(e){var t=(0,c.Z)(e,4),i=t[0],n=t[1],r=t[2],a=t[3],s=b(this,Ag)[Ag](),o=(0,c.Z)(s,2),l=o[0],u=o[1],h=b(this,vg)[vg],d=(0,c.Z)(h,4),f=d[0],p=d[1],g=d[2],y=d[3];if(h[0]=i,h[1]=n,h[2]=r,h[3]=a,Math.abs(g-l)<=Qd.PRECISION||Math.abs(y-u)<=Qd.PRECISION){var m,w=i+r/2-(f+g/2),k=n+a/2-(p+y/2),A=(0,v.Z)(b(this,gg)[gg]);try{for(A.s();!(m=A.n()).done;){var _=m.value,x=_.line,P=_.points;Qd._translate(x,w,k,x),Qd._translate(P,w,k,P)}}catch(D){A.e(D)}finally{A.f()}return{root:{viewBox:this.viewBox},path:{"transform-origin":"".concat(Qd.svgRound(i)," ").concat(Qd.svgRound(n)),transform:this.rotationTransform||null,d:this.toSVGPath()}}}var S=(r-2*l)/(g-2*l),E=(a-2*u)/(y-2*u),C=-S*(f+l)+i+l,O=-E*(p+u)+n+u;if(1!==S||1!==E||0!==C||0!==O){var M,T=(0,v.Z)(b(this,gg)[gg]);try{for(T.s();!(M=T.n()).done;){var R=M.value,Z=R.line,I=R.points;Qd._rescale(Z,C,O,S,E,Z),Qd._rescale(I,C,O,S,E,I)}}catch(D){T.e(D)}finally{T.f()}}return{root:{viewBox:this.viewBox},path:{"transform-origin":"".concat(Qd.svgRound(i)," ").concat(Qd.svgRound(n)),transform:this.rotationTransform||null,d:this.toSVGPath()}}}},{key:"getPathTranslatedSVGProperties",value:function(e,t){var i=(0,c.Z)(e,2),n=i[0],r=i[1],a=(0,c.Z)(t,2),s=a[0],o=a[1],l=b(this,vg)[vg],u=n-l[0],h=r-l[1];if(b(this,yg)[yg]===s&&b(this,mg)[mg]===o){var d,f=(0,v.Z)(b(this,gg)[gg]);try{for(f.s();!(d=f.n()).done;){var p=d.value,g=p.line,y=p.points;Qd._translate(g,u,h,g),Qd._translate(y,u,h,y)}}catch(S){f.e(S)}finally{f.f()}}else{var m=b(this,yg)[yg]/s,w=b(this,mg)[mg]/o;b(this,yg)[yg]=s,b(this,mg)[mg]=o;var k,A=(0,v.Z)(b(this,gg)[gg]);try{for(A.s();!(k=A.n()).done;){var _=k.value,x=_.line,P=_.points;Qd._rescale(x,u,h,m,w,x),Qd._rescale(P,u,h,m,w,P)}}catch(S){A.e(S)}finally{A.f()}l[2]*=m,l[3]*=w}return l[0]=n,l[1]=r,{root:{viewBox:this.viewBox},path:{d:this.toSVGPath(),"transform-origin":"".concat(Qd.svgRound(n)," ").concat(Qd.svgRound(r))}}}},{key:"defaultSVGProperties",get:function(){var e=b(this,vg)[vg];return{root:{viewBox:this.viewBox},rootClass:{draw:!0},path:{d:this.toSVGPath(),"transform-origin":"".concat(Qd.svgRound(e[0])," ").concat(Qd.svgRound(e[1])),transform:this.rotationTransform||null},bbox:e}}}],[{key:"deserialize",value:function(e,t,i,n,r,a){var s,o,l,u,h,d=a.paths,f=d.lines,p=d.points,g=a.rotation,y=a.thickness,m=[];switch(g){case 0:h=Qd._rescale,s=-e/i,o=t/n+1,l=1/i,u=-1/n;break;case 90:h=Qd._rescaleAndSwap,s=-t/n,o=-e/i,l=1/n,u=1/i;break;case 180:h=Qd._rescale,s=e/i+1,o=-t/n,l=-1/i,u=1/n;break;case 270:h=Qd._rescaleAndSwap,s=t/n+1,o=e/i+1,l=-1/n,u=-1/i}if(!f){f=[];var b,w=(0,v.Z)(p);try{for(w.s();!(b=w.n()).done;){var k=b.value,A=k.length;if(2!==A)if(4!==A){var _=new Float32Array(3*(A-2));f.push(_);var x=k.subarray(0,4),P=(0,c.Z)(x,4),S=P[0],E=P[1],C=P[2],O=P[3];_.set([NaN,NaN,NaN,NaN,S,E],0);for(var M=4;M<A;M+=2){var T=k[M],R=k[M+1];_.set(Qd.createBezierPoints(S,E,C,O,T,R),3*(M-2));var Z=[C,O,T,R];S=Z[0],E=Z[1],C=Z[2],O=Z[3]}}else f.push(new Float32Array([NaN,NaN,NaN,NaN,k[0],k[1],NaN,NaN,NaN,NaN,k[2],k[3]]));else f.push(new Float32Array([NaN,NaN,NaN,NaN,k[0],k[1]]))}}catch(j){w.e(j)}finally{w.f()}}for(var I=0,D=f.length;I<D;I++)m.push({line:h(f[I].map((function(e){return null!==e&&void 0!==e?e:NaN})),s,o,l,u),points:h(p[I].map((function(e){return null!==e&&void 0!==e?e:NaN})),s,o,l,u)});var L=new this.prototype.constructor;return L.build(m,i,n,1,g,y,r),L}}]),i}(Qd);function Eg(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:b(this,kg)[kg],t=b(this,pg)[pg]+e/2*b(this,bg)[bg];return b(this,wg)[wg]%180===0?[t/b(this,yg)[yg],t/b(this,mg)[mg]]:[t/b(this,mg)[mg],t/b(this,yg)[yg]]}function Cg(){var e=(0,c.Z)(b(this,vg)[vg],4),t=e[0],i=e[1],n=e[2],r=e[3],a=b(this,Ag)[Ag](0),s=(0,c.Z)(a,2),o=s[0],l=s[1];return[t+o,i+l,n-2*o,r-2*l]}function Og(){var e,t=b(this,vg)[vg]=new Float32Array([1/0,1/0,-1/0,-1/0]),i=(0,v.Z)(b(this,gg)[gg]);try{for(i.s();!(e=i.n()).done;){var n=e.value.line;if(n.length<=12)for(var r=4,a=n.length;r<a;r+=6)He.pointBoundingBox(n[r],n[r+1],t);else for(var s=n[4],o=n[5],l=6,u=n.length;l<u;l+=6){var h=n.subarray(l,l+6),d=(0,c.Z)(h,6),f=d[0],p=d[1],g=d[2],y=d[3],m=d[4],w=d[5];He.bezierBoundingBox(s,o,f,p,g,y,m,w,t),s=m,o=w}}}catch(P){i.e(P)}finally{i.f()}var k=b(this,Ag)[Ag](),A=(0,c.Z)(k,2),_=A[0],x=A[1];t[0]=Xe(t[0]-_,0,1),t[1]=Xe(t[1]-x,0,1),t[2]=Xe(t[2]+_,0,1),t[3]=Xe(t[3]+x,0,1),t[2]-=t[0],t[3]-=t[1]}function Mg(e){var t=b(this,Ag)[Ag](),i=(0,c.Z)(t,2),n=i[0],r=i[1];b(this,kg)[kg]=e;var a=b(this,Ag)[Ag](),s=(0,c.Z)(a,2),o=s[0]-n,l=s[1]-r,u=b(this,vg)[vg];return u[0]-=o,u[1]-=l,u[2]+=2*o,u[3]+=2*l,u}var Tg=function(e){P(i,e);var t=R(i);function i(e){var r,s;return(0,_.Z)(this,i),(s=t.call(this))._viewParameters=e,a((r=o(s),n(i.prototype)),"updateProperties",r).call(r,{fill:"none",stroke:wa._defaultLineColor,"stroke-opacity":1,"stroke-width":1,"stroke-linecap":"round","stroke-linejoin":"round","stroke-miterlimit":10}),s}return(0,A.Z)(i,[{key:"updateSVGProperty",value:function(e,t){var r;"stroke-width"===e&&(null!==(r=t)&&void 0!==r||(t=this["stroke-width"]),t*=this._viewParameters.realScale);a(n(i.prototype),"updateSVGProperty",this).call(this,e,t)}},{key:"clone",value:function(){var e=new i(this._viewParameters);return e.updateAll(this),e}}]),i}(Sp),Rg=k("hasElementChanged"),Zg=function(e){P(i,e);var t=R(i);function i(e){var n;return(0,_.Z)(this,i),n=t.call(this,(0,l.Z)((0,l.Z)({},e),{},{name:"inkEditor"})),Object.defineProperty(o(n),Rg,{value:Ig}),n._willKeepAspectRatio=!0,n.defaultL10nId="pdfjs-editor-ink-editor",n}return(0,A.Z)(i,[{key:"onScaleChanging",value:function(){if(this.parent){a(n(i.prototype),"onScaleChanging",this).call(this);var e=this._drawId,t=this._drawingOptions,r=this.parent;t.updateSVGProperty("stroke-width"),r.drawLayer.updateProperties(e,t.toSVGProperties())}}},{key:"createDrawingOptions",value:function(e){var t=e.color,n=e.thickness,r=e.opacity;this._drawingOptions=i.getDefaultDrawingOptions({stroke:He.makeHexColor.apply(He,(0,u.Z)(t)),"stroke-width":n,"stroke-opacity":r})}},{key:"serialize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();var t=this.serializeDraw(e),i=t.lines,n=t.points,r=t.rect,a=this._drawingOptions,s=a.stroke,o=a["stroke-opacity"],l=a["stroke-width"],u={annotationType:X.INK,color:wa._colorManager.convert(s),opacity:o,thickness:l,paths:{lines:i,points:n},pageIndex:this.pageIndex,rect:r,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return e?(u.isCopy=!0,u):this.annotationElementId&&!b(this,Rg)[Rg](u)?null:(u.id=this.annotationElementId,u)}},{key:"renderAnnotationElement",value:function(e){var t=this.serializeDraw(!1),i=t.points,n=t.rect;return e.updateEdited({rect:n,thickness:this._drawingOptions["stroke-width"],points:i}),null}}],[{key:"initialize",value:function(e,t){wa.initialize(e,t),this._defaultDrawingOptions=new Tg(t.viewParameters)}},{key:"getDefaultDrawingOptions",value:function(e){var t=this._defaultDrawingOptions.clone();return t.updateProperties(e),t}},{key:"supportMultipleDrawings",get:function(){return!0}},{key:"typesMap",get:function(){return Ee(this,"typesMap",new Map([[Y.INK_THICKNESS,"stroke-width"],[Y.INK_COLOR,"stroke"],[Y.INK_OPACITY,"stroke-opacity"]]))}},{key:"createDrawerInstance",value:function(e,t,i,n,r){return new cg(e,t,i,n,r,this._defaultDrawingOptions["stroke-width"])}},{key:"deserializeDraw",value:function(e,t,i,n,r,a){return Sg.deserialize(e,t,i,n,r,a)}},{key:"deserialize",value:function(){var e=(0,d.Z)((0,h.Z)().mark((function e(t,r,s){var o,l,u,c,d,v,f,p,g,y,m,b,w;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=null,t instanceof od&&(u=(l=t).data,c=u.inkLists,d=u.rect,v=u.rotation,f=u.id,p=u.color,g=u.opacity,y=u.borderStyle.rawWidth,m=u.popupRef,b=l.parent.page.pageNumber,o=t={annotationType:X.INK,color:Array.from(p),thickness:y,opacity:g,paths:{points:c},boxes:null,pageIndex:b-1,rect:d.slice(0),rotation:v,annotationElementId:f,id:f,deleted:!1,popupRef:m}),e.next=4,a(n(i),"deserialize",this).call(this,t,r,s);case 4:return(w=e.sent)._initialData=o,e.abrupt("return",w);case 7:case"end":return e.stop()}}),e,this)})));return function(t,i,n){return e.apply(this,arguments)}}()},{key:"onScaleChangingWhenDrawing",value:function(){var e=this._currentParent;e&&(a(n(i),"onScaleChangingWhenDrawing",this).call(this),this._defaultDrawingOptions.updateSVGProperty("stroke-width"),e.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}}]),i}(Up);function Ig(e){var t=this._initialData,i=t.color,n=t.thickness,r=t.opacity,a=t.pageIndex;return this._hasBeenMoved||this._hasBeenResized||e.color.some((function(e,t){return e!==i[t]}))||e.thickness!==n||e.opacity!==r||e.pageIndex!==a}Zg._type="ink",Zg._editorType=X.INK,Zg._defaultDrawingOptions=null;var Dg=function(e){P(i,e);var t=R(i);function i(){return(0,_.Z)(this,i),t.apply(this,arguments)}return(0,A.Z)(i,[{key:"toSVGPath",value:function(){var e=a(n(i.prototype),"toSVGPath",this).call(this);return e.endsWith("Z")||(e+="Z"),e}}]),i}(Sg),Lg=k("PARAMETERS"),jg=k("neighborIndexToId"),Fg=k("neighborIdToIndex"),Ng=k("clockwiseNonZero"),Bg=k("counterClockwiseNonZero"),Hg=k("findContours"),zg=k("douglasPeuckerHelper"),Gg=k("douglasPeucker"),Ug=k("bilateralFilter"),Vg=k("getHistogram"),Wg=k("toUint8"),qg=k("guessThreshold"),Xg=k("getGrayPixels"),Yg=function(){function e(){(0,_.Z)(this,e)}return(0,A.Z)(e,null,[{key:"extractContoursFromText",value:function(e,t,i,n,r,a){var s=t.fontFamily,o=t.fontStyle,l=t.fontWeight,u=new OffscreenCanvas(1,1),h=u.getContext("2d",{alpha:!1}),c=h.font="".concat(o," ").concat(l," ").concat(200,"px ").concat(s),d=h.measureText(e),v=d.actualBoundingBoxLeft,f=d.actualBoundingBoxRight,p=d.actualBoundingBoxAscent,g=d.actualBoundingBoxDescent,y=d.fontBoundingBoxAscent,m=d.fontBoundingBoxDescent,w=d.width,k=1.5,A=Math.ceil(Math.max(Math.abs(v)+Math.abs(f)||0,w)*k),_=Math.ceil(Math.max(Math.abs(p)+Math.abs(g)||200,Math.abs(y)+Math.abs(m)||200)*k);(h=(u=new OffscreenCanvas(A,_)).getContext("2d",{alpha:!0,willReadFrequently:!0})).font=c,h.filter="grayscale(1)",h.fillStyle="white",h.fillRect(0,0,A,_),h.fillStyle="black",h.fillText(e,.5*A/2,1.5*_/2);var x=b(this,Wg)[Wg](h.getImageData(0,0,A,_).data),P=b(this,Vg)[Vg](x),S=b(this,qg)[qg](P),E=b(this,Hg)[Hg](x,A,_,S);return this.processDrawnLines({lines:{curves:E,width:A,height:_},pageWidth:i,pageHeight:n,rotation:r,innerMargin:a,mustSmooth:!0,areContours:!0})}},{key:"process",value:function(e,t,i,n,r){var a=b(this,Xg)[Xg](e),s=(0,c.Z)(a,3),o=s[0],l=s[1],u=s[2],h=b(this,Ug)[Ug](o,l,u,Math.hypot(l,u)*b(this,Lg)[Lg].sigmaSFactor,b(this,Lg)[Lg].sigmaR,b(this,Lg)[Lg].kernelSize),d=(0,c.Z)(h,2),v=d[0],f=d[1],p=b(this,qg)[qg](f),g=b(this,Hg)[Hg](v,l,u,p);return this.processDrawnLines({lines:{curves:g,width:l,height:u},pageWidth:t,pageHeight:i,rotation:n,innerMargin:r,mustSmooth:!0,areContours:!0})}},{key:"processDrawnLines",value:function(e){var t,i=e.lines,n=e.pageWidth,r=e.pageHeight,a=e.rotation,s=e.innerMargin,o=e.mustSmooth,l=e.areContours;if(a%180!==0){var u=[r,n];n=u[0],r=u[1]}var h,d=i.curves,f=i.width,p=i.height,g=null!==(t=i.thickness)&&void 0!==t?t:0,y=[],m=Math.min(n/f,r/p),w=m/n,k=m/r,A=[],_=(0,v.Z)(d);try{for(_.s();!(h=_.n()).done;){var x=h.value.points,P=o?b(this,Gg)[Gg](x):x;if(P){A.push(P);var S=P.length,E=new Float32Array(S),C=new Float32Array(3*(2===S?2:S-2));if(y.push({line:C,points:E}),2!==S){var O=(0,c.Z)(P,4),M=O[0],T=O[1],R=O[2],Z=O[3];M*=w,T*=k,R*=w,Z*=k,E.set([M,T,R,Z],0),C.set([NaN,NaN,NaN,NaN,M,T],0);for(var I=4;I<S;I+=2){var D=E[I]=P[I]*w,L=E[I+1]=P[I+1]*k;C.set(Qd.createBezierPoints(M,T,R,Z,D,L),3*(I-2));var j=[R,Z,D,L];M=j[0],T=j[1],R=j[2],Z=j[3]}}else E[0]=P[0]*w,E[1]=P[1]*k,C.set([NaN,NaN,NaN,NaN,E[0],E[1]],0)}}}catch(N){_.e(N)}finally{_.f()}if(0===y.length)return null;var F=l?new Dg:new Sg;return F.build(y,n,r,1,a,l?0:g,s),{outline:F,newCurves:A,areContours:l,thickness:g,width:f,height:p}}},{key:"compressSignature",value:function(){var e=(0,d.Z)((0,h.Z)().mark((function e(t){var i,n,r,a,s,o,l,u,c,d,f,p,g,y,m,b,w,k,A,_,x,P,S,E,C,O,M,T,R,Z,I,D,L;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=t.outlines,n=t.areContours,r=t.thickness,a=t.width,s=t.height,o=1/0,l=-1/0,u=0,c=(0,v.Z)(i);try{for(c.s();!(d=c.n()).done;)for(f=d.value,u+=f.length,p=2,g=f.length;p<g;p++)y=f[p]-f[p-2],o=Math.min(o,y),l=Math.max(l,y)}catch(h){c.e(h)}finally{c.f()}m=o>=-128&&l<=127?Int8Array:o>=-32768&&l<=32767?Int16Array:Int32Array,b=i.length,w=8+3*b,k=new Uint32Array(w),A=0,k[A++]=w*Uint32Array.BYTES_PER_ELEMENT+(u-2*b)*m.BYTES_PER_ELEMENT,k[A++]=0,k[A++]=a,k[A++]=s,k[A++]=n?0:1,k[A++]=Math.max(0,Math.floor(null!==r&&void 0!==r?r:0)),k[A++]=b,k[A++]=m.BYTES_PER_ELEMENT,_=(0,v.Z)(i);try{for(_.s();!(x=_.n()).done;)P=x.value,k[A++]=P.length-2,k[A++]=P[0],k[A++]=P[1]}catch(h){_.e(h)}finally{_.f()}return S=new CompressionStream("deflate-raw"),E=S.writable.getWriter(),e.next=25,E.ready;case 25:E.write(k),C=m.prototype.constructor,O=(0,v.Z)(i);try{for(O.s();!(M=O.n()).done;){for(T=M.value,R=new C(T.length-2),Z=2,I=T.length;Z<I;Z++)R[Z-2]=T[Z]-T[Z-2];E.write(R)}}catch(h){O.e(h)}finally{O.f()}return E.close(),e.next=32,new Response(S.readable).arrayBuffer();case 32:return D=e.sent,L=new Uint8Array(D),e.abrupt("return",Ye(L));case 35:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"decompressSignature",value:function(){var e=(0,d.Z)((0,h.Z)().mark((function e(t){var i,n,r,a,s,o,l,u,c,v,f,p,g,y,m,b,w,k,A,_,x,P,S,E,C,O,M,T,R;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,I=t,i=Uint8Array.fromBase64?Uint8Array.fromBase64(I):Le(atob(I)),n=new DecompressionStream("deflate-raw"),r=n.readable,a=n.writable,s=a.getWriter(),e.next=6,s.ready;case 6:s.write(i).then((0,d.Z)((0,h.Z)().mark((function e(){return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.ready;case 2:return e.next=4,s.close();case 4:case"end":return e.stop()}}),e)})))).catch((function(){})),o=null,l=0,u=!1,c=!1,e.prev=11,f=Z(r);case 13:return e.next=15,f.next();case 15:if(!(u=!(p=e.sent).done)){e.next=23;break}g=p.value,o||(o=new Uint8Array(new Uint32Array(g.buffer,0,4)[0])),o.set(g,l),l+=g.length;case 20:u=!1,e.next=13;break;case 23:e.next=29;break;case 25:e.prev=25,e.t0=e.catch(11),c=!0,v=e.t0;case 29:if(e.prev=29,e.prev=30,!u||null==f.return){e.next=34;break}return e.next=34,f.return();case 34:if(e.prev=34,!c){e.next=37;break}throw v;case 37:return e.finish(34);case 38:return e.finish(29);case 39:if(y=new Uint32Array(o.buffer,0,o.length>>2),0===(m=y[1])){e.next=43;break}throw new Error("Invalid version: ".concat(m));case 43:b=y[2],w=y[3],k=0===y[4],A=y[5],_=y[6],x=y[7],P=[],S=(8+3*_)*Uint32Array.BYTES_PER_ELEMENT,e.t1=x,e.next=e.t1===Int8Array.BYTES_PER_ELEMENT?54:e.t1===Int16Array.BYTES_PER_ELEMENT?56:e.t1===Int32Array.BYTES_PER_ELEMENT?58:60;break;case 54:return E=new Int8Array(o.buffer,S),e.abrupt("break",60);case 56:return E=new Int16Array(o.buffer,S),e.abrupt("break",60);case 58:return E=new Int32Array(o.buffer,S),e.abrupt("break",60);case 60:for(l=0,C=0;C<_;C++){for(O=y[3*C+8],M=new Float32Array(O+2),P.push(M),T=0;T<2;T++)M[T]=y[3*C+8+T+1];for(R=0;R<O;R++)M[R+2]=M[R]+E[l++]}return e.abrupt("return",{areContours:k,thickness:A,outlines:P,width:b,height:w});case 65:return e.prev=65,e.t2=e.catch(0),ke("decompressSignature: ".concat(e.t2)),e.abrupt("return",null);case 69:case"end":return e.stop()}var I}),e,null,[[0,65],[11,25,29,39],[30,,34,38]])})));return function(t){return e.apply(this,arguments)}}()}]),e}();Object.defineProperty(Yg,Xg,{value:function(e){var t=e,i=e,n=i.width,r=i.height,a=b(this,Lg)[Lg].maxDim,s=n,o=r;if(n>a||r>a){var l=n,u=r,h=Math.log2(Math.max(n,r)/a),c=Math.floor(h);h=h===c?c-1:c;for(var d=0;d<h;d++){s=Math.ceil(l/2),o=Math.ceil(u/2);var v=new OffscreenCanvas(s,o);v.getContext("2d").drawImage(e,0,0,l,u,0,0,s,o),l=s,u=o,e!==t&&e.close(),e=v.transferToImageBitmap()}var f=Math.min(a/s,a/o);s=Math.round(s*f),o=Math.round(o*f)}var p=new OffscreenCanvas(s,o).getContext("2d",{willReadFrequently:!0});p.filter="grayscale(1)",p.drawImage(e,0,0,e.width,e.height,0,0,s,o);var g=p.getImageData(0,0,s,o).data;return[b(this,Wg)[Wg](g),s,o]}}),Object.defineProperty(Yg,qg,{value:function(e){var t,i=-1/0,n=-1/0,r=e.findIndex((function(e){return 0!==e})),a=r,s=r;for(t=r;t<256;t++){var o=e[t];o>i&&(t-a>n&&(n=t-a,s=t-1),i=o,a=t)}for(t=s-1;t>=0&&!(e[t]>e[t+1]);t--);return t}}),Object.defineProperty(Yg,Wg,{value:function(e){for(var t=e.length,i=new Uint8ClampedArray(t>>2),n=-1/0,r=1/0,a=0,s=i.length;a<s;a++){if(0!==e[3+(a<<2)]){var o=i[a]=e[a<<2];o>n&&(n=o),o<r&&(r=o)}else n=i[a]=255}for(var l=255/(n-r),u=0;u<t;u++)i[u]=(i[u]-r)*l;return i}}),Object.defineProperty(Yg,Vg,{value:function(e){var t,i=new Uint32Array(256),n=(0,v.Z)(e);try{for(n.s();!(t=n.n()).done;){i[t.value]++}}catch(r){n.e(r)}finally{n.f()}return i}}),Object.defineProperty(Yg,Ug,{value:function(e,t,i,n,r,a){for(var s=new Float32Array(Math.pow(a,2)),o=-2*Math.pow(n,2),l=a>>1,u=0;u<a;u++)for(var h=Math.pow(u-l,2),c=0;c<a;c++)s[u*a+c]=Math.exp((h+Math.pow(c-l,2))/o);for(var d=new Float32Array(256),v=-2*Math.pow(r,2),f=0;f<256;f++)d[f]=Math.exp(Math.pow(f,2)/v);for(var p=e.length,g=new Uint8Array(p),y=new Uint32Array(256),m=0;m<i;m++)for(var b=0;b<t;b++){for(var w=m*t+b,k=e[w],A=0,_=0,x=0;x<a;x++){var P=m+x-l;if(!(P<0||P>=i))for(var S=0;S<a;S++){var E=b+S-l;if(!(E<0||E>=t)){var C=e[P*t+E],O=s[x*a+S]*d[Math.abs(C-k)];A+=C*O,_+=O}}}y[g[w]=Math.round(A/_)]++}return[g,y]}}),Object.defineProperty(Yg,Gg,{value:function(e){var t=[],i=e.length;return b(this,zg)[zg](e,0,i,t),t.push(e[i-2],e[i-1]),t.length<=4?null:t}}),Object.defineProperty(Yg,zg,{value:function(e,t,i,n){if(i-t<=4)for(var r=t;r<i-2;r+=2)n.push(e[r],e[r+1]);else{for(var a=e[t],s=e[t+1],o=e[i-4]-a,l=e[i-3]-s,u=Math.hypot(o,l),h=o/u,c=l/u,d=h*s-c*a,v=l/o,f=1/u,p=Math.atan(v),g=Math.cos(p),y=Math.sin(p),m=f*(Math.abs(g)+Math.abs(y)),w=f*(1-m+Math.pow(m,2)),k=Math.max(Math.atan(Math.abs(y+g)*w),Math.atan(Math.abs(y-g)*w)),A=0,_=t,x=t+2;x<i-2;x+=2){var P=Math.abs(d-h*e[x+1]+c*e[x]);P>A&&(_=x,A=P)}A>Math.pow(u*k,2)?(b(this,zg)[zg](e,t,_+2,n),b(this,zg)[zg](e,_,i,n)):n.push(a,s)}}}),Object.defineProperty(Yg,Hg,{value:function(e,t,i,n){for(var r=e.length,a=new Int32Array(r),s=0;s<r;s++)a[s]=e[s]<=n?1:0;for(var o=1;o<i-1;o++)a[o*t]=a[o*t+t-1]=0;for(var l=0;l<t;l++)a[l]=a[t*i-1-l]=0;for(var u,h=1,c=[],d=1;d<i-1;d++){u=1;for(var f=1;f<t-1;f++){var p=d*t+f,g=a[p];if(0!==g){var y=d,m=f;if(1===g&&0===a[p-1])h+=1,m-=1;else{if(!(g>=1&&0===a[p+1])){1!==g&&(u=Math.abs(g));continue}h+=1,m+=1,g>1&&(u=g)}var w=[f,d],k=m===f+1,A={isHole:k,points:w,id:h,parent:0};c.push(A);var _,x=void 0,P=(0,v.Z)(c);try{for(P.s();!(_=P.n()).done;){var S=_.value;if(S.id===u){x=S;break}}}catch(F){P.e(F)}finally{P.f()}x?x.isHole?A.parent=k?x.parent:u:A.parent=k?u:x.parent:A.parent=k?u:0;var E=b(this,Ng)[Ng](a,t,d,f,y,m,0);if(-1!==E){var C=b(this,Fg)[Fg][2*E],O=b(this,Fg)[Fg][2*E+1],M=d+C,T=f+O;y=M,m=T;for(var R=d,Z=f;;){var I=b(this,Bg)[Bg](a,t,R,Z,y,m,1),D=R+(C=b(this,Fg)[Fg][2*I]),L=Z+(O=b(this,Fg)[Fg][2*I+1]);w.push(L,D);var j=R*t+Z;if(0===a[j+1]?a[j]=-h:1===a[j]&&(a[j]=h),D===d&&L===f&&R===M&&Z===T){1!==a[p]&&(u=Math.abs(a[p]));break}y=R,m=Z,R=D,Z=L}}else a[p]=-h,1!==a[p]&&(u=Math.abs(a[p]))}}}return c}}),Object.defineProperty(Yg,Bg,{value:function(e,t,i,n,r,a,s){for(var o=b(this,jg)[jg](i,n,r,a),l=0;l<8;l++){var u=(l+o+s+16)%8;if(0!==e[(i+b(this,Fg)[Fg][2*u])*t+(n+b(this,Fg)[Fg][2*u+1])])return u}return-1}}),Object.defineProperty(Yg,Ng,{value:function(e,t,i,n,r,a,s){for(var o=b(this,jg)[jg](i,n,r,a),l=0;l<8;l++){var u=(-l+o-s+16)%8;if(0!==e[(i+b(this,Fg)[Fg][2*u])*t+(n+b(this,Fg)[Fg][2*u+1])])return u}return-1}}),Object.defineProperty(Yg,jg,{value:function(e,t,i,n){return n-=t,0===(i-=e)?n>0?0:4:1===i?n+6:2-n}}),Object.defineProperty(Yg,Lg,{writable:!0,value:{maxDim:512,sigmaSFactor:.02,sigmaR:25,kernelSize:16}}),Object.defineProperty(Yg,Fg,{writable:!0,value:new Int32Array([0,1,-1,1,-1,0,-1,-1,0,-1,1,-1,1,0,1,1])});var Kg=function(e){P(i,e);var t=R(i);function i(){var e,r;return(0,_.Z)(this,i),a((e=o(r=t.call(this)),n(i.prototype)),"updateProperties",e).call(e,{fill:wa._defaultLineColor,"stroke-width":0}),r}return(0,A.Z)(i,[{key:"clone",value:function(){var e=new i;return e.updateAll(this),e}}]),i}(Sp),Qg=function(e){P(i,e);var t=R(i);function i(e){var r,s;return(0,_.Z)(this,i),a((r=o(s=t.call(this,e)),n(i.prototype)),"updateProperties",r).call(r,{stroke:wa._defaultLineColor,"stroke-width":1}),s}return(0,A.Z)(i,[{key:"clone",value:function(){var e=new i(this._viewParameters);return e.updateAll(this),e}}]),i}(Tg),Jg=k("isExtracted"),$g=k("description"),ey=k("signatureData"),ty=k("signatureUUID"),iy=function(e){P(i,e);var t=R(i);function i(e){var n;return(0,_.Z)(this,i),n=t.call(this,(0,l.Z)((0,l.Z)({},e),{},{mustBeCommitted:!0,name:"signatureEditor"})),Object.defineProperty(o(n),Jg,{writable:!0,value:!1}),Object.defineProperty(o(n),$g,{writable:!0,value:null}),Object.defineProperty(o(n),ey,{writable:!0,value:null}),Object.defineProperty(o(n),ty,{writable:!0,value:null}),n._willKeepAspectRatio=!0,b(o(n),ey)[ey]=e.signatureData||null,b(o(n),$g)[$g]=null,n.defaultL10nId="pdfjs-editor-signature-editor1",n}return(0,A.Z)(i,[{key:"telemetryFinalData",get:function(){return{type:"signature",hasDescription:!!b(this,$g)[$g]}}},{key:"isResizable",get:function(){return!0}},{key:"onScaleChanging",value:function(){null!==this._drawId&&a(n(i.prototype),"onScaleChanging",this).call(this)}},{key:"render",value:function(){if(this.div)return this.div;var e,t,r=this._isCopy;if(r&&(this._isCopy=!1,e=this.x,t=this.y),a(n(i.prototype),"render",this).call(this),null===this._drawId)if(b(this,ey)[ey]){var s=b(this,ey)[ey],o=s.lines,l=s.mustSmooth,u=s.areContours,h=s.description,c=s.uuid,d=s.heightInPage,v=this.parent.viewport,f=v.rawDims,p=f.pageWidth,g=f.pageHeight,y=v.rotation,m=Yg.processDrawnLines({lines:o,pageWidth:p,pageHeight:g,rotation:y,innerMargin:i._INNER_MARGIN,mustSmooth:l,areContours:u});this.addSignature(m,d,h,c)}else this.div.setAttribute("data-l10n-args",JSON.stringify({description:""})),this.div.hidden=!0,this._uiManager.getSignature(this);return r&&(this._isCopy=!0,this._moveAfterPaste(e,t)),this.div}},{key:"setUuid",value:function(e){b(this,ty)[ty]=e,this.addEditToolbar()}},{key:"getUuid",value:function(){return b(this,ty)[ty]}},{key:"description",get:function(){return b(this,$g)[$g]},set:function(e){b(this,$g)[$g]=e,a(n(i.prototype),"addEditToolbar",this).call(this).then((function(t){null===t||void 0===t||t.updateEditSignatureButton(e)}))}},{key:"getSignaturePreview",value:function(){var e=b(this,ey)[ey],t=e.newCurves,i=e.areContours,n=e.thickness,r=e.width,a=e.height,s=Math.max(r,a);return{areContours:i,outline:Yg.processDrawnLines({lines:{curves:t.map((function(e){return{points:e}})),thickness:n,width:r,height:a},pageWidth:s,pageHeight:s,rotation:0,innerMargin:0,mustSmooth:!1,areContours:i}).outline}}},{key:"toolbarButtons",get:function(){return this._uiManager.signatureManager?[["editSignature",this._uiManager.signatureManager]]:a(n(i.prototype),"toolbarButtons",this)}},{key:"addSignature",value:function(e,t,n,r){var a,s=this.x,o=this.y,l=(b(this,ey)[ey]=e).outline;b(this,Jg)[Jg]=l instanceof Dg,this.description=n,this.div.setAttribute("data-l10n-args",JSON.stringify({description:n})),b(this,Jg)[Jg]?a=i.getDefaultDrawingOptions():(a=i._defaultDrawnSignatureOptions.clone()).updateProperties({"stroke-width":l.thickness}),this._addOutlines({drawOutlines:l,drawingOptions:a});var u=(0,c.Z)(this.parentDimensions,2),h=u[0],d=u[1],v=t/(0,c.Z)(this.pageDimensions,2)[1];v=v>=1?.5:v,this.width*=v/this.height,this.width>=1&&(v*=.9/this.width,this.width=.9),this.height=v,this.setDims(h*this.width,d*this.height),this.x=s,this.y=o,this.center(),this._onResized(),this.onScaleChanging(),this.rotate(),this._uiManager.addToAnnotationStorage(this),this.setUuid(r),this._reportTelemetry({action:"pdfjs.signature.inserted",data:{hasBeenSaved:!!r,hasDescription:!!n}}),this.div.hidden=!1}},{key:"getFromImage",value:function(e){var t=this.parent.viewport,n=t.rawDims,r=n.pageWidth,a=n.pageHeight,s=t.rotation;return Yg.process(e,r,a,s,i._INNER_MARGIN)}},{key:"getFromText",value:function(e,t){var n=this.parent.viewport,r=n.rawDims,a=r.pageWidth,s=r.pageHeight,o=n.rotation;return Yg.extractContoursFromText(e,t,a,s,o,i._INNER_MARGIN)}},{key:"getDrawnSignature",value:function(e){var t=this.parent.viewport,n=t.rawDims,r=n.pageWidth,a=n.pageHeight,s=t.rotation;return Yg.processDrawnLines({lines:e,pageWidth:r,pageHeight:a,rotation:s,innerMargin:i._INNER_MARGIN,mustSmooth:!1,areContours:!1})}},{key:"createDrawingOptions",value:function(e){var t=e.areContours,n=e.thickness;t?this._drawingOptions=i.getDefaultDrawingOptions():(this._drawingOptions=i._defaultDrawnSignatureOptions.clone(),this._drawingOptions.updateProperties({"stroke-width":n}))}},{key:"serialize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.isEmpty())return null;var t=this.serializeDraw(e),i=t.lines,n=t.points,r=t.rect,a=this._drawingOptions["stroke-width"],s={annotationType:X.SIGNATURE,isSignature:!0,areContours:b(this,Jg)[Jg],color:[0,0,0],thickness:b(this,Jg)[Jg]?0:a,pageIndex:this.pageIndex,rect:r,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return e?(s.paths={lines:i,points:n},s.uuid=b(this,ty)[ty],s.isCopy=!0):s.lines=i,b(this,$g)[$g]&&(s.accessibilityData={type:"Figure",alt:b(this,$g)[$g]}),s}}],[{key:"initialize",value:function(e,t){wa.initialize(e,t),this._defaultDrawingOptions=new Kg,this._defaultDrawnSignatureOptions=new Qg(t.viewParameters)}},{key:"getDefaultDrawingOptions",value:function(e){var t=this._defaultDrawingOptions.clone();return t.updateProperties(e),t}},{key:"supportMultipleDrawings",get:function(){return!1}},{key:"typesMap",get:function(){return Ee(this,"typesMap",new Map)}},{key:"isDrawer",get:function(){return!1}},{key:"computeTelemetryFinalData",value:function(e){var t,i,n=e.get("hasDescription");return{hasAltText:null!==(t=n.get(!0))&&void 0!==t?t:0,hasNoAltText:null!==(i=n.get(!1))&&void 0!==i?i:0}}},{key:"deserializeDraw",value:function(e,t,i,n,r,a){return a.areContours?Dg.deserialize(e,t,i,n,r,a):Sg.deserialize(e,t,i,n,r,a)}},{key:"deserialize",value:function(){var e=(0,d.Z)((0,h.Z)().mark((function e(t,r,s){var o,l;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a(n(i),"deserialize",this).call(this,t,r,s);case 2:return b(l=e.sent,Jg)[Jg]=t.areContours,b(l,$g)[$g]=(null===(o=t.accessibilityData)||void 0===o?void 0:o.alt)||"",b(l,ty)[ty]=t.uuid,e.abrupt("return",l);case 7:case"end":return e.stop()}}),e,this)})));return function(t,i,n){return e.apply(this,arguments)}}()}]),i}(Up);iy._type="signature",iy._editorType=X.SIGNATURE,iy._defaultDrawingOptions=null;var ny=k("bitmap"),ry=k("bitmapId"),ay=k("bitmapPromise"),sy=k("bitmapUrl"),oy=k("bitmapFile"),ly=k("bitmapFileName"),uy=k("canvas"),hy=k("missingCanvas"),cy=k("resizeTimeoutId"),dy=k("isSvg"),vy=k("hasBeenAddedInUndoStack"),fy=k("getBitmapFetched"),py=k("getBitmapDone"),gy=k("getBitmap"),yy=k("createCanvas"),my=k("scaleBitmap"),by=k("drawBitmap"),wy=k("serializeBitmap"),ky=k("hasElementChanged"),Ay=function(e){P(i,e);var t=R(i);function i(e){var n;return(0,_.Z)(this,i),n=t.call(this,(0,l.Z)((0,l.Z)({},e),{},{name:"stampEditor"})),Object.defineProperty(o(n),ky,{value:My}),Object.defineProperty(o(n),wy,{value:Oy}),Object.defineProperty(o(n),by,{value:Cy}),Object.defineProperty(o(n),my,{value:Ey}),Object.defineProperty(o(n),yy,{value:Sy}),Object.defineProperty(o(n),gy,{value:Py}),Object.defineProperty(o(n),py,{value:xy}),Object.defineProperty(o(n),fy,{value:_y}),Object.defineProperty(o(n),ny,{writable:!0,value:null}),Object.defineProperty(o(n),ry,{writable:!0,value:null}),Object.defineProperty(o(n),ay,{writable:!0,value:null}),Object.defineProperty(o(n),sy,{writable:!0,value:null}),Object.defineProperty(o(n),oy,{writable:!0,value:null}),Object.defineProperty(o(n),ly,{writable:!0,value:""}),Object.defineProperty(o(n),uy,{writable:!0,value:null}),Object.defineProperty(o(n),hy,{writable:!0,value:!1}),Object.defineProperty(o(n),cy,{writable:!0,value:null}),Object.defineProperty(o(n),dy,{writable:!0,value:!1}),Object.defineProperty(o(n),vy,{writable:!0,value:!1}),b(o(n),sy)[sy]=e.bitmapUrl,b(o(n),oy)[oy]=e.bitmapFile,n.defaultL10nId="pdfjs-editor-stamp-editor",n}return(0,A.Z)(i,[{key:"altTextFinish",value:function(){this._uiManager.useNewAltTextFlow&&(this.div.hidden=!1),a(n(i.prototype),"altTextFinish",this).call(this)}},{key:"telemetryFinalData",get:function(){var e;return{type:"stamp",hasAltText:!(null===(e=this.altTextData)||void 0===e||!e.altText)}}},{key:"mlGuessAltText",value:function(){var e=(0,d.Z)((0,h.Z)().mark((function e(){var t,i,n,r,a,s,o,l,u,c=arguments;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=c.length>0&&void 0!==c[0]?c[0]:null,i=!(c.length>1&&void 0!==c[1])||c[1],!this.hasAltTextData()){e.next=4;break}return e.abrupt("return",null);case 4:if(n=this._uiManager.mlManager){e.next=7;break}throw new Error("No ML.");case 7:return e.next=9,n.isEnabledFor("altText");case 9:if(e.sent){e.next=11;break}throw new Error("ML isn't enabled for alt text.");case 11:return r=t||this.copyCanvas(null,null,!0).imageData,a=r.data,s=r.width,o=r.height,e.next=14,n.guess({name:"altText",request:{data:a,width:s,height:o,channels:a.length/(s*o)}});case 14:if(l=e.sent){e.next=17;break}throw new Error("No response from the AI service.");case 17:if(!l.error){e.next=19;break}throw new Error("Error from the AI service.");case 19:if(!l.cancel){e.next=21;break}return e.abrupt("return",null);case 21:if(l.output){e.next=23;break}throw new Error("No valid response from the AI service.");case 23:return u=l.output,e.next=26,this.setGuessedAltText(u);case 26:return i&&!this.hasAltTextData()&&(this.altTextData={alt:u,decorative:!1}),e.abrupt("return",u);case 28:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"remove",value:function(){var e;b(this,ry)[ry]&&(b(this,ny)[ny]=null,this._uiManager.imageManager.deleteId(b(this,ry)[ry]),null===(e=b(this,uy)[uy])||void 0===e||e.remove(),b(this,uy)[uy]=null,b(this,cy)[cy]&&(clearTimeout(b(this,cy)[cy]),b(this,cy)[cy]=null));a(n(i.prototype),"remove",this).call(this)}},{key:"rebuild",value:function(){this.parent?(a(n(i.prototype),"rebuild",this).call(this),null!==this.div&&(b(this,ry)[ry]&&null===b(this,uy)[uy]&&b(this,gy)[gy](),this.isAttachedToDOM||this.parent.add(this))):b(this,ry)[ry]&&b(this,gy)[gy]()}},{key:"onceAdded",value:function(e){this._isDraggable=!0,e&&this.div.focus()}},{key:"isEmpty",value:function(){return!(b(this,ay)[ay]||b(this,ny)[ny]||b(this,sy)[sy]||b(this,oy)[oy]||b(this,ry)[ry]||b(this,hy)[hy])}},{key:"toolbarButtons",get:function(){return[["altText",this.createAltText()]]}},{key:"isResizable",get:function(){return!0}},{key:"render",value:function(){return this.div||(this._isCopy&&(e=this.x,t=this.y),a(n(i.prototype),"render",this).call(this),this.div.hidden=!0,this.createAltText(),b(this,hy)[hy]||(b(this,ny)[ny]?b(this,yy)[yy]():b(this,gy)[gy]()),this._isCopy&&this._moveAfterPaste(e,t),this._uiManager.addShouldRescale(this)),this.div;var e,t}},{key:"setCanvas",value:function(e,t){var i=this._uiManager.imageManager.getFromCanvas(e,t),n=i.id,r=i.bitmap;t.remove(),n&&this._uiManager.imageManager.isValidId(n)&&(b(this,ry)[ry]=n,r&&(b(this,ny)[ny]=r),b(this,hy)[hy]=!1,b(this,yy)[yy]())}},{key:"_onResized",value:function(){this.onScaleChanging()}},{key:"onScaleChanging",value:function(){var e=this;if(this.parent){null!==b(this,cy)[cy]&&clearTimeout(b(this,cy)[cy]);b(this,cy)[cy]=setTimeout((function(){b(e,cy)[cy]=null,b(e,by)[by]()}),200)}}},{key:"copyCanvas",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];e||(e=224);var n=b(this,ny)[ny],r=n.width,a=n.height,s=new yt,o=b(this,ny)[ny],l=r,u=a,h=null;if(t){var c,d;if(r>t||a>t){var v=Math.min(t/r,t/a);l=Math.floor(r*v),u=Math.floor(a*v)}var f=(h=document.createElement("canvas")).width=Math.ceil(l*s.sx),p=h.height=Math.ceil(u*s.sy);b(this,dy)[dy]||(o=b(this,my)[my](f,p));var g=h.getContext("2d");g.filter=this._uiManager.hcmFilter;var y="white",m="#cfcfd8";"none"!==this._uiManager.hcmFilter?m="black":null!==(c=(d=window).matchMedia)&&void 0!==c&&c.call(d,"(prefers-color-scheme: dark)").matches&&(y="#8f8f9d",m="#42414d");var w=15,k=w*s.sx,A=w*s.sy,_=new OffscreenCanvas(2*k,2*A),x=_.getContext("2d");x.fillStyle=y,x.fillRect(0,0,2*k,2*A),x.fillStyle=m,x.fillRect(0,0,k,A),x.fillRect(k,A,k,A),g.fillStyle=g.createPattern(_,"repeat"),g.fillRect(0,0,f,p),g.drawImage(o,0,0,o.width,o.height,0,0,f,p)}var P=null;if(i){var S,E;if(s.symmetric&&o.width<e&&o.height<e)S=o.width,E=o.height;else if(o=b(this,ny)[ny],r>e||a>e){var C=Math.min(e/r,e/a);S=Math.floor(r*C),E=Math.floor(a*C),b(this,dy)[dy]||(o=b(this,my)[my](S,E))}var O=new OffscreenCanvas(S,E),M=O.getContext("2d",{willReadFrequently:!0});M.drawImage(o,0,0,o.width,o.height,0,0,S,E),P={width:S,height:E,data:M.getImageData(0,0,S,E).data}}return{canvas:h,width:l,height:u,imageData:P}}},{key:"serialize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();var i={annotationType:X.STAMP,bitmapId:b(this,ry)[ry],pageIndex:this.pageIndex,rect:this.getRect(0,0),rotation:this.rotation,isSvg:b(this,dy)[dy],structTreeParentId:this._structTreeParentId};if(e)return i.bitmapUrl=b(this,wy)[wy](!0),i.accessibilityData=this.serializeAltText(!0),i.isCopy=!0,i;var n=this.serializeAltText(!1),r=n.decorative,a=n.altText;if(!r&&a&&(i.accessibilityData={type:"Figure",alt:a}),this.annotationElementId){var s,o=b(this,ky)[ky](i);if(o.isSame)return null;if(o.isSameAltText)delete i.accessibilityData;else i.accessibilityData.structParent=null!==(s=this._initialData.structParent)&&void 0!==s?s:-1}if(i.id=this.annotationElementId,null===t)return i;t.stamps||(t.stamps=new Map);var l=b(this,dy)[dy]?(i.rect[2]-i.rect[0])*(i.rect[3]-i.rect[1]):null;if(t.stamps.has(b(this,ry)[ry])){if(b(this,dy)[dy]){var u=t.stamps.get(b(this,ry)[ry]);l>u.area&&(u.area=l,u.serialized.bitmap.close(),u.serialized.bitmap=b(this,wy)[wy](!1))}}else t.stamps.set(b(this,ry)[ry],{area:l,serialized:i}),i.bitmap=b(this,wy)[wy](!1);return i}},{key:"renderAnnotationElement",value:function(e){return e.updateEdited({rect:this.getRect(0,0)}),null}}],[{key:"initialize",value:function(e,t){wa.initialize(e,t)}},{key:"isHandlingMimeForPasting",value:function(e){return mt.includes(e)}},{key:"paste",value:function(e,t){t.pasteEditor({mode:X.STAMP},{bitmapFile:e.getAsFile()})}},{key:"computeTelemetryFinalData",value:function(e){var t,i,n=e.get("hasAltText");return{hasAltText:null!==(t=n.get(!0))&&void 0!==t?t:0,hasNoAltText:null!==(i=n.get(!1))&&void 0!==i?i:0}}},{key:"deserialize",value:function(){var e=(0,d.Z)((0,h.Z)().mark((function e(t,r,s){var o,l,u,d,v,f,p,g,y,m,w,k,A,_,x,P,S,E,C,O,M,T,R,Z,I,D,L,j;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=null,l=!1,!(t instanceof vd)){e.next=21;break}return v=(d=t).data,f=v.rect,p=v.rotation,g=v.id,y=v.structParent,m=v.popupRef,w=d.container,k=d.parent.page.pageNumber,(A=d.canvas)?(delete t.canvas,P=s.imageManager.getFromCanvas(w.id,A),_=P.id,x=P.bitmap,A.remove()):(l=!0,t._hasNoCanvas=!0),e.next=7,r._structTree.getAriaAttributes("".concat(qe).concat(g));case 7:if(e.t2=u=e.sent,e.t1=null===e.t2,e.t1){e.next=11;break}e.t1=void 0===u;case 11:if(!e.t1){e.next=15;break}e.t3=void 0,e.next=16;break;case 15:e.t3=u.get("aria-label");case 16:if(e.t0=e.t3,e.t0){e.next=19;break}e.t0="";case 19:S=e.t0,o=t={annotationType:X.STAMP,bitmapId:_,bitmap:x,pageIndex:k-1,rect:f.slice(0),rotation:p,annotationElementId:g,id:g,deleted:!1,accessibilityData:{decorative:!1,altText:S},isSvg:!1,structParent:y,popupRef:m};case 21:return e.next=23,a(n(i),"deserialize",this).call(this,t,r,s);case 23:return E=e.sent,O=(C=t).rect,M=C.bitmap,T=C.bitmapUrl,R=C.bitmapId,Z=C.isSvg,I=C.accessibilityData,l?(s.addMissingCanvas(t.id,E),b(E,hy)[hy]=!0):R&&s.imageManager.isValidId(R)?(b(E,ry)[ry]=R,M&&(b(E,ny)[ny]=M)):b(E,sy)[sy]=T,b(E,dy)[dy]=Z,D=(0,c.Z)(E.pageDimensions,2),L=D[0],j=D[1],E.width=(O[2]-O[0])/L,E.height=(O[3]-O[1])/j,I&&(E.altTextData=I),E._initialData=o,b(E,vy)[vy]=!!o,e.abrupt("return",E);case 34:case"end":return e.stop()}}),e,this)})));return function(t,i,n){return e.apply(this,arguments)}}()}]),i}(wa);function _y(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e?(b(this,ny)[ny]=e.bitmap,t||(b(this,ry)[ry]=e.id,b(this,dy)[dy]=e.isSvg),e.file&&(b(this,ly)[ly]=e.file.name),b(this,yy)[yy]()):this.remove()}function xy(){var e=this;if(b(this,ay)[ay]=null,this._uiManager.enableWaiting(!1),b(this,uy)[uy])if(this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&b(this,ny)[ny])this.addEditToolbar().then((function(){e._editToolbar.hide(),e._uiManager.editAltText(e,!0)}));else{if(!this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&b(this,ny)[ny]){this._reportTelemetry({action:"pdfjs.image.image_added",data:{alt_text_modal:!1,alt_text_type:"empty"}});try{this.mlGuessAltText()}catch(t){}}this.div.focus()}}function Py(){var e=this;if(b(this,ry)[ry])return this._uiManager.enableWaiting(!0),void this._uiManager.imageManager.getFromId(b(this,ry)[ry]).then((function(t){return b(e,fy)[fy](t,!0)})).finally((function(){return b(e,py)[py]()}));if(b(this,sy)[sy]){var t=b(this,sy)[sy];return b(this,sy)[sy]=null,this._uiManager.enableWaiting(!0),void(b(this,ay)[ay]=this._uiManager.imageManager.getFromUrl(t).then((function(t){return b(e,fy)[fy](t)})).finally((function(){return b(e,py)[py]()})))}if(b(this,oy)[oy]){var i=b(this,oy)[oy];return b(this,oy)[oy]=null,this._uiManager.enableWaiting(!0),void(b(this,ay)[ay]=this._uiManager.imageManager.getFromFile(i).then((function(t){return b(e,fy)[fy](t)})).finally((function(){return b(e,py)[py]()})))}var n=document.createElement("input");n.type="file",n.accept=mt.join(",");var r=this._uiManager._signal;b(this,ay)[ay]=new Promise((function(t){n.addEventListener("change",(0,d.Z)((0,h.Z)().mark((function i(){var r;return(0,h.Z)().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(n.files&&0!==n.files.length){i.next=4;break}e.remove(),i.next=10;break;case 4:return e._uiManager.enableWaiting(!0),i.next=7,e._uiManager.imageManager.getFromFile(n.files[0]);case 7:r=i.sent,e._reportTelemetry({action:"pdfjs.image.image_selected",data:{alt_text_modal:e._uiManager.useNewAltTextFlow}}),b(e,fy)[fy](r);case 10:t();case 11:case"end":return i.stop()}}),i)}))),{signal:r}),n.addEventListener("cancel",(function(){e.remove(),t()}),{signal:r})})).finally((function(){return b(e,py)[py]()})),n.click()}function Sy(){var e,t=this.div,i=b(this,ny)[ny],n=i.width,r=i.height,a=(0,c.Z)(this.pageDimensions,2),s=a[0],o=a[1],l=.75;if(this.width)n=this.width*s,r=this.height*o;else if(n>l*s||r>l*o){var u=Math.min(l*s/n,l*o/r);n*=u,r*=u}var h=(0,c.Z)(this.parentDimensions,2),d=h[0],v=h[1];this.setDims(n*d/s,r*v/o),this._uiManager.enableWaiting(!1);var f=b(this,uy)[uy]=document.createElement("canvas");f.setAttribute("role","img"),this.addContainer(f),this.width=n/s,this.height=r/o,null!==(e=this._initialOptions)&&void 0!==e&&e.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&!this.annotationElementId||(t.hidden=!1),b(this,by)[by](),b(this,vy)[vy]||(this.parent.addUndoableEditor(this),b(this,vy)[vy]=!0),this._reportTelemetry({action:"inserted_image"}),b(this,ly)[ly]&&this.div.setAttribute("aria-description",b(this,ly)[ly]),this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-stamp-added-alert")}function Ey(e,t){for(var i=b(this,ny)[ny],n=i.width,r=i.height,a=b(this,ny)[ny];n>2*e||r>2*t;){var s=n,o=r;n>2*e&&(n=n>=16384?Math.floor(n/2)-1:Math.ceil(n/2)),r>2*t&&(r=r>=16384?Math.floor(r/2)-1:Math.ceil(r/2));var l=new OffscreenCanvas(n,r);l.getContext("2d").drawImage(a,0,0,s,o,0,0,n,r),a=l.transferToImageBitmap()}return a}function Cy(){var e=(0,c.Z)(this.parentDimensions,2),t=e[0],i=e[1],n=this.width,r=this.height,a=new yt,s=Math.ceil(n*t*a.sx),o=Math.ceil(r*i*a.sy),l=b(this,uy)[uy];if(l&&(l.width!==s||l.height!==o)){l.width=s,l.height=o;var u=b(this,dy)[dy]?b(this,ny)[ny]:b(this,my)[my](s,o),h=l.getContext("2d");h.filter=this._uiManager.hcmFilter,h.drawImage(u,0,0,u.width,u.height,0,0,s,o)}}function Oy(e){if(e){if(b(this,dy)[dy]){var t=this._uiManager.imageManager.getSvgUrl(b(this,ry)[ry]);if(t)return t}var i=document.createElement("canvas"),n=b(this,ny)[ny];return i.width=n.width,i.height=n.height,i.getContext("2d").drawImage(b(this,ny)[ny],0,0),i.toDataURL()}if(b(this,dy)[dy]){var r=(0,c.Z)(this.pageDimensions,2),a=r[0],s=r[1],o=Math.round(this.width*a*Qe.PDF_TO_CSS_UNITS),l=Math.round(this.height*s*Qe.PDF_TO_CSS_UNITS),u=new OffscreenCanvas(o,l);return u.getContext("2d").drawImage(b(this,ny)[ny],0,0,b(this,ny)[ny].width,b(this,ny)[ny].height,0,0,o,l),u.transferToImageBitmap()}return structuredClone(b(this,ny)[ny])}function My(e){var t,i=this._initialData,n=i.pageIndex,r=i.accessibilityData.altText,a=e.pageIndex===n,s=((null===(t=e.accessibilityData)||void 0===t?void 0:t.alt)||"")===r;return{isSame:!this._hasBeenMoved&&!this._hasBeenResized&&a&&s,isSameAltText:s}}Ay._type="stamp",Ay._editorType=X.STAMP;var Ty=k("accessibilityManager"),Ry=k("allowClick"),Zy=k("annotationLayer"),Iy=k("clickAC"),Dy=k("editorFocusTimeoutId"),Ly=k("editors"),jy=k("hadPointerDown"),Fy=k("isDisabling"),Ny=k("isEnabling"),By=k("drawingAC"),Hy=k("focusedElement"),zy=k("textLayer"),Gy=k("textSelectionAC"),Uy=k("textLayerDblClickAC"),Vy=k("lastPointerDownTimestamp"),Wy=k("uiManager"),qy=k("editorTypes"),Xy=k("textLayerPointerDown"),Yy=k("currentEditorType"),Ky=k("createNewEditor"),Qy=k("getCenterPoint"),Jy=k("cleanup"),$y=function(){function e(t){var i=t.uiManager,n=t.pageIndex,r=t.div,a=t.structTreeLayer,s=t.accessibilityManager,o=t.annotationLayer,l=t.drawLayer,h=t.textLayer,c=t.viewport,d=t.l10n;(0,_.Z)(this,e),Object.defineProperty(this,Jy,{value:rm}),Object.defineProperty(this,Qy,{value:nm}),Object.defineProperty(this,Ky,{value:im}),Object.defineProperty(this,Yy,{get:tm,set:void 0}),Object.defineProperty(this,Xy,{value:em}),Object.defineProperty(this,Ty,{writable:!0,value:void 0}),Object.defineProperty(this,Ry,{writable:!0,value:!1}),Object.defineProperty(this,Zy,{writable:!0,value:null}),Object.defineProperty(this,Iy,{writable:!0,value:null}),Object.defineProperty(this,Dy,{writable:!0,value:null}),Object.defineProperty(this,Ly,{writable:!0,value:new Map}),Object.defineProperty(this,jy,{writable:!0,value:!1}),Object.defineProperty(this,Fy,{writable:!0,value:!1}),Object.defineProperty(this,Ny,{writable:!0,value:!1}),Object.defineProperty(this,By,{writable:!0,value:null}),Object.defineProperty(this,Hy,{writable:!0,value:null}),Object.defineProperty(this,zy,{writable:!0,value:null}),Object.defineProperty(this,Gy,{writable:!0,value:null}),Object.defineProperty(this,Uy,{writable:!0,value:null}),Object.defineProperty(this,Vy,{writable:!0,value:-1}),Object.defineProperty(this,Wy,{writable:!0,value:void 0});var f=(0,u.Z)(b(e,qy)[qy].values());if(!e._initialized){e._initialized=!0;var p,g=(0,v.Z)(f);try{for(g.s();!(p=g.n()).done;){p.value.initialize(d,i)}}catch(y){g.e(y)}finally{g.f()}}i.registerEditorTypes(f),b(this,Wy)[Wy]=i,this.pageIndex=n,this.div=r,b(this,Ty)[Ty]=s,b(this,Zy)[Zy]=o,this.viewport=c,b(this,zy)[zy]=h,this.drawLayer=l,this._structTree=a,b(this,Wy)[Wy].addLayer(this)}return(0,A.Z)(e,[{key:"isEmpty",get:function(){return 0===b(this,Ly)[Ly].size}},{key:"isInvisible",get:function(){return this.isEmpty&&b(this,Wy)[Wy].getMode()===X.NONE}},{key:"updateToolbar",value:function(e){b(this,Wy)[Wy].updateToolbar(e)}},{key:"updateMode",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:b(this,Wy)[Wy].getMode();switch(b(this,Jy)[Jy](),t){case X.NONE:return this.disableTextSelection(),this.togglePointerEvents(!1),this.toggleAnnotationLayerPointerEvents(!0),void this.disableClick();case X.INK:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick();break;case X.HIGHLIGHT:this.enableTextSelection(),this.togglePointerEvents(!1),this.disableClick();break;default:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick()}this.toggleAnnotationLayerPointerEvents(!1);var i,n=this.div.classList,r=(0,v.Z)(b(e,qy)[qy].values());try{for(r.s();!(i=r.n()).done;){var a=i.value;n.toggle("".concat(a._type,"Editing"),t===a._editorType)}}catch(s){r.e(s)}finally{r.f()}this.div.hidden=!1}},{key:"hasTextLayer",value:function(e){var t;return e===(null===(t=b(this,zy)[zy])||void 0===t?void 0:t.div)}},{key:"setEditingState",value:function(e){b(this,Wy)[Wy].setEditingState(e)}},{key:"addCommands",value:function(e){b(this,Wy)[Wy].addCommands(e)}},{key:"cleanUndoStack",value:function(e){b(this,Wy)[Wy].cleanUndoStack(e)}},{key:"toggleDrawing",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.div.classList.toggle("drawing",!e)}},{key:"togglePointerEvents",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.div.classList.toggle("disabled",!e)}},{key:"toggleAnnotationLayerPointerEvents",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];null===(e=b(this,Zy)[Zy])||void 0===e||e.div.classList.toggle("disabled",!t)}},{key:"enable",value:function(){var e=(0,d.Z)((0,h.Z)().mark((function e(){var t,i,n,r,a,s,o,l,u,c;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:b(this,Ny)[Ny]=!0,this.div.tabIndex=0,this.togglePointerEvents(!0),null===(t=b(this,Uy)[Uy])||void 0===t||t.abort(),b(this,Uy)[Uy]=null,i=new Set,n=(0,v.Z)(b(this,Ly)[Ly].values());try{for(n.s();!(r=n.n()).done;)(a=r.value).enableEditing(),a.show(!0),a.annotationElementId&&(b(this,Wy)[Wy].removeChangedExistingAnnotation(a),i.add(a.annotationElementId))}catch(h){n.e(h)}finally{n.f()}if(b(this,Zy)[Zy]){e.next=11;break}return b(this,Ny)[Ny]=!1,e.abrupt("return");case 11:s=b(this,Zy)[Zy].getEditableAnnotations(),o=(0,v.Z)(s),e.prev=13,o.s();case 15:if((l=o.n()).done){e.next=31;break}if((u=l.value).hide(),!b(this,Wy)[Wy].isDeletedAnnotationElement(u.data.id)){e.next=20;break}return e.abrupt("continue",29);case 20:if(!i.has(u.data.id)){e.next=22;break}return e.abrupt("continue",29);case 22:return e.next=24,this.deserialize(u);case 24:if(c=e.sent){e.next=27;break}return e.abrupt("continue",29);case 27:this.addOrRebuild(c),c.enableEditing();case 29:e.next=15;break;case 31:e.next=36;break;case 33:e.prev=33,e.t0=e.catch(13),o.e(e.t0);case 36:return e.prev=36,o.f(),e.finish(36);case 39:b(this,Ny)[Ny]=!1;case 40:case"end":return e.stop()}}),e,this,[[13,33,36,39]])})));return function(){return e.apply(this,arguments)}}()},{key:"disable",value:function(){var t=this;if(b(this,Fy)[Fy]=!0,this.div.tabIndex=-1,this.togglePointerEvents(!1),b(this,zy)[zy]&&!b(this,Uy)[Uy]){b(this,Uy)[Uy]=new AbortController;var i=b(this,Wy)[Wy].combinedSignal(b(this,Uy)[Uy]);b(this,zy)[zy].div.addEventListener("pointerdown",(function(e){var i=e.clientX,n=e.clientY,r=e.timeStamp;if(r-b(t,Vy)[Vy]>500)b(t,Vy)[Vy]=r;else{b(t,Vy)[Vy]=-1;var a=t.div.classList;a.toggle("getElements",!0);var s=document.elementsFromPoint(i,n);if(a.toggle("getElements",!1),t.div.contains(s[0])){var o,l,u=new RegExp("^".concat(q,"[0-9]+$")),h=(0,v.Z)(s);try{for(h.s();!(l=h.n()).done;){var c=l.value;if(u.test(c.id)){o=c.id;break}}}catch(f){h.e(f)}finally{h.f()}if(o){var d=b(t,Ly)[Ly].get(o);null===(null===d||void 0===d?void 0:d.annotationElementId)&&(e.stopPropagation(),e.preventDefault(),d.dblclick())}}}}),{signal:i,capture:!0})}var n,r=new Map,a=new Map,s=(0,v.Z)(b(this,Ly)[Ly].values());try{for(s.s();!(n=s.n()).done;){var o,l=n.value;l.disableEditing(),l.annotationElementId&&(null===l.serialize()?(a.set(l.annotationElementId,l),null===(o=this.getEditableAnnotation(l.annotationElementId))||void 0===o||o.show(),l.remove()):r.set(l.annotationElementId,l))}}catch(k){s.e(k)}finally{s.f()}if(b(this,Zy)[Zy]){var u,h=b(this,Zy)[Zy].getEditableAnnotations(),c=(0,v.Z)(h);try{for(c.s();!(u=c.n()).done;){var d=u.value,f=d.data.id;if(!b(this,Wy)[Wy].isDeletedAnnotationElement(f)){var p=a.get(f);p?(p.resetAnnotationElement(d),p.show(!1),d.show()):((p=r.get(f))&&(b(this,Wy)[Wy].addChangedExistingAnnotation(p),p.renderAnnotationElement(d)&&p.show(!1)),d.show())}}}catch(k){c.e(k)}finally{c.f()}}b(this,Jy)[Jy](),this.isEmpty&&(this.div.hidden=!0);var g,y=this.div.classList,m=(0,v.Z)(b(e,qy)[qy].values());try{for(m.s();!(g=m.n()).done;){var w=g.value;y.remove("".concat(w._type,"Editing"))}}catch(k){m.e(k)}finally{m.f()}this.disableTextSelection(),this.toggleAnnotationLayerPointerEvents(!0),b(this,Fy)[Fy]=!1}},{key:"getEditableAnnotation",value:function(e){var t;return(null===(t=b(this,Zy)[Zy])||void 0===t?void 0:t.getEditableAnnotation(e))||null}},{key:"setActiveEditor",value:function(e){b(this,Wy)[Wy].getActive()!==e&&b(this,Wy)[Wy].setActiveEditor(e)}},{key:"enableTextSelection",value:function(){var e;if(this.div.tabIndex=-1,null!==(e=b(this,zy)[zy])&&void 0!==e&&e.div&&!b(this,Gy)[Gy]){b(this,Gy)[Gy]=new AbortController;var t=b(this,Wy)[Wy].combinedSignal(b(this,Gy)[Gy]);b(this,zy)[zy].div.addEventListener("pointerdown",b(this,Xy)[Xy].bind(this),{signal:t}),b(this,zy)[zy].div.classList.add("highlighting")}}},{key:"disableTextSelection",value:function(){var e;this.div.tabIndex=0,null!==(e=b(this,zy)[zy])&&void 0!==e&&e.div&&b(this,Gy)[Gy]&&(b(this,Gy)[Gy].abort(),b(this,Gy)[Gy]=null,b(this,zy)[zy].div.classList.remove("highlighting"))}},{key:"enableClick",value:function(){if(!b(this,Iy)[Iy]){b(this,Iy)[Iy]=new AbortController;var e=b(this,Wy)[Wy].combinedSignal(b(this,Iy)[Iy]);this.div.addEventListener("pointerdown",this.pointerdown.bind(this),{signal:e});var t=this.pointerup.bind(this);this.div.addEventListener("pointerup",t,{signal:e}),this.div.addEventListener("pointercancel",t,{signal:e})}}},{key:"disableClick",value:function(){var e;null===(e=b(this,Iy)[Iy])||void 0===e||e.abort(),b(this,Iy)[Iy]=null}},{key:"attach",value:function(e){b(this,Ly)[Ly].set(e.id,e);var t=e.annotationElementId;t&&b(this,Wy)[Wy].isDeletedAnnotationElement(t)&&b(this,Wy)[Wy].removeDeletedAnnotationElement(e)}},{key:"detach",value:function(e){var t;b(this,Ly)[Ly].delete(e.id),null===(t=b(this,Ty)[Ty])||void 0===t||t.removePointerInTextLayer(e.contentDiv),!b(this,Fy)[Fy]&&e.annotationElementId&&b(this,Wy)[Wy].addDeletedAnnotationElement(e)}},{key:"remove",value:function(e){this.detach(e),b(this,Wy)[Wy].removeEditor(e),e.div.remove(),e.isAttachedToDOM=!1}},{key:"changeParent",value:function(e){var t;e.parent!==this&&(e.parent&&e.annotationElementId&&(b(this,Wy)[Wy].addDeletedAnnotationElement(e.annotationElementId),wa.deleteAnnotationElement(e),e.annotationElementId=null),this.attach(e),null===(t=e.parent)||void 0===t||t.detach(e),e.setParent(this),e.div&&e.isAttachedToDOM&&(e.div.remove(),this.div.append(e.div)))}},{key:"add",value:function(e){if(e.parent!==this||!e.isAttachedToDOM){if(this.changeParent(e),b(this,Wy)[Wy].addEditor(e),this.attach(e),!e.isAttachedToDOM){var t=e.render();this.div.append(t),e.isAttachedToDOM=!0}e.fixAndSetPosition(),e.onceAdded(!b(this,Ny)[Ny]),b(this,Wy)[Wy].addToAnnotationStorage(e),e._reportTelemetry(e.telemetryInitialData)}}},{key:"moveEditorInDOM",value:function(e){var t,i=this;if(e.isAttachedToDOM){var n=document.activeElement;e.div.contains(n)&&!b(this,Dy)[Dy]&&(e._focusEventsAllowed=!1,b(this,Dy)[Dy]=setTimeout((function(){b(i,Dy)[Dy]=null,e.div.contains(document.activeElement)?e._focusEventsAllowed=!0:(e.div.addEventListener("focusin",(function(){e._focusEventsAllowed=!0}),{once:!0,signal:b(i,Wy)[Wy]._signal}),n.focus())}),0)),e._structTreeParentId=null===(t=b(this,Ty)[Ty])||void 0===t?void 0:t.moveElementInDOM(this.div,e.div,e.contentDiv,!0)}}},{key:"addOrRebuild",value:function(e){e.needsToBeRebuilt()?(e.parent||(e.parent=this),e.rebuild(),e.show()):this.add(e)}},{key:"addUndoableEditor",value:function(e){this.addCommands({cmd:function(){return e._uiManager.rebuild(e)},undo:function(){e.remove()},mustExec:!1})}},{key:"getNextId",value:function(){return b(this,Wy)[Wy].getId()}},{key:"combinedSignal",value:function(e){return b(this,Wy)[Wy].combinedSignal(e)}},{key:"canCreateNewEmptyEditor",value:function(){var e;return null===(e=b(this,Yy)[Yy])||void 0===e?void 0:e.canCreateNewEmptyEditor()}},{key:"pasteEditor",value:function(){var e=(0,d.Z)((0,h.Z)().mark((function e(t,i){var n,r,a,s,o;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.updateToolbar(t),e.next=3,b(this,Wy)[Wy].updateMode(t.mode);case 3:n=b(this,Qy)[Qy](),r=n.offsetX,a=n.offsetY,s=this.getNextId(),(o=b(this,Ky)[Ky]((0,l.Z)({parent:this,id:s,x:r,y:a,uiManager:b(this,Wy)[Wy],isCentered:!0},i)))&&this.add(o);case 7:case"end":return e.stop()}}),e,this)})));return function(t,i){return e.apply(this,arguments)}}()},{key:"deserialize",value:function(){var t=(0,d.Z)((0,h.Z)().mark((function t(i){var n,r;return(0,h.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,null===(n=b(e,qy)[qy].get(null!==(r=i.annotationType)&&void 0!==r?r:i.annotationEditorType))||void 0===n?void 0:n.deserialize(i,this,b(this,Wy)[Wy]);case 2:if(t.t0=t.sent,t.t0){t.next=5;break}t.t0=null;case 5:return t.abrupt("return",t.t0);case 6:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"createAndAddNewEditor",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=this.getNextId(),r=b(this,Ky)[Ky]((0,l.Z)({parent:this,id:n,x:e.offsetX,y:e.offsetY,uiManager:b(this,Wy)[Wy],isCentered:t},i));return r&&this.add(r),r}},{key:"addNewEditor",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.createAndAddNewEditor(b(this,Qy)[Qy](),!0,e)}},{key:"setSelected",value:function(e){b(this,Wy)[Wy].setSelected(e)}},{key:"toggleSelected",value:function(e){b(this,Wy)[Wy].toggleSelected(e)}},{key:"unselect",value:function(e){b(this,Wy)[Wy].unselect(e)}},{key:"pointerup",value:function(e){var t,i=je.platform.isMac;if(!(0!==e.button||e.ctrlKey&&i)&&e.target===this.div&&b(this,jy)[jy]&&(b(this,jy)[jy]=!1,null===(t=b(this,Yy)[Yy])||void 0===t||!t.isDrawer||!b(this,Yy)[Yy].supportMultipleDrawings))if(b(this,Ry)[Ry]){var n=b(this,Wy)[Wy].getMode();n!==X.STAMP&&n!==X.SIGNATURE?this.createAndAddNewEditor(e,!1):b(this,Wy)[Wy].unselectAll()}else b(this,Ry)[Ry]=!0}},{key:"pointerdown",value:function(e){var t;if(b(this,Wy)[Wy].getMode()===X.HIGHLIGHT&&this.enableTextSelection(),b(this,jy)[jy])b(this,jy)[jy]=!1;else{var i=je.platform.isMac;if(!(0!==e.button||e.ctrlKey&&i)&&e.target===this.div)if(b(this,jy)[jy]=!0,null!==(t=b(this,Yy)[Yy])&&void 0!==t&&t.isDrawer)this.startDrawingSession(e);else{var n=b(this,Wy)[Wy].getActive();b(this,Ry)[Ry]=!n||n.isEmpty()}}}},{key:"startDrawingSession",value:function(e){var t=this;if(this.div.focus({preventScroll:!0}),b(this,By)[By])b(this,Yy)[Yy].startDrawing(this,b(this,Wy)[Wy],!1,e);else{b(this,Wy)[Wy].setCurrentDrawingSession(this),b(this,By)[By]=new AbortController;var i=b(this,Wy)[Wy].combinedSignal(b(this,By)[By]);this.div.addEventListener("blur",(function(e){var i=e.relatedTarget;i&&!t.div.contains(i)&&(b(t,Hy)[Hy]=null,t.commitOrRemove())}),{signal:i}),b(this,Yy)[Yy].startDrawing(this,b(this,Wy)[Wy],!1,e)}}},{key:"pause",value:function(e){var t=this;if(e){var i=document.activeElement;this.div.contains(i)&&(b(this,Hy)[Hy]=i)}else b(this,Hy)[Hy]&&setTimeout((function(){var e;null===(e=b(t,Hy)[Hy])||void 0===e||e.focus(),b(t,Hy)[Hy]=null}),0)}},{key:"endDrawingSession",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return b(this,By)[By]?(b(this,Wy)[Wy].setCurrentDrawingSession(null),b(this,By)[By].abort(),b(this,By)[By]=null,b(this,Hy)[Hy]=null,b(this,Yy)[Yy].endDrawing(e)):null}},{key:"findNewParent",value:function(e,t,i){var n=b(this,Wy)[Wy].findParent(t,i);return null!==n&&n!==this&&(n.changeParent(e),!0)}},{key:"commitOrRemove",value:function(){return!!b(this,By)[By]&&(this.endDrawingSession(),!0)}},{key:"onScaleChanging",value:function(){b(this,By)[By]&&b(this,Yy)[Yy].onScaleChangingWhenDrawing(this)}},{key:"destroy",value:function(){var e;this.commitOrRemove(),(null===(e=b(this,Wy)[Wy].getActive())||void 0===e?void 0:e.parent)===this&&(b(this,Wy)[Wy].commitOrRemove(),b(this,Wy)[Wy].setActiveEditor(null)),b(this,Dy)[Dy]&&(clearTimeout(b(this,Dy)[Dy]),b(this,Dy)[Dy]=null);var t,i=(0,v.Z)(b(this,Ly)[Ly].values());try{for(i.s();!(t=i.n()).done;){var n,r=t.value;null===(n=b(this,Ty)[Ty])||void 0===n||n.removePointerInTextLayer(r.contentDiv),r.setParent(null),r.isAttachedToDOM=!1,r.div.remove()}}catch(a){i.e(a)}finally{i.f()}this.div=null,b(this,Ly)[Ly].clear(),b(this,Wy)[Wy].removeLayer(this)}},{key:"render",value:function(e){var t=e.viewport;this.viewport=t,gt(this.div,t);var i,n=(0,v.Z)(b(this,Wy)[Wy].getEditors(this.pageIndex));try{for(n.s();!(i=n.n()).done;){var r=i.value;this.add(r),r.rebuild()}}catch(a){n.e(a)}finally{n.f()}this.updateMode()}},{key:"update",value:function(e){var t=e.viewport;b(this,Wy)[Wy].commitOrRemove(),b(this,Jy)[Jy]();var i=this.viewport.rotation,n=t.rotation;if(this.viewport=t,gt(this.div,{rotation:n}),i!==n){var r,a=(0,v.Z)(b(this,Ly)[Ly].values());try{for(a.s();!(r=a.n()).done;){r.value.rotate(n)}}catch(s){a.e(s)}finally{a.f()}}}},{key:"pageDimensions",get:function(){var e=this.viewport.rawDims;return[e.pageWidth,e.pageHeight]}},{key:"scale",get:function(){return b(this,Wy)[Wy].viewParameters.realScale}}]),e}();function em(e){var t=this;b(this,Wy)[Wy].unselectAll();var i=e.target;if(i===b(this,zy)[zy].div||("img"===i.getAttribute("role")||i.classList.contains("endOfContent"))&&b(this,zy)[zy].div.contains(i)){var n=je.platform.isMac;if(0!==e.button||e.ctrlKey&&n)return;b(this,Wy)[Wy].showAllEditors("highlight",!0,!0),b(this,zy)[zy].div.classList.add("free"),this.toggleDrawing(),cp.startHighlighting(this,"ltr"===b(this,Wy)[Wy].direction,{target:b(this,zy)[zy].div,x:e.x,y:e.y}),b(this,zy)[zy].div.addEventListener("pointerup",(function(){b(t,zy)[zy].div.classList.remove("free"),t.toggleDrawing(!0)}),{once:!0,signal:b(this,Wy)[Wy]._signal}),e.preventDefault()}}function tm(){return b($y,qy)[qy].get(b(this,Wy)[Wy].getMode())}function im(e){var t=b(this,Yy)[Yy];return t?new t.prototype.constructor(e):null}function nm(){var e=this.div.getBoundingClientRect(),t=e.x,i=e.y,n=e.width,r=e.height,a=Math.max(0,t),s=Math.max(0,i),o=(a+Math.min(window.innerWidth,t+n))/2-t,l=(s+Math.min(window.innerHeight,i+r))/2-i,u=this.viewport.rotation%180===0?[o,l]:[l,o],h=(0,c.Z)(u,2);return{offsetX:h[0],offsetY:h[1]}}function rm(){var e,t=(0,v.Z)(b(this,Ly)[Ly].values());try{for(t.s();!(e=t.n()).done;){var i=e.value;i.isEmpty()&&i.remove()}}catch(n){t.e(n)}finally{t.f()}}$y._initialized=!1,Object.defineProperty($y,qy,{writable:!0,value:new Map([Gd,Zg,Ay,cp,iy].map((function(e){return[e._editorType,e]})))});var am=k("parent"),sm=k("mapping"),om=k("toUpdate"),lm=k("id"),um=k("setBox"),hm=k("createSVG"),cm=k("createClipPath"),dm=k("updateProperties"),vm=function(){function e(t){var i=t.pageIndex;(0,_.Z)(this,e),Object.defineProperty(this,dm,{value:gm}),Object.defineProperty(this,cm,{value:pm}),Object.defineProperty(this,hm,{value:fm}),Object.defineProperty(this,am,{writable:!0,value:null}),Object.defineProperty(this,sm,{writable:!0,value:new Map}),Object.defineProperty(this,om,{writable:!0,value:new Map}),this.pageIndex=i}return(0,A.Z)(e,[{key:"setParent",value:function(e){if(b(this,am)[am]){if(b(this,am)[am]!==e){if(b(this,sm)[sm].size>0){var t,i=(0,v.Z)(b(this,sm)[sm].values());try{for(i.s();!(t=i.n()).done;){var n=t.value;n.remove(),e.append(n)}}catch(r){i.e(r)}finally{i.f()}}b(this,am)[am]=e}}else b(this,am)[am]=e}},{key:"draw",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=b(e,lm)[lm]++,a=b(this,hm)[hm](),s=e._svgFactory.createElement("defs");a.append(s);var o=e._svgFactory.createElement("path");s.append(o);var l="path_p".concat(this.pageIndex,"_").concat(r);o.setAttribute("id",l),o.setAttribute("vector-effect","non-scaling-stroke"),i&&b(this,om)[om].set(r,o);var u=n?b(this,cm)[cm](s,l):null,h=e._svgFactory.createElement("use");return a.append(h),h.setAttribute("href","#".concat(l)),this.updateProperties(a,t),b(this,sm)[sm].set(r,a),{id:r,clipPathId:"url(#".concat(u,")")}}},{key:"drawOutline",value:function(t,i){var n=b(e,lm)[lm]++,r=b(this,hm)[hm](),a=e._svgFactory.createElement("defs");r.append(a);var s=e._svgFactory.createElement("path");a.append(s);var o,l="path_p".concat(this.pageIndex,"_").concat(n);if(s.setAttribute("id",l),s.setAttribute("vector-effect","non-scaling-stroke"),i){var u=e._svgFactory.createElement("mask");a.append(u),o="mask_p".concat(this.pageIndex,"_").concat(n),u.setAttribute("id",o),u.setAttribute("maskUnits","objectBoundingBox");var h=e._svgFactory.createElement("rect");u.append(h),h.setAttribute("width","1"),h.setAttribute("height","1"),h.setAttribute("fill","white");var c=e._svgFactory.createElement("use");u.append(c),c.setAttribute("href","#".concat(l)),c.setAttribute("stroke","none"),c.setAttribute("fill","black"),c.setAttribute("fill-rule","nonzero"),c.classList.add("mask")}var d=e._svgFactory.createElement("use");r.append(d),d.setAttribute("href","#".concat(l)),o&&d.setAttribute("mask","url(#".concat(o,")"));var v=d.cloneNode();return r.append(v),d.classList.add("mainOutline"),v.classList.add("secondaryOutline"),this.updateProperties(r,t),b(this,sm)[sm].set(n,r),n}},{key:"finalizeDraw",value:function(e,t){b(this,om)[om].delete(e),this.updateProperties(e,t)}},{key:"updateProperties",value:function(t,i){if(i){var n=i.root,r=i.bbox,a=i.rootClass,s=i.path,o="number"===typeof t?b(this,sm)[sm].get(t):t;if(o){if(n&&b(this,dm)[dm](o,n),r&&b(e,um)[um](o,r),a)for(var l=o.classList,u=0,h=Object.entries(a);u<h.length;u++){var d=(0,c.Z)(h[u],2),v=d[0],f=d[1];l.toggle(v,f)}if(s){var p=o.firstChild.firstChild;b(this,dm)[dm](p,s)}}}}},{key:"updateParent",value:function(e,t){if(t!==this){var i=b(this,sm)[sm].get(e);i&&(b(t,am)[am].append(i),b(this,sm)[sm].delete(e),b(t,sm)[sm].set(e,i))}}},{key:"remove",value:function(e){b(this,om)[om].delete(e),null!==b(this,am)[am]&&(b(this,sm)[sm].get(e).remove(),b(this,sm)[sm].delete(e))}},{key:"destroy",value:function(){b(this,am)[am]=null;var e,t=(0,v.Z)(b(this,sm)[sm].values());try{for(t.s();!(e=t.n()).done;){e.value.remove()}}catch(i){t.e(i)}finally{t.f()}b(this,sm)[sm].clear(),b(this,om)[om].clear()}}],[{key:"_svgFactory",get:function(){return Ee(this,"_svgFactory",new jh)}}]),e}();function fm(){var e=vm._svgFactory.create(1,1,!0);return b(this,am)[am].append(e),e.setAttribute("aria-hidden",!0),e}function pm(e,t){var i=vm._svgFactory.createElement("clipPath");e.append(i);var n="clip_".concat(t);i.setAttribute("id",n),i.setAttribute("clipPathUnits","objectBoundingBox");var r=vm._svgFactory.createElement("use");return i.append(r),r.setAttribute("href","#".concat(t)),r.classList.add("clip"),n}function gm(e,t){for(var i=0,n=Object.entries(t);i<n.length;i++){var r=(0,c.Z)(n[i],2),a=r[0],s=r[1];null===s?e.removeAttribute(a):e.setAttribute(a,s)}}Object.defineProperty(vm,um,{value:function(e,t){var i=(0,c.Z)(t,4),n=i[0],r=i[1],a=i[2],s=i[3],o=e.style;o.top="".concat(100*r,"%"),o.left="".concat(100*n,"%"),o.width="".concat(100*a,"%"),o.height="".concat(100*s,"%")}}),Object.defineProperty(vm,lm,{writable:!0,value:0}),globalThis._pdfjsTestingUtils={HighlightOutliner:Xv},globalThis.pdfjsLib={AbortException:Ie,AnnotationEditorLayer:$y,AnnotationEditorParamsType:Y,AnnotationEditorType:X,AnnotationEditorUIManager:xn,AnnotationLayer:xd,AnnotationMode:W,AnnotationType:re,build:Rh,ColorPicker:xf,createValidAbsoluteUrl:Pe,DOMSVGFactory:jh,DrawLayer:vm,FeatureTest:je,fetchData:Je,getDocument:Hu,getFilenameFromUrl:rt,getPdfFilenameFromUrl:at,getUuid:We,getXfaPageViewport:dt,GlobalWorkerOptions:gl,ImageKind:ne,InvalidPDFException:Te,isDataScheme:it,isPdfFile:nt,isValidExplicitDest:ss,MathClamp:Xe,noContextMenu:lt,normalizeUnicode:Ve,OPS:ce,OutputScale:yt,PasswordResponses:ge,PDFDataRangeTransport:Yu,PDFDateString:ct,PDFWorker:vh,PermissionFlag:K,PixelsPerInch:Qe,RenderingCancelledException:tt,ResponseException:Re,setLayerDimensions:gt,shadow:Ee,SignatureExtractor:Yg,stopEvent:ut,SupportedImageMimeTypes:mt,TextLayer:Lu,TouchManager:Er,updateUrlHash:Se,Util:He,VerbosityLevel:he,version:Th,XfaLayer:Fh}}}]);
//# sourceMappingURL=681.5a2987b4.chunk.js.map