<!DOCTYPE html>
<html  lang="<%= htmlWebpackPlugin.options.strings.lang %>"  data-dark-mode>
<head>
  <script src="https://cdn.paddle.com/paddle/v2/paddle.js"></script>
  <script>
    Paddle.Environment.set("production"); // Use "production" for live environment
    Paddle.Initialize({
      token: "live_e52f015f98dbce460791b4b9fe7"
    });
  </script>
  <script>
    // Get from query params: uid, lang, darkMode - and set them already - so we don't have flickering.
    // uid=oiu987oiuo&theme=dark&lang=he&onClose=closeModals
    const params = new URLSearchParams(window.location.search);

    const uid = params.get("uid");
    const email = params.get("email");
    const businessName = params.get("businessName");
    const theme = params.get("theme");
    const lang = params.get("lang");
    const onCloseParentCallbackName = params.get("onClose") || "closeModals";
    const isPremiumPlanAlready = params.get("isPremiumPlanAlready") === "true";

    const onClose = (isPurchase) => {
      console.log('onClose called');
      const isIframed = window.self !== window.top;
      if (isIframed) {
        parent[onCloseParentCallbackName](isPurchase);
      } else {
        // Not iframed - send the user in this tab to https://ttsreader.com/player/ by changing location href:
        window.location.href = "https://ttsreader.com/player/";
      }

    }

    console.log({ uid, theme, lang, isPremiumPlanAlready });

    if (theme==="dark") {
      document.documentElement.setAttribute("data-dark-mode", "");
    } else {
      document.documentElement.removeAttribute("data-dark-mode");
    }

    if (isPremiumPlanAlready) {
        document.documentElement.setAttribute("data-premium-plan", "true");
        } else {
        document.documentElement.removeAttribute("data-premium-plan");
    }

    if (lang==="ar" || lang==="he" || lang==="fa") {
      document.documentElement.setAttribute("dir", "rtl");
    } else {
      document.documentElement.removeAttribute("dir");
    }
  </script>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>TTSReader Purchase Page</title> <!-- TODO: use strings.newUpgradeModal_title... -->
  <!-- TODO: consider &currency=USD as in https://developer.paypal.com/reference/currency-codes/ with a currency selector. -->

  <script>
    // Helper: map timezone ‚Üí country code (ISO 3166-1 alpha-2)
    function getCountryCodeFromTz() {
      const tz = Intl.DateTimeFormat().resolvedOptions().timeZone;

      const tzToCountry = {
        // United States
        "America/New_York": "US",
        "America/Detroit": "US",
        "America/Chicago": "US",
        "America/Denver": "US",
        "America/Los_Angeles": "US",
        "America/Phoenix": "US",
        "America/Anchorage": "US",
        "Pacific/Honolulu": "US",

        // United Kingdom
        "Europe/London": "GB",

        // Canada
        "America/Toronto": "CA",
        "America/Vancouver": "CA",
        "America/Edmonton": "CA",
        "America/Halifax": "CA",
        "America/St_Johns": "CA",

        // Australia
        "Australia/Sydney": "AU",
        "Australia/Melbourne": "AU",
        "Australia/Brisbane": "AU",
        "Australia/Perth": "AU",
        "Australia/Adelaide": "AU",

        // Mexico
        "America/Mexico_City": "MX",
        "America/Cancun": "MX",
        "America/Tijuana": "MX",

        // Spain
        "Europe/Madrid": "ES",
        "Atlantic/Canary": "ES",

        // Ireland
        "Europe/Dublin": "IE",

        // Argentina
        "America/Argentina/Buenos_Aires": "AR",
        "America/Argentina/Cordoba": "AR",
        "America/Argentina/Mendoza": "AR",

        // Portugal
        "Europe/Lisbon": "PT",
        "Atlantic/Madeira": "PT",
        "Atlantic/Azores": "PT",

        // France
        "Europe/Paris": "FR",

        // Germany
        "Europe/Berlin": "DE",

        // Italy
        "Europe/Rome": "IT",

        // Netherlands
        "Europe/Amsterdam": "NL",

        // Brazil
        "America/Sao_Paulo": "BR",

        // Israel
        "Asia/Jerusalem": "IL",

        // Romania
        "Europe/Bucharest": "RO",

        // Russia
        "Europe/Moscow": "RU",

        // China
        "Asia/Shanghai": "CN",
        "Asia/Chongqing": "CN",
        "Asia/Harbin": "CN",

        // Japan
        "Asia/Tokyo": "JP",

        // Korea
        "Asia/Seoul": "KR",

        // India
        "Asia/Kolkata": "IN",

        // UAE, Jordan, Egypt (for Arabic)
        "Asia/Dubai": "AE",
        "Asia/Amman": "JO",
        "Africa/Cairo": "EG",
      };

      return tzToCountry[tz] || "";
    }

    // --------------------------------------------------------------------

    const language = "<%= htmlWebpackPlugin.options.strings.lang %>";

    // Taken from: https://developer.paypal.com/reference/locale-codes/
    // When adding new locales, always test before production, as documentation is not always up to date.
    const allowedLocales = new Set([
      "ar-AE", "ar-JO", "ar-EG", "en-IE",
      "de-DE", "en-US", "es-ES", "fr-FR", "en-IN",
      "ko-KR", "pt-PT", "ro-RO", "ru-RU", "zh-CN",
      "en-CN", "en-RO", "en-RU", "he-IL", "it-IT",
      "nl-NL", "ja-JP", "en-JP", "de-CH", "en-DE",
      "en-GB", "en-AU", "en-CA", "en-IL", "en-PT",
      "en-FR", "en-ES", "en-AR", "en-BR", "en-NL",
      "fr-US", "fr-CA", "es-US", "es-AR", "es-CL",
      "zh-US", "pt-BR"
    ]);

    function getPayPalLocale(language) {
      const countryCode = getCountryCodeFromTz();
      const langCountry = `${language}-${countryCode}`;

      if (allowedLocales.has(langCountry)) {
        return `${language}_${countryCode}`;
      }

      return null;
    }

    // --------------------------------------------------------------------
    const locale = getPayPalLocale(language);
    console.log("Detected PayPal locale:", locale);

    const PAYPAL_CLIENT_ID = "AUZU9gCiVB9cPTl9r8lUGSUvD-dn8dSsmYzxysRH2Ec4Dv6fpq2g4gK7nZYYrltIFnyAMMS7F5IfN0LG";
    let localeQuery = locale ? `&locale=${locale}` : "";

    let scriptElSubs = document.createElement("script");
    scriptElSubs.setAttribute("data-namespace", "paypalSubs");
    scriptElSubs.src = `https://www.paypal.com/sdk/js?client-id=${PAYPAL_CLIENT_ID}&vault=true&intent=subscription${localeQuery}`;
    scriptElSubs.onload = () => {
      runOnPayPalReady();
    };

    let scriptElOnce = document.createElement("script");
    scriptElOnce.setAttribute("data-namespace", "paypalOnce");
    scriptElOnce.src = `https://www.paypal.com/sdk/js?client-id=${PAYPAL_CLIENT_ID}${localeQuery}`;
    scriptElOnce.onload = () => {
      runOnPayPalReady();
    };

    window.addEventListener("load", function () {
      document.head.appendChild(scriptElSubs);
      document.head.appendChild(scriptElOnce);

        /*
          // Iterate over all allowedLocales and log them and inject the paypal sdk script for each locale (for testing purposes)
          allowedLocales.forEach(loc => {
            console.log("Injecting PayPal SDK for locale:", loc);
            let scriptElTest = document.createElement("script");
            scriptElTest.setAttribute("data-namespace", `paypalTest_${loc.replace('-','_')}`);
            // Remove async and defer explicitly (in case the browser sets them by default)
            scriptElTest.async = false;
            scriptElTest.defer = false;
            scriptElTest.src = `https://www.paypal.com/sdk/js?client-id=${PAYPAL_CLIENT_ID}&locale=${loc.replace('-','_')}`;

            document.head.appendChild(scriptElTest);
        });*/
    });
  </script>

  <script>
    const _200k = 2*Math.pow(10,5);
    const _1M = Math.pow(10,6);
    const _500k = 5*Math.pow(10,5);
    const _2p5M = 2.5*_1M;

    const SKUS = {
      FREE_LIFE_LIMIT_CHARS: 5000, // 5k chars free life limit
      SKU_TTSREADER_PREMIUM_MONTHLY: {
        name: "TTSReader Premium Monthly",
        type: "PREMIUM",
        level: 1,
        isAutoRenew: true,
        durationType: "m",
        quotaCharsD: _200k,
        quotaCharsM: _1M,
        paddlePriceId: "pri_01ke6jck25vm0hc1p0ya0wf6sx",
      },
      SKU_TTSREADER_PREMIUM_ANNUAL: {
        name: "TTSReader Premium Annual",
        type: "PREMIUM",
        level: 1,
        isAutoRenew: true,
        durationType: "y",
        quotaCharsD: _200k,
        quotaCharsM: _1M,
        paddlePriceId: "pri_01ke6k5fqsfrn3k6xcvt1zb57s",
      },

      SKU_TTSREADER_EXTRA_CREDITS_1M: {
        name: "TTSReader 1M Extra Credits",
        type: "EXTRA_CREDITS",
        isAutoRenew: false,
        durationType: "y_extendable",
        creditsAmount: _1M,
        paddlePriceId: "pri_01kabacg9281qsv502zexm1805",
      },
      SKU_TTSREADER_EXTRA_CREDITS_3M: {
        name: "TTSReader 3M Extra Credits",
        type: "EXTRA_CREDITS",
        isAutoRenew: false,
        durationType: "y_extendable",
        creditsAmount: 3*_1M,
        paddlePriceId: "pri_01k8469wr0t4c9d4rthhsbz7s4",
      },
      SKU_TTSREADER_EXTRA_CREDITS_10M: {
        name: "TTSReader 10M Extra Credits",
        type: "EXTRA_CREDITS",
        isAutoRenew: false,
        durationType: "y_extendable",
        creditsAmount: 10*_1M,
        paddlePriceId: "pri_01ke6hmr6pdwykmrmkrht7qy28",
      },
    }

  </script>
  <style>
    html {
      height: 100%;
      width: 100%;
    }
    * {
      box-sizing: border-box;
    }
    body {
      height: 100%;
      overflow: hidden;
      font-family: 'Inter','Segoe UI',sans-serif;
      margin: 0;
      background:linear-gradient(180deg,#fff 0%,#aac 100%);
      color:#333;
      /* background: white /*url(./images/anima2_transparent_white.webp) no-repeat center*/;
      /*background-size: cover;*/
    }

    /*html[data-dark-mode] {
      color: white;
      stroke: white;
      background: url(https://ttsreader.com/img/bg1.jpg) repeat;
    }*/

    [data-dark-mode] body {
      color: white;
      stroke: white;
      background: linear-gradient(180deg,#55555588 0%,#aaaacc88 100%);
    }

    [data-premium-plan] .Hide-If-Premium-Plan-Exists {
      display: none;
    }

    [data-premium-plan] .Show-If-Premium-Plan-Exists {
      display: block;
    }

    .modal-header {
      padding: 15px 20px;
      padding-top: 23px;
      font-size: 1.6em;
      border-bottom: 1px solid #eee;
      flex: 0 0 auto;
      text-align: center; /* ‚úÖ Title centered */
    }

    .modal-content {
      flex: 1 1 auto;
      padding: 15px 20px;
      overflow-y: auto;
      display: flex;               /* ‚úÖ Enables easy centering */
      flex-direction: column;      /* ‚úÖ Stack vertically */
      text-align: center;          /* ‚úÖ Center text inside content */
    }

    .modal-footer {
      background-color: #ffffff55;
      padding: 15px 20px;
      border-top: 1px solid #eee;
      text-align: center; /* ‚úÖ Buttons centered horizontally */
      flex: 0 0 auto;
    }

    [data-dark-mode] .modal-footer {
      background-color: #00000022;
    }

    .wideModal button {
      padding: 10px 20px; margin: 5px; font-size: 1em;
      cursor: pointer; border: none; border-radius: 5px;
    }

    .wideModal button.primary { background: #3b82f6; color: #fff; }
    .wideModal button.secondary { background: #ddd; color: #000; }

    .Gallery-Container {
      border-radius: 20px;
      padding: 16px;
      background-color: #e2e2e2aa;
      max-width: 600px;
      margin: auto;
    }

    [data-dark-mode] .Gallery-Container {
      background-color: #000000aa;
    }

    .wideModal .voice-tile.selected .checkmark {
      display: block;
    }

    .wideModal .voice-tile button {
      margin-top: 10px;              /* Optional spacing */
    }

    /* Upgrade modal styles */

    .Gallery-Container > h3 {
      margin: 5px auto;
    }

    .pricing-card, .pricing-card-clone  {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: white;
      border-radius: 20px;
      padding: 20px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      flex-wrap: wrap;
      cursor: pointer;
      border: 2px solid transparent;
      transition: transform 0.5s ease, border-color 0.3s;
      position: relative;
      margin-top: 15px;
    }

    .pricing-card-clone {
      box-shadow: none;
      cursor: unset;
      margin-top: 0;
    }

    .pricing-card:hover {
      border-color: orangered;
      box-shadow: yellow 0 0 10px;
      transition: box-shadow 0.3s ease, border-color 0.3s ease;
    }

    .pricing-left {
      color: black;
      display: flex;
      flex-direction: column;
      flex: 1;
      text-align: start;
    }

    .pricing-time {
      font-weight: 700;
      font-size: 1.5em;
      margin-bottom: 5px;
    }

    .pricing-subtext {
      font-size: 0.95em;
      color: #444;
    }

    .pricing-price {
      padding: 12px 22px;
      border-radius: 16px;
      font-weight: bold;
      font-size: 1.1em;
      white-space: nowrap;
      text-align: center;
    }

    .pricing-price.dark {
      background: #25172a;
      color: white;
    }

    .pricing-price.popular {
      background: linear-gradient(135deg, #ff7a18, #fbb034);
      color: white;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .pricing-price .pricing-tag {
      font-size: 0.7em;
      font-weight: bold;
      color: #ffe9e1;
      margin-bottom: 4px;
    }

    .pricing-details {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.5s ease, padding 0.3s ease;
      padding: 0;
    }

    .pricing-card.active .pricing-details {
      max-height: 200px;
      padding: 15px 10px 0;
    }


    .wideModal {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: white;
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }
    .modal-step {
      width: 100%;
      height: 100%;
      text-align: center;
      display: flex;
      flex-direction: column;
      position: relative;
      margin: auto;
    }
    .modal-content {
      transition: filter 0.3s ease;
    }

    .modal-content.blurred {
      filter: blur(5px);
    }

    .Gallery-Container {
      display: flex;
      flex-direction: column;
    }

    .pricing-card.selected {
      border-color: #007BFF;
      z-index: 10;
    }
    .pricing-left {
      flex: 1;
    }
    .pricing-price {
      font-size: 1.2em;
    }
    .paypal-container {
      position: absolute;
      top: 50%; left: 50%;
      transform: translate(-50%, -50%) scale(0);
      opacity: 0;
      transition: all 0.4s ease;
      text-align: center;
    }
    .paypal-container.show {
      transform: translate(-50%, -50%) scale(1);
      opacity: 1;
    }
    .modal-header {
      height: 80px;
      margin-bottom: 20px;
      position: relative;
    }
    .modal-header .cloned-card {
      position: absolute;
      top: 0; left: 0;
      width: 100%;
      transition: all 0.5s ease;
    }
    #backBtn {
      position: absolute;
      top: 10px;
      right: 10px;
      padding: 5px 10px;
      cursor: pointer;
      background: #eee;
      border: 1px solid #aaa;
      border-radius: 4px;
    }
    .modal-step[data-ws-sku] {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: #ffffff99;
      z-index: 10;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      pointer-events: none;
    }
    .modal-step[data-ws-sku]:not(.hidden) {
      pointer-events: auto;
      display: flex;
    }
    .hidden {
      opacity: 0;
      visibility: hidden;
      pointer-events: none;
    }
    [data-ws-sku] .modal-content {
      width: 100%;
      max-width: 700px;
    }

    [data-ws-sku] card {
      position: relative;
      box-shadow: 0 0 10px rgba(0, 0, 0, .1);
      padding: 20px;
      color: black;
      background-color: #fff;
      border-radius: 20px;
    }

    .Close-Btn {
      z-index: 9;
      box-sizing: content-box;
      position: absolute;
      top: 10px;
      right: 10px;
      width: 29px;
      height: 30px;
      padding: 5px;
      cursor: pointer;
    }
  </style>
</head>

<body>

<div data-ws-step="0" class="modal-step">
  <div class="modal-content">
    <!--<p><%= htmlWebpackPlugin.options.strings.newUpgradeModal_selectPreferredPackage %> <a title="<%= htmlWebpackPlugin.options.strings.newUpgradeModal_additionalDetailsAboutPlans %>" style="cursor: pointer; text-decoration: none;color: orangered" href="https://ttsreader.com/docs/support/pricing/" target="_blank"><svg style="position: relative;top: 3px;height: 1em;" xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="icon icon-tabler icons-tabler-outline icon-tabler-info-circle"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M3 12a9 9 0 1 0 18 0a9 9 0 0 0 -18 0" /><path d="M12 9h.01" /><path d="M11 12h1v4h1" /></svg></a>
      <br/><%= htmlWebpackPlugin.options.strings.newUpgradeModal_allPlansUnlockFeatures %>
      <br/><%= htmlWebpackPlugin.options.strings.newUpgradeModal_committedToAffordableSolutions %>
      <br/><%= htmlWebpackPlugin.options.strings.newUpgradeModal_mostConvenientPlans %>
      <br/><br/><%= htmlWebpackPlugin.options.strings.newUpgradeModal_poweredByPaypal %>
    </p>-->

    <br/>
    <h2><%= htmlWebpackPlugin.options.strings.d20251109_upgrade_iframe_title %><!-- Choose Subscription OR One-Time-Payment --></h2>
    <h3><%= htmlWebpackPlugin.options.strings.d20251109_upgrade_iframe_subtitle %><!-- All plans include --></h3>
    <p style="font-size: 1.1em;font-weight: normal; padding: 10px 20px;max-width: 900px;margin: 0 auto 50px;"><%= htmlWebpackPlugin.options.strings.d20251109_upgrade_iframe_features_list %><!-- ‚úÖ Premium AI Voices (1M characters/mo. per subscription, or as many as you buy per credits) ‚úÖ Commercial & Publishing License ‚úÖ 100% Copyrights Ownership ‚úÖ Premium Support ‚úÖ Personal Podcast Channel ‚úÖ Instant MP3 & WAV Export ‚úÖ & More--></p>

    <div class="" style="max-width: 1000px; margin: auto;margin-top: -15px;">
      <div class="Hide-If-Premium-Plan-Exists">
        <div class="Gallery-Container">
          <h3 style="font-size: 1.5em;"><%= htmlWebpackPlugin.options.strings.d20251109_upgrade_iframe_subscription_title %><!-- Subscription--></h3>
          <!--<p><%= htmlWebpackPlugin.options.strings.newUpgradeModal_cancelAnyTime %></p>-->
          <p style="margin: 5px;"><%= htmlWebpackPlugin.options.strings.newUpgradeModal_unlimitedBasicVoices %></p>
          <div class="pricing-card" data-ws-sku="SKU_TTSREADER_PREMIUM_MONTHLY">
            <div class="pricing-left">
              <div class="pricing-time"><%= htmlWebpackPlugin.options.strings.newUpgradeModal_billedMonthly %></div>
              <div class="pricing-subtext"></div>
            </div>
            <div class="pricing-price dark">$10.99 / <%= htmlWebpackPlugin.options.strings.d20251109_month_short %><!-- mo.--></div>
          </div>

          <div class="pricing-card" data-ws-sku="SKU_TTSREADER_PREMIUM_ANNUAL">
            <div class="pricing-left">
              <div class="pricing-time"><%= htmlWebpackPlugin.options.strings.newUpgradeModal_billedAnnually %></div>
              <div class="pricing-subtext"><span style="text-decoration: line-through;opacity:0.5">$131.88</span> -> $99/<%= htmlWebpackPlugin.options.strings.d20251109_year_short %><!-- y --><%= htmlWebpackPlugin.options.strings.d20251109_upgrade_iframe_25_discount %><!-- (25% Discount)--></div>
            </div>
            <div class="pricing-price popular">
              <span class="pricing-tag"><%= htmlWebpackPlugin.options.strings.newUpgradeModal_bestValue %></span>
              $8.25 / <%= htmlWebpackPlugin.options.strings.d20251109_month_short %>
            </div>
          </div>
        </div>
        <br/>
      </div>

      <div style="height: 30px;"></div>
      <!--<h2><%= htmlWebpackPlugin.options.strings.newUpgradeModal_payAsYouGo %></h2>
      <p><%= htmlWebpackPlugin.options.strings.newUpgradeModal_validForOneYear %></p>-->
      <div class="Gallery-Container">
        <h3 style="font-size: 1.5em;"><%= htmlWebpackPlugin.options.strings.d20251109_upgrade_iframe_credits_title %><!-- One-Time Payment Packages--></h3>
        <p style="margin: 5px;"><%= htmlWebpackPlugin.options.strings.d20251109_upgrade_iframe_credits_subtitle %><!-- Does NOT auto renew. Buy credits to use whenever you want within one year (which can also be further extended). --></p>
        <!--<div class="pricing-card" data-ws-sku="SKU_TTSREADER_EXTRA_CREDITS_200k">
          <div class="pricing-left">
            <div class="pricing-time"><%= htmlWebpackPlugin.options.strings.newUpgradeModal_200kChars %></div>
            <div class="pricing-subtext"><%= htmlWebpackPlugin.options.strings.newUpgradeModal_ofPremiumAIVoices %></div>
          </div>
          <div class="pricing-price dark">$10</div>
        </div>-->

        <div class="pricing-card" data-ws-sku="SKU_TTSREADER_EXTRA_CREDITS_1M">
          <div class="pricing-left">
            <div class="pricing-time"><%= htmlWebpackPlugin.options.strings.d20251109_upgrade_iframe_1M_package %><!-- 1 Million Premium Characters--></div>
            <div class="pricing-subtext">+&nbsp;<%= htmlWebpackPlugin.options.strings.d20251109_upgrade_iframe_unlimited_basic_voices %><!--Unlimited basic voices--></div>
          </div>
          <div class="pricing-price dark">$19</div>
        </div>

        <div class="pricing-card" data-ws-sku="SKU_TTSREADER_EXTRA_CREDITS_3M">
          <div class="pricing-left">
            <div class="pricing-time"><%= htmlWebpackPlugin.options.strings.d20251109_upgrade_iframe_3M_package %><!-- 3 Million Premium Characters--></div>
            <div class="pricing-subtext">+&nbsp;<%= htmlWebpackPlugin.options.strings.d20251109_upgrade_iframe_unlimited_basic_voices %><!--Unlimited basic voices--></div>
          </div>
          <div class="pricing-price dark">$39</div>
        </div>

        <div class="pricing-card" data-ws-sku="SKU_TTSREADER_EXTRA_CREDITS_10M">
          <div class="pricing-left">
            <div class="pricing-time"><%= htmlWebpackPlugin.options.strings.d20251109_upgrade_iframe_10M_package %><!-- 10 Million Premium Characters--></div>
            <div class="pricing-subtext">+&nbsp;<%= htmlWebpackPlugin.options.strings.d20251109_upgrade_iframe_unlimited_basic_voices %><!--Unlimited basic voices--></div>
          </div>
          <div class="pricing-price dark">$99</div>
        </div>
      </div>
      <p><%= htmlWebpackPlugin.options.strings.newUpgradeModal_allCurrenciesInUSD %></p>

      <br/>
      <h2><%= htmlWebpackPlugin.options.strings.d20251109_upgrade_iframe_trusted_by_millions %><!-- Trusted by leading businesses, top colleges & millions of users, since 2015--></h2>
      <div style="margin-top: -30px;">
        <div style="position: relative; width: 100%; max-width: 700px; margin: 50px auto; text-align: center; font-family: 'Georgia', serif;">

          <!-- Placeholder for height (the longest slide) -->
          <div style="opacity: 0; pointer-events: none; visibility: hidden;">
            <p style="font-size: 1.2rem; color: #333; background: #f9f9f9; border-left: 4px solid #6c63ff; padding: 20px; border-radius: 8px; margin: 0 auto; max-width: 600px;">
              <em>‚ÄúWhat impressed me most was how their support team responded... That kind of respect was almost unimaginable.‚Äù</em>
              <br>
              <span style="display: block; text-align: right; margin-top: 10px; font-weight: bold; color: #555;">
        ‚Äî Ana R., 2025
      </span>
            </p>
          </div>

          <!-- Slides -->
          <div class="slide" style="opacity: 1; transition: opacity 1s ease-in-out; position: absolute; width: 100%; top: 0; left: 0;">
            <p style="font-size: 1.2rem; color: #333; background: #f9f9f9; border-left: 4px solid #6c63ff; padding: 20px; border-radius: 8px; margin: 0 auto; max-width: 600px;">
              <em>‚Äú<%= htmlWebpackPlugin.options.strings.d20251109_upgrade_testimonial_kathleen %><!-- I‚Äôve been using TTSReader for several months, and I already can‚Äôt imagine my life without it!-->‚Äù</em>
              <br>
              <span style="display: block; text-align: right; margin-top: 10px; font-weight: bold; color: #555;">
        ‚Äî KathleenP, USA, 2025
      </span>
            </p>
          </div>

          <div class="slide" style="opacity: 0; transition: opacity 1s ease-in-out; position: absolute; width: 100%; top: 0; left: 0;">
            <p style="font-size: 1.2rem; color: #333; background: #f9f9f9; border-left: 4px solid #6c63ff; padding: 20px; border-radius: 8px; margin: 0 auto; max-width: 600px;">
              <em>‚Äú<%= htmlWebpackPlugin.options.strings.d20251109_upgrade_testimonial_sourabhi %><!-- What impressed me most was how their support team responded... That kind of respect was almost unimaginable.-->‚Äù</em>
              <br>
              <span style="display: block; text-align: right; margin-top: 10px; font-weight: bold; color: #555;">
        ‚Äî Sourabhi, Christian Blogger, 2025
      </span>
            </p>
          </div>

          <div class="slide" style="opacity: 0; transition: opacity 1s ease-in-out; position: absolute; width: 100%; top: 0; left: 0;">
            <p style="font-size: 1.2rem; color: #333; background: #f9f9f9; border-left: 4px solid #6c63ff; padding: 20px; border-radius: 8px; margin: 0 auto; max-width: 600px;">
              <em>‚Äú<%= htmlWebpackPlugin.options.strings.d20251109_upgrade_testimonial_delora %><!-- I've used this app for so many years that I've lost track of how long it's been. I love this app!-->‚Äù</em>
              <br>
              <span style="display: block; text-align: right; margin-top: 10px; font-weight: bold; color: #555;">
        ‚Äî DeLora Lambert, 2024
      </span>
            </p>
          </div>
        </div>
        <script>
          const slides = document.querySelectorAll('.slide');
          let index = 0;

          setInterval(() => {
            slides[index].style.opacity = 0;           // fade out current
            index = (index + 1) % slides.length;       // move forward (always)
            slides[index].style.opacity = 1;           // fade in next
          }, 4000); // every 4 seconds
        </script>
      </div>

      <br/>
      <section style="max-width:900px;margin:24px auto;padding:24px;border:1px solid #e6e6e6;border-radius:12px;box-shadow:0 6px 18px rgba(0,0,0,0.06);font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;color:#1f2937;background:#ffffff;">
        <h2 style="margin:0 0 16px 0;font-size:28px;line-height:1.25;font-weight:700;color:#111827;text-align:center;">
          <%= htmlWebpackPlugin.options.strings.d20251109_upgrade_iframe_guarantee_title %><!-- Personal Guarantee by our Founder-->
        </h2>

        <div style="display:flex;flex-wrap:wrap;align-items:center;gap:24px;">
          <!-- LEFT: Headshot -->
          <div style="flex:1 1 260px;display:flex;justify-content:center;">
            <img src="ronen_headshot_400px.png"
                 alt="Founder headshot"
                 style="width:260px;height:260px;object-fit:contain;border-radius:50%;border:4px solid #f3f4f6;box-shadow:0 8px 20px rgba(0,0,0,0.08);" />
          </div>

          <!-- RIGHT: Message + Signature -->
          <div style="flex:2 1 360px;">
            <p style="margin:0 0 10px 0;font-size:16px;line-height:1.6;color:#374151;">
              <%= htmlWebpackPlugin.options.strings.d20251109_upgrade_guarantee_part1 %><!-- Upon upgrade, I will send you a personal email, to which you may reply directly - and I will respond personally.-->
            </p>
            <p style="margin:0 0 10px 0;font-size:16px;line-height:1.6;color:#374151;">
              <%= htmlWebpackPlugin.options.strings.d20251109_upgrade_guarantee_part2 %><!-- Your trust and support are much appreciated and I am personally committed to your satisfaction. ‚Äî<strong>Full refund</strong> in the unlikely case that you regret your purchase for any reason.<br/><br/>Thank you!-->
            </p>

            <!-- Signature -->
            <div style="margin-top:18px;">
              <!-- Optional name/title under signature -->
              <div style="margin-top:6px;color:#6b7280;font-size: 1.2em;">Ronen Rabinovici, Founder</div>
            </div>
          </div>
        </div>
      </section>

      <p><%= htmlWebpackPlugin.options.strings.newUpgradeModal_forHelpContactUs %></p>
    </div>
    <div style="flex:2"></div>

  </div>
</div>

<div class="closeIframeButton Close-Btn" onclick="onClose()" >
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-xbox-x" style="
    height: 35px;
"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M12 21a9 9 0 0 0 9 -9a9 9 0 0 0 -9 -9a9 9 0 0 0 -9 9a9 9 0 0 0 9 9z"></path><path d="M9 8l6 8"></path><path d="M15 8l-6 8"></path></svg>
</div>

<template id="skuStepTemplate">
  <div data-ws-sku="SKU_TTSREADER_EXTRA_CREDITS_10M" class="modal-step hidden">
    <div class="modal-content">
      <div style="flex:1"></div>
      <card>
        <div class="backBtn Close-Btn" >
          <svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="3"  stroke-linecap="round"  stroke-linejoin="round"  class="icon icon-tabler icons-tabler-outline icon-tabler-chevron-left"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M15 6l-6 6l6 6" /></svg>
        </div>
        <br/>
        <div class="pricing-card-clone"></div>
        <p style="text-transform: uppercase"><%= htmlWebpackPlugin.options.strings.newUpgradeModal_poweredByPaypalAllMethods %></p>
        <div class="Paypal-Button-Container"></div>
        <p><strong><%= htmlWebpackPlugin.options.strings.newUpgradeModal_satisfactionGuaranteed %></strong></p>
        <p><%= htmlWebpackPlugin.options.strings.newUpgradeModal_byWellSource %></p>
        <p>Unable to pay? Let us know at contact@ttsreader.com</p>
      </card>
      <div style="flex:1"></div>
    </div>
  </div>
</template>

<script>
  "use strict";

  function delayAcknowledgeAlertAsync() {
    // Acknowledge alert after a delay to ensure the UI is responsive
    setTimeout(() => {
      alert('<%= htmlWebpackPlugin.options.strings.main__thank_you_order_received %>');
      onClose(true); // Close the modal after acknowledging
    }, 100);
  }

  function renderPayPalButton(uid, sku, container) {

    let style = {
      shape: 'pill',
      color: 'gold',
      layout: 'vertical',
      label: 'paypal',
      height: 50             // üîº Default is ~35 ‚Äî make this 45‚Äì55 for a larger button
    };

    let onApproveSub = function (data, actions) {
      console.log('subscriptionID: ' + data?.subscriptionID); // You can add optional success message for the subscriber here
      delayAcknowledgeAlertAsync();
      return Promise.resolve();
      // onSubscriptionComplete(data.subscriptionID, uid);
    };

    let onApproveOnce = function (data, actions) {
      return actions.order.capture().then(function (details) {
        delayAcknowledgeAlertAsync();
      });
    };

    let onCancel = function (data) {
      console.log('Payment cancelled:', data);
      // Optionally, you can add a message to the user here
      alert('<%= htmlWebpackPlugin.options.strings.main__payment_cancelled %>');
    };

    const custom_id = sku + "__" + uid;

    let config = {
      style, onCancel
    }

    let paypalScope;

    if (sku === "SKU_TTSREADER_PREMIUM_MONTHLY") {
      paypalScope = paypalSubs;
      config.onApprove = onApproveSub;
      config.createSubscription = function (data, actions) {
        return actions.subscription.create({
          /* Creates the subscription */
          plan_id: 'P-82C30553N8925890NMZZWUTA',
          custom_id
        });
      }
    } else if (sku === "SKU_TTSREADER_PREMIUM_PLUS_MONTHLY") {
      paypalScope = paypalSubs;
      config.onApprove = onApproveSub;
      config.createSubscription = function (data, actions) {
        return actions.subscription.create({
          /* Creates the subscription */
          plan_id: 'P-01654138F1540764BNCKMCSI',
          custom_id
        });
      }
    } else if (sku === "SKU_TTSREADER_PREMIUM_ANNUAL") {
      paypalScope = paypalSubs;
      config.onApprove = onApproveSub;
      config.createSubscription = function(data, actions) {
        return actions.subscription.create({
          /* Creates the subscription */
          plan_id: 'P-72R93922LT130451PNBJ7OCI',
          custom_id
        });
      }
    } else {
      paypalScope = paypalOnce; // For one-time purchases
      config.onApprove = onApproveOnce;
      // Default is the minimum 200k:
      let price = 10; // In USD
      let credits = "200k"; // As human string

      // For more:
      if (sku === "SKU_TTSREADER_EXTRA_CREDITS_1M") {
        price = 19; // In USD
        credits = "1 Million"; // As human string
      } else if (sku === "SKU_TTSREADER_EXTRA_CREDITS_3M") {
        price = 39; // In USD
        credits = "3 Million"; // As human string
      } else if (sku === "SKU_TTSREADER_EXTRA_CREDITS_10M") {
        price = 99; // In USD
        credits = "10 Million"; // As human string
      }

      let description = "TTSReader " + credits + " Extra Credits, UID: " + uid;
      config.createOrder = function (data, actions) {
        return actions.order.create({
          purchase_units: [{
            description,
            custom_id,
            amount: {
              value: price
            }
          }]
        });
      }
    }

    paypalScope.Buttons(config).render(container); // Renders the PayPal button UI
  }

  const template = document.getElementById('skuStepTemplate');
  let wasPayPalReady = false;
  let attempts = 0;

  function runOnPayPalReady() {
    if (!window.paypalSubs || !window.paypalOnce) {
      console.log("PayPal SDK not yet loaded");
      if (attempts++ > 200) {
        alert('Failed to load payment processor. Please make sure connection is good and refresh the page.');
      } else {
        setTimeout(() => runOnPayPalReady(), 200);
      }
      return;
    }

    if (wasPayPalReady) return; // Prevent multiple runs

    wasPayPalReady = true;
    console.log("PayPal SDK loaded on attempt " + attempts);
    document.querySelectorAll('.pricing-card[data-ws-sku]').forEach(card => {
      const sku = card.getAttribute('data-ws-sku');
      const clone = template.content.cloneNode(true);
      const modalStep = clone.querySelector('.modal-step');

      // Update the sku ID
      modalStep.setAttribute('data-ws-sku', sku);

      // Replace pricing-card-clone content
      const cardClone = modalStep.querySelector('.pricing-card-clone');
      cardClone.innerHTML = card.innerHTML;

      // Append to body
      document.body.appendChild(modalStep);
      //
      let paypalContainer = modalStep.querySelector('.Paypal-Button-Container');
      renderPayPalButton(uid, sku, paypalContainer);
    });

    const baseStep = document.querySelector('[data-ws-step="0"]');
    document.querySelectorAll('.pricing-card[data-ws-sku]').forEach(card => {
      card.addEventListener('click', () => {
        const sku = card.dataset.wsSku;
        openPaddleCheckout(sku);
      });
    });

    function openPaddleCheckout(sku) {
      let itemsList = [
        {
          priceId: SKUS[sku].paddlePriceId,
          quantity: 1
        }
      ];

      let customerData = {
        email,
        business: {
          name: businessName,
        }}

      let custom_data = {
        uid
      };

      Paddle.Checkout.open({
        items: itemsList,
        customer: customerData,
        customData:custom_data,
      });
    }

    function closeSkuStep(skuStepElement) {
      skuStepElement.style.transition = 'opacity 0.4s ease';
      skuStepElement.style.opacity = 0;
      setTimeout(() => {
        skuStepElement.classList.add('hidden');
        baseStep.style.filter = 'none';
      }, 400);
      document.querySelector('.closeIframeButton').classList.remove('hidden');
    }

    document.querySelectorAll('.modal-step[data-ws-sku] .backBtn').forEach(button => {
      button.addEventListener('click', () => {
        const skuStep = button.closest('.modal-step');
        closeSkuStep(skuStep);
      });
    });

    document.querySelectorAll('.modal-step[data-ws-sku]').forEach(modalStep => {
      modalStep.addEventListener('click', function (ev) {
        const card = modalStep.querySelector('card');
        if (!card) return;

        if (!card.contains(ev.target)) {
          onClickOutsideCard(ev, modalStep);
        }
      });
    });

    function onClickOutsideCard(ev, modalStep) {
      console.log('Clicked outside <card> in:', modalStep.getAttribute('data-ws-sku'));
      // Your logic here
      closeSkuStep(modalStep);
    }
  }

</script>
</body>
</html>